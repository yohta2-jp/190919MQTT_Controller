!function(a){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=a();else if("function"==typeof define&&define.amd)define([],a);else{var b;b="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,b.Application=a()}}(function(){var b;return function a(b,c,d){function e(g,h){if(!c[g]){if(!b[g]){var i="function"==typeof require&&require;if(!h&&i)return i(g,!0);if(f)return f(g,!0);var j=new Error("Cannot find module '"+g+"'");throw j.code="MODULE_NOT_FOUND",j}var k=c[g]={exports:{}};b[g][0].call(k.exports,function(a){var c=b[g][1][a];return e(c||a)},k,k.exports,a,b,c,d)}return c[g].exports}for(var f="function"==typeof require&&require,g=0;g<d.length;g++)e(d[g]);return e}({1:[function(a,b,c){!function(a){"use strict";function b(a){var b=a.charCodeAt(0);return b===f||b===k?62:b===g||b===l?63:b<h?-1:b<h+10?b-h+26+26:b<j+26?b-j:b<i+26?b-i+26:void 0}function c(a){function c(a){j[l++]=a}var d,f,g,h,i,j;if(a.length%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var k=a.length;i="="===a.charAt(k-2)?2:"="===a.charAt(k-1)?1:0,j=new e(3*a.length/4-i),g=i>0?a.length-4:a.length;var l=0;for(d=0,f=0;d<g;d+=4,f+=3)h=b(a.charAt(d))<<18|b(a.charAt(d+1))<<12|b(a.charAt(d+2))<<6|b(a.charAt(d+3)),c((16711680&h)>>16),c((65280&h)>>8),c(255&h);return 2===i?(h=b(a.charAt(d))<<2|b(a.charAt(d+1))>>4,c(255&h)):1===i&&(h=b(a.charAt(d))<<10|b(a.charAt(d+1))<<4|b(a.charAt(d+2))>>2,c(h>>8&255),c(255&h)),j}function d(a){function b(a){return"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(a)}function c(a){return b(a>>18&63)+b(a>>12&63)+b(a>>6&63)+b(63&a)}var d,e,f,g=a.length%3,h="";for(d=0,f=a.length-g;d<f;d+=3)e=(a[d]<<16)+(a[d+1]<<8)+a[d+2],h+=c(e);switch(g){case 1:e=a[a.length-1],h+=b(e>>2),h+=b(e<<4&63),h+="==";break;case 2:e=(a[a.length-2]<<8)+a[a.length-1],h+=b(e>>10),h+=b(e>>4&63),h+=b(e<<2&63),h+="="}return h}var e="undefined"!=typeof Uint8Array?Uint8Array:Array,f="+".charCodeAt(0),g="/".charCodeAt(0),h="0".charCodeAt(0),i="a".charCodeAt(0),j="A".charCodeAt(0),k="-".charCodeAt(0),l="_".charCodeAt(0);a.toByteArray=c,a.fromByteArray=d}(void 0===c?this.base64js={}:c)},{}],2:[function(a,b,c){function d(a,b){return 1-3*b+3*a}function e(a,b){return 3*b-6*a}function f(a){return 3*a}function g(a,b,c){return((d(b,c)*a+e(b,c))*a+f(b))*a}function h(a,b,c){return 3*d(b,c)*a*a+2*e(b,c)*a+f(b)}function i(a,b,c,d,e){var f,h,i=0;do{h=b+(c-b)/2,f=g(h,d,e)-a,f>0?c=h:b=h}while(Math.abs(f)>m&&++i<n);return h}function j(a,b,c,d){for(var e=0;e<l;++e){var f=h(b,c,d);if(0===f)return b;b-=(g(b,c,d)-a)/f}return b}function k(a,b,c,d){if(4===arguments.length)return new k([a,b,c,d]);if(!(this instanceof k))return new k(a);if(!a||4!==a.length)throw new Error("BezierEasing: points must contains 4 values");for(var e=0;e<4;++e)if("number"!=typeof a[e]||isNaN(a[e])||!isFinite(a[e]))throw new Error("BezierEasing: points should be integers.");if(a[0]<0||a[0]>1||a[2]<0||a[2]>1)throw new Error("BezierEasing x values must be in [0, 1] range.");this._str="BezierEasing("+a+")",this._css="cubic-bezier("+a+")",this._p=a,this._mSampleValues=q?new Float32Array(o):new Array(o),this._precomputed=!1,this.get=this.get.bind(this)}var l=4,m=1e-7,n=10,o=11,p=1/(o-1),q="function"==typeof Float32Array;k.prototype={get:function(a){var b=this._p[0],c=this._p[1],d=this._p[2],e=this._p[3];return this._precomputed||this._precompute(),b===c&&d===e?a:0===a?0:1===a?1:g(this._getTForX(a),c,e)},getPoints:function(){return this._p},toString:function(){return this._str},toCSS:function(){return this._css},_precompute:function(){var a=this._p[0],b=this._p[1],c=this._p[2],d=this._p[3];this._precomputed=!0,a===b&&c===d||this._calcSampleValues()},_calcSampleValues:function(){for(var a=this._p[0],b=this._p[2],c=0;c<o;++c)this._mSampleValues[c]=g(c*p,a,b)},_getTForX:function(a){for(var b=this._p[0],c=this._p[2],d=this._mSampleValues,e=0,f=1,g=o-1;f!==g&&d[f]<=a;++f)e+=p;--f;var k=(a-d[f])/(d[f+1]-d[f]),l=e+k*p,m=h(l,b,c);return m>=.001?j(a,l,b,c):0===m?l:i(a,e,e+p,b,c)}},k.css={ease:k.ease=k(.25,.1,.25,1),linear:k.linear=k(0,0,1,1),"ease-in":k.easeIn=k(.42,0,1,1),"ease-out":k.easeOut=k(0,0,.58,1),"ease-in-out":k.easeInOut=k(.42,0,.58,1)},b.exports=k},{}],3:[function(a,b,c){},{}],4:[function(a,b,c){(function(b){"use strict";function d(){function a(){}try{var b=new Uint8Array(1);return b.foo=function(){return 42},b.constructor=a,42===b.foo()&&b.constructor===a&&"function"==typeof b.subarray&&0===b.subarray(1,1).byteLength}catch(e){return!1}}function e(){return f.TYPED_ARRAY_SUPPORT?2147483647:1073741823}function f(a){return this instanceof f?(f.TYPED_ARRAY_SUPPORT||(this.length=0,this.parent=void 0),"number"==typeof a?g(this,a):"string"==typeof a?h(this,a,arguments.length>1?arguments[1]:"utf8"):i(this,a)):arguments.length>1?new f(a,arguments[1]):new f(a)}function g(a,b){if(a=p(a,b<0?0:0|q(b)),!f.TYPED_ARRAY_SUPPORT)for(var c=0;c<b;c++)a[c]=0;return a}function h(a,b,c){return"string"==typeof c&&""!==c||(c="utf8"),a=p(a,0|s(b,c)),a.write(b,c),a}function i(a,b){if(f.isBuffer(b))return j(a,b);if(Y(b))return k(a,b);if(null==b)throw new TypeError("must start with number, buffer, array or string");if("undefined"!=typeof ArrayBuffer){if(b.buffer instanceof ArrayBuffer)return l(a,b);if(b instanceof ArrayBuffer)return m(a,b)}return b.length?n(a,b):o(a,b)}function j(a,b){var c=0|q(b.length);return a=p(a,c),b.copy(a,0,0,c),a}function k(a,b){var c=0|q(b.length);a=p(a,c);for(var d=0;d<c;d+=1)a[d]=255&b[d];return a}function l(a,b){var c=0|q(b.length);a=p(a,c);for(var d=0;d<c;d+=1)a[d]=255&b[d];return a}function m(a,b){return f.TYPED_ARRAY_SUPPORT?(b.byteLength,a=f._augment(new Uint8Array(b))):a=l(a,new Uint8Array(b)),a}function n(a,b){var c=0|q(b.length);a=p(a,c);for(var d=0;d<c;d+=1)a[d]=255&b[d];return a}function o(a,b){var c,d=0;"Buffer"===b.type&&Y(b.data)&&(c=b.data,d=0|q(c.length)),a=p(a,d);for(var e=0;e<d;e+=1)a[e]=255&c[e];return a}function p(a,b){return f.TYPED_ARRAY_SUPPORT?(a=f._augment(new Uint8Array(b)),a.__proto__=f.prototype):(a.length=b,a._isBuffer=!0),0!==b&&b<=f.poolSize>>>1&&(a.parent=Z),a}function q(a){if(a>=e())throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+e().toString(16)+" bytes");return 0|a}function r(a,b){if(!(this instanceof r))return new r(a,b);var c=new f(a,b);return delete c.parent,c}function s(a,b){"string"!=typeof a&&(a=""+a);var c=a.length;if(0===c)return 0;for(var d=!1;;)switch(b){case"ascii":case"binary":case"raw":case"raws":return c;case"utf8":case"utf-8":return R(a).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*c;case"hex":return c>>>1;case"base64":return U(a).length;default:if(d)return R(a).length;b=(""+b).toLowerCase(),d=!0}}function t(a,b,c){var d=!1;if(b|=0,c=void 0===c||c===1/0?this.length:0|c,a||(a="utf8"),b<0&&(b=0),c>this.length&&(c=this.length),c<=b)return"";for(;;)switch(a){case"hex":return F(this,b,c);case"utf8":case"utf-8":return B(this,b,c);case"ascii":return D(this,b,c);case"binary":return E(this,b,c);case"base64":return A(this,b,c);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return G(this,b,c);default:if(d)throw new TypeError("Unknown encoding: "+a);a=(a+"").toLowerCase(),d=!0}}function u(a,b,c,d){c=Number(c)||0;var e=a.length-c;d?(d=Number(d))>e&&(d=e):d=e;var f=b.length;if(f%2!=0)throw new Error("Invalid hex string");d>f/2&&(d=f/2);for(var g=0;g<d;g++){var h=parseInt(b.substr(2*g,2),16);if(isNaN(h))throw new Error("Invalid hex string");a[c+g]=h}return g}function v(a,b,c,d){return V(R(b,a.length-c),a,c,d)}function w(a,b,c,d){return V(S(b),a,c,d)}function x(a,b,c,d){return w(a,b,c,d)}function y(a,b,c,d){return V(U(b),a,c,d)}function z(a,b,c,d){return V(T(b,a.length-c),a,c,d)}function A(a,b,c){return 0===b&&c===a.length?W.fromByteArray(a):W.fromByteArray(a.slice(b,c))}function B(a,b,c){c=Math.min(a.length,c);for(var d=[],e=b;e<c;){var f=a[e],g=null,h=f>239?4:f>223?3:f>191?2:1;if(e+h<=c){var i,j,k,l;switch(h){case 1:f<128&&(g=f);break;case 2:i=a[e+1],128==(192&i)&&(l=(31&f)<<6|63&i)>127&&(g=l);break;case 3:i=a[e+1],j=a[e+2],128==(192&i)&&128==(192&j)&&(l=(15&f)<<12|(63&i)<<6|63&j)>2047&&(l<55296||l>57343)&&(g=l);break;case 4:i=a[e+1],j=a[e+2],k=a[e+3],128==(192&i)&&128==(192&j)&&128==(192&k)&&(l=(15&f)<<18|(63&i)<<12|(63&j)<<6|63&k)>65535&&l<1114112&&(g=l)}}null===g?(g=65533,h=1):g>65535&&(g-=65536,d.push(g>>>10&1023|55296),g=56320|1023&g),d.push(g),e+=h}return C(d)}function C(a){var b=a.length;if(b<=$)return String.fromCharCode.apply(String,a);for(var c="",d=0;d<b;)c+=String.fromCharCode.apply(String,a.slice(d,d+=$));return c}function D(a,b,c){var d="";c=Math.min(a.length,c);for(var e=b;e<c;e++)d+=String.fromCharCode(127&a[e]);return d}function E(a,b,c){var d="";c=Math.min(a.length,c);for(var e=b;e<c;e++)d+=String.fromCharCode(a[e]);return d}function F(a,b,c){var d=a.length;(!b||b<0)&&(b=0),(!c||c<0||c>d)&&(c=d);for(var e="",f=b;f<c;f++)e+=Q(a[f]);return e}function G(a,b,c){for(var d=a.slice(b,c),e="",f=0;f<d.length;f+=2)e+=String.fromCharCode(d[f]+256*d[f+1]);return e}function H(a,b,c){if(a%1!=0||a<0)throw new RangeError("offset is not uint");if(a+b>c)throw new RangeError("Trying to access beyond buffer length")}function I(a,b,c,d,e,g){if(!f.isBuffer(a))throw new TypeError("buffer must be a Buffer instance");if(b>e||b<g)throw new RangeError("value is out of bounds");if(c+d>a.length)throw new RangeError("index out of range")}function J(a,b,c,d){b<0&&(b=65535+b+1);for(var e=0,f=Math.min(a.length-c,2);e<f;e++)a[c+e]=(b&255<<8*(d?e:1-e))>>>8*(d?e:1-e)}function K(a,b,c,d){b<0&&(b=4294967295+b+1);for(var e=0,f=Math.min(a.length-c,4);e<f;e++)a[c+e]=b>>>8*(d?e:3-e)&255}function L(a,b,c,d,e,f){if(b>e||b<f)throw new RangeError("value is out of bounds");if(c+d>a.length)throw new RangeError("index out of range");if(c<0)throw new RangeError("index out of range")}function M(a,b,c,d,e){return e||L(a,b,c,4,3.4028234663852886e38,-3.4028234663852886e38),X.write(a,b,c,d,23,4),c+4}function N(a,b,c,d,e){return e||L(a,b,c,8,1.7976931348623157e308,-1.7976931348623157e308),X.write(a,b,c,d,52,8),c+8}function O(a){if(a=P(a).replace(aa,""),a.length<2)return"";for(;a.length%4!=0;)a+="=";return a}function P(a){return a.trim?a.trim():a.replace(/^\s+|\s+$/g,"")}function Q(a){return a<16?"0"+a.toString(16):a.toString(16)}function R(a,b){b=b||1/0;for(var c,d=a.length,e=null,f=[],g=0;g<d;g++){if((c=a.charCodeAt(g))>55295&&c<57344){if(!e){if(c>56319){(b-=3)>-1&&f.push(239,191,189);continue}if(g+1===d){(b-=3)>-1&&f.push(239,191,189);continue}e=c;continue}if(c<56320){(b-=3)>-1&&f.push(239,191,189),e=c;continue}c=65536+(e-55296<<10|c-56320)}else e&&(b-=3)>-1&&f.push(239,191,189);if(e=null,c<128){if((b-=1)<0)break;f.push(c)}else if(c<2048){if((b-=2)<0)break;f.push(c>>6|192,63&c|128)}else if(c<65536){if((b-=3)<0)break;f.push(c>>12|224,c>>6&63|128,63&c|128)}else{if(!(c<1114112))throw new Error("Invalid code point");if((b-=4)<0)break;f.push(c>>18|240,c>>12&63|128,c>>6&63|128,63&c|128)}}return f}function S(a){for(var b=[],c=0;c<a.length;c++)b.push(255&a.charCodeAt(c));return b}function T(a,b){for(var c,d,e,f=[],g=0;g<a.length&&!((b-=2)<0);g++)c=a.charCodeAt(g),d=c>>8,e=c%256,f.push(e),f.push(d);return f}function U(a){return W.toByteArray(O(a))}function V(a,b,c,d){for(var e=0;e<d&&!(e+c>=b.length||e>=a.length);e++)b[e+c]=a[e];return e}var W=a("base64-js"),X=a("ieee754"),Y=a("isarray");c.Buffer=f,c.SlowBuffer=r,c.INSPECT_MAX_BYTES=50,f.poolSize=8192;var Z={};f.TYPED_ARRAY_SUPPORT=void 0!==b.TYPED_ARRAY_SUPPORT?b.TYPED_ARRAY_SUPPORT:d(),f.TYPED_ARRAY_SUPPORT?(f.prototype.__proto__=Uint8Array.prototype,f.__proto__=Uint8Array):(f.prototype.length=void 0,f.prototype.parent=void 0),f.isBuffer=function(a){return!(null==a||!a._isBuffer)},f.compare=function(a,b){if(!f.isBuffer(a)||!f.isBuffer(b))throw new TypeError("Arguments must be Buffers");if(a===b)return 0;for(var c=a.length,d=b.length,e=0,g=Math.min(c,d);e<g&&a[e]===b[e];)++e;return e!==g&&(c=a[e],d=b[e]),c<d?-1:d<c?1:0},f.isEncoding=function(a){switch(String(a).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"binary":case"base64":case"raw":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},f.concat=function(a,b){if(!Y(a))throw new TypeError("list argument must be an Array of Buffers.");if(0===a.length)return new f(0);var c;if(void 0===b)for(b=0,c=0;c<a.length;c++)b+=a[c].length;var d=new f(b),e=0;for(c=0;c<a.length;c++){var g=a[c];g.copy(d,e),e+=g.length}return d},f.byteLength=s,f.prototype.toString=function(){var a=0|this.length;return 0===a?"":0===arguments.length?B(this,0,a):t.apply(this,arguments)},f.prototype.equals=function(a){if(!f.isBuffer(a))throw new TypeError("Argument must be a Buffer");return this===a||0===f.compare(this,a)},f.prototype.inspect=function(){var a="",b=c.INSPECT_MAX_BYTES;return this.length>0&&(a=this.toString("hex",0,b).match(/.{2}/g).join(" "),this.length>b&&(a+=" ... ")),"<Buffer "+a+">"},f.prototype.compare=function(a){if(!f.isBuffer(a))throw new TypeError("Argument must be a Buffer");return this===a?0:f.compare(this,a)},f.prototype.indexOf=function(a,b){function c(a,b,c){for(var d=-1,e=0;c+e<a.length;e++)if(a[c+e]===b[-1===d?0:e-d]){if(-1===d&&(d=e),e-d+1===b.length)return c+d}else d=-1;return-1}if(b>2147483647?b=2147483647:b<-2147483648&&(b=-2147483648),b>>=0,0===this.length)return-1;if(b>=this.length)return-1;if(b<0&&(b=Math.max(this.length+b,0)),"string"==typeof a)return 0===a.length?-1:String.prototype.indexOf.call(this,a,b);if(f.isBuffer(a))return c(this,a,b);if("number"==typeof a)return f.TYPED_ARRAY_SUPPORT&&"function"===Uint8Array.prototype.indexOf?Uint8Array.prototype.indexOf.call(this,a,b):c(this,[a],b);throw new TypeError("val must be string, number or Buffer")},f.prototype.get=function(a){return console.log(".get() is deprecated. Access using array indexes instead."),this.readUInt8(a)},f.prototype.set=function(a,b){return console.log(".set() is deprecated. Access using array indexes instead."),this.writeUInt8(a,b)},f.prototype.write=function(a,b,c,d){if(void 0===b)d="utf8",c=this.length,b=0;else if(void 0===c&&"string"==typeof b)d=b,c=this.length,b=0;else if(isFinite(b))b|=0,isFinite(c)?(c|=0,void 0===d&&(d="utf8")):(d=c,c=void 0);else{var e=d;d=b,b=0|c,c=e}var f=this.length-b;if((void 0===c||c>f)&&(c=f),a.length>0&&(c<0||b<0)||b>this.length)throw new RangeError("attempt to write outside buffer bounds");d||(d="utf8");for(var g=!1;;)switch(d){case"hex":return u(this,a,b,c);case"utf8":case"utf-8":return v(this,a,b,c);case"ascii":return w(this,a,b,c);case"binary":return x(this,a,b,c);case"base64":return y(this,a,b,c);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return z(this,a,b,c);default:if(g)throw new TypeError("Unknown encoding: "+d);d=(""+d).toLowerCase(),g=!0}},f.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};var $=4096;f.prototype.slice=function(a,b){var c=this.length;a=~~a,b=void 0===b?c:~~b,a<0?(a+=c)<0&&(a=0):a>c&&(a=c),b<0?(b+=c)<0&&(b=0):b>c&&(b=c),b<a&&(b=a);var d;if(f.TYPED_ARRAY_SUPPORT)d=f._augment(this.subarray(a,b));else{var e=b-a;d=new f(e,void 0);for(var g=0;g<e;g++)d[g]=this[g+a]}return d.length&&(d.parent=this.parent||this),d},f.prototype.readUIntLE=function(a,b,c){a|=0,b|=0,c||H(a,b,this.length);for(var d=this[a],e=1,f=0;++f<b&&(e*=256);)d+=this[a+f]*e;return d},f.prototype.readUIntBE=function(a,b,c){a|=0,b|=0,c||H(a,b,this.length);for(var d=this[a+--b],e=1;b>0&&(e*=256);)d+=this[a+--b]*e;return d},f.prototype.readUInt8=function(a,b){return b||H(a,1,this.length),this[a]},f.prototype.readUInt16LE=function(a,b){return b||H(a,2,this.length),this[a]|this[a+1]<<8},f.prototype.readUInt16BE=function(a,b){return b||H(a,2,this.length),this[a]<<8|this[a+1]},f.prototype.readUInt32LE=function(a,b){return b||H(a,4,this.length),(this[a]|this[a+1]<<8|this[a+2]<<16)+16777216*this[a+3]},f.prototype.readUInt32BE=function(a,b){return b||H(a,4,this.length),16777216*this[a]+(this[a+1]<<16|this[a+2]<<8|this[a+3])},f.prototype.readIntLE=function(a,b,c){a|=0,b|=0,c||H(a,b,this.length);for(var d=this[a],e=1,f=0;++f<b&&(e*=256);)d+=this[a+f]*e;return e*=128,d>=e&&(d-=Math.pow(2,8*b)),d},f.prototype.readIntBE=function(a,b,c){a|=0,b|=0,c||H(a,b,this.length);for(var d=b,e=1,f=this[a+--d];d>0&&(e*=256);)f+=this[a+--d]*e;return e*=128,f>=e&&(f-=Math.pow(2,8*b)),f},f.prototype.readInt8=function(a,b){return b||H(a,1,this.length),128&this[a]?-1*(255-this[a]+1):this[a]},f.prototype.readInt16LE=function(a,b){b||H(a,2,this.length);var c=this[a]|this[a+1]<<8;return 32768&c?4294901760|c:c},f.prototype.readInt16BE=function(a,b){b||H(a,2,this.length);var c=this[a+1]|this[a]<<8;return 32768&c?4294901760|c:c},f.prototype.readInt32LE=function(a,b){return b||H(a,4,this.length),this[a]|this[a+1]<<8|this[a+2]<<16|this[a+3]<<24},f.prototype.readInt32BE=function(a,b){return b||H(a,4,this.length),this[a]<<24|this[a+1]<<16|this[a+2]<<8|this[a+3]},f.prototype.readFloatLE=function(a,b){return b||H(a,4,this.length),X.read(this,a,!0,23,4)},f.prototype.readFloatBE=function(a,b){return b||H(a,4,this.length),X.read(this,a,!1,23,4)},f.prototype.readDoubleLE=function(a,b){return b||H(a,8,this.length),X.read(this,a,!0,52,8)},f.prototype.readDoubleBE=function(a,b){return b||H(a,8,this.length),X.read(this,a,!1,52,8)},f.prototype.writeUIntLE=function(a,b,c,d){a=+a,b|=0,c|=0,d||I(this,a,b,c,Math.pow(2,8*c),0);var e=1,f=0;for(this[b]=255&a;++f<c&&(e*=256);)this[b+f]=a/e&255;return b+c},f.prototype.writeUIntBE=function(a,b,c,d){a=+a,b|=0,c|=0,d||I(this,a,b,c,Math.pow(2,8*c),0);var e=c-1,f=1;for(this[b+e]=255&a;--e>=0&&(f*=256);)this[b+e]=a/f&255;return b+c},f.prototype.writeUInt8=function(a,b,c){return a=+a,b|=0,c||I(this,a,b,1,255,0),f.TYPED_ARRAY_SUPPORT||(a=Math.floor(a)),this[b]=255&a,b+1},f.prototype.writeUInt16LE=function(a,b,c){return a=+a,b|=0,c||I(this,a,b,2,65535,0),f.TYPED_ARRAY_SUPPORT?(this[b]=255&a,this[b+1]=a>>>8):J(this,a,b,!0),b+2},f.prototype.writeUInt16BE=function(a,b,c){return a=+a,b|=0,c||I(this,a,b,2,65535,0),f.TYPED_ARRAY_SUPPORT?(this[b]=a>>>8,this[b+1]=255&a):J(this,a,b,!1),b+2},f.prototype.writeUInt32LE=function(a,b,c){return a=+a,b|=0,c||I(this,a,b,4,4294967295,0),f.TYPED_ARRAY_SUPPORT?(this[b+3]=a>>>24,this[b+2]=a>>>16,this[b+1]=a>>>8,this[b]=255&a):K(this,a,b,!0),b+4},f.prototype.writeUInt32BE=function(a,b,c){return a=+a,b|=0,c||I(this,a,b,4,4294967295,0),f.TYPED_ARRAY_SUPPORT?(this[b]=a>>>24,this[b+1]=a>>>16,this[b+2]=a>>>8,this[b+3]=255&a):K(this,a,b,!1),b+4},f.prototype.writeIntLE=function(a,b,c,d){if(a=+a,b|=0,!d){var e=Math.pow(2,8*c-1);I(this,a,b,c,e-1,-e)}var f=0,g=1,h=a<0?1:0;for(this[b]=255&a;++f<c&&(g*=256);)this[b+f]=(a/g>>0)-h&255;return b+c},f.prototype.writeIntBE=function(a,b,c,d){if(a=+a,b|=0,!d){var e=Math.pow(2,8*c-1);I(this,a,b,c,e-1,-e)}var f=c-1,g=1,h=a<0?1:0;for(this[b+f]=255&a;--f>=0&&(g*=256);)this[b+f]=(a/g>>0)-h&255;return b+c},f.prototype.writeInt8=function(a,b,c){return a=+a,b|=0,c||I(this,a,b,1,127,-128),f.TYPED_ARRAY_SUPPORT||(a=Math.floor(a)),a<0&&(a=255+a+1),this[b]=255&a,b+1},f.prototype.writeInt16LE=function(a,b,c){return a=+a,b|=0,c||I(this,a,b,2,32767,-32768),f.TYPED_ARRAY_SUPPORT?(this[b]=255&a,this[b+1]=a>>>8):J(this,a,b,!0),b+2},f.prototype.writeInt16BE=function(a,b,c){return a=+a,b|=0,c||I(this,a,b,2,32767,-32768),f.TYPED_ARRAY_SUPPORT?(this[b]=a>>>8,this[b+1]=255&a):J(this,a,b,!1),b+2},f.prototype.writeInt32LE=function(a,b,c){return a=+a,b|=0,c||I(this,a,b,4,2147483647,-2147483648),f.TYPED_ARRAY_SUPPORT?(this[b]=255&a,this[b+1]=a>>>8,this[b+2]=a>>>16,this[b+3]=a>>>24):K(this,a,b,!0),b+4},f.prototype.writeInt32BE=function(a,b,c){return a=+a,b|=0,c||I(this,a,b,4,2147483647,-2147483648),a<0&&(a=4294967295+a+1),f.TYPED_ARRAY_SUPPORT?(this[b]=a>>>24,this[b+1]=a>>>16,this[b+2]=a>>>8,this[b+3]=255&a):K(this,a,b,!1),b+4},f.prototype.writeFloatLE=function(a,b,c){return M(this,a,b,!0,c)},f.prototype.writeFloatBE=function(a,b,c){return M(this,a,b,!1,c)},f.prototype.writeDoubleLE=function(a,b,c){return N(this,a,b,!0,c)},f.prototype.writeDoubleBE=function(a,b,c){return N(this,a,b,!1,c)},f.prototype.copy=function(a,b,c,d){if(c||(c=0),d||0===d||(d=this.length),b>=a.length&&(b=a.length),b||(b=0),d>0&&d<c&&(d=c),d===c)return 0;if(0===a.length||0===this.length)return 0;if(b<0)throw new RangeError("targetStart out of bounds");if(c<0||c>=this.length)throw new RangeError("sourceStart out of bounds");if(d<0)throw new RangeError("sourceEnd out of bounds");d>this.length&&(d=this.length),a.length-b<d-c&&(d=a.length-b+c);var e,g=d-c;if(this===a&&c<b&&b<d)for(e=g-1;e>=0;e--)a[e+b]=this[e+c];else if(g<1e3||!f.TYPED_ARRAY_SUPPORT)for(e=0;e<g;e++)a[e+b]=this[e+c];else a._set(this.subarray(c,c+g),b);return g},f.prototype.fill=function(a,b,c){if(a||(a=0),b||(b=0),c||(c=this.length),c<b)throw new RangeError("end < start");if(c!==b&&0!==this.length){if(b<0||b>=this.length)throw new RangeError("start out of bounds");if(c<0||c>this.length)throw new RangeError("end out of bounds");var d;if("number"==typeof a)for(d=b;d<c;d++)this[d]=a;else{var e=R(a.toString()),f=e.length;for(d=b;d<c;d++)this[d]=e[d%f]}return this}},f.prototype.toArrayBuffer=function(){if("undefined"!=typeof Uint8Array){if(f.TYPED_ARRAY_SUPPORT)return new f(this).buffer;for(var a=new Uint8Array(this.length),b=0,c=a.length;b<c;b+=1)a[b]=this[b];return a.buffer}throw new TypeError("Buffer.toArrayBuffer not supported in this browser")};var _=f.prototype;f._augment=function(a){return a.constructor=f,a._isBuffer=!0,a._set=a.set,a.get=_.get,a.set=_.set,a.write=_.write,a.toString=_.toString,a.toLocaleString=_.toString,a.toJSON=_.toJSON,a.equals=_.equals,a.compare=_.compare,a.indexOf=_.indexOf,a.copy=_.copy,a.slice=_.slice,a.readUIntLE=_.readUIntLE,a.readUIntBE=_.readUIntBE,a.readUInt8=_.readUInt8,a.readUInt16LE=_.readUInt16LE,a.readUInt16BE=_.readUInt16BE,a.readUInt32LE=_.readUInt32LE,a.readUInt32BE=_.readUInt32BE,a.readIntLE=_.readIntLE,a.readIntBE=_.readIntBE,a.readInt8=_.readInt8,a.readInt16LE=_.readInt16LE,a.readInt16BE=_.readInt16BE,a.readInt32LE=_.readInt32LE,a.readInt32BE=_.readInt32BE,a.readFloatLE=_.readFloatLE,a.readFloatBE=_.readFloatBE,a.readDoubleLE=_.readDoubleLE,a.readDoubleBE=_.readDoubleBE,a.writeUInt8=_.writeUInt8,a.writeUIntLE=_.writeUIntLE,a.writeUIntBE=_.writeUIntBE,a.writeUInt16LE=_.writeUInt16LE,a.writeUInt16BE=_.writeUInt16BE,a.writeUInt32LE=_.writeUInt32LE,a.writeUInt32BE=_.writeUInt32BE,a.writeIntLE=_.writeIntLE,a.writeIntBE=_.writeIntBE,a.writeInt8=_.writeInt8,a.writeInt16LE=_.writeInt16LE,a.writeInt16BE=_.writeInt16BE,a.writeInt32LE=_.writeInt32LE,a.writeInt32BE=_.writeInt32BE,a.writeFloatLE=_.writeFloatLE,a.writeFloatBE=_.writeFloatBE,a.writeDoubleLE=_.writeDoubleLE,a.writeDoubleBE=_.writeDoubleBE,a.fill=_.fill,a.inspect=_.inspect,a.toArrayBuffer=_.toArrayBuffer,a};var aa=/[^+\/0-9A-Za-z-_]/g}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"base64-js":1,ieee754:8,isarray:5}],5:[function(a,b,c){var d={}.toString;b.exports=Array.isArray||function(a){return"[object Array]"==d.call(a)}},{}],6:[function(a,b,c){(function(a){function b(a){return Array.isArray?Array.isArray(a):"[object Array]"===q(a)}function d(a){return"boolean"==typeof a}function e(a){return null===a}function f(a){return null==a}function g(a){return"number"==typeof a}function h(a){return"string"==typeof a}function i(a){return"symbol"==typeof a}function j(a){return void 0===a}function k(a){return"[object RegExp]"===q(a)}function l(a){return"object"==typeof a&&null!==a}function m(a){return"[object Date]"===q(a)}function n(a){return"[object Error]"===q(a)||a instanceof Error}function o(a){return"function"==typeof a}function p(a){return null===a||"boolean"==typeof a||"number"==typeof a||"string"==typeof a||"symbol"==typeof a||void 0===a}function q(a){return Object.prototype.toString.call(a)}c.isArray=b,c.isBoolean=d,c.isNull=e,c.isNullOrUndefined=f,c.isNumber=g,c.isString=h,c.isSymbol=i,c.isUndefined=j,c.isRegExp=k,c.isObject=l,c.isDate=m,c.isError=n,c.isFunction=o,c.isPrimitive=p,c.isBuffer=a.isBuffer}).call(this,{isBuffer:a("../../is-buffer/index.js")})},{"../../is-buffer/index.js":10}],7:[function(a,b,c){function d(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}function e(a){return"function"==typeof a}function f(a){return"number"==typeof a}function g(a){return"object"==typeof a&&null!==a}function h(a){return void 0===a}b.exports=d,d.EventEmitter=d,d.prototype._events=void 0,d.prototype._maxListeners=void 0,d.defaultMaxListeners=10,d.prototype.setMaxListeners=function(a){if(!f(a)||a<0||isNaN(a))throw TypeError("n must be a positive number");return this._maxListeners=a,this},d.prototype.emit=function(a){var b,c,d,f,i,j;if(this._events||(this._events={}),"error"===a&&(!this._events.error||g(this._events.error)&&!this._events.error.length)){if((b=arguments[1])instanceof Error)throw b;throw TypeError('Uncaught, unspecified "error" event.')}if(c=this._events[a],h(c))return!1;if(e(c))switch(arguments.length){case 1:c.call(this);break;case 2:c.call(this,arguments[1]);break;case 3:c.call(this,arguments[1],arguments[2]);break;default:for(d=arguments.length,f=new Array(d-1),i=1;i<d;i++)f[i-1]=arguments[i];c.apply(this,f)}else if(g(c)){for(d=arguments.length,f=new Array(d-1),i=1;i<d;i++)f[i-1]=arguments[i];for(j=c.slice(),d=j.length,i=0;i<d;i++)j[i].apply(this,f)}return!0},d.prototype.addListener=function(a,b){var c;if(!e(b))throw TypeError("listener must be a function");if(this._events||(this._events={}),this._events.newListener&&this.emit("newListener",a,e(b.listener)?b.listener:b),this._events[a]?g(this._events[a])?this._events[a].push(b):this._events[a]=[this._events[a],b]:this._events[a]=b,g(this._events[a])&&!this._events[a].warned){var c;c=h(this._maxListeners)?d.defaultMaxListeners:this._maxListeners,c&&c>0&&this._events[a].length>c&&(this._events[a].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[a].length),"function"==typeof console.trace&&console.trace())}return this},d.prototype.on=d.prototype.addListener,d.prototype.once=function(a,b){function c(){this.removeListener(a,c),d||(d=!0,b.apply(this,arguments))}if(!e(b))throw TypeError("listener must be a function");var d=!1;return c.listener=b,this.on(a,c),this},d.prototype.removeListener=function(a,b){var c,d,f,h;if(!e(b))throw TypeError("listener must be a function");if(!this._events||!this._events[a])return this;if(c=this._events[a],f=c.length,d=-1,c===b||e(c.listener)&&c.listener===b)delete this._events[a],this._events.removeListener&&this.emit("removeListener",a,b);else if(g(c)){for(h=f;h-- >0;)if(c[h]===b||c[h].listener&&c[h].listener===b){d=h;break}if(d<0)return this;1===c.length?(c.length=0,delete this._events[a]):c.splice(d,1),this._events.removeListener&&this.emit("removeListener",a,b)}return this},d.prototype.removeAllListeners=function(a){var b,c;if(!this._events)return this;if(!this._events.removeListener)return 0===arguments.length?this._events={}:this._events[a]&&delete this._events[a],this;if(0===arguments.length){for(b in this._events)"removeListener"!==b&&this.removeAllListeners(b);return this.removeAllListeners("removeListener"),this._events={},this}if(c=this._events[a],e(c))this.removeListener(a,c);else for(;c.length;)this.removeListener(a,c[c.length-1]);return delete this._events[a],this},d.prototype.listeners=function(a){return this._events&&this._events[a]?e(this._events[a])?[this._events[a]]:this._events[a].slice():[]},d.listenerCount=function(a,b){return a._events&&a._events[b]?e(a._events[b])?1:a._events[b].length:0}},{}],8:[function(a,b,c){c.read=function(a,b,c,d,e){var f,g,h=8*e-d-1,i=(1<<h)-1,j=i>>1,k=-7,l=c?e-1:0,m=c?-1:1,n=a[b+l];for(l+=m,f=n&(1<<-k)-1,n>>=-k,k+=h;k>0;f=256*f+a[b+l],l+=m,k-=8);for(g=f&(1<<-k)-1,f>>=-k,k+=d;k>0;g=256*g+a[b+l],l+=m,k-=8);if(0===f)f=1-j;else{if(f===i)return g?NaN:1/0*(n?-1:1);g+=Math.pow(2,d),f-=j}return(n?-1:1)*g*Math.pow(2,f-d)},c.write=function(a,b,c,d,e,f){var g,h,i,j=8*f-e-1,k=(1<<j)-1,l=k>>1,m=23===e?Math.pow(2,-24)-Math.pow(2,-77):0,n=d?0:f-1,o=d?1:-1,p=b<0||0===b&&1/b<0?1:0;for(b=Math.abs(b),isNaN(b)||b===1/0?(h=isNaN(b)?1:0,g=k):(g=Math.floor(Math.log(b)/Math.LN2),b*(i=Math.pow(2,-g))<1&&(g--,i*=2),b+=g+l>=1?m/i:m*Math.pow(2,1-l),b*i>=2&&(g++,i/=2),g+l>=k?(h=0,g=k):g+l>=1?(h=(b*i-1)*Math.pow(2,e),g+=l):(h=b*Math.pow(2,l-1)*Math.pow(2,e),g=0));e>=8;a[c+n]=255&h,n+=o,h/=256,e-=8);for(g=g<<e|h,j+=e;j>0;a[c+n]=255&g,n+=o,g/=256,j-=8);a[c+n-o]|=128*p}},{}],9:[function(a,b,c){"function"==typeof Object.create?b.exports=function(a,b){a.super_=b,a.prototype=Object.create(b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}})}:b.exports=function(a,b){a.super_=b;var c=function(){};c.prototype=b.prototype,a.prototype=new c,a.prototype.constructor=a}},{}],10:[function(a,b,c){function d(a){return!!a.constructor&&"function"==typeof a.constructor.isBuffer&&a.constructor.isBuffer(a)}function e(a){return"function"==typeof a.readFloatLE&&"function"==typeof a.slice&&d(a.slice(0,0))}b.exports=function(a){return null!=a&&(d(a)||e(a)||!!a._isBuffer)}},{}],11:[function(a,b,c){!function(a){"use strict";var d="Compound",e="Identifier",f="MemberExpression",g="Literal",h="ThisExpression",i="CallExpression",j="UnaryExpression",k="BinaryExpression",l="LogicalExpression",m="ConditionalExpression",n="ArrayExpression",o=46,p=44,q=39,r=34,s=40,t=41,u=91,v=93,w=63,x=59,y=58,z=function(a,b){var c=new Error(a+" at character "+b);throw c.index=b,c.description=a,c},A=!0,B={"-":A,"!":A,"~":A,"+":A},C={"||":1,"&&":2,"|":3,"^":4,"&":5,"==":6,"!=":6,"===":6,"!==":6,"<":7,">":7,"<=":7,">=":7,"<<":8,">>":8,">>>":8,"+":9,"-":9,"*":10,"/":10,"%":10},D=function(a){var b,c=0;for(var d in a)(b=d.length)>c&&a.hasOwnProperty(d)&&(c=b);return c},E=D(B),F=D(C),G={true:!0,false:!1,null:null},H="this",I=function(a){return C[a]||0},J=function(a,b,c){return{type:"||"===a||"&&"===a?l:k,operator:a,left:b,right:c}},K=function(a){return a>=48&&a<=57},L=function(a){return 36===a||95===a||a>=65&&a<=90||a>=97&&a<=122||a>=128&&!C[String.fromCharCode(a)]},M=function(a){return 36===a||95===a||a>=65&&a<=90||a>=97&&a<=122||a>=48&&a<=57||a>=128&&!C[String.fromCharCode(a)]},N=function(a){for(var b,c,k=0,l=a.charAt,A=a.charCodeAt,D=function(b){return l.call(a,b)},N=function(b){return A.call(a,b)},O=a.length,P=function(){for(var a=N(k);32===a||9===a||10===a||13===a;)a=N(++k)},Q=function(){var a,b,c=S();return P(),N(k)!==w?c:(k++,a=Q(),a||z("Expected expression",k),P(),N(k)===y?(k++,b=Q(),b||z("Expected expression",k),{type:m,test:c,consequent:a,alternate:b}):void z("Expected :",k))},R=function(){P();for(var b=a.substr(k,F),c=b.length;c>0;){if(C.hasOwnProperty(b))return k+=c,b;b=b.substr(0,--c)}return!1},S=function(){var a,b,c,d,e,f,g,h;if(f=T(),!(b=R()))return f;for(e={value:b,prec:I(b)},g=T(),g||z("Expected expression after "+b,k),d=[f,e,g];(b=R())&&0!==(c=I(b));){for(e={value:b,prec:c};d.length>2&&c<=d[d.length-2].prec;)g=d.pop(),b=d.pop().value,f=d.pop(),a=J(b,f,g),d.push(a);a=T(),a||z("Expected expression after "+b,k),d.push(e,a)}for(h=d.length-1,a=d[h];h>1;)a=J(d[h-1].value,d[h-2],a),h-=2;return a},T=function(){var b,c,d;if(P(),b=N(k),K(b)||b===o)return U();if(b===q||b===r)return V();if(b===u)return $();for(c=a.substr(k,E),d=c.length;d>0;){if(B.hasOwnProperty(c))return k+=d,{type:j,operator:c,argument:T(),prefix:!0};c=c.substr(0,--d)}return!(!L(b)&&b!==s)&&Y()},U=function(){for(var a,b,c="";K(N(k));)c+=D(k++);if(N(k)===o)for(c+=D(k++);K(N(k));)c+=D(k++);if("e"===(a=D(k))||"E"===a){for(c+=D(k++),a=D(k),"+"!==a&&"-"!==a||(c+=D(k++));K(N(k));)c+=D(k++);K(N(k-1))||z("Expected exponent ("+c+D(k)+")",k)}return b=N(k),L(b)?z("Variable names cannot start with a number ("+c+D(k)+")",k):b===o&&z("Unexpected period",k),{type:g,value:parseFloat(c),raw:c}},V=function(){for(var a,b="",c=D(k++),d=!1;k<O;){if((a=D(k++))===c){d=!0;break}if("\\"===a)switch(a=D(k++)){case"n":b+="\n";break;case"r":b+="\r";break
;case"t":b+="\t";break;case"b":b+="\b";break;case"f":b+="\f";break;case"v":b+="\v";break;default:b+=a}else b+=a}return d||z('Unclosed quote after "'+b+'"',k),{type:g,value:b,raw:c+b+c}},W=function(){var b,c=N(k),d=k;for(L(c)?k++:z("Unexpected "+D(k),k);k<O&&(c=N(k),M(c));)k++;return b=a.slice(d,k),G.hasOwnProperty(b)?{type:g,value:G[b],raw:b}:b===H?{type:h}:{type:e,name:b}},X=function(a){for(var b,c,e=[],f=!1;k<O;){if(P(),(b=N(k))===a){f=!0,k++;break}b===p?k++:(c=Q(),c&&c.type!==d||z("Expected comma",k),e.push(c))}return f||z("Expected "+String.fromCharCode(a),k),e},Y=function(){var a,b;for(a=N(k),b=a===s?Z():W(),P(),a=N(k);a===o||a===u||a===s;)k++,a===o?(P(),b={type:f,computed:!1,object:b,property:W()}):a===u?(b={type:f,computed:!0,object:b,property:Q()},P(),a=N(k),a!==v&&z("Unclosed [",k),k++):a===s&&(b={type:i,arguments:X(t),callee:b}),P(),a=N(k);return b},Z=function(){k++;var a=Q();if(P(),N(k)===t)return k++,a;z("Unclosed (",k)},$=function(){return k++,{type:n,elements:X(v)}},_=[];k<O;)b=N(k),b===x||b===p?k++:(c=Q())?_.push(c):k<O&&z('Unexpected "'+D(k)+'"',k);return 1===_.length?_[0]:{type:d,body:_}};if(N.version="0.3.3",N.toString=function(){return"JavaScript Expression Parser (JSEP) v"+N.version},N.addUnaryOp=function(a){return E=Math.max(a.length,E),B[a]=A,this},N.addBinaryOp=function(a,b){return F=Math.max(a.length,F),C[a]=b,this},N.addLiteral=function(a,b){return G[a]=b,this},N.removeUnaryOp=function(a){return delete B[a],a.length===E&&(E=D(B)),this},N.removeAllUnaryOps=function(){return B={},E=0,this},N.removeBinaryOp=function(a){return delete C[a],a.length===F&&(F=D(C)),this},N.removeAllBinaryOps=function(){return C={},F=0,this},N.removeLiteral=function(a){return delete G[a],this},N.removeAllLiterals=function(){return G={},this},void 0===c){var O=a.jsep;a.jsep=N,N.noConflict=function(){return a.jsep===N&&(a.jsep=O),N}}else void 0!==b&&b.exports?c=b.exports=N:c.parse=N}(this)},{}],12:[function(a,c,d){(function(a){(function(){function f(a,b,c){switch(c.length){case 0:return a.call(b);case 1:return a.call(b,c[0]);case 2:return a.call(b,c[0],c[1]);case 3:return a.call(b,c[0],c[1],c[2])}return a.apply(b,c)}function g(a,b,c,d){for(var e=-1,f=null==a?0:a.length;++e<f;){var g=a[e];b(d,g,c(g),a)}return d}function h(a,b){for(var c=-1,d=null==a?0:a.length;++c<d&&!1!==b(a[c],c,a););return a}function i(a,b){for(var c=null==a?0:a.length;c--&&!1!==b(a[c],c,a););return a}function j(a,b){for(var c=-1,d=null==a?0:a.length;++c<d;)if(!b(a[c],c,a))return!1;return!0}function k(a,b){for(var c=-1,d=null==a?0:a.length,e=0,f=[];++c<d;){var g=a[c];b(g,c,a)&&(f[e++]=g)}return f}function l(a,b){return!!(null==a?0:a.length)&&w(a,b,0)>-1}function m(a,b,c){for(var d=-1,e=null==a?0:a.length;++d<e;)if(c(b,a[d]))return!0;return!1}function n(a,b){for(var c=-1,d=null==a?0:a.length,e=Array(d);++c<d;)e[c]=b(a[c],c,a);return e}function o(a,b){for(var c=-1,d=b.length,e=a.length;++c<d;)a[e+c]=b[c];return a}function p(a,b,c,d){var e=-1,f=null==a?0:a.length;for(d&&f&&(c=a[++e]);++e<f;)c=b(c,a[e],e,a);return c}function q(a,b,c,d){var e=null==a?0:a.length;for(d&&e&&(c=a[--e]);e--;)c=b(c,a[e],e,a);return c}function r(a,b){for(var c=-1,d=null==a?0:a.length;++c<d;)if(b(a[c],c,a))return!0;return!1}function s(a){return a.split("")}function t(a){return a.match(Pb)||[]}function u(a,b,c){var d;return c(a,function(a,c,e){if(b(a,c,e))return d=c,!1}),d}function v(a,b,c,d){for(var e=a.length,f=c+(d?1:-1);d?f--:++f<e;)if(b(a[f],f,a))return f;return-1}function w(a,b,c){return b===b?Y(a,b,c):v(a,y,c)}function x(a,b,c,d){for(var e=c-1,f=a.length;++e<f;)if(d(a[e],b))return e;return-1}function y(a){return a!==a}function z(a,b){var c=null==a?0:a.length;return c?E(a,b)/c:Ka}function A(a){return function(b){return null==b?da:b[a]}}function B(a){return function(b){return null==a?da:a[b]}}function C(a,b,c,d,e){return e(a,function(a,e,f){c=d?(d=!1,a):b(c,a,e,f)}),c}function D(a,b){var c=a.length;for(a.sort(b);c--;)a[c]=a[c].value;return a}function E(a,b){for(var c,d=-1,e=a.length;++d<e;){var f=b(a[d]);f!==da&&(c=c===da?f:c+f)}return c}function F(a,b){for(var c=-1,d=Array(a);++c<a;)d[c]=b(c);return d}function G(a,b){return n(b,function(b){return[b,a[b]]})}function H(a){return function(b){return a(b)}}function I(a,b){return n(b,function(b){return a[b]})}function J(a,b){return a.has(b)}function K(a,b){for(var c=-1,d=a.length;++c<d&&w(b,a[c],0)>-1;);return c}function L(a,b){for(var c=a.length;c--&&w(b,a[c],0)>-1;);return c}function M(a,b){for(var c=a.length,d=0;c--;)a[c]===b&&++d;return d}function N(a){return"\\"+_c[a]}function O(a,b){return null==a?da:a[b]}function P(a){return Sc.test(a)}function Q(a){return Tc.test(a)}function R(a){for(var b,c=[];!(b=a.next()).done;)c.push(b.value);return c}function S(a){var b=-1,c=Array(a.size);return a.forEach(function(a,d){c[++b]=[d,a]}),c}function T(a,b){return function(c){return a(b(c))}}function U(a,b){for(var c=-1,d=a.length,e=0,f=[];++c<d;){var g=a[c];g!==b&&g!==ka||(a[c]=ka,f[e++]=c)}return f}function V(a,b){return"__proto__"==b?da:a[b]}function W(a){var b=-1,c=Array(a.size);return a.forEach(function(a){c[++b]=a}),c}function X(a){var b=-1,c=Array(a.size);return a.forEach(function(a){c[++b]=[a,a]}),c}function Y(a,b,c){for(var d=c-1,e=a.length;++d<e;)if(a[d]===b)return d;return-1}function Z(a,b,c){for(var d=c+1;d--;)if(a[d]===b)return d;return d}function $(a){return P(a)?aa(a):qd(a)}function _(a){return P(a)?ba(a):s(a)}function aa(a){for(var b=Qc.lastIndex=0;Qc.test(a);)++b;return b}function ba(a){return a.match(Qc)||[]}function ca(a){return a.match(Rc)||[]}var da,ea="4.17.5",fa=200,ga="Unsupported core-js use. Try https://npms.io/search?q=ponyfill.",ha="Expected a function",ia="__lodash_hash_undefined__",ja=500,ka="__lodash_placeholder__",la=1,ma=2,na=4,oa=1,pa=2,qa=1,ra=2,sa=4,ta=8,ua=16,va=32,wa=64,xa=128,ya=256,za=512,Aa=30,Ba="...",Ca=800,Da=16,Ea=1,Fa=2,Ga=3,Ha=1/0,Ia=9007199254740991,Ja=1.7976931348623157e308,Ka=NaN,La=4294967295,Ma=La-1,Na=La>>>1,Oa=[["ary",xa],["bind",qa],["bindKey",ra],["curry",ta],["curryRight",ua],["flip",za],["partial",va],["partialRight",wa],["rearg",ya]],Pa="[object Arguments]",Qa="[object Array]",Ra="[object AsyncFunction]",Sa="[object Boolean]",Ta="[object Date]",Ua="[object DOMException]",Va="[object Error]",Wa="[object Function]",Xa="[object GeneratorFunction]",Ya="[object Map]",Za="[object Number]",$a="[object Null]",_a="[object Object]",ab="[object Promise]",bb="[object Proxy]",cb="[object RegExp]",db="[object Set]",eb="[object String]",fb="[object Symbol]",gb="[object Undefined]",hb="[object WeakMap]",ib="[object WeakSet]",jb="[object ArrayBuffer]",kb="[object DataView]",lb="[object Float32Array]",mb="[object Float64Array]",nb="[object Int8Array]",ob="[object Int16Array]",pb="[object Int32Array]",qb="[object Uint8Array]",rb="[object Uint8ClampedArray]",sb="[object Uint16Array]",tb="[object Uint32Array]",ub=/\b__p \+= '';/g,vb=/\b(__p \+=) '' \+/g,wb=/(__e\(.*?\)|\b__t\)) \+\n'';/g,xb=/&(?:amp|lt|gt|quot|#39);/g,yb=/[&<>"']/g,zb=RegExp(xb.source),Ab=RegExp(yb.source),Bb=/<%-([\s\S]+?)%>/g,Cb=/<%([\s\S]+?)%>/g,Db=/<%=([\s\S]+?)%>/g,Eb=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,Fb=/^\w*$/,Gb=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,Hb=/[\\^$.*+?()[\]{}|]/g,Ib=RegExp(Hb.source),Jb=/^\s+|\s+$/g,Kb=/^\s+/,Lb=/\s+$/,Mb=/\{(?:\n\/\* \[wrapped with .+\] \*\/)?\n?/,Nb=/\{\n\/\* \[wrapped with (.+)\] \*/,Ob=/,? & /,Pb=/[^\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\x7f]+/g,Qb=/\\(\\)?/g,Rb=/\$\{([^\\}]*(?:\\.[^\\}]*)*)\}/g,Sb=/\w*$/,Tb=/^[-+]0x[0-9a-f]+$/i,Ub=/^0b[01]+$/i,Vb=/^\[object .+?Constructor\]$/,Wb=/^0o[0-7]+$/i,Xb=/^(?:0|[1-9]\d*)$/,Yb=/[\xc0-\xd6\xd8-\xf6\xf8-\xff\u0100-\u017f]/g,Zb=/($^)/,$b=/['\n\r\u2028\u2029\\]/g,_b="\\ud800-\\udfff",ac="\\u0300-\\u036f",bc="\\ufe20-\\ufe2f",cc="\\u20d0-\\u20ff",dc=ac+bc+cc,ec="\\u2700-\\u27bf",fc="a-z\\xdf-\\xf6\\xf8-\\xff",gc="\\xac\\xb1\\xd7\\xf7",hc="\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf",ic="\\u2000-\\u206f",jc=" \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000",kc="A-Z\\xc0-\\xd6\\xd8-\\xde",lc="\\ufe0e\\ufe0f",mc=gc+hc+ic+jc,nc="['’]",oc="["+_b+"]",pc="["+mc+"]",qc="["+dc+"]",rc="\\d+",sc="["+ec+"]",tc="["+fc+"]",uc="[^"+_b+mc+rc+ec+fc+kc+"]",vc="\\ud83c[\\udffb-\\udfff]",wc="(?:"+qc+"|"+vc+")",xc="[^"+_b+"]",yc="(?:\\ud83c[\\udde6-\\uddff]){2}",zc="[\\ud800-\\udbff][\\udc00-\\udfff]",Ac="["+kc+"]",Bc="\\u200d",Cc="(?:"+tc+"|"+uc+")",Dc="(?:"+Ac+"|"+uc+")",Ec="(?:"+nc+"(?:d|ll|m|re|s|t|ve))?",Fc="(?:"+nc+"(?:D|LL|M|RE|S|T|VE))?",Gc=wc+"?",Hc="["+lc+"]?",Ic="(?:"+Bc+"(?:"+[xc,yc,zc].join("|")+")"+Hc+Gc+")*",Jc="\\d*(?:1st|2nd|3rd|(?![123])\\dth)(?=\\b|[A-Z_])",Kc="\\d*(?:1ST|2ND|3RD|(?![123])\\dTH)(?=\\b|[a-z_])",Lc=Hc+Gc+Ic,Mc="(?:"+[sc,yc,zc].join("|")+")"+Lc,Nc="(?:"+[xc+qc+"?",qc,yc,zc,oc].join("|")+")",Oc=RegExp(nc,"g"),Pc=RegExp(qc,"g"),Qc=RegExp(vc+"(?="+vc+")|"+Nc+Lc,"g"),Rc=RegExp([Ac+"?"+tc+"+"+Ec+"(?="+[pc,Ac,"$"].join("|")+")",Dc+"+"+Fc+"(?="+[pc,Ac+Cc,"$"].join("|")+")",Ac+"?"+Cc+"+"+Ec,Ac+"+"+Fc,Kc,Jc,rc,Mc].join("|"),"g"),Sc=RegExp("["+Bc+_b+dc+lc+"]"),Tc=/[a-z][A-Z]|[A-Z]{2,}[a-z]|[0-9][a-zA-Z]|[a-zA-Z][0-9]|[^a-zA-Z0-9 ]/,Uc=["Array","Buffer","DataView","Date","Error","Float32Array","Float64Array","Function","Int8Array","Int16Array","Int32Array","Map","Math","Object","Promise","RegExp","Set","String","Symbol","TypeError","Uint8Array","Uint8ClampedArray","Uint16Array","Uint32Array","WeakMap","_","clearTimeout","isFinite","parseInt","setTimeout"],Vc=-1,Wc={};Wc[lb]=Wc[mb]=Wc[nb]=Wc[ob]=Wc[pb]=Wc[qb]=Wc[rb]=Wc[sb]=Wc[tb]=!0,Wc[Pa]=Wc[Qa]=Wc[jb]=Wc[Sa]=Wc[kb]=Wc[Ta]=Wc[Va]=Wc[Wa]=Wc[Ya]=Wc[Za]=Wc[_a]=Wc[cb]=Wc[db]=Wc[eb]=Wc[hb]=!1;var Xc={};Xc[Pa]=Xc[Qa]=Xc[jb]=Xc[kb]=Xc[Sa]=Xc[Ta]=Xc[lb]=Xc[mb]=Xc[nb]=Xc[ob]=Xc[pb]=Xc[Ya]=Xc[Za]=Xc[_a]=Xc[cb]=Xc[db]=Xc[eb]=Xc[fb]=Xc[qb]=Xc[rb]=Xc[sb]=Xc[tb]=!0,Xc[Va]=Xc[Wa]=Xc[hb]=!1;var Yc={"À":"A","Á":"A","Â":"A","Ã":"A","Ä":"A","Å":"A","à":"a","á":"a","â":"a","ã":"a","ä":"a","å":"a","Ç":"C","ç":"c","Ð":"D","ð":"d","È":"E","É":"E","Ê":"E","Ë":"E","è":"e","é":"e","ê":"e","ë":"e","Ì":"I","Í":"I","Î":"I","Ï":"I","ì":"i","í":"i","î":"i","ï":"i","Ñ":"N","ñ":"n","Ò":"O","Ó":"O","Ô":"O","Õ":"O","Ö":"O","Ø":"O","ò":"o","ó":"o","ô":"o","õ":"o","ö":"o","ø":"o","Ù":"U","Ú":"U","Û":"U","Ü":"U","ù":"u","ú":"u","û":"u","ü":"u","Ý":"Y","ý":"y","ÿ":"y","Æ":"Ae","æ":"ae","Þ":"Th","þ":"th","ß":"ss","Ā":"A","Ă":"A","Ą":"A","ā":"a","ă":"a","ą":"a","Ć":"C","Ĉ":"C","Ċ":"C","Č":"C","ć":"c","ĉ":"c","ċ":"c","č":"c","Ď":"D","Đ":"D","ď":"d","đ":"d","Ē":"E","Ĕ":"E","Ė":"E","Ę":"E","Ě":"E","ē":"e","ĕ":"e","ė":"e","ę":"e","ě":"e","Ĝ":"G","Ğ":"G","Ġ":"G","Ģ":"G","ĝ":"g","ğ":"g","ġ":"g","ģ":"g","Ĥ":"H","Ħ":"H","ĥ":"h","ħ":"h","Ĩ":"I","Ī":"I","Ĭ":"I","Į":"I","İ":"I","ĩ":"i","ī":"i","ĭ":"i","į":"i","ı":"i","Ĵ":"J","ĵ":"j","Ķ":"K","ķ":"k","ĸ":"k","Ĺ":"L","Ļ":"L","Ľ":"L","Ŀ":"L","Ł":"L","ĺ":"l","ļ":"l","ľ":"l","ŀ":"l","ł":"l","Ń":"N","Ņ":"N","Ň":"N","Ŋ":"N","ń":"n","ņ":"n","ň":"n","ŋ":"n","Ō":"O","Ŏ":"O","Ő":"O","ō":"o","ŏ":"o","ő":"o","Ŕ":"R","Ŗ":"R","Ř":"R","ŕ":"r","ŗ":"r","ř":"r","Ś":"S","Ŝ":"S","Ş":"S","Š":"S","ś":"s","ŝ":"s","ş":"s","š":"s","Ţ":"T","Ť":"T","Ŧ":"T","ţ":"t","ť":"t","ŧ":"t","Ũ":"U","Ū":"U","Ŭ":"U","Ů":"U","Ű":"U","Ų":"U","ũ":"u","ū":"u","ŭ":"u","ů":"u","ű":"u","ų":"u","Ŵ":"W","ŵ":"w","Ŷ":"Y","ŷ":"y","Ÿ":"Y","Ź":"Z","Ż":"Z","Ž":"Z","ź":"z","ż":"z","ž":"z","Ĳ":"IJ","ĳ":"ij","Œ":"Oe","œ":"oe","ŉ":"'n","ſ":"s"},Zc={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},$c={"&amp;":"&","&lt;":"<","&gt;":">","&quot;":'"',"&#39;":"'"},_c={"\\":"\\","'":"'","\n":"n","\r":"r","\u2028":"u2028","\u2029":"u2029"},ad=parseFloat,bd=parseInt,cd="object"==typeof a&&a&&a.Object===Object&&a,dd="object"==typeof self&&self&&self.Object===Object&&self,ed=cd||dd||Function("return this")(),fd="object"==typeof d&&d&&!d.nodeType&&d,gd=fd&&"object"==typeof c&&c&&!c.nodeType&&c,hd=gd&&gd.exports===fd,id=hd&&cd.process,jd=function(){try{return id&&id.binding&&id.binding("util")}catch(e){}}(),kd=jd&&jd.isArrayBuffer,ld=jd&&jd.isDate,md=jd&&jd.isMap,nd=jd&&jd.isRegExp,od=jd&&jd.isSet,pd=jd&&jd.isTypedArray,qd=A("length"),rd=B(Yc),sd=B(Zc),td=B($c),ud=function a(b){function c(a){if(fi(a)&&!qm(a)&&!(a instanceof B)){if(a instanceof s)return a;if(qk.call(a,"__wrapped__"))return cg(a)}return new s(a)}function d(){}function s(a,b){this.__wrapped__=a,this.__actions__=[],this.__chain__=!!b,this.__index__=0,this.__values__=da}function B(a){this.__wrapped__=a,this.__actions__=[],this.__dir__=1,this.__filtered__=!1,this.__iteratees__=[],this.__takeCount__=La,this.__views__=[]}function Y(){var a=new B(this.__wrapped__);return a.__actions__=Ke(this.__actions__),a.__dir__=this.__dir__,a.__filtered__=this.__filtered__,a.__iteratees__=Ke(this.__iteratees__),a.__takeCount__=this.__takeCount__,a.__views__=Ke(this.__views__),a}function aa(){if(this.__filtered__){var a=new B(this);a.__dir__=-1,a.__filtered__=!0}else a=this.clone(),a.__dir__*=-1;return a}function ba(){var a=this.__wrapped__.value(),b=this.__dir__,c=qm(a),d=b<0,e=c?a.length:0,f=Af(0,e,this.__views__),g=f.start,h=f.end,i=h-g,j=d?h:g-1,k=this.__iteratees__,l=k.length,m=0,n=Uk(i,this.__takeCount__);if(!c||!d&&e==i&&n==i)return te(a,this.__actions__);var o=[];a:for(;i--&&m<n;){j+=b;for(var p=-1,q=a[j];++p<l;){var r=k[p],s=r.iteratee,t=r.type,u=s(q);if(t==Fa)q=u;else if(!u){if(t==Ea)continue a;break a}}o[m++]=q}return o}function Pb(a){var b=-1,c=null==a?0:a.length;for(this.clear();++b<c;){var d=a[b];this.set(d[0],d[1])}}function _b(){this.__data__=cl?cl(null):{},this.size=0}function ac(a){var b=this.has(a)&&delete this.__data__[a];return this.size-=b?1:0,b}function bc(a){var b=this.__data__;if(cl){var c=b[a];return c===ia?da:c}return qk.call(b,a)?b[a]:da}function cc(a){var b=this.__data__;return cl?b[a]!==da:qk.call(b,a)}function dc(a,b){var c=this.__data__;return this.size+=this.has(a)?0:1,c[a]=cl&&b===da?ia:b,this}function ec(a){var b=-1,c=null==a?0:a.length;for(this.clear();++b<c;){var d=a[b];this.set(d[0],d[1])}}function fc(){this.__data__=[],this.size=0}function gc(a){var b=this.__data__,c=Fc(b,a);return!(c<0)&&(c==b.length-1?b.pop():Ek.call(b,c,1),--this.size,!0)}function hc(a){var b=this.__data__,c=Fc(b,a);return c<0?da:b[c][1]}function ic(a){return Fc(this.__data__,a)>-1}function jc(a,b){var c=this.__data__,d=Fc(c,a);return d<0?(++this.size,c.push([a,b])):c[d][1]=b,this}function kc(a){var b=-1,c=null==a?0:a.length;for(this.clear();++b<c;){var d=a[b];this.set(d[0],d[1])}}function lc(){this.size=0,this.__data__={hash:new Pb,map:new($k||ec),string:new Pb}}function mc(a){var b=wf(this,a).delete(a);return this.size-=b?1:0,b}function nc(a){return wf(this,a).get(a)}function oc(a){return wf(this,a).has(a)}function pc(a,b){var c=wf(this,a),d=c.size;return c.set(a,b),this.size+=c.size==d?0:1,this}function qc(a){var b=-1,c=null==a?0:a.length;for(this.__data__=new kc;++b<c;)this.add(a[b])}function rc(a){return this.__data__.set(a,ia),this}function sc(a){return this.__data__.has(a)}function tc(a){var b=this.__data__=new ec(a);this.size=b.size}function uc(){this.__data__=new ec,this.size=0}function vc(a){var b=this.__data__,c=b.delete(a);return this.size=b.size,c}function wc(a){return this.__data__.get(a)}function xc(a){return this.__data__.has(a)}function yc(a,b){var c=this.__data__;if(c instanceof ec){var d=c.__data__;if(!$k||d.length<fa-1)return d.push([a,b]),this.size=++c.size,this;c=this.__data__=new kc(d)}return c.set(a,b),this.size=c.size,this}function zc(a,b){var c=qm(a),d=!c&&pm(a),e=!c&&!d&&sm(a),f=!c&&!d&&!e&&xm(a),g=c||d||e||f,h=g?F(a.length,jk):[],i=h.length;for(var j in a)!b&&!qk.call(a,j)||g&&("length"==j||e&&("offset"==j||"parent"==j)||f&&("buffer"==j||"byteLength"==j||"byteOffset"==j)||If(j,i))||h.push(j);return h}function Ac(a){var b=a.length;return b?a[ae(0,b-1)]:da}function Bc(a,b){return $f(Ke(a),Lc(b,0,a.length))}function Cc(a){return $f(Ke(a))}function Dc(a,b,c){(c===da||Th(a[b],c))&&(c!==da||b in a)||Jc(a,b,c)}function Ec(a,b,c){var d=a[b];qk.call(a,b)&&Th(d,c)&&(c!==da||b in a)||Jc(a,b,c)}function Fc(a,b){for(var c=a.length;c--;)if(Th(a[c][0],b))return c;return-1}function Gc(a,b,c,d){return ol(a,function(a,e,f){b(d,a,c(a),f)}),d}function Hc(a,b){return a&&Le(b,Oi(b),a)}function Ic(a,b){return a&&Le(b,Pi(b),a)}function Jc(a,b,c){"__proto__"==b&&Ik?Ik(a,b,{configurable:!0,enumerable:!0,value:c,writable:!0}):a[b]=c}function Kc(a,b){for(var c=-1,d=b.length,e=ck(d),f=null==a;++c<d;)e[c]=f?da:Li(a,b[c]);return e}function Lc(a,b,c){return a===a&&(c!==da&&(a=a<=c?a:c),b!==da&&(a=a>=b?a:b)),a}function Mc(a,b,c,d,e,f){var g,i=b&la,j=b&ma,k=b&na;if(c&&(g=e?c(a,d,e,f):c(a)),g!==da)return g;if(!ei(a))return a;var l=qm(a);if(l){if(g=Df(a),!i)return Ke(a,g)}else{var m=Al(a),n=m==Wa||m==Xa;if(sm(a))return Ae(a,i);if(m==_a||m==Pa||n&&!e){if(g=j||n?{}:Ef(a),!i)return j?Ne(a,Ic(g,a)):Me(a,Hc(g,a))}else{if(!Xc[m])return e?a:{};g=Ff(a,m,i)}}f||(f=new tc);var o=f.get(a);if(o)return o;if(f.set(a,g),wm(a))return a.forEach(function(d){g.add(Mc(d,b,c,d,a,f))}),g;if(um(a))return a.forEach(function(d,e){g.set(e,Mc(d,b,c,e,a,f))}),g;var p=k?j?sf:rf:j?Pi:Oi,q=l?da:p(a);return h(q||a,function(d,e){q&&(e=d,d=a[e]),Ec(g,e,Mc(d,b,c,e,a,f))}),g}function Nc(a){var b=Oi(a);return function(c){return Qc(c,a,b)}}function Qc(a,b,c){var d=c.length;if(null==a)return!d;for(a=hk(a);d--;){var e=c[d],f=b[e],g=a[e];if(g===da&&!(e in a)||!f(g))return!1}return!0}function Rc(a,b,c){if("function"!=typeof a)throw new kk(ha);return Dl(function(){a.apply(da,c)},b)}function Sc(a,b,c,d){var e=-1,f=l,g=!0,h=a.length,i=[],j=b.length;if(!h)return i;c&&(b=n(b,H(c))),d?(f=m,g=!1):b.length>=fa&&(f=J,g=!1,b=new qc(b));a:for(;++e<h;){var k=a[e],o=null==c?k:c(k);if(k=d||0!==k?k:0,g&&o===o){for(var p=j;p--;)if(b[p]===o)continue a;i.push(k)}else f(b,o,d)||i.push(k)}return i}function Tc(a,b){var c=!0;return ol(a,function(a,d,e){return c=!!b(a,d,e)}),c}function Yc(a,b,c){for(var d=-1,e=a.length;++d<e;){var f=a[d],g=b(f);if(null!=g&&(h===da?g===g&&!qi(g):c(g,h)))var h=g,i=f}return i}function Zc(a,b,c,d){var e=a.length;for(c=wi(c),c<0&&(c=-c>e?0:e+c),d=d===da||d>e?e:wi(d),d<0&&(d+=e),d=c>d?0:xi(d);c<d;)a[c++]=b;return a}function $c(a,b){var c=[];return ol(a,function(a,d,e){b(a,d,e)&&c.push(a)}),c}function _c(a,b,c,d,e){var f=-1,g=a.length;for(c||(c=Hf),e||(e=[]);++f<g;){var h=a[f];b>0&&c(h)?b>1?_c(h,b-1,c,d,e):o(e,h):d||(e[e.length]=h)}return e}function cd(a,b){return a&&ql(a,b,Oi)}function dd(a,b){return a&&rl(a,b,Oi)}function fd(a,b){return k(b,function(b){return bi(a[b])})}function gd(a,b){b=ye(b,a);for(var c=0,d=b.length;null!=a&&c<d;)a=a[_f(b[c++])];return c&&c==d?a:da}function id(a,b,c){var d=b(a);return qm(a)?d:o(d,c(a))}function jd(a){return null==a?a===da?gb:$a:Hk&&Hk in hk(a)?zf(a):Uf(a)}function qd(a,b){return a>b}function ud(a,b){return null!=a&&qk.call(a,b)}function wd(a,b){return null!=a&&b in hk(a)}function xd(a,b,c){return a>=Uk(b,c)&&a<Tk(b,c)}function yd(a,b,c){for(var d=c?m:l,e=a[0].length,f=a.length,g=f,h=ck(f),i=1/0,j=[];g--;){var k=a[g];g&&b&&(k=n(k,H(b))),i=Uk(k.length,i),h[g]=!c&&(b||e>=120&&k.length>=120)?new qc(g&&k):da}k=a[0];var o=-1,p=h[0];a:for(;++o<e&&j.length<i;){var q=k[o],r=b?b(q):q;if(q=c||0!==q?q:0,!(p?J(p,r):d(j,r,c))){for(g=f;--g;){var s=h[g];if(!(s?J(s,r):d(a[g],r,c)))continue a}p&&p.push(r),j.push(q)}}return j}function zd(a,b,c,d){return cd(a,function(a,e,f){b(d,c(a),e,f)}),d}function Ad(a,b,c){b=ye(b,a),a=Wf(a,b);var d=null==a?a:a[_f(vg(b))];return null==d?da:f(d,a,c)}function Bd(a){return fi(a)&&jd(a)==Pa}function Cd(a){return fi(a)&&jd(a)==jb}function Dd(a){return fi(a)&&jd(a)==Ta}function Ed(a,b,c,d,e){return a===b||(null==a||null==b||!fi(a)&&!fi(b)?a!==a&&b!==b:Fd(a,b,c,d,Ed,e))}function Fd(a,b,c,d,e,f){var g=qm(a),h=qm(b),i=g?Qa:Al(a),j=h?Qa:Al(b);i=i==Pa?_a:i,j=j==Pa?_a:j;var k=i==_a,l=j==_a,m=i==j;if(m&&sm(a)){if(!sm(b))return!1;g=!0,k=!1}if(m&&!k)return f||(f=new tc),g||xm(a)?nf(a,b,c,d,e,f):of(a,b,i,c,d,e,f);if(!(c&oa)){var n=k&&qk.call(a,"__wrapped__"),o=l&&qk.call(b,"__wrapped__");if(n||o){var p=n?a.value():a,q=o?b.value():b;return f||(f=new tc),e(p,q,c,d,f)}}return!!m&&(f||(f=new tc),pf(a,b,c,d,e,f))}function Gd(a){return fi(a)&&Al(a)==Ya}function Hd(a,b,c,d){var e=c.length,f=e,g=!d;if(null==a)return!f;for(a=hk(a);e--;){var h=c[e];if(g&&h[2]?h[1]!==a[h[0]]:!(h[0]in a))return!1}for(;++e<f;){h=c[e];var i=h[0],j=a[i],k=h[1];if(g&&h[2]){if(j===da&&!(i in a))return!1}else{var l=new tc;if(d)var m=d(j,k,i,a,b,l);if(!(m===da?Ed(k,j,oa|pa,d,l):m))return!1}}return!0}function Id(a){return!(!ei(a)||Nf(a))&&(bi(a)?wk:Vb).test(ag(a))}function Jd(a){return fi(a)&&jd(a)==cb}function Kd(a){return fi(a)&&Al(a)==db}function Ld(a){return fi(a)&&di(a.length)&&!!Wc[jd(a)]}function Md(a){return"function"==typeof a?a:null==a?Ej:"object"==typeof a?qm(a)?Sd(a[0],a[1]):Rd(a):Mj(a)}function Nd(a){if(!Of(a))return Sk(a);var b=[];for(var c in hk(a))qk.call(a,c)&&"constructor"!=c&&b.push(c);return b}function Od(a){if(!ei(a))return Tf(a);var b=Of(a),c=[];for(var d in a)("constructor"!=d||!b&&qk.call(a,d))&&c.push(d);return c}function Pd(a,b){return a<b}function Qd(a,b){var c=-1,d=Uh(a)?ck(a.length):[];return ol(a,function(a,e,f){d[++c]=b(a,e,f)}),d}function Rd(a){var b=xf(a);return 1==b.length&&b[0][2]?Qf(b[0][0],b[0][1]):function(c){return c===a||Hd(c,a,b)}}function Sd(a,b){return Kf(a)&&Pf(b)?Qf(_f(a),b):function(c){var d=Li(c,a);return d===da&&d===b?Ni(c,a):Ed(b,d,oa|pa)}}function Td(a,b,c,d,e){a!==b&&ql(b,function(f,g){if(ei(f))e||(e=new tc),Ud(a,b,g,c,Td,d,e);else{var h=d?d(V(a,g),f,g+"",a,b,e):da;h===da&&(h=f),Dc(a,g,h)}},Pi)}function Ud(a,b,c,d,e,f,g){var h=V(a,c),i=V(b,c),j=g.get(i);if(j)return void Dc(a,c,j);var k=f?f(h,i,c+"",a,b,g):da,l=k===da;if(l){var m=qm(i),n=!m&&sm(i),o=!m&&!n&&xm(i);k=i,m||n||o?qm(h)?k=h:Vh(h)?k=Ke(h):n?(l=!1,k=Ae(i,!0)):o?(l=!1,k=Fe(i,!0)):k=[]:ni(i)||pm(i)?(k=h,pm(h)?k=zi(h):(!ei(h)||d&&bi(h))&&(k=Ef(i))):l=!1}l&&(g.set(i,k),e(k,i,d,f,g),g.delete(i)),Dc(a,c,k)}function Vd(a,b){var c=a.length;if(c)return b+=b<0?c:0,If(b,c)?a[b]:da}function Wd(a,b,c){var d=-1;return b=n(b.length?b:[Ej],H(vf())),D(Qd(a,function(a,c,e){return{criteria:n(b,function(b){return b(a)}),index:++d,value:a}}),function(a,b){return He(a,b,c)})}function Xd(a,b){return Yd(a,b,function(b,c){return Ni(a,c)})}function Yd(a,b,c){for(var d=-1,e=b.length,f={};++d<e;){var g=b[d],h=gd(a,g);c(h,g)&&ge(f,ye(g,a),h)}return f}function Zd(a){return function(b){return gd(b,a)}}function $d(a,b,c,d){var e=d?x:w,f=-1,g=b.length,h=a;for(a===b&&(b=Ke(b)),c&&(h=n(a,H(c)));++f<g;)for(var i=0,j=b[f],k=c?c(j):j;(i=e(h,k,i,d))>-1;)h!==a&&Ek.call(h,i,1),Ek.call(a,i,1);return a}function _d(a,b){for(var c=a?b.length:0,d=c-1;c--;){var e=b[c];if(c==d||e!==f){var f=e;If(e)?Ek.call(a,e,1):qe(a,e)}}return a}function ae(a,b){return a+Nk(Xk()*(b-a+1))}function be(a,b,c,d){for(var e=-1,f=Tk(Mk((b-a)/(c||1)),0),g=ck(f);f--;)g[d?f:++e]=a,a+=c;return g}function ce(a,b){var c="";if(!a||b<1||b>Ia)return c;do{b%2&&(c+=a),(b=Nk(b/2))&&(a+=a)}while(b);return c}function de(a,b){return El(Vf(a,b,Ej),a+"")}function ee(a){return Ac(_i(a))}function fe(a,b){var c=_i(a);return $f(c,Lc(b,0,c.length))}function ge(a,b,c,d){if(!ei(a))return a;b=ye(b,a);for(var e=-1,f=b.length,g=f-1,h=a;null!=h&&++e<f;){var i=_f(b[e]),j=c;if(e!=g){var k=h[i];j=d?d(k,i,h):da,j===da&&(j=ei(k)?k:If(b[e+1])?[]:{})}Ec(h,i,j),h=h[i]}return a}function he(a){return $f(_i(a))}function ie(a,b,c){var d=-1,e=a.length;b<0&&(b=-b>e?0:e+b),c=c>e?e:c,c<0&&(c+=e),e=b>c?0:c-b>>>0,b>>>=0;for(var f=ck(e);++d<e;)f[d]=a[d+b];return f}function je(a,b){var c;return ol(a,function(a,d,e){return!(c=b(a,d,e))}),!!c}function ke(a,b,c){var d=0,e=null==a?d:a.length;if("number"==typeof b&&b===b&&e<=Na){for(;d<e;){var f=d+e>>>1,g=a[f];null!==g&&!qi(g)&&(c?g<=b:g<b)?d=f+1:e=f}return e}return le(a,b,Ej,c)}function le(a,b,c,d){b=c(b);for(var e=0,f=null==a?0:a.length,g=b!==b,h=null===b,i=qi(b),j=b===da;e<f;){var k=Nk((e+f)/2),l=c(a[k]),m=l!==da,n=null===l,o=l===l,p=qi(l);if(g)var q=d||o;else q=j?o&&(d||m):h?o&&m&&(d||!n):i?o&&m&&!n&&(d||!p):!n&&!p&&(d?l<=b:l<b);q?e=k+1:f=k}return Uk(f,Ma)}function me(a,b){for(var c=-1,d=a.length,e=0,f=[];++c<d;){var g=a[c],h=b?b(g):g;if(!c||!Th(h,i)){var i=h;f[e++]=0===g?0:g}}return f}function ne(a){return"number"==typeof a?a:qi(a)?Ka:+a}function oe(a){if("string"==typeof a)return a;if(qm(a))return n(a,oe)+"";if(qi(a))return ml?ml.call(a):"";var b=a+"";return"0"==b&&1/a==-Ha?"-0":b}function pe(a,b,c){var d=-1,e=l,f=a.length,g=!0,h=[],i=h;if(c)g=!1,e=m;else if(f>=fa){var j=b?null:wl(a);if(j)return W(j);g=!1,e=J,i=new qc}else i=b?[]:h;a:for(;++d<f;){var k=a[d],n=b?b(k):k;if(k=c||0!==k?k:0,g&&n===n){for(var o=i.length;o--;)if(i[o]===n)continue a;b&&i.push(n),h.push(k)}else e(i,n,c)||(i!==h&&i.push(n),h.push(k))}return h}function qe(a,b){return b=ye(b,a),null==(a=Wf(a,b))||delete a[_f(vg(b))]}function re(a,b,c,d){return ge(a,b,c(gd(a,b)),d)}function se(a,b,c,d){for(var e=a.length,f=d?e:-1;(d?f--:++f<e)&&b(a[f],f,a););return c?ie(a,d?0:f,d?f+1:e):ie(a,d?f+1:0,d?e:f)}function te(a,b){var c=a;return c instanceof B&&(c=c.value()),p(b,function(a,b){return b.func.apply(b.thisArg,o([a],b.args))},c)}function ue(a,b,c){var d=a.length;if(d<2)return d?pe(a[0]):[];for(var e=-1,f=ck(d);++e<d;)for(var g=a[e],h=-1;++h<d;)h!=e&&(f[e]=Sc(f[e]||g,a[h],b,c));return pe(_c(f,1),b,c)}function ve(a,b,c){for(var d=-1,e=a.length,f=b.length,g={};++d<e;){var h=d<f?b[d]:da;c(g,a[d],h)}return g}function we(a){return Vh(a)?a:[]}function xe(a){return"function"==typeof a?a:Ej}function ye(a,b){return qm(a)?a:Kf(a,b)?[a]:Fl(Bi(a))}function ze(a,b,c){var d=a.length;return c=c===da?d:c,!b&&c>=d?a:ie(a,b,c)}function Ae(a,b){if(b)return a.slice();var c=a.length,d=Ak?Ak(c):new a.constructor(c);return a.copy(d),d}function Be(a){var b=new a.constructor(a.byteLength);return new zk(b).set(new zk(a)),b}function Ce(a,b){var c=b?Be(a.buffer):a.buffer;return new a.constructor(c,a.byteOffset,a.byteLength)}function De(a){var b=new a.constructor(a.source,Sb.exec(a));return b.lastIndex=a.lastIndex,b}function Ee(a){return ll?hk(ll.call(a)):{}}function Fe(a,b){var c=b?Be(a.buffer):a.buffer;return new a.constructor(c,a.byteOffset,a.length)}function Ge(a,b){if(a!==b){var c=a!==da,d=null===a,e=a===a,f=qi(a),g=b!==da,h=null===b,i=b===b,j=qi(b);if(!h&&!j&&!f&&a>b||f&&g&&i&&!h&&!j||d&&g&&i||!c&&i||!e)return 1;if(!d&&!f&&!j&&a<b||j&&c&&e&&!d&&!f||h&&c&&e||!g&&e||!i)return-1}return 0}function He(a,b,c){for(var d=-1,e=a.criteria,f=b.criteria,g=e.length,h=c.length;++d<g;){var i=Ge(e[d],f[d]);if(i){if(d>=h)return i;return i*("desc"==c[d]?-1:1)}}return a.index-b.index}function Ie(a,b,c,d){for(var e=-1,f=a.length,g=c.length,h=-1,i=b.length,j=Tk(f-g,0),k=ck(i+j),l=!d;++h<i;)k[h]=b[h];for(;++e<g;)(l||e<f)&&(k[c[e]]=a[e]);for(;j--;)k[h++]=a[e++];return k}function Je(a,b,c,d){for(var e=-1,f=a.length,g=-1,h=c.length,i=-1,j=b.length,k=Tk(f-h,0),l=ck(k+j),m=!d;++e<k;)l[e]=a[e];for(var n=e;++i<j;)l[n+i]=b[i];for(;++g<h;)(m||e<f)&&(l[n+c[g]]=a[e++]);return l}function Ke(a,b){var c=-1,d=a.length;for(b||(b=ck(d));++c<d;)b[c]=a[c];return b}function Le(a,b,c,d){var e=!c;c||(c={});for(var f=-1,g=b.length;++f<g;){var h=b[f],i=d?d(c[h],a[h],h,c,a):da;i===da&&(i=a[h]),e?Jc(c,h,i):Ec(c,h,i)}return c}function Me(a,b){return Le(a,yl(a),b)}function Ne(a,b){return Le(a,zl(a),b)}function Oe(a,b){return function(c,d){var e=qm(c)?g:Gc,f=b?b():{};return e(c,a,vf(d,2),f)}}function Pe(a){return de(function(b,c){var d=-1,e=c.length,f=e>1?c[e-1]:da,g=e>2?c[2]:da;for(f=a.length>3&&"function"==typeof f?(e--,f):da,g&&Jf(c[0],c[1],g)&&(f=e<3?da:f,e=1),b=hk(b);++d<e;){var h=c[d];h&&a(b,h,d,f)}return b})}function Qe(a,b){return function(c,d){if(null==c)return c;if(!Uh(c))return a(c,d);for(var e=c.length,f=b?e:-1,g=hk(c);(b?f--:++f<e)&&!1!==d(g[f],f,g););return c}}function Re(a){return function(b,c,d){for(var e=-1,f=hk(b),g=d(b),h=g.length;h--;){var i=g[a?h:++e];if(!1===c(f[i],i,f))break}return b}}function Se(a,b,c){function d(){return(this&&this!==ed&&this instanceof d?f:a).apply(e?c:this,arguments)}var e=b&qa,f=Ve(a);return d}function Te(a){return function(b){b=Bi(b);var c=P(b)?_(b):da,d=c?c[0]:b.charAt(0),e=c?ze(c,1).join(""):b.slice(1);return d[a]()+e}}function Ue(a){return function(b){return p(zj(fj(b).replace(Oc,"")),a,"")}}function Ve(a){return function(){var b=arguments;switch(b.length){case 0:return new a;case 1:return new a(b[0]);case 2:return new a(b[0],b[1]);case 3:return new a(b[0],b[1],b[2]);case 4:return new a(b[0],b[1],b[2],b[3]);case 5:return new a(b[0],b[1],b[2],b[3],b[4]);case 6:return new a(b[0],b[1],b[2],b[3],b[4],b[5]);case 7:return new a(b[0],b[1],b[2],b[3],b[4],b[5],b[6])}var c=nl(a.prototype),d=a.apply(c,b);return ei(d)?d:c}}function We(a,b,c){function d(){for(var g=arguments.length,h=ck(g),i=g,j=uf(d);i--;)h[i]=arguments[i];var k=g<3&&h[0]!==j&&h[g-1]!==j?[]:U(h,j);return(g-=k.length)<c?ff(a,b,Ze,d.placeholder,da,h,k,da,da,c-g):f(this&&this!==ed&&this instanceof d?e:a,this,h)}var e=Ve(a);return d}function Xe(a){return function(b,c,d){var e=hk(b);if(!Uh(b)){var f=vf(c,3);b=Oi(b),c=function(a){return f(e[a],a,e)}}var g=a(b,c,d);return g>-1?e[f?b[g]:g]:da}}function Ye(a){return qf(function(b){var c=b.length,d=c,e=s.prototype.thru;for(a&&b.reverse();d--;){var f=b[d];if("function"!=typeof f)throw new kk(ha);if(e&&!g&&"wrapper"==tf(f))var g=new s([],!0)}for(d=g?d:c;++d<c;){f=b[d];var h=tf(f),i="wrapper"==h?xl(f):da;g=i&&Mf(i[0])&&i[1]==(xa|ta|va|ya)&&!i[4].length&&1==i[9]?g[tf(i[0])].apply(g,i[3]):1==f.length&&Mf(f)?g[h]():g.thru(f)}return function(){var a=arguments,d=a[0];if(g&&1==a.length&&qm(d))return g.plant(d).value();for(var e=0,f=c?b[e].apply(this,a):d;++e<c;)f=b[e].call(this,f);return f}})}function Ze(a,b,c,d,e,f,g,h,i,j){function k(){for(var r=arguments.length,s=ck(r),t=r;t--;)s[t]=arguments[t];if(o)var u=uf(k),v=M(s,u);if(d&&(s=Ie(s,d,e,o)),f&&(s=Je(s,f,g,o)),r-=v,o&&r<j){var w=U(s,u);return ff(a,b,Ze,k.placeholder,c,s,w,h,i,j-r)}var x=m?c:this,y=n?x[a]:a;return r=s.length,h?s=Xf(s,h):p&&r>1&&s.reverse(),l&&i<r&&(s.length=i),this&&this!==ed&&this instanceof k&&(y=q||Ve(y)),y.apply(x,s)}var l=b&xa,m=b&qa,n=b&ra,o=b&(ta|ua),p=b&za,q=n?da:Ve(a);return k}function $e(a,b){return function(c,d){return zd(c,a,b(d),{})}}function _e(a,b){return function(c,d){var e;if(c===da&&d===da)return b;if(c!==da&&(e=c),d!==da){if(e===da)return d;"string"==typeof c||"string"==typeof d?(c=oe(c),d=oe(d)):(c=ne(c),d=ne(d)),e=a(c,d)}return e}}function af(a){return qf(function(b){return b=n(b,H(vf())),de(function(c){var d=this;return a(b,function(a){return f(a,d,c)})})})}function bf(a,b){b=b===da?" ":oe(b);var c=b.length;if(c<2)return c?ce(b,a):b;var d=ce(b,Mk(a/$(b)));return P(b)?ze(_(d),0,a).join(""):d.slice(0,a)}function cf(a,b,c,d){function e(){for(var b=-1,i=arguments.length,j=-1,k=d.length,l=ck(k+i),m=this&&this!==ed&&this instanceof e?h:a;++j<k;)l[j]=d[j];for(;i--;)l[j++]=arguments[++b];return f(m,g?c:this,l)}var g=b&qa,h=Ve(a);return e}function df(a){return function(b,c,d){return d&&"number"!=typeof d&&Jf(b,c,d)&&(c=d=da),b=vi(b),c===da?(c=b,b=0):c=vi(c),d=d===da?b<c?1:-1:vi(d),be(b,c,d,a)}}function ef(a){return function(b,c){return"string"==typeof b&&"string"==typeof c||(b=yi(b),c=yi(c)),a(b,c)}}function ff(a,b,c,d,e,f,g,h,i,j){var k=b&ta,l=k?g:da,m=k?da:g,n=k?f:da,o=k?da:f;b|=k?va:wa,(b&=~(k?wa:va))&sa||(b&=~(qa|ra));var p=[a,b,e,n,l,o,m,h,i,j],q=c.apply(da,p);return Mf(a)&&Cl(q,p),q.placeholder=d,Yf(q,a,b)}function gf(a){var b=gk[a];return function(a,c){if(a=yi(a),c=null==c?0:Uk(wi(c),292)){var d=(Bi(a)+"e").split("e");return d=(Bi(b(d[0]+"e"+(+d[1]+c)))+"e").split("e"),+(d[0]+"e"+(+d[1]-c))}return b(a)}}function hf(a){return function(b){var c=Al(b);return c==Ya?S(b):c==db?X(b):G(b,a(b))}}function jf(a,b,c,d,e,f,g,h){var i=b&ra;if(!i&&"function"!=typeof a)throw new kk(ha);var j=d?d.length:0;if(j||(b&=~(va|wa),d=e=da),g=g===da?g:Tk(wi(g),0),h=h===da?h:wi(h),j-=e?e.length:0,b&wa){var k=d,l=e;d=e=da}var m=i?da:xl(a),n=[a,b,c,d,e,k,l,f,g,h];if(m&&Sf(n,m),a=n[0],b=n[1],c=n[2],d=n[3],e=n[4],
h=n[9]=n[9]===da?i?0:a.length:Tk(n[9]-j,0),!h&&b&(ta|ua)&&(b&=~(ta|ua)),b&&b!=qa)o=b==ta||b==ua?We(a,b,h):b!=va&&b!=(qa|va)||e.length?Ze.apply(da,n):cf(a,b,c,d);else var o=Se(a,b,c);return Yf((m?sl:Cl)(o,n),a,b)}function kf(a,b,c,d){return a===da||Th(a,nk[c])&&!qk.call(d,c)?b:a}function lf(a,b,c,d,e,f){return ei(a)&&ei(b)&&(f.set(b,a),Td(a,b,da,lf,f),f.delete(b)),a}function mf(a){return ni(a)?da:a}function nf(a,b,c,d,e,f){var g=c&oa,h=a.length,i=b.length;if(h!=i&&!(g&&i>h))return!1;var j=f.get(a);if(j&&f.get(b))return j==b;var k=-1,l=!0,m=c&pa?new qc:da;for(f.set(a,b),f.set(b,a);++k<h;){var n=a[k],o=b[k];if(d)var p=g?d(o,n,k,b,a,f):d(n,o,k,a,b,f);if(p!==da){if(p)continue;l=!1;break}if(m){if(!r(b,function(a,b){if(!J(m,b)&&(n===a||e(n,a,c,d,f)))return m.push(b)})){l=!1;break}}else if(n!==o&&!e(n,o,c,d,f)){l=!1;break}}return f.delete(a),f.delete(b),l}function of(a,b,c,d,e,f,g){switch(c){case kb:if(a.byteLength!=b.byteLength||a.byteOffset!=b.byteOffset)return!1;a=a.buffer,b=b.buffer;case jb:return!(a.byteLength!=b.byteLength||!f(new zk(a),new zk(b)));case Sa:case Ta:case Za:return Th(+a,+b);case Va:return a.name==b.name&&a.message==b.message;case cb:case eb:return a==b+"";case Ya:var h=S;case db:var i=d&oa;if(h||(h=W),a.size!=b.size&&!i)return!1;var j=g.get(a);if(j)return j==b;d|=pa,g.set(a,b);var k=nf(h(a),h(b),d,e,f,g);return g.delete(a),k;case fb:if(ll)return ll.call(a)==ll.call(b)}return!1}function pf(a,b,c,d,e,f){var g=c&oa,h=rf(a),i=h.length;if(i!=rf(b).length&&!g)return!1;for(var j=i;j--;){var k=h[j];if(!(g?k in b:qk.call(b,k)))return!1}var l=f.get(a);if(l&&f.get(b))return l==b;var m=!0;f.set(a,b),f.set(b,a);for(var n=g;++j<i;){k=h[j];var o=a[k],p=b[k];if(d)var q=g?d(p,o,k,b,a,f):d(o,p,k,a,b,f);if(!(q===da?o===p||e(o,p,c,d,f):q)){m=!1;break}n||(n="constructor"==k)}if(m&&!n){var r=a.constructor,s=b.constructor;r!=s&&"constructor"in a&&"constructor"in b&&!("function"==typeof r&&r instanceof r&&"function"==typeof s&&s instanceof s)&&(m=!1)}return f.delete(a),f.delete(b),m}function qf(a){return El(Vf(a,da,ng),a+"")}function rf(a){return id(a,Oi,yl)}function sf(a){return id(a,Pi,zl)}function tf(a){for(var b=a.name+"",c=el[b],d=qk.call(el,b)?c.length:0;d--;){var e=c[d],f=e.func;if(null==f||f==a)return e.name}return b}function uf(a){return(qk.call(c,"placeholder")?c:a).placeholder}function vf(){var a=c.iteratee||Fj;return a=a===Fj?Md:a,arguments.length?a(arguments[0],arguments[1]):a}function wf(a,b){var c=a.__data__;return Lf(b)?c["string"==typeof b?"string":"hash"]:c.map}function xf(a){for(var b=Oi(a),c=b.length;c--;){var d=b[c],e=a[d];b[c]=[d,e,Pf(e)]}return b}function yf(a,b){var c=O(a,b);return Id(c)?c:da}function zf(a){var b=qk.call(a,Hk),c=a[Hk];try{a[Hk]=da;var d=!0}catch(e){}var e=tk.call(a);return d&&(b?a[Hk]=c:delete a[Hk]),e}function Af(a,b,c){for(var d=-1,e=c.length;++d<e;){var f=c[d],g=f.size;switch(f.type){case"drop":a+=g;break;case"dropRight":b-=g;break;case"take":b=Uk(b,a+g);break;case"takeRight":a=Tk(a,b-g)}}return{start:a,end:b}}function Bf(a){var b=a.match(Nb);return b?b[1].split(Ob):[]}function Cf(a,b,c){b=ye(b,a);for(var d=-1,e=b.length,f=!1;++d<e;){var g=_f(b[d]);if(!(f=null!=a&&c(a,g)))break;a=a[g]}return f||++d!=e?f:!!(e=null==a?0:a.length)&&di(e)&&If(g,e)&&(qm(a)||pm(a))}function Df(a){var b=a.length,c=new a.constructor(b);return b&&"string"==typeof a[0]&&qk.call(a,"index")&&(c.index=a.index,c.input=a.input),c}function Ef(a){return"function"!=typeof a.constructor||Of(a)?{}:nl(Bk(a))}function Ff(a,b,c){var d=a.constructor;switch(b){case jb:return Be(a);case Sa:case Ta:return new d(+a);case kb:return Ce(a,c);case lb:case mb:case nb:case ob:case pb:case qb:case rb:case sb:case tb:return Fe(a,c);case Ya:return new d;case Za:case eb:return new d(a);case cb:return De(a);case db:return new d;case fb:return Ee(a)}}function Gf(a,b){var c=b.length;if(!c)return a;var d=c-1;return b[d]=(c>1?"& ":"")+b[d],b=b.join(c>2?", ":" "),a.replace(Mb,"{\n/* [wrapped with "+b+"] */\n")}function Hf(a){return qm(a)||pm(a)||!!(Fk&&a&&a[Fk])}function If(a,b){var c=typeof a;return!!(b=null==b?Ia:b)&&("number"==c||"symbol"!=c&&Xb.test(a))&&a>-1&&a%1==0&&a<b}function Jf(a,b,c){if(!ei(c))return!1;var d=typeof b;return!!("number"==d?Uh(c)&&If(b,c.length):"string"==d&&b in c)&&Th(c[b],a)}function Kf(a,b){if(qm(a))return!1;var c=typeof a;return!("number"!=c&&"symbol"!=c&&"boolean"!=c&&null!=a&&!qi(a))||(Fb.test(a)||!Eb.test(a)||null!=b&&a in hk(b))}function Lf(a){var b=typeof a;return"string"==b||"number"==b||"symbol"==b||"boolean"==b?"__proto__"!==a:null===a}function Mf(a){var b=tf(a),d=c[b];if("function"!=typeof d||!(b in B.prototype))return!1;if(a===d)return!0;var e=xl(d);return!!e&&a===e[0]}function Nf(a){return!!sk&&sk in a}function Of(a){var b=a&&a.constructor;return a===("function"==typeof b&&b.prototype||nk)}function Pf(a){return a===a&&!ei(a)}function Qf(a,b){return function(c){return null!=c&&(c[a]===b&&(b!==da||a in hk(c)))}}function Rf(a){var b=Fh(a,function(a){return c.size===ja&&c.clear(),a}),c=b.cache;return b}function Sf(a,b){var c=a[1],d=b[1],e=c|d,f=e<(qa|ra|xa),g=d==xa&&c==ta||d==xa&&c==ya&&a[7].length<=b[8]||d==(xa|ya)&&b[7].length<=b[8]&&c==ta;if(!f&&!g)return a;d&qa&&(a[2]=b[2],e|=c&qa?0:sa);var h=b[3];if(h){var i=a[3];a[3]=i?Ie(i,h,b[4]):h,a[4]=i?U(a[3],ka):b[4]}return h=b[5],h&&(i=a[5],a[5]=i?Je(i,h,b[6]):h,a[6]=i?U(a[5],ka):b[6]),h=b[7],h&&(a[7]=h),d&xa&&(a[8]=null==a[8]?b[8]:Uk(a[8],b[8])),null==a[9]&&(a[9]=b[9]),a[0]=b[0],a[1]=e,a}function Tf(a){var b=[];if(null!=a)for(var c in hk(a))b.push(c);return b}function Uf(a){return tk.call(a)}function Vf(a,b,c){return b=Tk(b===da?a.length-1:b,0),function(){for(var d=arguments,e=-1,g=Tk(d.length-b,0),h=ck(g);++e<g;)h[e]=d[b+e];e=-1;for(var i=ck(b+1);++e<b;)i[e]=d[e];return i[b]=c(h),f(a,this,i)}}function Wf(a,b){return b.length<2?a:gd(a,ie(b,0,-1))}function Xf(a,b){for(var c=a.length,d=Uk(b.length,c),e=Ke(a);d--;){var f=b[d];a[d]=If(f,c)?e[f]:da}return a}function Yf(a,b,c){var d=b+"";return El(a,Gf(d,bg(Bf(d),c)))}function Zf(a){var b=0,c=0;return function(){var d=Vk(),e=Da-(d-c);if(c=d,e>0){if(++b>=Ca)return arguments[0]}else b=0;return a.apply(da,arguments)}}function $f(a,b){var c=-1,d=a.length,e=d-1;for(b=b===da?d:b;++c<b;){var f=ae(c,e),g=a[f];a[f]=a[c],a[c]=g}return a.length=b,a}function _f(a){if("string"==typeof a||qi(a))return a;var b=a+"";return"0"==b&&1/a==-Ha?"-0":b}function ag(a){if(null!=a){try{return pk.call(a)}catch(e){}try{return a+""}catch(e){}}return""}function bg(a,b){return h(Oa,function(c){var d="_."+c[0];b&c[1]&&!l(a,d)&&a.push(d)}),a.sort()}function cg(a){if(a instanceof B)return a.clone();var b=new s(a.__wrapped__,a.__chain__);return b.__actions__=Ke(a.__actions__),b.__index__=a.__index__,b.__values__=a.__values__,b}function dg(a,b,c){b=(c?Jf(a,b,c):b===da)?1:Tk(wi(b),0);var d=null==a?0:a.length;if(!d||b<1)return[];for(var e=0,f=0,g=ck(Mk(d/b));e<d;)g[f++]=ie(a,e,e+=b);return g}function eg(a){for(var b=-1,c=null==a?0:a.length,d=0,e=[];++b<c;){var f=a[b];f&&(e[d++]=f)}return e}function fg(){var a=arguments.length;if(!a)return[];for(var b=ck(a-1),c=arguments[0],d=a;d--;)b[d-1]=arguments[d];return o(qm(c)?Ke(c):[c],_c(b,1))}function gg(a,b,c){var d=null==a?0:a.length;return d?(b=c||b===da?1:wi(b),ie(a,b<0?0:b,d)):[]}function hg(a,b,c){var d=null==a?0:a.length;return d?(b=c||b===da?1:wi(b),b=d-b,ie(a,0,b<0?0:b)):[]}function ig(a,b){return a&&a.length?se(a,vf(b,3),!0,!0):[]}function jg(a,b){return a&&a.length?se(a,vf(b,3),!0):[]}function kg(a,b,c,d){var e=null==a?0:a.length;return e?(c&&"number"!=typeof c&&Jf(a,b,c)&&(c=0,d=e),Zc(a,b,c,d)):[]}function lg(a,b,c){var d=null==a?0:a.length;if(!d)return-1;var e=null==c?0:wi(c);return e<0&&(e=Tk(d+e,0)),v(a,vf(b,3),e)}function mg(a,b,c){var d=null==a?0:a.length;if(!d)return-1;var e=d-1;return c!==da&&(e=wi(c),e=c<0?Tk(d+e,0):Uk(e,d-1)),v(a,vf(b,3),e,!0)}function ng(a){return(null==a?0:a.length)?_c(a,1):[]}function og(a){return(null==a?0:a.length)?_c(a,Ha):[]}function pg(a,b){return(null==a?0:a.length)?(b=b===da?1:wi(b),_c(a,b)):[]}function qg(a){for(var b=-1,c=null==a?0:a.length,d={};++b<c;){var e=a[b];d[e[0]]=e[1]}return d}function rg(a){return a&&a.length?a[0]:da}function sg(a,b,c){var d=null==a?0:a.length;if(!d)return-1;var e=null==c?0:wi(c);return e<0&&(e=Tk(d+e,0)),w(a,b,e)}function tg(a){return(null==a?0:a.length)?ie(a,0,-1):[]}function ug(a,b){return null==a?"":Rk.call(a,b)}function vg(a){var b=null==a?0:a.length;return b?a[b-1]:da}function wg(a,b,c){var d=null==a?0:a.length;if(!d)return-1;var e=d;return c!==da&&(e=wi(c),e=e<0?Tk(d+e,0):Uk(e,d-1)),b===b?Z(a,b,e):v(a,y,e,!0)}function xg(a,b){return a&&a.length?Vd(a,wi(b)):da}function yg(a,b){return a&&a.length&&b&&b.length?$d(a,b):a}function zg(a,b,c){return a&&a.length&&b&&b.length?$d(a,b,vf(c,2)):a}function Ag(a,b,c){return a&&a.length&&b&&b.length?$d(a,b,da,c):a}function Bg(a,b){var c=[];if(!a||!a.length)return c;var d=-1,e=[],f=a.length;for(b=vf(b,3);++d<f;){var g=a[d];b(g,d,a)&&(c.push(g),e.push(d))}return _d(a,e),c}function Cg(a){return null==a?a:Yk.call(a)}function Dg(a,b,c){var d=null==a?0:a.length;return d?(c&&"number"!=typeof c&&Jf(a,b,c)?(b=0,c=d):(b=null==b?0:wi(b),c=c===da?d:wi(c)),ie(a,b,c)):[]}function Eg(a,b){return ke(a,b)}function Fg(a,b,c){return le(a,b,vf(c,2))}function Gg(a,b){var c=null==a?0:a.length;if(c){var d=ke(a,b);if(d<c&&Th(a[d],b))return d}return-1}function Hg(a,b){return ke(a,b,!0)}function Ig(a,b,c){return le(a,b,vf(c,2),!0)}function Jg(a,b){if(null==a?0:a.length){var c=ke(a,b,!0)-1;if(Th(a[c],b))return c}return-1}function Kg(a){return a&&a.length?me(a):[]}function Lg(a,b){return a&&a.length?me(a,vf(b,2)):[]}function Mg(a){var b=null==a?0:a.length;return b?ie(a,1,b):[]}function Ng(a,b,c){return a&&a.length?(b=c||b===da?1:wi(b),ie(a,0,b<0?0:b)):[]}function Og(a,b,c){var d=null==a?0:a.length;return d?(b=c||b===da?1:wi(b),b=d-b,ie(a,b<0?0:b,d)):[]}function Pg(a,b){return a&&a.length?se(a,vf(b,3),!1,!0):[]}function Qg(a,b){return a&&a.length?se(a,vf(b,3)):[]}function Rg(a){return a&&a.length?pe(a):[]}function Sg(a,b){return a&&a.length?pe(a,vf(b,2)):[]}function Tg(a,b){return b="function"==typeof b?b:da,a&&a.length?pe(a,da,b):[]}function Ug(a){if(!a||!a.length)return[];var b=0;return a=k(a,function(a){if(Vh(a))return b=Tk(a.length,b),!0}),F(b,function(b){return n(a,A(b))})}function Vg(a,b){if(!a||!a.length)return[];var c=Ug(a);return null==b?c:n(c,function(a){return f(b,da,a)})}function Wg(a,b){return ve(a||[],b||[],Ec)}function Xg(a,b){return ve(a||[],b||[],ge)}function Yg(a){var b=c(a);return b.__chain__=!0,b}function Zg(a,b){return b(a),a}function $g(a,b){return b(a)}function _g(){return Yg(this)}function ah(){return new s(this.value(),this.__chain__)}function bh(){this.__values__===da&&(this.__values__=ui(this.value()));var a=this.__index__>=this.__values__.length;return{done:a,value:a?da:this.__values__[this.__index__++]}}function ch(){return this}function dh(a){for(var b,c=this;c instanceof d;){var e=cg(c);e.__index__=0,e.__values__=da,b?f.__wrapped__=e:b=e;var f=e;c=c.__wrapped__}return f.__wrapped__=a,b}function eh(){var a=this.__wrapped__;if(a instanceof B){var b=a;return this.__actions__.length&&(b=new B(this)),b=b.reverse(),b.__actions__.push({func:$g,args:[Cg],thisArg:da}),new s(b,this.__chain__)}return this.thru(Cg)}function fh(){return te(this.__wrapped__,this.__actions__)}function gh(a,b,c){var d=qm(a)?j:Tc;return c&&Jf(a,b,c)&&(b=da),d(a,vf(b,3))}function hh(a,b){return(qm(a)?k:$c)(a,vf(b,3))}function ih(a,b){return _c(oh(a,b),1)}function jh(a,b){return _c(oh(a,b),Ha)}function kh(a,b,c){return c=c===da?1:wi(c),_c(oh(a,b),c)}function lh(a,b){return(qm(a)?h:ol)(a,vf(b,3))}function mh(a,b){return(qm(a)?i:pl)(a,vf(b,3))}function nh(a,b,c,d){a=Uh(a)?a:_i(a),c=c&&!d?wi(c):0;var e=a.length;return c<0&&(c=Tk(e+c,0)),pi(a)?c<=e&&a.indexOf(b,c)>-1:!!e&&w(a,b,c)>-1}function oh(a,b){return(qm(a)?n:Qd)(a,vf(b,3))}function ph(a,b,c,d){return null==a?[]:(qm(b)||(b=null==b?[]:[b]),c=d?da:c,qm(c)||(c=null==c?[]:[c]),Wd(a,b,c))}function qh(a,b,c){var d=qm(a)?p:C,e=arguments.length<3;return d(a,vf(b,4),c,e,ol)}function rh(a,b,c){var d=qm(a)?q:C,e=arguments.length<3;return d(a,vf(b,4),c,e,pl)}function sh(a,b){return(qm(a)?k:$c)(a,Gh(vf(b,3)))}function th(a){return(qm(a)?Ac:ee)(a)}function uh(a,b,c){return b=(c?Jf(a,b,c):b===da)?1:wi(b),(qm(a)?Bc:fe)(a,b)}function vh(a){return(qm(a)?Cc:he)(a)}function wh(a){if(null==a)return 0;if(Uh(a))return pi(a)?$(a):a.length;var b=Al(a);return b==Ya||b==db?a.size:Nd(a).length}function xh(a,b,c){var d=qm(a)?r:je;return c&&Jf(a,b,c)&&(b=da),d(a,vf(b,3))}function yh(a,b){if("function"!=typeof b)throw new kk(ha);return a=wi(a),function(){if(--a<1)return b.apply(this,arguments)}}function zh(a,b,c){return b=c?da:b,b=a&&null==b?a.length:b,jf(a,xa,da,da,da,da,b)}function Ah(a,b){var c;if("function"!=typeof b)throw new kk(ha);return a=wi(a),function(){return--a>0&&(c=b.apply(this,arguments)),a<=1&&(b=da),c}}function Bh(a,b,c){b=c?da:b;var d=jf(a,ta,da,da,da,da,da,b);return d.placeholder=Bh.placeholder,d}function Ch(a,b,c){b=c?da:b;var d=jf(a,ua,da,da,da,da,da,b);return d.placeholder=Ch.placeholder,d}function Dh(a,b,c){function d(b){var c=m,d=n;return m=n=da,s=b,p=a.apply(d,c)}function e(a){return s=a,q=Dl(h,b),t?d(a):p}function f(a){var c=a-r,d=a-s,e=b-c;return u?Uk(e,o-d):e}function g(a){var c=a-r,d=a-s;return r===da||c>=b||c<0||u&&d>=o}function h(){var a=em();if(g(a))return i(a);q=Dl(h,f(a))}function i(a){return q=da,v&&m?d(a):(m=n=da,p)}function j(){q!==da&&vl(q),s=0,m=r=n=q=da}function k(){return q===da?p:i(em())}function l(){var a=em(),c=g(a);if(m=arguments,n=this,r=a,c){if(q===da)return e(r);if(u)return q=Dl(h,b),d(r)}return q===da&&(q=Dl(h,b)),p}var m,n,o,p,q,r,s=0,t=!1,u=!1,v=!0;if("function"!=typeof a)throw new kk(ha);return b=yi(b)||0,ei(c)&&(t=!!c.leading,u="maxWait"in c,o=u?Tk(yi(c.maxWait)||0,b):o,v="trailing"in c?!!c.trailing:v),l.cancel=j,l.flush=k,l}function Eh(a){return jf(a,za)}function Fh(a,b){if("function"!=typeof a||null!=b&&"function"!=typeof b)throw new kk(ha);var c=function(){var d=arguments,e=b?b.apply(this,d):d[0],f=c.cache;if(f.has(e))return f.get(e);var g=a.apply(this,d);return c.cache=f.set(e,g)||f,g};return c.cache=new(Fh.Cache||kc),c}function Gh(a){if("function"!=typeof a)throw new kk(ha);return function(){var b=arguments;switch(b.length){case 0:return!a.call(this);case 1:return!a.call(this,b[0]);case 2:return!a.call(this,b[0],b[1]);case 3:return!a.call(this,b[0],b[1],b[2])}return!a.apply(this,b)}}function Hh(a){return Ah(2,a)}function Ih(a,b){if("function"!=typeof a)throw new kk(ha);return b=b===da?b:wi(b),de(a,b)}function Jh(a,b){if("function"!=typeof a)throw new kk(ha);return b=null==b?0:Tk(wi(b),0),de(function(c){var d=c[b],e=ze(c,0,b);return d&&o(e,d),f(a,this,e)})}function Kh(a,b,c){var d=!0,e=!0;if("function"!=typeof a)throw new kk(ha);return ei(c)&&(d="leading"in c?!!c.leading:d,e="trailing"in c?!!c.trailing:e),Dh(a,b,{leading:d,maxWait:b,trailing:e})}function Lh(a){return zh(a,1)}function Mh(a,b){return km(xe(b),a)}function Nh(){if(!arguments.length)return[];var a=arguments[0];return qm(a)?a:[a]}function Oh(a){return Mc(a,na)}function Ph(a,b){return b="function"==typeof b?b:da,Mc(a,na,b)}function Qh(a){return Mc(a,la|na)}function Rh(a,b){return b="function"==typeof b?b:da,Mc(a,la|na,b)}function Sh(a,b){return null==b||Qc(a,b,Oi(b))}function Th(a,b){return a===b||a!==a&&b!==b}function Uh(a){return null!=a&&di(a.length)&&!bi(a)}function Vh(a){return fi(a)&&Uh(a)}function Wh(a){return!0===a||!1===a||fi(a)&&jd(a)==Sa}function Xh(a){return fi(a)&&1===a.nodeType&&!ni(a)}function Yh(a){if(null==a)return!0;if(Uh(a)&&(qm(a)||"string"==typeof a||"function"==typeof a.splice||sm(a)||xm(a)||pm(a)))return!a.length;var b=Al(a);if(b==Ya||b==db)return!a.size;if(Of(a))return!Nd(a).length;for(var c in a)if(qk.call(a,c))return!1;return!0}function Zh(a,b){return Ed(a,b)}function $h(a,b,c){c="function"==typeof c?c:da;var d=c?c(a,b):da;return d===da?Ed(a,b,da,c):!!d}function _h(a){if(!fi(a))return!1;var b=jd(a);return b==Va||b==Ua||"string"==typeof a.message&&"string"==typeof a.name&&!ni(a)}function ai(a){return"number"==typeof a&&Qk(a)}function bi(a){if(!ei(a))return!1;var b=jd(a);return b==Wa||b==Xa||b==Ra||b==bb}function ci(a){return"number"==typeof a&&a==wi(a)}function di(a){return"number"==typeof a&&a>-1&&a%1==0&&a<=Ia}function ei(a){var b=typeof a;return null!=a&&("object"==b||"function"==b)}function fi(a){return null!=a&&"object"==typeof a}function gi(a,b){return a===b||Hd(a,b,xf(b))}function hi(a,b,c){return c="function"==typeof c?c:da,Hd(a,b,xf(b),c)}function ii(a){return mi(a)&&a!=+a}function ji(a){if(Bl(a))throw new ek(ga);return Id(a)}function ki(a){return null===a}function li(a){return null==a}function mi(a){return"number"==typeof a||fi(a)&&jd(a)==Za}function ni(a){if(!fi(a)||jd(a)!=_a)return!1;var b=Bk(a);if(null===b)return!0;var c=qk.call(b,"constructor")&&b.constructor;return"function"==typeof c&&c instanceof c&&pk.call(c)==uk}function oi(a){return ci(a)&&a>=-Ia&&a<=Ia}function pi(a){return"string"==typeof a||!qm(a)&&fi(a)&&jd(a)==eb}function qi(a){return"symbol"==typeof a||fi(a)&&jd(a)==fb}function ri(a){return a===da}function si(a){return fi(a)&&Al(a)==hb}function ti(a){return fi(a)&&jd(a)==ib}function ui(a){if(!a)return[];if(Uh(a))return pi(a)?_(a):Ke(a);if(Gk&&a[Gk])return R(a[Gk]());var b=Al(a);return(b==Ya?S:b==db?W:_i)(a)}function vi(a){if(!a)return 0===a?a:0;if((a=yi(a))===Ha||a===-Ha){return(a<0?-1:1)*Ja}return a===a?a:0}function wi(a){var b=vi(a),c=b%1;return b===b?c?b-c:b:0}function xi(a){return a?Lc(wi(a),0,La):0}function yi(a){if("number"==typeof a)return a;if(qi(a))return Ka;if(ei(a)){var b="function"==typeof a.valueOf?a.valueOf():a;a=ei(b)?b+"":b}if("string"!=typeof a)return 0===a?a:+a;a=a.replace(Jb,"");var c=Ub.test(a);return c||Wb.test(a)?bd(a.slice(2),c?2:8):Tb.test(a)?Ka:+a}function zi(a){return Le(a,Pi(a))}function Ai(a){return a?Lc(wi(a),-Ia,Ia):0===a?a:0}function Bi(a){return null==a?"":oe(a)}function Ci(a,b){var c=nl(a);return null==b?c:Hc(c,b)}function Di(a,b){return u(a,vf(b,3),cd)}function Ei(a,b){return u(a,vf(b,3),dd)}function Fi(a,b){return null==a?a:ql(a,vf(b,3),Pi)}function Gi(a,b){return null==a?a:rl(a,vf(b,3),Pi)}function Hi(a,b){return a&&cd(a,vf(b,3))}function Ii(a,b){return a&&dd(a,vf(b,3))}function Ji(a){return null==a?[]:fd(a,Oi(a))}function Ki(a){return null==a?[]:fd(a,Pi(a))}function Li(a,b,c){var d=null==a?da:gd(a,b);return d===da?c:d}function Mi(a,b){return null!=a&&Cf(a,b,ud)}function Ni(a,b){return null!=a&&Cf(a,b,wd)}function Oi(a){return Uh(a)?zc(a):Nd(a)}function Pi(a){return Uh(a)?zc(a,!0):Od(a)}function Qi(a,b){var c={};return b=vf(b,3),cd(a,function(a,d,e){Jc(c,b(a,d,e),a)}),c}function Ri(a,b){var c={};return b=vf(b,3),cd(a,function(a,d,e){Jc(c,d,b(a,d,e))}),c}function Si(a,b){return Ti(a,Gh(vf(b)))}function Ti(a,b){if(null==a)return{};var c=n(sf(a),function(a){return[a]});return b=vf(b),Yd(a,c,function(a,c){return b(a,c[0])})}function Ui(a,b,c){b=ye(b,a);var d=-1,e=b.length;for(e||(e=1,a=da);++d<e;){var f=null==a?da:a[_f(b[d])];f===da&&(d=e,f=c),a=bi(f)?f.call(a):f}return a}function Vi(a,b,c){return null==a?a:ge(a,b,c)}function Wi(a,b,c,d){return d="function"==typeof d?d:da,null==a?a:ge(a,b,c,d)}function Xi(a,b,c){var d=qm(a),e=d||sm(a)||xm(a);if(b=vf(b,4),null==c){var f=a&&a.constructor;c=e?d?new f:[]:ei(a)&&bi(f)?nl(Bk(a)):{}}return(e?h:cd)(a,function(a,d,e){return b(c,a,d,e)}),c}function Yi(a,b){return null==a||qe(a,b)}function Zi(a,b,c){return null==a?a:re(a,b,xe(c))}function $i(a,b,c,d){return d="function"==typeof d?d:da,null==a?a:re(a,b,xe(c),d)}function _i(a){return null==a?[]:I(a,Oi(a))}function aj(a){return null==a?[]:I(a,Pi(a))}function bj(a,b,c){return c===da&&(c=b,b=da),c!==da&&(c=yi(c),c=c===c?c:0),b!==da&&(b=yi(b),b=b===b?b:0),Lc(yi(a),b,c)}function cj(a,b,c){return b=vi(b),c===da?(c=b,b=0):c=vi(c),a=yi(a),xd(a,b,c)}function dj(a,b,c){if(c&&"boolean"!=typeof c&&Jf(a,b,c)&&(b=c=da),c===da&&("boolean"==typeof b?(c=b,b=da):"boolean"==typeof a&&(c=a,a=da)),a===da&&b===da?(a=0,b=1):(a=vi(a),b===da?(b=a,a=0):b=vi(b)),a>b){var d=a;a=b,b=d}if(c||a%1||b%1){var e=Xk();return Uk(a+e*(b-a+ad("1e-"+((e+"").length-1))),b)}return ae(a,b)}function ej(a){return Xm(Bi(a).toLowerCase())}function fj(a){return(a=Bi(a))&&a.replace(Yb,rd).replace(Pc,"")}function gj(a,b,c){a=Bi(a),b=oe(b);var d=a.length;c=c===da?d:Lc(wi(c),0,d);var e=c;return(c-=b.length)>=0&&a.slice(c,e)==b}function hj(a){return a=Bi(a),a&&Ab.test(a)?a.replace(yb,sd):a}function ij(a){return a=Bi(a),a&&Ib.test(a)?a.replace(Hb,"\\$&"):a}function jj(a,b,c){a=Bi(a),b=wi(b);var d=b?$(a):0;if(!b||d>=b)return a;var e=(b-d)/2;return bf(Nk(e),c)+a+bf(Mk(e),c)}function kj(a,b,c){a=Bi(a),b=wi(b);var d=b?$(a):0;return b&&d<b?a+bf(b-d,c):a}function lj(a,b,c){a=Bi(a),b=wi(b);var d=b?$(a):0;return b&&d<b?bf(b-d,c)+a:a}function mj(a,b,c){return c||null==b?b=0:b&&(b=+b),Wk(Bi(a).replace(Kb,""),b||0)}function nj(a,b,c){return b=(c?Jf(a,b,c):b===da)?1:wi(b),ce(Bi(a),b)}function oj(){var a=arguments,b=Bi(a[0]);return a.length<3?b:b.replace(a[1],a[2])}function pj(a,b,c){return c&&"number"!=typeof c&&Jf(a,b,c)&&(b=c=da),(c=c===da?La:c>>>0)?(a=Bi(a),a&&("string"==typeof b||null!=b&&!vm(b))&&!(b=oe(b))&&P(a)?ze(_(a),0,c):a.split(b,c)):[]}function qj(a,b,c){return a=Bi(a),c=null==c?0:Lc(wi(c),0,a.length),b=oe(b),a.slice(c,c+b.length)==b}function rj(a,b,d){var e=c.templateSettings;d&&Jf(a,b,d)&&(b=da),a=Bi(a),b=Cm({},b,e,kf);var f,g,h=Cm({},b.imports,e.imports,kf),i=Oi(h),j=I(h,i),k=0,l=b.interpolate||Zb,m="__p += '",n=ik((b.escape||Zb).source+"|"+l.source+"|"+(l===Db?Rb:Zb).source+"|"+(b.evaluate||Zb).source+"|$","g"),o="//# sourceURL="+("sourceURL"in b?b.sourceURL:"lodash.templateSources["+ ++Vc+"]")+"\n";a.replace(n,function(b,c,d,e,h,i){return d||(d=e),m+=a.slice(k,i).replace($b,N),c&&(f=!0,m+="' +\n__e("+c+") +\n'"),h&&(g=!0,m+="';\n"+h+";\n__p += '"),d&&(m+="' +\n((__t = ("+d+")) == null ? '' : __t) +\n'"),k=i+b.length,b}),m+="';\n";var p=b.variable;p||(m="with (obj) {\n"+m+"\n}\n"),m=(g?m.replace(ub,""):m).replace(vb,"$1").replace(wb,"$1;"),m="function("+(p||"obj")+") {\n"+(p?"":"obj || (obj = {});\n")+"var __t, __p = ''"+(f?", __e = _.escape":"")+(g?", __j = Array.prototype.join;\nfunction print() { __p += __j.call(arguments, '') }\n":";\n")+m+"return __p\n}";var q=Ym(function(){return fk(i,o+"return "+m).apply(da,j)});if(q.source=m,_h(q))throw q;return q}function sj(a){return Bi(a).toLowerCase()}function tj(a){return Bi(a).toUpperCase()}function uj(a,b,c){if((a=Bi(a))&&(c||b===da))return a.replace(Jb,"");if(!a||!(b=oe(b)))return a;var d=_(a),e=_(b);return ze(d,K(d,e),L(d,e)+1).join("")}function vj(a,b,c){if((a=Bi(a))&&(c||b===da))return a.replace(Lb,"");if(!a||!(b=oe(b)))return a;var d=_(a);return ze(d,0,L(d,_(b))+1).join("")}function wj(a,b,c){if((a=Bi(a))&&(c||b===da))return a.replace(Kb,"");if(!a||!(b=oe(b)))return a;var d=_(a);return ze(d,K(d,_(b))).join("")}function xj(a,b){var c=Aa,d=Ba;if(ei(b)){var e="separator"in b?b.separator:e;c="length"in b?wi(b.length):c,d="omission"in b?oe(b.omission):d}a=Bi(a);var f=a.length;if(P(a)){var g=_(a);f=g.length}if(c>=f)return a;var h=c-$(d);if(h<1)return d;var i=g?ze(g,0,h).join(""):a.slice(0,h);if(e===da)return i+d;if(g&&(h+=i.length-h),vm(e)){if(a.slice(h).search(e)){var j,k=i;for(e.global||(e=ik(e.source,Bi(Sb.exec(e))+"g")),e.lastIndex=0;j=e.exec(k);)var l=j.index;i=i.slice(0,l===da?h:l)}}else if(a.indexOf(oe(e),h)!=h){var m=i.lastIndexOf(e);m>-1&&(i=i.slice(0,m))}return i+d}function yj(a){return a=Bi(a),a&&zb.test(a)?a.replace(xb,td):a}function zj(a,b,c){return a=Bi(a),b=c?da:b,b===da?Q(a)?ca(a):t(a):a.match(b)||[]}function Aj(a){var b=null==a?0:a.length,c=vf();return a=b?n(a,function(a){if("function"!=typeof a[1])throw new kk(ha);return[c(a[0]),a[1]]}):[],de(function(c){for(var d=-1;++d<b;){var e=a[d];if(f(e[0],this,c))return f(e[1],this,c)}})}function Bj(a){return Nc(Mc(a,la))}function Cj(a){return function(){return a}}function Dj(a,b){return null==a||a!==a?b:a}function Ej(a){return a}function Fj(a){return Md("function"==typeof a?a:Mc(a,la))}function Gj(a){return Rd(Mc(a,la))}function Hj(a,b){return Sd(a,Mc(b,la))}function Ij(a,b,c){var d=Oi(b),e=fd(b,d);null!=c||ei(b)&&(e.length||!d.length)||(c=b,b=a,a=this,e=fd(b,Oi(b)));var f=!(ei(c)&&"chain"in c&&!c.chain),g=bi(a);return h(e,function(c){var d=b[c];a[c]=d,g&&(a.prototype[c]=function(){var b=this.__chain__;if(f||b){var c=a(this.__wrapped__);return(c.__actions__=Ke(this.__actions__)).push({func:d,args:arguments,thisArg:a}),c.__chain__=b,c}return d.apply(a,o([this.value()],arguments))})}),a}function Jj(){return ed._===this&&(ed._=vk),this}function Kj(){}function Lj(a){return a=wi(a),de(function(b){return Vd(b,a)})}function Mj(a){return Kf(a)?A(_f(a)):Zd(a)}function Nj(a){return function(b){return null==a?da:gd(a,b)}}function Oj(){return[]}function Pj(){return!1}function Qj(){return{}}function Rj(){return""}function Sj(){return!0}function Tj(a,b){if((a=wi(a))<1||a>Ia)return[];var c=La,d=Uk(a,La);b=vf(b),a-=La;for(var e=F(d,b);++c<a;)b(c);return e}function Uj(a){return qm(a)?n(a,_f):qi(a)?[a]:Ke(Fl(Bi(a)))}function Vj(a){var b=++rk;return Bi(a)+b}function Wj(a){return a&&a.length?Yc(a,Ej,qd):da}function Xj(a,b){return a&&a.length?Yc(a,vf(b,2),qd):da}function Yj(a){return z(a,Ej)}function Zj(a,b){return z(a,vf(b,2))}function $j(a){return a&&a.length?Yc(a,Ej,Pd):da}function _j(a,b){return a&&a.length?Yc(a,vf(b,2),Pd):da}function ak(a){return a&&a.length?E(a,Ej):0}function bk(a,b){return a&&a.length?E(a,vf(b,2)):0}b=null==b?ed:vd.defaults(ed.Object(),b,vd.pick(ed,Uc));var ck=b.Array,dk=b.Date,ek=b.Error,fk=b.Function,gk=b.Math,hk=b.Object,ik=b.RegExp,jk=b.String,kk=b.TypeError,lk=ck.prototype,mk=fk.prototype,nk=hk.prototype,ok=b["__core-js_shared__"],pk=mk.toString,qk=nk.hasOwnProperty,rk=0,sk=function(){var a=/[^.]+$/.exec(ok&&ok.keys&&ok.keys.IE_PROTO||"");return a?"Symbol(src)_1."+a:""}(),tk=nk.toString,uk=pk.call(hk),vk=ed._,wk=ik("^"+pk.call(qk).replace(Hb,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),xk=hd?b.Buffer:da,yk=b.Symbol,zk=b.Uint8Array,Ak=xk?xk.allocUnsafe:da,Bk=T(hk.getPrototypeOf,hk),Ck=hk.create,Dk=nk.propertyIsEnumerable,Ek=lk.splice,Fk=yk?yk.isConcatSpreadable:da,Gk=yk?yk.iterator:da,Hk=yk?yk.toStringTag:da,Ik=function(){try{var a=yf(hk,"defineProperty");return a({},"",{}),a}catch(e){}}(),Jk=b.clearTimeout!==ed.clearTimeout&&b.clearTimeout,Kk=dk&&dk.now!==ed.Date.now&&dk.now,Lk=b.setTimeout!==ed.setTimeout&&b.setTimeout,Mk=gk.ceil,Nk=gk.floor,Ok=hk.getOwnPropertySymbols,Pk=xk?xk.isBuffer:da,Qk=b.isFinite,Rk=lk.join,Sk=T(hk.keys,hk),Tk=gk.max,Uk=gk.min,Vk=dk.now,Wk=b.parseInt,Xk=gk.random,Yk=lk.reverse,Zk=yf(b,"DataView"),$k=yf(b,"Map"),_k=yf(b,"Promise"),al=yf(b,"Set"),bl=yf(b,"WeakMap"),cl=yf(hk,"create"),dl=bl&&new bl,el={},fl=ag(Zk),gl=ag($k),hl=ag(_k),il=ag(al),jl=ag(bl),kl=yk?yk.prototype:da,ll=kl?kl.valueOf:da,ml=kl?kl.toString:da,nl=function(){function a(){}return function(b){if(!ei(b))return{};if(Ck)return Ck(b);a.prototype=b;var c=new a;return a.prototype=da,c}}();c.templateSettings={escape:Bb,evaluate:Cb,interpolate:Db,variable:"",imports:{_:c}},c.prototype=d.prototype,c.prototype.constructor=c,s.prototype=nl(d.prototype),s.prototype.constructor=s,B.prototype=nl(d.prototype),B.prototype.constructor=B,Pb.prototype.clear=_b,Pb.prototype.delete=ac,Pb.prototype.get=bc,Pb.prototype.has=cc,Pb.prototype.set=dc,ec.prototype.clear=fc,ec.prototype.delete=gc,ec.prototype.get=hc,ec.prototype.has=ic,ec.prototype.set=jc,kc.prototype.clear=lc,kc.prototype.delete=mc,kc.prototype.get=nc,kc.prototype.has=oc,kc.prototype.set=pc,qc.prototype.add=qc.prototype.push=rc,qc.prototype.has=sc,tc.prototype.clear=uc,tc.prototype.delete=vc,tc.prototype.get=wc,tc.prototype.has=xc,tc.prototype.set=yc;var ol=Qe(cd),pl=Qe(dd,!0),ql=Re(),rl=Re(!0),sl=dl?function(a,b){return dl.set(a,b),a}:Ej,tl=Ik?function(a,b){return Ik(a,"toString",{configurable:!0,enumerable:!1,value:Cj(b),writable:!0})}:Ej,ul=de,vl=Jk||function(a){return ed.clearTimeout(a)},wl=al&&1/W(new al([,-0]))[1]==Ha?function(a){return new al(a)}:Kj,xl=dl?function(a){return dl.get(a)}:Kj,yl=Ok?function(a){return null==a?[]:(a=hk(a),k(Ok(a),function(b){return Dk.call(a,b)}))}:Oj,zl=Ok?function(a){for(var b=[];a;)o(b,yl(a)),a=Bk(a);return b}:Oj,Al=jd;(Zk&&Al(new Zk(new ArrayBuffer(1)))!=kb||$k&&Al(new $k)!=Ya||_k&&Al(_k.resolve())!=ab||al&&Al(new al)!=db||bl&&Al(new bl)!=hb)&&(Al=function(a){var b=jd(a),c=b==_a?a.constructor:da,d=c?ag(c):"";if(d)switch(d){case fl:return kb;case gl:return Ya;case hl:return ab;case il:return db;case jl:return hb}return b});var Bl=ok?bi:Pj,Cl=Zf(sl),Dl=Lk||function(a,b){return ed.setTimeout(a,b)},El=Zf(tl),Fl=Rf(function(a){var b=[];return 46===a.charCodeAt(0)&&b.push(""),a.replace(Gb,function(a,c,d,e){b.push(d?e.replace(Qb,"$1"):c||a)}),b}),Gl=de(function(a,b){return Vh(a)?Sc(a,_c(b,1,Vh,!0)):[]}),Hl=de(function(a,b){var c=vg(b);return Vh(c)&&(c=da),Vh(a)?Sc(a,_c(b,1,Vh,!0),vf(c,2)):[]}),Il=de(function(a,b){var c=vg(b);return Vh(c)&&(c=da),Vh(a)?Sc(a,_c(b,1,Vh,!0),da,c):[]}),Jl=de(function(a){var b=n(a,we);return b.length&&b[0]===a[0]?yd(b):[]}),Kl=de(function(a){var b=vg(a),c=n(a,we);return b===vg(c)?b=da:c.pop(),c.length&&c[0]===a[0]?yd(c,vf(b,2)):[]}),Ll=de(function(a){var b=vg(a),c=n(a,we);return b="function"==typeof b?b:da,b&&c.pop(),c.length&&c[0]===a[0]?yd(c,da,b):[]}),Ml=de(yg),Nl=qf(function(a,b){var c=null==a?0:a.length,d=Kc(a,b);return _d(a,n(b,function(a){return If(a,c)?+a:a}).sort(Ge)),d}),Ol=de(function(a){return pe(_c(a,1,Vh,!0))}),Pl=de(function(a){var b=vg(a);return Vh(b)&&(b=da),pe(_c(a,1,Vh,!0),vf(b,2))}),Ql=de(function(a){var b=vg(a);return b="function"==typeof b?b:da,pe(_c(a,1,Vh,!0),da,b)}),Rl=de(function(a,b){return Vh(a)?Sc(a,b):[]}),Sl=de(function(a){return ue(k(a,Vh))}),Tl=de(function(a){var b=vg(a);return Vh(b)&&(b=da),ue(k(a,Vh),vf(b,2))}),Ul=de(function(a){var b=vg(a);return b="function"==typeof b?b:da,ue(k(a,Vh),da,b)}),Vl=de(Ug),Wl=de(function(a){var b=a.length,c=b>1?a[b-1]:da;return c="function"==typeof c?(a.pop(),c):da,Vg(a,c)}),Xl=qf(function(a){var b=a.length,c=b?a[0]:0,d=this.__wrapped__,e=function(b){return Kc(b,a)};return!(b>1||this.__actions__.length)&&d instanceof B&&If(c)?(d=d.slice(c,+c+(b?1:0)),d.__actions__.push({func:$g,args:[e],thisArg:da}),new s(d,this.__chain__).thru(function(a){return b&&!a.length&&a.push(da),a})):this.thru(e)}),Yl=Oe(function(a,b,c){qk.call(a,c)?++a[c]:Jc(a,c,1)}),Zl=Xe(lg),$l=Xe(mg),_l=Oe(function(a,b,c){qk.call(a,c)?a[c].push(b):Jc(a,c,[b])}),am=de(function(a,b,c){var d=-1,e="function"==typeof b,g=Uh(a)?ck(a.length):[];return ol(a,function(a){g[++d]=e?f(b,a,c):Ad(a,b,c)}),g}),bm=Oe(function(a,b,c){Jc(a,c,b)}),cm=Oe(function(a,b,c){a[c?0:1].push(b)},function(){return[[],[]]}),dm=de(function(a,b){if(null==a)return[];var c=b.length;return c>1&&Jf(a,b[0],b[1])?b=[]:c>2&&Jf(b[0],b[1],b[2])&&(b=[b[0]]),Wd(a,_c(b,1),[])}),em=Kk||function(){return ed.Date.now()},fm=de(function(a,b,c){var d=qa;if(c.length){var e=U(c,uf(fm));d|=va}return jf(a,d,b,c,e)}),gm=de(function(a,b,c){var d=qa|ra;if(c.length){var e=U(c,uf(gm));d|=va}return jf(b,d,a,c,e)}),hm=de(function(a,b){return Rc(a,1,b)}),im=de(function(a,b,c){return Rc(a,yi(b)||0,c)});Fh.Cache=kc;var jm=ul(function(a,b){b=1==b.length&&qm(b[0])?n(b[0],H(vf())):n(_c(b,1),H(vf()));var c=b.length;return de(function(d){for(var e=-1,g=Uk(d.length,c);++e<g;)d[e]=b[e].call(this,d[e]);return f(a,this,d)})}),km=de(function(a,b){var c=U(b,uf(km));return jf(a,va,da,b,c)}),lm=de(function(a,b){var c=U(b,uf(lm));return jf(a,wa,da,b,c)}),mm=qf(function(a,b){return jf(a,ya,da,da,da,b)}),nm=ef(qd),om=ef(function(a,b){return a>=b}),pm=Bd(function(){return arguments}())?Bd:function(a){return fi(a)&&qk.call(a,"callee")&&!Dk.call(a,"callee")},qm=ck.isArray,rm=kd?H(kd):Cd,sm=Pk||Pj,tm=ld?H(ld):Dd,um=md?H(md):Gd,vm=nd?H(nd):Jd,wm=od?H(od):Kd,xm=pd?H(pd):Ld,ym=ef(Pd),zm=ef(function(a,b){return a<=b}),Am=Pe(function(a,b){if(Of(b)||Uh(b))return void Le(b,Oi(b),a);for(var c in b)qk.call(b,c)&&Ec(a,c,b[c])}),Bm=Pe(function(a,b){
Le(b,Pi(b),a)}),Cm=Pe(function(a,b,c,d){Le(b,Pi(b),a,d)}),Dm=Pe(function(a,b,c,d){Le(b,Oi(b),a,d)}),Em=qf(Kc),Fm=de(function(a,b){a=hk(a);var c=-1,d=b.length,e=d>2?b[2]:da;for(e&&Jf(b[0],b[1],e)&&(d=1);++c<d;)for(var f=b[c],g=Pi(f),h=-1,i=g.length;++h<i;){var j=g[h],k=a[j];(k===da||Th(k,nk[j])&&!qk.call(a,j))&&(a[j]=f[j])}return a}),Gm=de(function(a){return a.push(da,lf),f(Lm,da,a)}),Hm=$e(function(a,b,c){null!=b&&"function"!=typeof b.toString&&(b=tk.call(b)),a[b]=c},Cj(Ej)),Im=$e(function(a,b,c){null!=b&&"function"!=typeof b.toString&&(b=tk.call(b)),qk.call(a,b)?a[b].push(c):a[b]=[c]},vf),Jm=de(Ad),Km=Pe(function(a,b,c){Td(a,b,c)}),Lm=Pe(function(a,b,c,d){Td(a,b,c,d)}),Mm=qf(function(a,b){var c={};if(null==a)return c;var d=!1;b=n(b,function(b){return b=ye(b,a),d||(d=b.length>1),b}),Le(a,sf(a),c),d&&(c=Mc(c,la|ma|na,mf));for(var e=b.length;e--;)qe(c,b[e]);return c}),Nm=qf(function(a,b){return null==a?{}:Xd(a,b)}),Om=hf(Oi),Pm=hf(Pi),Qm=Ue(function(a,b,c){return b=b.toLowerCase(),a+(c?ej(b):b)}),Rm=Ue(function(a,b,c){return a+(c?"-":"")+b.toLowerCase()}),Sm=Ue(function(a,b,c){return a+(c?" ":"")+b.toLowerCase()}),Tm=Te("toLowerCase"),Um=Ue(function(a,b,c){return a+(c?"_":"")+b.toLowerCase()}),Vm=Ue(function(a,b,c){return a+(c?" ":"")+Xm(b)}),Wm=Ue(function(a,b,c){return a+(c?" ":"")+b.toUpperCase()}),Xm=Te("toUpperCase"),Ym=de(function(a,b){try{return f(a,da,b)}catch(e){return _h(e)?e:new ek(e)}}),Zm=qf(function(a,b){return h(b,function(b){b=_f(b),Jc(a,b,fm(a[b],a))}),a}),$m=Ye(),_m=Ye(!0),an=de(function(a,b){return function(c){return Ad(c,a,b)}}),bn=de(function(a,b){return function(c){return Ad(a,c,b)}}),cn=af(n),dn=af(j),en=af(r),fn=df(),gn=df(!0),hn=_e(function(a,b){return a+b},0),jn=gf("ceil"),kn=_e(function(a,b){return a/b},1),ln=gf("floor"),mn=_e(function(a,b){return a*b},1),nn=gf("round"),on=_e(function(a,b){return a-b},0);return c.after=yh,c.ary=zh,c.assign=Am,c.assignIn=Bm,c.assignInWith=Cm,c.assignWith=Dm,c.at=Em,c.before=Ah,c.bind=fm,c.bindAll=Zm,c.bindKey=gm,c.castArray=Nh,c.chain=Yg,c.chunk=dg,c.compact=eg,c.concat=fg,c.cond=Aj,c.conforms=Bj,c.constant=Cj,c.countBy=Yl,c.create=Ci,c.curry=Bh,c.curryRight=Ch,c.debounce=Dh,c.defaults=Fm,c.defaultsDeep=Gm,c.defer=hm,c.delay=im,c.difference=Gl,c.differenceBy=Hl,c.differenceWith=Il,c.drop=gg,c.dropRight=hg,c.dropRightWhile=ig,c.dropWhile=jg,c.fill=kg,c.filter=hh,c.flatMap=ih,c.flatMapDeep=jh,c.flatMapDepth=kh,c.flatten=ng,c.flattenDeep=og,c.flattenDepth=pg,c.flip=Eh,c.flow=$m,c.flowRight=_m,c.fromPairs=qg,c.functions=Ji,c.functionsIn=Ki,c.groupBy=_l,c.initial=tg,c.intersection=Jl,c.intersectionBy=Kl,c.intersectionWith=Ll,c.invert=Hm,c.invertBy=Im,c.invokeMap=am,c.iteratee=Fj,c.keyBy=bm,c.keys=Oi,c.keysIn=Pi,c.map=oh,c.mapKeys=Qi,c.mapValues=Ri,c.matches=Gj,c.matchesProperty=Hj,c.memoize=Fh,c.merge=Km,c.mergeWith=Lm,c.method=an,c.methodOf=bn,c.mixin=Ij,c.negate=Gh,c.nthArg=Lj,c.omit=Mm,c.omitBy=Si,c.once=Hh,c.orderBy=ph,c.over=cn,c.overArgs=jm,c.overEvery=dn,c.overSome=en,c.partial=km,c.partialRight=lm,c.partition=cm,c.pick=Nm,c.pickBy=Ti,c.property=Mj,c.propertyOf=Nj,c.pull=Ml,c.pullAll=yg,c.pullAllBy=zg,c.pullAllWith=Ag,c.pullAt=Nl,c.range=fn,c.rangeRight=gn,c.rearg=mm,c.reject=sh,c.remove=Bg,c.rest=Ih,c.reverse=Cg,c.sampleSize=uh,c.set=Vi,c.setWith=Wi,c.shuffle=vh,c.slice=Dg,c.sortBy=dm,c.sortedUniq=Kg,c.sortedUniqBy=Lg,c.split=pj,c.spread=Jh,c.tail=Mg,c.take=Ng,c.takeRight=Og,c.takeRightWhile=Pg,c.takeWhile=Qg,c.tap=Zg,c.throttle=Kh,c.thru=$g,c.toArray=ui,c.toPairs=Om,c.toPairsIn=Pm,c.toPath=Uj,c.toPlainObject=zi,c.transform=Xi,c.unary=Lh,c.union=Ol,c.unionBy=Pl,c.unionWith=Ql,c.uniq=Rg,c.uniqBy=Sg,c.uniqWith=Tg,c.unset=Yi,c.unzip=Ug,c.unzipWith=Vg,c.update=Zi,c.updateWith=$i,c.values=_i,c.valuesIn=aj,c.without=Rl,c.words=zj,c.wrap=Mh,c.xor=Sl,c.xorBy=Tl,c.xorWith=Ul,c.zip=Vl,c.zipObject=Wg,c.zipObjectDeep=Xg,c.zipWith=Wl,c.entries=Om,c.entriesIn=Pm,c.extend=Bm,c.extendWith=Cm,Ij(c,c),c.add=hn,c.attempt=Ym,c.camelCase=Qm,c.capitalize=ej,c.ceil=jn,c.clamp=bj,c.clone=Oh,c.cloneDeep=Qh,c.cloneDeepWith=Rh,c.cloneWith=Ph,c.conformsTo=Sh,c.deburr=fj,c.defaultTo=Dj,c.divide=kn,c.endsWith=gj,c.eq=Th,c.escape=hj,c.escapeRegExp=ij,c.every=gh,c.find=Zl,c.findIndex=lg,c.findKey=Di,c.findLast=$l,c.findLastIndex=mg,c.findLastKey=Ei,c.floor=ln,c.forEach=lh,c.forEachRight=mh,c.forIn=Fi,c.forInRight=Gi,c.forOwn=Hi,c.forOwnRight=Ii,c.get=Li,c.gt=nm,c.gte=om,c.has=Mi,c.hasIn=Ni,c.head=rg,c.identity=Ej,c.includes=nh,c.indexOf=sg,c.inRange=cj,c.invoke=Jm,c.isArguments=pm,c.isArray=qm,c.isArrayBuffer=rm,c.isArrayLike=Uh,c.isArrayLikeObject=Vh,c.isBoolean=Wh,c.isBuffer=sm,c.isDate=tm,c.isElement=Xh,c.isEmpty=Yh,c.isEqual=Zh,c.isEqualWith=$h,c.isError=_h,c.isFinite=ai,c.isFunction=bi,c.isInteger=ci,c.isLength=di,c.isMap=um,c.isMatch=gi,c.isMatchWith=hi,c.isNaN=ii,c.isNative=ji,c.isNil=li,c.isNull=ki,c.isNumber=mi,c.isObject=ei,c.isObjectLike=fi,c.isPlainObject=ni,c.isRegExp=vm,c.isSafeInteger=oi,c.isSet=wm,c.isString=pi,c.isSymbol=qi,c.isTypedArray=xm,c.isUndefined=ri,c.isWeakMap=si,c.isWeakSet=ti,c.join=ug,c.kebabCase=Rm,c.last=vg,c.lastIndexOf=wg,c.lowerCase=Sm,c.lowerFirst=Tm,c.lt=ym,c.lte=zm,c.max=Wj,c.maxBy=Xj,c.mean=Yj,c.meanBy=Zj,c.min=$j,c.minBy=_j,c.stubArray=Oj,c.stubFalse=Pj,c.stubObject=Qj,c.stubString=Rj,c.stubTrue=Sj,c.multiply=mn,c.nth=xg,c.noConflict=Jj,c.noop=Kj,c.now=em,c.pad=jj,c.padEnd=kj,c.padStart=lj,c.parseInt=mj,c.random=dj,c.reduce=qh,c.reduceRight=rh,c.repeat=nj,c.replace=oj,c.result=Ui,c.round=nn,c.runInContext=a,c.sample=th,c.size=wh,c.snakeCase=Um,c.some=xh,c.sortedIndex=Eg,c.sortedIndexBy=Fg,c.sortedIndexOf=Gg,c.sortedLastIndex=Hg,c.sortedLastIndexBy=Ig,c.sortedLastIndexOf=Jg,c.startCase=Vm,c.startsWith=qj,c.subtract=on,c.sum=ak,c.sumBy=bk,c.template=rj,c.times=Tj,c.toFinite=vi,c.toInteger=wi,c.toLength=xi,c.toLower=sj,c.toNumber=yi,c.toSafeInteger=Ai,c.toString=Bi,c.toUpper=tj,c.trim=uj,c.trimEnd=vj,c.trimStart=wj,c.truncate=xj,c.unescape=yj,c.uniqueId=Vj,c.upperCase=Wm,c.upperFirst=Xm,c.each=lh,c.eachRight=mh,c.first=rg,Ij(c,function(){var a={};return cd(c,function(b,d){qk.call(c.prototype,d)||(a[d]=b)}),a}(),{chain:!1}),c.VERSION=ea,h(["bind","bindKey","curry","curryRight","partial","partialRight"],function(a){c[a].placeholder=c}),h(["drop","take"],function(a,b){B.prototype[a]=function(c){c=c===da?1:Tk(wi(c),0);var d=this.__filtered__&&!b?new B(this):this.clone();return d.__filtered__?d.__takeCount__=Uk(c,d.__takeCount__):d.__views__.push({size:Uk(c,La),type:a+(d.__dir__<0?"Right":"")}),d},B.prototype[a+"Right"]=function(b){return this.reverse()[a](b).reverse()}}),h(["filter","map","takeWhile"],function(a,b){var c=b+1,d=c==Ea||c==Ga;B.prototype[a]=function(a){var b=this.clone();return b.__iteratees__.push({iteratee:vf(a,3),type:c}),b.__filtered__=b.__filtered__||d,b}}),h(["head","last"],function(a,b){var c="take"+(b?"Right":"");B.prototype[a]=function(){return this[c](1).value()[0]}}),h(["initial","tail"],function(a,b){var c="drop"+(b?"":"Right");B.prototype[a]=function(){return this.__filtered__?new B(this):this[c](1)}}),B.prototype.compact=function(){return this.filter(Ej)},B.prototype.find=function(a){return this.filter(a).head()},B.prototype.findLast=function(a){return this.reverse().find(a)},B.prototype.invokeMap=de(function(a,b){return"function"==typeof a?new B(this):this.map(function(c){return Ad(c,a,b)})}),B.prototype.reject=function(a){return this.filter(Gh(vf(a)))},B.prototype.slice=function(a,b){a=wi(a);var c=this;return c.__filtered__&&(a>0||b<0)?new B(c):(a<0?c=c.takeRight(-a):a&&(c=c.drop(a)),b!==da&&(b=wi(b),c=b<0?c.dropRight(-b):c.take(b-a)),c)},B.prototype.takeRightWhile=function(a){return this.reverse().takeWhile(a).reverse()},B.prototype.toArray=function(){return this.take(La)},cd(B.prototype,function(a,b){var d=/^(?:filter|find|map|reject)|While$/.test(b),e=/^(?:head|last)$/.test(b),f=c[e?"take"+("last"==b?"Right":""):b],g=e||/^find/.test(b);f&&(c.prototype[b]=function(){var b=this.__wrapped__,h=e?[1]:arguments,i=b instanceof B,j=h[0],k=i||qm(b),l=function(a){var b=f.apply(c,o([a],h));return e&&m?b[0]:b};k&&d&&"function"==typeof j&&1!=j.length&&(i=k=!1);var m=this.__chain__,n=!!this.__actions__.length,p=g&&!m,q=i&&!n;if(!g&&k){b=q?b:new B(this);var r=a.apply(b,h);return r.__actions__.push({func:$g,args:[l],thisArg:da}),new s(r,m)}return p&&q?a.apply(this,h):(r=this.thru(l),p?e?r.value()[0]:r.value():r)})}),h(["pop","push","shift","sort","splice","unshift"],function(a){var b=lk[a],d=/^(?:push|sort|unshift)$/.test(a)?"tap":"thru",e=/^(?:pop|shift)$/.test(a);c.prototype[a]=function(){var a=arguments;if(e&&!this.__chain__){var c=this.value();return b.apply(qm(c)?c:[],a)}return this[d](function(c){return b.apply(qm(c)?c:[],a)})}}),cd(B.prototype,function(a,b){var d=c[b];if(d){var e=d.name+"";(el[e]||(el[e]=[])).push({name:b,func:d})}}),el[Ze(da,ra).name]=[{name:"wrapper",func:da}],B.prototype.clone=Y,B.prototype.reverse=aa,B.prototype.value=ba,c.prototype.at=Xl,c.prototype.chain=_g,c.prototype.commit=ah,c.prototype.next=bh,c.prototype.plant=dh,c.prototype.reverse=eh,c.prototype.toJSON=c.prototype.valueOf=c.prototype.value=fh,c.prototype.first=c.prototype.head,Gk&&(c.prototype[Gk]=ch),c},vd=ud();"function"==typeof b&&"object"==typeof b.amd&&b.amd?(ed._=vd,b(function(){return vd})):gd?((gd.exports=vd)._=vd,fd._=vd):ed._=vd}).call(this)}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],13:[function(a,b,c){"undefined"==typeof Paho&&(Paho={}),Paho.MQTT=function(a){function b(a,b,c){return b[c++]=a>>8,b[c++]=a%256,c}function c(a,c,d,f){return f=b(c,d,f),e(a,d,f),f+c}function d(a){for(var b=0,c=0;c<a.length;c++){var d=a.charCodeAt(c);2047<d?(55296<=d&&56319>=d&&(c++,b++),b+=3):127<d?b+=2:b++}return b}function e(a,b,c){for(var d=0;d<a.length;d++){var e=a.charCodeAt(d);if(55296<=e&&56319>=e){var f=a.charCodeAt(++d);if(isNaN(f))throw Error(k(i.MALFORMED_UNICODE,[e,f]));e=f-56320+(e-55296<<10)+65536}127>=e?b[c++]=e:(2047>=e?b[c++]=e>>6&31|192:(65535>=e?b[c++]=e>>12&15|224:(b[c++]=e>>18&7|240,b[c++]=e>>12&63|128),b[c++]=e>>6&63|128),b[c++]=63&e|128)}return b}function f(a,b,c){for(var d,e="",f=b;f<b+c;){if(!(128>(d=a[f++]))){var g=a[f++]-128;if(0>g)throw Error(k(i.MALFORMED_UTF,[d.toString(16),g.toString(16),""]));if(224>d)d=64*(d-192)+g;else{var h=a[f++]-128;if(0>h)throw Error(k(i.MALFORMED_UTF,[d.toString(16),g.toString(16),h.toString(16)]));if(240>d)d=4096*(d-224)+64*g+h;else{var j=a[f++]-128;if(0>j)throw Error(k(i.MALFORMED_UTF,[d.toString(16),g.toString(16),h.toString(16),j.toString(16)]));if(!(248>d))throw Error(k(i.MALFORMED_UTF,[d.toString(16),g.toString(16),h.toString(16),j.toString(16)]));d=262144*(d-240)+4096*g+64*h+j}}}65535<d&&(d-=65536,e+=String.fromCharCode(55296+(d>>10)),d=56320+(1023&d)),e+=String.fromCharCode(d)}return e}var g=function(a,b){for(var c in a)if(a.hasOwnProperty(c)){if(!b.hasOwnProperty(c)){var d="Unknown property, "+c+". Valid properties are:";for(c in b)b.hasOwnProperty(c)&&(d=d+" "+c);throw Error(d)}if(typeof a[c]!==b[c])throw Error(k(i.INVALID_TYPE,[typeof a[c],c]))}},h=function(a,b){return function(){return a.apply(b,arguments)}},i={OK:{code:0,text:"AMQJSC0000I OK."},CONNECT_TIMEOUT:{code:1,text:"AMQJSC0001E Connect timed out."},SUBSCRIBE_TIMEOUT:{code:2,text:"AMQJS0002E Subscribe timed out."},UNSUBSCRIBE_TIMEOUT:{code:3,text:"AMQJS0003E Unsubscribe timed out."},PING_TIMEOUT:{code:4,text:"AMQJS0004E Ping timed out."},INTERNAL_ERROR:{code:5,text:"AMQJS0005E Internal error. Error Message: {0}, Stack trace: {1}"},CONNACK_RETURNCODE:{code:6,text:"AMQJS0006E Bad Connack return code:{0} {1}."},SOCKET_ERROR:{code:7,text:"AMQJS0007E Socket error:{0}."},SOCKET_CLOSE:{code:8,text:"AMQJS0008I Socket closed."},MALFORMED_UTF:{code:9,text:"AMQJS0009E Malformed UTF data:{0} {1} {2}."},UNSUPPORTED:{code:10,text:"AMQJS0010E {0} is not supported by this browser."},INVALID_STATE:{code:11,text:"AMQJS0011E Invalid state {0}."},INVALID_TYPE:{code:12,text:"AMQJS0012E Invalid type {0} for {1}."},INVALID_ARGUMENT:{code:13,text:"AMQJS0013E Invalid argument {0} for {1}."},UNSUPPORTED_OPERATION:{code:14,text:"AMQJS0014E Unsupported operation."},INVALID_STORED_DATA:{code:15,text:"AMQJS0015E Invalid data in local storage key={0} value={1}."},INVALID_MQTT_MESSAGE_TYPE:{code:16,text:"AMQJS0016E Invalid MQTT message type {0}."},MALFORMED_UNICODE:{code:17,text:"AMQJS0017E Malformed Unicode string:{0} {1}."}},j={0:"Connection Accepted",1:"Connection Refused: unacceptable protocol version",2:"Connection Refused: identifier rejected",3:"Connection Refused: server unavailable",4:"Connection Refused: bad user name or password",5:"Connection Refused: not authorized"},k=function(a,b){var c=a.text;if(b)for(var d,e,f=0;f<b.length;f++)if(d="{"+f+"}",0<(e=c.indexOf(d)))var g=c.substring(0,e),c=c.substring(e+d.length),c=g+b[f]+c;return c},l=[0,6,77,81,73,115,100,112,3],m=[0,4,77,81,84,84,4],n=function(a,b){this.type=a;for(var c in b)b.hasOwnProperty(c)&&(this[c]=b[c])};n.prototype.encode=function(){var a=(15&this.type)<<4,e=0,f=[],g=0;switch(void 0!=this.messageIdentifier&&(e+=2),this.type){case 1:switch(this.mqttVersion){case 3:e+=l.length+3;break;case 4:e+=m.length+3}if(e+=d(this.clientId)+2,void 0!=this.willMessage){var e=e+(d(this.willMessage.destinationName)+2),h=this.willMessage.payloadBytes;h instanceof Uint8Array||(h=new Uint8Array(j)),e+=h.byteLength+2}void 0!=this.userName&&(e+=d(this.userName)+2),void 0!=this.password&&(e+=d(this.password)+2);break;case 8:for(var a=2|a,i=0;i<this.topics.length;i++)f[i]=d(this.topics[i]),e+=f[i]+2;e+=this.requestedQos.length;break;case 10:for(a|=2,i=0;i<this.topics.length;i++)f[i]=d(this.topics[i]),e+=f[i]+2;break;case 6:a|=2;break;case 3:this.payloadMessage.duplicate&&(a|=8),a=a|=this.payloadMessage.qos<<1,this.payloadMessage.retained&&(a|=1);var g=d(this.payloadMessage.destinationName),j=this.payloadMessage.payloadBytes,e=e+(g+2)+j.byteLength;j instanceof ArrayBuffer?j=new Uint8Array(j):j instanceof Uint8Array||(j=new Uint8Array(j.buffer))}var k=e,i=Array(1),n=0;do{var o=k%128,k=k>>7;0<k&&(o|=128),i[n++]=o}while(0<k&&4>n);if(k=i.length+1,e=new ArrayBuffer(e+k),n=new Uint8Array(e),n[0]=a,n.set(i,1),3==this.type)k=c(this.payloadMessage.destinationName,g,n,k);else if(1==this.type){switch(this.mqttVersion){case 3:n.set(l,k),k+=l.length;break;case 4:n.set(m,k),k+=m.length}a=0,this.cleanSession&&(a=2),void 0!=this.willMessage&&(a=4|a|this.willMessage.qos<<3,this.willMessage.retained&&(a|=32)),void 0!=this.userName&&(a|=128),void 0!=this.password&&(a|=64),n[k++]=a,k=b(this.keepAliveInterval,n,k)}switch(void 0!=this.messageIdentifier&&(k=b(this.messageIdentifier,n,k)),this.type){case 1:k=c(this.clientId,d(this.clientId),n,k),void 0!=this.willMessage&&(k=c(this.willMessage.destinationName,d(this.willMessage.destinationName),n,k),k=b(h.byteLength,n,k),n.set(h,k),k+=h.byteLength),void 0!=this.userName&&(k=c(this.userName,d(this.userName),n,k)),void 0!=this.password&&c(this.password,d(this.password),n,k);break;case 3:n.set(j,k);break;case 8:for(i=0;i<this.topics.length;i++)k=c(this.topics[i],f[i],n,k),n[k++]=this.requestedQos[i];break;case 10:for(i=0;i<this.topics.length;i++)k=c(this.topics[i],f[i],n,k)}return e};var o=function(a,b,c){this._client=a,this._window=b,this._keepAliveInterval=1e3*c,this.isReset=!1;var d=new n(12).encode(),e=function(a){return function(){return f.apply(a)}},f=function(){this.isReset?(this.isReset=!1,this._client._trace("Pinger.doPing","send PINGREQ"),this._client.socket.send(d),this.timeout=this._window.setTimeout(e(this),this._keepAliveInterval)):(this._client._trace("Pinger.doPing","Timed out"),this._client._disconnected(i.PING_TIMEOUT.code,k(i.PING_TIMEOUT)))};this.reset=function(){this.isReset=!0,this._window.clearTimeout(this.timeout),0<this._keepAliveInterval&&(this.timeout=setTimeout(e(this),this._keepAliveInterval))},this.cancel=function(){this._window.clearTimeout(this.timeout)}},p=function(a,b,c,d,e){this._window=b,c||(c=30),this.timeout=setTimeout(function(a,b,c){return function(){return a.apply(b,c)}}(d,a,e),1e3*c),this.cancel=function(){this._window.clearTimeout(this.timeout)}},q=function(b,c,d,e,f){if(!("WebSocket"in a&&null!==a.WebSocket))throw Error(k(i.UNSUPPORTED,["WebSocket"]));if(!("localStorage"in a&&null!==a.localStorage))throw Error(k(i.UNSUPPORTED,["localStorage"]));if(!("ArrayBuffer"in a&&null!==a.ArrayBuffer))throw Error(k(i.UNSUPPORTED,["ArrayBuffer"]));this._trace("Paho.MQTT.Client",b,c,d,e,f),this.host=c,this.port=d,this.path=e,this.uri=b,this.clientId=f,this._localKey=c+":"+d+("/mqtt"!=e?":"+e:"")+":"+f+":",this._msg_queue=[],this._sentMessages={},this._receivedMessages={},this._notify_msg_sent={},this._message_identifier=1,this._sequence=0;for(var g in localStorage)0!=g.indexOf("Sent:"+this._localKey)&&0!=g.indexOf("Received:"+this._localKey)||this.restore(g)};q.prototype.host,q.prototype.port,q.prototype.path,q.prototype.uri,q.prototype.clientId,q.prototype.socket,q.prototype.connected=!1,q.prototype.maxMessageIdentifier=65536,q.prototype.connectOptions,q.prototype.hostIndex,q.prototype.onConnectionLost,q.prototype.onMessageDelivered,q.prototype.onMessageArrived,q.prototype.traceFunction,q.prototype._msg_queue=null,q.prototype._connectTimeout,q.prototype.sendPinger=null,q.prototype.receivePinger=null,q.prototype.receiveBuffer=null,q.prototype._traceBuffer=null,q.prototype._MAX_TRACE_ENTRIES=100,q.prototype.connect=function(a){var b=this._traceMask(a,"password");if(this._trace("Client.connect",b,this.socket,this.connected),this.connected)throw Error(k(i.INVALID_STATE,["already connected"]));if(this.socket)throw Error(k(i.INVALID_STATE,["already connected"]));this.connectOptions=a,a.uris?(this.hostIndex=0,this._doConnect(a.uris[0])):this._doConnect(this.uri)},q.prototype.subscribe=function(a,b){if(this._trace("Client.subscribe",a,b),!this.connected)throw Error(k(i.INVALID_STATE,["not connected"]));var c=new n(8);c.topics=[a],c.requestedQos=void 0!=b.qos?[b.qos]:[0],b.onSuccess&&(c.onSuccess=function(a){b.onSuccess({invocationContext:b.invocationContext,grantedQos:a})}),b.onFailure&&(c.onFailure=function(a){b.onFailure({invocationContext:b.invocationContext,errorCode:a})}),b.timeout&&(c.timeOut=new p(this,window,b.timeout,b.onFailure,[{invocationContext:b.invocationContext,errorCode:i.SUBSCRIBE_TIMEOUT.code,errorMessage:k(i.SUBSCRIBE_TIMEOUT)}])),this._requires_ack(c),this._schedule_message(c)},q.prototype.unsubscribe=function(a,b){if(this._trace("Client.unsubscribe",a,b),!this.connected)throw Error(k(i.INVALID_STATE,["not connected"]));var c=new n(10);c.topics=[a],b.onSuccess&&(c.callback=function(){b.onSuccess({invocationContext:b.invocationContext})}),b.timeout&&(c.timeOut=new p(this,window,b.timeout,b.onFailure,[{invocationContext:b.invocationContext,errorCode:i.UNSUBSCRIBE_TIMEOUT.code,errorMessage:k(i.UNSUBSCRIBE_TIMEOUT)}])),this._requires_ack(c),this._schedule_message(c)},q.prototype.send=function(a){if(this._trace("Client.send",a),!this.connected)throw Error(k(i.INVALID_STATE,["not connected"]));wireMessage=new n(3),wireMessage.payloadMessage=a,0<a.qos?this._requires_ack(wireMessage):this.onMessageDelivered&&(this._notify_msg_sent[wireMessage]=this.onMessageDelivered(wireMessage.payloadMessage)),this._schedule_message(wireMessage)},q.prototype.disconnect=function(){if(this._trace("Client.disconnect"),!this.socket)throw Error(k(i.INVALID_STATE,["not connecting or connected"]));wireMessage=new n(14),this._notify_msg_sent[wireMessage]=h(this._disconnected,this),this._schedule_message(wireMessage)},q.prototype.getTraceLog=function(){if(null!==this._traceBuffer){this._trace("Client.getTraceLog",new Date),this._trace("Client.getTraceLog in flight messages",this._sentMessages.length);for(var a in this._sentMessages)this._trace("_sentMessages ",a,this._sentMessages[a]);for(a in this._receivedMessages)this._trace("_receivedMessages ",a,this._receivedMessages[a]);return this._traceBuffer}},q.prototype.startTrace=function(){null===this._traceBuffer&&(this._traceBuffer=[]),this._trace("Client.startTrace",new Date,"1.0.2")},q.prototype.stopTrace=function(){delete this._traceBuffer},q.prototype._doConnect=function(a){this.connectOptions.useSSL&&(a=a.split(":"),a[0]="wss",a=a.join(":")),this.connected=!1,this.socket=4>this.connectOptions.mqttVersion?new WebSocket(a,["mqttv3.1"]):new WebSocket(a,["mqtt"]),this.socket.binaryType="arraybuffer",this.socket.onopen=h(this._on_socket_open,this),this.socket.onmessage=h(this._on_socket_message,this),this.socket.onerror=h(this._on_socket_error,this),this.socket.onclose=h(this._on_socket_close,this),this.sendPinger=new o(this,window,this.connectOptions.keepAliveInterval),this.receivePinger=new o(this,window,this.connectOptions.keepAliveInterval),this._connectTimeout=new p(this,window,this.connectOptions.timeout,this._disconnected,[i.CONNECT_TIMEOUT.code,k(i.CONNECT_TIMEOUT)])},q.prototype._schedule_message=function(a){this._msg_queue.push(a),this.connected&&this._process_queue()},q.prototype.store=function(a,b){var c={type:b.type,messageIdentifier:b.messageIdentifier,version:1};switch(b.type){case 3:b.pubRecReceived&&(c.pubRecReceived=!0),c.payloadMessage={};for(var d="",e=b.payloadMessage.payloadBytes,f=0;f<e.length;f++)d=15>=e[f]?d+"0"+e[f].toString(16):d+e[f].toString(16);c.payloadMessage.payloadHex=d,c.payloadMessage.qos=b.payloadMessage.qos,c.payloadMessage.destinationName=b.payloadMessage.destinationName,b.payloadMessage.duplicate&&(c.payloadMessage.duplicate=!0),b.payloadMessage.retained&&(c.payloadMessage.retained=!0),0==a.indexOf("Sent:")&&(void 0===b.sequence&&(b.sequence=++this._sequence),c.sequence=b.sequence);break;default:throw Error(k(i.INVALID_STORED_DATA,[key,c]))}localStorage.setItem(a+this._localKey+b.messageIdentifier,JSON.stringify(c))},q.prototype.restore=function(a){var b=localStorage.getItem(a),c=JSON.parse(b),d=new n(c.type,c);switch(c.type){case 3:for(var b=c.payloadMessage.payloadHex,e=new ArrayBuffer(b.length/2),e=new Uint8Array(e),f=0;2<=b.length;){var g=parseInt(b.substring(0,2),16),b=b.substring(2,b.length);e[f++]=g}b=new Paho.MQTT.Message(e),b.qos=c.payloadMessage.qos,b.destinationName=c.payloadMessage.destinationName,c.payloadMessage.duplicate&&(b.duplicate=!0),c.payloadMessage.retained&&(b.retained=!0),d.payloadMessage=b;break;default:throw Error(k(i.INVALID_STORED_DATA,[a,b]))}0==a.indexOf("Sent:"+this._localKey)?(d.payloadMessage.duplicate=!0,this._sentMessages[d.messageIdentifier]=d):0==a.indexOf("Received:"+this._localKey)&&(this._receivedMessages[d.messageIdentifier]=d)},q.prototype._process_queue=function(){for(var a=null,b=this._msg_queue.reverse();a=b.pop();)this._socket_send(a),this._notify_msg_sent[a]&&(this._notify_msg_sent[a](),delete this._notify_msg_sent[a])},q.prototype._requires_ack=function(a){var b=Object.keys(this._sentMessages).length;if(b>this.maxMessageIdentifier)throw Error("Too many messages:"+b);for(;void 0!==this._sentMessages[this._message_identifier];)this._message_identifier++;a.messageIdentifier=this._message_identifier,this._sentMessages[a.messageIdentifier]=a,3===a.type&&this.store("Sent:",a),this._message_identifier===this.maxMessageIdentifier&&(this._message_identifier=1)},q.prototype._on_socket_open=function(){var a=new n(1,this.connectOptions);a.clientId=this.clientId,this._socket_send(a)},q.prototype._on_socket_message=function(a){this._trace("Client._on_socket_message",a.data),a=this._deframeMessages(a.data);for(var b=0;b<a.length;b+=1)this._handleMessage(a[b])},q.prototype._deframeMessages=function(a){if(a=new Uint8Array(a),this.receiveBuffer){var c=new Uint8Array(this.receiveBuffer.length+a.length);c.set(this.receiveBuffer),c.set(a,this.receiveBuffer.length),a=c,delete this.receiveBuffer}try{for(var c=0,d=[];c<a.length;){var e;a:{var g=a,h=c,j=h,l=g[h],m=l>>4,o=15&l,h=h+1,p=void 0,q=0,r=1;do{if(h==g.length){e=[null,j];break a}p=g[h++],q+=(127&p)*r,r*=128}while(0!=(128&p));if((p=h+q)>g.length)e=[null,j];else{var s=new n(m);switch(m){case 2:1&g[h++]&&(s.sessionPresent=!0),s.returnCode=g[h++];break;case 3:var j=o>>1&3,t=256*g[h]+g[h+1],h=h+2,u=f(g,h,t),h=h+t;0<j&&(s.messageIdentifier=256*g[h]+g[h+1],h+=2);var v=new Paho.MQTT.Message(g.subarray(h,p));1==(1&o)&&(v.retained=!0),8==(8&o)&&(v.duplicate=!0),v.qos=j,v.destinationName=u,s.payloadMessage=v;break;case 4:case 5:case 6:case 7:case 11:s.messageIdentifier=256*g[h]+g[h+1];break;case 9:s.messageIdentifier=256*g[h]+g[h+1],h+=2,s.returnCode=g.subarray(h,p)}e=[s,p]}}var w=e[0],c=e[1];if(null===w)break;d.push(w)}c<a.length&&(this.receiveBuffer=a.subarray(c))}catch(b){return void this._disconnected(i.INTERNAL_ERROR.code,k(i.INTERNAL_ERROR,[b.message,b.stack.toString()]))}return d},q.prototype._handleMessage=function(a){this._trace("Client._handleMessage",a);try{switch(a.type){case 2:if(this._connectTimeout.cancel(),this.connectOptions.cleanSession){for(var b in this._sentMessages){var c=this._sentMessages[b];localStorage.removeItem("Sent:"+this._localKey+c.messageIdentifier)}this._sentMessages={};for(b in this._receivedMessages){var d=this._receivedMessages[b];localStorage.removeItem("Received:"+this._localKey+d.messageIdentifier)}this._receivedMessages={}}if(0!==a.returnCode){this._disconnected(i.CONNACK_RETURNCODE.code,k(i.CONNACK_RETURNCODE,[a.returnCode,j[a.returnCode]]));break}this.connected=!0,this.connectOptions.uris&&(this.hostIndex=this.connectOptions.uris.length),a=[];for(var e in this._sentMessages)this._sentMessages.hasOwnProperty(e)&&a.push(this._sentMessages[e]);a=a.sort(function(a,b){return a.sequence-b.sequence}),e=0;for(var f=a.length;e<f;e++)if(c=a[e],3==c.type&&c.pubRecReceived){var g=new n(6,{messageIdentifier:c.messageIdentifier});this._schedule_message(g)}else this._schedule_message(c);this.connectOptions.onSuccess&&this.connectOptions.onSuccess({invocationContext:this.connectOptions.invocationContext}),this._process_queue();break;case 3:this._receivePublish(a);break;case 4:(c=this._sentMessages[a.messageIdentifier])&&(delete this._sentMessages[a.messageIdentifier],localStorage.removeItem("Sent:"+this._localKey+a.messageIdentifier),this.onMessageDelivered&&this.onMessageDelivered(c.payloadMessage));break;case 5:(c=this._sentMessages[a.messageIdentifier])&&(c.pubRecReceived=!0,g=new n(6,{messageIdentifier:a.messageIdentifier}),this.store("Sent:",c),this._schedule_message(g));break;case 6:d=this._receivedMessages[a.messageIdentifier],localStorage.removeItem("Received:"+this._localKey+a.messageIdentifier),d&&(this._receiveMessage(d),delete this._receivedMessages[a.messageIdentifier]);var h=new n(7,{messageIdentifier:a.messageIdentifier});this._schedule_message(h);break;case 7:c=this._sentMessages[a.messageIdentifier],delete this._sentMessages[a.messageIdentifier],localStorage.removeItem("Sent:"+this._localKey+a.messageIdentifier),this.onMessageDelivered&&this.onMessageDelivered(c.payloadMessage);break;case 9:(c=this._sentMessages[a.messageIdentifier])&&(c.timeOut&&c.timeOut.cancel(),128===a.returnCode[0]?c.onFailure&&c.onFailure(a.returnCode):c.onSuccess&&c.onSuccess(a.returnCode),delete this._sentMessages[a.messageIdentifier]);break;case 11:(c=this._sentMessages[a.messageIdentifier])&&(c.timeOut&&c.timeOut.cancel(),c.callback&&c.callback(),delete this._sentMessages[a.messageIdentifier]);break;case 13:this.sendPinger.reset();break;case 14:this._disconnected(i.INVALID_MQTT_MESSAGE_TYPE.code,k(i.INVALID_MQTT_MESSAGE_TYPE,[a.type]));break;default:this._disconnected(i.INVALID_MQTT_MESSAGE_TYPE.code,k(i.INVALID_MQTT_MESSAGE_TYPE,[a.type]))}}catch(l){this._disconnected(i.INTERNAL_ERROR.code,k(i.INTERNAL_ERROR,[l.message,l.stack.toString()]))}},q.prototype._on_socket_error=function(a){this._disconnected(i.SOCKET_ERROR.code,k(i.SOCKET_ERROR,[a.data]))},q.prototype._on_socket_close=function(){this._disconnected(i.SOCKET_CLOSE.code,k(i.SOCKET_CLOSE))},q.prototype._socket_send=function(a){if(1==a.type){var b=this._traceMask(a,"password");this._trace("Client._socket_send",b)}else this._trace("Client._socket_send",a);this.socket.send(a.encode()),this.sendPinger.reset()},q.prototype._receivePublish=function(a){switch(a.payloadMessage.qos){case"undefined":case 0:this._receiveMessage(a);break;case 1:var b=new n(4,{messageIdentifier:a.messageIdentifier});this._schedule_message(b),this._receiveMessage(a);break;case 2:this._receivedMessages[a.messageIdentifier]=a,this.store("Received:",a),a=new n(5,{messageIdentifier:a.messageIdentifier}),this._schedule_message(a);break;default:throw Error("Invaild qos="+wireMmessage.payloadMessage.qos)}},q.prototype._receiveMessage=function(a){this.onMessageArrived&&this.onMessageArrived(a.payloadMessage)},q.prototype._disconnected=function(a,b){this._trace("Client._disconnected",a,b),this.sendPinger.cancel(),this.receivePinger.cancel(),this._connectTimeout&&this._connectTimeout.cancel(),this._msg_queue=[],this._notify_msg_sent={},this.socket&&(this.socket.onopen=null,this.socket.onmessage=null,this.socket.onerror=null,this.socket.onclose=null,1===this.socket.readyState&&this.socket.close(),delete this.socket),this.connectOptions.uris&&this.hostIndex<this.connectOptions.uris.length-1?(this.hostIndex++,this._doConnect(this.connectOptions.uris[this.hostIndex])):(void 0===a&&(a=i.OK.code,b=k(i.OK)),this.connected?(this.connected=!1,this.onConnectionLost&&this.onConnectionLost({errorCode:a,errorMessage:b})):4===this.connectOptions.mqttVersion&&!1===this.connectOptions.mqttVersionExplicit?(this._trace("Failed to connect V4, dropping back to V3"),this.connectOptions.mqttVersion=3,this.connectOptions.uris?(this.hostIndex=0,this._doConnect(this.connectOptions.uris[0])):this._doConnect(this.uri)):this.connectOptions.onFailure&&this.connectOptions.onFailure({invocationContext:this.connectOptions.invocationContext,errorCode:a,errorMessage:b}))},q.prototype._trace=function(){if(this.traceFunction){for(var a in arguments)void 0!==arguments[a]&&(arguments[a]=JSON.stringify(arguments[a]));a=Array.prototype.slice.call(arguments).join(""),this.traceFunction({severity:"Debug",message:a})}if(null!==this._traceBuffer){a=0;for(var b=arguments.length;a<b;a++)this._traceBuffer.length==this._MAX_TRACE_ENTRIES&&this._traceBuffer.shift(),0===a?this._traceBuffer.push(arguments[a]):void 0===arguments[a]?this._traceBuffer.push(arguments[a]):this._traceBuffer.push("  "+JSON.stringify(arguments[a]))}},q.prototype._traceMask=function(a,b){var c,d={};for(c in a)a.hasOwnProperty(c)&&(d[c]=c==b?"******":a[c]);return d};var r=function(a,b,c,d){var e;if("string"!=typeof a)throw Error(k(i.INVALID_TYPE,[typeof a,"host"]));if(2==arguments.length){d=b,e=a;var f=e.match(/^(wss?):\/\/((\[(.+)\])|([^\/]+?))(:(\d+))?(\/.*)$/);if(!f)throw Error(k(i.INVALID_ARGUMENT,[a,"host"]));a=f[4]||f[2],b=parseInt(f[7]),c=f[8]}else{if(3==arguments.length&&(d=c,c="/mqtt"),"number"!=typeof b||0>b)throw Error(k(i.INVALID_TYPE,[typeof b,"port"]));if("string"!=typeof c)throw Error(k(i.INVALID_TYPE,[typeof c,"path"]));e="ws://"+(-1!=a.indexOf(":")&&"["!=a.slice(0,1)&&"]"!=a.slice(-1)?"["+a+"]":a)+":"+b+c}for(var h=f=0;h<d.length;h++){var j=d.charCodeAt(h);55296<=j&&56319>=j&&h++,f++}if("string"!=typeof d||65535<f)throw Error(k(i.INVALID_ARGUMENT,[d,"clientId"]));var l=new q(e,a,b,c,d);this._getHost=function(){return a},this._setHost=function(){throw Error(k(i.UNSUPPORTED_OPERATION))},this._getPort=function(){return b},this._setPort=function(){throw Error(k(i.UNSUPPORTED_OPERATION))},this._getPath=function(){return c},this._setPath=function(){throw Error(k(i.UNSUPPORTED_OPERATION))},this._getURI=function(){return e},this._setURI=function(){throw Error(k(i.UNSUPPORTED_OPERATION))},this._getClientId=function(){return l.clientId},this._setClientId=function(){throw Error(k(i.UNSUPPORTED_OPERATION))},this._getOnConnectionLost=function(){return l.onConnectionLost},this._setOnConnectionLost=function(a){if("function"!=typeof a)throw Error(k(i.INVALID_TYPE,[typeof a,"onConnectionLost"]));l.onConnectionLost=a},this._getOnMessageDelivered=function(){return l.onMessageDelivered},this._setOnMessageDelivered=function(a){
if("function"!=typeof a)throw Error(k(i.INVALID_TYPE,[typeof a,"onMessageDelivered"]));l.onMessageDelivered=a},this._getOnMessageArrived=function(){return l.onMessageArrived},this._setOnMessageArrived=function(a){if("function"!=typeof a)throw Error(k(i.INVALID_TYPE,[typeof a,"onMessageArrived"]));l.onMessageArrived=a},this._getTrace=function(){return l.traceFunction},this._setTrace=function(a){if("function"!=typeof a)throw Error(k(i.INVALID_TYPE,[typeof a,"onTrace"]));l.traceFunction=a},this.connect=function(a){if(a=a||{},g(a,{timeout:"number",userName:"string",password:"string",willMessage:"object",keepAliveInterval:"number",cleanSession:"boolean",useSSL:"boolean",invocationContext:"object",onSuccess:"function",onFailure:"function",hosts:"object",ports:"object",mqttVersion:"number",mqttVersionExplicit:"boolean",uris:"object"}),void 0===a.keepAliveInterval&&(a.keepAliveInterval=60),4<a.mqttVersion||3>a.mqttVersion)throw Error(k(i.INVALID_ARGUMENT,[a.mqttVersion,"connectOptions.mqttVersion"]));if(void 0===a.mqttVersion?(a.mqttVersionExplicit=!1,a.mqttVersion=4):a.mqttVersionExplicit=!0,void 0!==a.password&&void 0===a.userName)throw Error(k(i.INVALID_ARGUMENT,[a.password,"connectOptions.password"]));if(a.willMessage){if(!(a.willMessage instanceof s))throw Error(k(i.INVALID_TYPE,[a.willMessage,"connectOptions.willMessage"]));if(a.willMessage.stringPayload,void 0===a.willMessage.destinationName)throw Error(k(i.INVALID_TYPE,[typeof a.willMessage.destinationName,"connectOptions.willMessage.destinationName"]))}if(void 0===a.cleanSession&&(a.cleanSession=!0),a.hosts){if(!(a.hosts instanceof Array))throw Error(k(i.INVALID_ARGUMENT,[a.hosts,"connectOptions.hosts"]));if(1>a.hosts.length)throw Error(k(i.INVALID_ARGUMENT,[a.hosts,"connectOptions.hosts"]));for(var b=!1,d=0;d<a.hosts.length;d++){if("string"!=typeof a.hosts[d])throw Error(k(i.INVALID_TYPE,[typeof a.hosts[d],"connectOptions.hosts["+d+"]"]));if(/^(wss?):\/\/((\[(.+)\])|([^\/]+?))(:(\d+))?(\/.*)$/.test(a.hosts[d])){if(0==d)b=!0;else if(!b)throw Error(k(i.INVALID_ARGUMENT,[a.hosts[d],"connectOptions.hosts["+d+"]"]))}else if(b)throw Error(k(i.INVALID_ARGUMENT,[a.hosts[d],"connectOptions.hosts["+d+"]"]))}if(b)a.uris=a.hosts;else{if(!a.ports)throw Error(k(i.INVALID_ARGUMENT,[a.ports,"connectOptions.ports"]));if(!(a.ports instanceof Array))throw Error(k(i.INVALID_ARGUMENT,[a.ports,"connectOptions.ports"]));if(a.hosts.length!=a.ports.length)throw Error(k(i.INVALID_ARGUMENT,[a.ports,"connectOptions.ports"]));for(a.uris=[],d=0;d<a.hosts.length;d++){if("number"!=typeof a.ports[d]||0>a.ports[d])throw Error(k(i.INVALID_TYPE,[typeof a.ports[d],"connectOptions.ports["+d+"]"]));var b=a.hosts[d],f=a.ports[d];e="ws://"+(-1!=b.indexOf(":")?"["+b+"]":b)+":"+f+c,a.uris.push(e)}}}l.connect(a)},this.subscribe=function(a,b){if("string"!=typeof a)throw Error("Invalid argument:"+a);if(b=b||{},g(b,{qos:"number",invocationContext:"object",onSuccess:"function",onFailure:"function",timeout:"number"}),b.timeout&&!b.onFailure)throw Error("subscribeOptions.timeout specified with no onFailure callback.");if(void 0!==b.qos&&0!==b.qos&&1!==b.qos&&2!==b.qos)throw Error(k(i.INVALID_ARGUMENT,[b.qos,"subscribeOptions.qos"]));l.subscribe(a,b)},this.unsubscribe=function(a,b){if("string"!=typeof a)throw Error("Invalid argument:"+a);if(b=b||{},g(b,{invocationContext:"object",onSuccess:"function",onFailure:"function",timeout:"number"}),b.timeout&&!b.onFailure)throw Error("unsubscribeOptions.timeout specified with no onFailure callback.");l.unsubscribe(a,b)},this.send=function(a,b,c,d){var e;if(0==arguments.length)throw Error("Invalid argument.length");if(1==arguments.length){if(!(a instanceof s)&&"string"!=typeof a)throw Error("Invalid argument:"+typeof a);if(e=a,void 0===e.destinationName)throw Error(k(i.INVALID_ARGUMENT,[e.destinationName,"Message.destinationName"]))}else e=new s(b),e.destinationName=a,3<=arguments.length&&(e.qos=c),4<=arguments.length&&(e.retained=d);l.send(e)},this.disconnect=function(){l.disconnect()},this.getTraceLog=function(){return l.getTraceLog()},this.startTrace=function(){l.startTrace()},this.stopTrace=function(){l.stopTrace()},this.isConnected=function(){return l.connected}};r.prototype={get host(){return this._getHost()},set host(a){this._setHost(a)},get port(){return this._getPort()},set port(a){this._setPort(a)},get path(){return this._getPath()},set path(a){this._setPath(a)},get clientId(){return this._getClientId()},set clientId(a){this._setClientId(a)},get onConnectionLost(){return this._getOnConnectionLost()},set onConnectionLost(a){this._setOnConnectionLost(a)},get onMessageDelivered(){return this._getOnMessageDelivered()},set onMessageDelivered(a){this._setOnMessageDelivered(a)},get onMessageArrived(){return this._getOnMessageArrived()},set onMessageArrived(a){this._setOnMessageArrived(a)},get trace(){return this._getTrace()},set trace(a){this._setTrace(a)}};var s=function(a){var b;if(!("string"==typeof a||a instanceof ArrayBuffer||a instanceof Int8Array||a instanceof Uint8Array||a instanceof Int16Array||a instanceof Uint16Array||a instanceof Int32Array||a instanceof Uint32Array||a instanceof Float32Array||a instanceof Float64Array))throw k(i.INVALID_ARGUMENT,[a,"newPayload"]);b=a,this._getPayloadString=function(){return"string"==typeof b?b:f(b,0,b.length)},this._getPayloadBytes=function(){if("string"==typeof b){var a=new ArrayBuffer(d(b)),a=new Uint8Array(a);return e(b,a,0),a}return b};var c=void 0;this._getDestinationName=function(){return c},this._setDestinationName=function(a){if("string"!=typeof a)throw Error(k(i.INVALID_ARGUMENT,[a,"newDestinationName"]));c=a};var g=0;this._getQos=function(){return g},this._setQos=function(a){if(0!==a&&1!==a&&2!==a)throw Error("Invalid argument:"+a);g=a};var h=!1;this._getRetained=function(){return h},this._setRetained=function(a){if("boolean"!=typeof a)throw Error(k(i.INVALID_ARGUMENT,[a,"newRetained"]));h=a};var j=!1;this._getDuplicate=function(){return j},this._setDuplicate=function(a){j=a}};return s.prototype={get payloadString(){return this._getPayloadString()},get payloadBytes(){return this._getPayloadBytes()},get destinationName(){return this._getDestinationName()},set destinationName(a){this._setDestinationName(a)},get qos(){return this._getQos()},set qos(a){this._setQos(a)},get retained(){return this._getRetained()},set retained(a){this._setRetained(a)},get duplicate(){return this._getDuplicate()},set duplicate(a){this._setDuplicate(a)}},{Client:r,Message:s}}(window)},{}],14:[function(a,b,c){(function(a){"use strict";function c(b,c,d,e){if("function"!=typeof b)throw new TypeError('"callback" argument must be a function');var f,g,h=arguments.length;switch(h){case 0:case 1:return a.nextTick(b);case 2:return a.nextTick(function(){b.call(null,c)});case 3:return a.nextTick(function(){b.call(null,c,d)});case 4:return a.nextTick(function(){b.call(null,c,d,e)});default:for(f=new Array(h-1),g=0;g<f.length;)f[g++]=arguments[g];return a.nextTick(function(){b.apply(null,f)})}}!a.version||0===a.version.indexOf("v0.")||0===a.version.indexOf("v1.")&&0!==a.version.indexOf("v1.8.")?b.exports={nextTick:c}:b.exports=a}).call(this,a("_process"))},{_process:15}],15:[function(a,b,c){function d(){throw new Error("setTimeout has not been defined")}function e(){throw new Error("clearTimeout has not been defined")}function f(a){if(l===setTimeout)return setTimeout(a,0);if((l===d||!l)&&setTimeout)return l=setTimeout,setTimeout(a,0);try{return l(a,0)}catch(e){try{return l.call(null,a,0)}catch(e){return l.call(this,a,0)}}}function g(a){if(m===clearTimeout)return clearTimeout(a);if((m===e||!m)&&clearTimeout)return m=clearTimeout,clearTimeout(a);try{return m(a)}catch(e){try{return m.call(null,a)}catch(e){return m.call(this,a)}}}function h(){q&&o&&(q=!1,o.length?p=o.concat(p):r=-1,p.length&&i())}function i(){if(!q){var a=f(h);q=!0;for(var b=p.length;b;){for(o=p,p=[];++r<b;)o&&o[r].run();r=-1,b=p.length}o=null,q=!1,g(a)}}function j(a,b){this.fun=a,this.array=b}function k(){}var l,m,n=b.exports={};!function(){try{l="function"==typeof setTimeout?setTimeout:d}catch(e){l=d}try{m="function"==typeof clearTimeout?clearTimeout:e}catch(e){m=e}}();var o,p=[],q=!1,r=-1;n.nextTick=function(a){var b=new Array(arguments.length-1);if(arguments.length>1)for(var c=1;c<arguments.length;c++)b[c-1]=arguments[c];p.push(new j(a,b)),1!==p.length||q||f(i)},j.prototype.run=function(){this.fun.apply(null,this.array)},n.title="browser",n.browser=!0,n.env={},n.argv=[],n.version="",n.versions={},n.on=k,n.addListener=k,n.once=k,n.off=k,n.removeListener=k,n.removeAllListeners=k,n.emit=k,n.prependListener=k,n.prependOnceListener=k,n.listeners=function(a){return[]},n.binding=function(a){throw new Error("process.binding is not supported")},n.cwd=function(){return"/"},n.chdir=function(a){throw new Error("process.chdir is not supported")},n.umask=function(){return 0}},{}],16:[function(a,b,c){b.exports=a("./lib/_stream_duplex.js")},{"./lib/_stream_duplex.js":17}],17:[function(a,b,c){"use strict";function d(a){if(!(this instanceof d))return new d(a);j.call(this,a),k.call(this,a),a&&!1===a.readable&&(this.readable=!1),a&&!1===a.writable&&(this.writable=!1),this.allowHalfOpen=!0,a&&!1===a.allowHalfOpen&&(this.allowHalfOpen=!1),this.once("end",e)}function e(){this.allowHalfOpen||this._writableState.ended||g.nextTick(f,this)}function f(a){a.end()}var g=a("process-nextick-args"),h=Object.keys||function(a){var b=[];for(var c in a)b.push(c);return b};b.exports=d;var i=a("core-util-is");i.inherits=a("inherits");var j=a("./_stream_readable"),k=a("./_stream_writable");i.inherits(d,j);for(var l=h(k.prototype),m=0;m<l.length;m++){var n=l[m];d.prototype[n]||(d.prototype[n]=k.prototype[n])}Object.defineProperty(d.prototype,"destroyed",{get:function(){return void 0!==this._readableState&&void 0!==this._writableState&&(this._readableState.destroyed&&this._writableState.destroyed)},set:function(a){void 0!==this._readableState&&void 0!==this._writableState&&(this._readableState.destroyed=a,this._writableState.destroyed=a)}}),d.prototype._destroy=function(a,b){this.push(null),this.end(),g.nextTick(b,a)}},{"./_stream_readable":19,"./_stream_writable":21,"core-util-is":6,inherits:9,"process-nextick-args":14}],18:[function(a,b,c){"use strict";function d(a){if(!(this instanceof d))return new d(a);e.call(this,a)}b.exports=d;var e=a("./_stream_transform"),f=a("core-util-is");f.inherits=a("inherits"),f.inherits(d,e),d.prototype._transform=function(a,b,c){c(null,a)}},{"./_stream_transform":20,"core-util-is":6,inherits:9}],19:[function(a,b,c){(function(c,d){"use strict";function e(a){return L.from(a)}function f(a){return L.isBuffer(a)||a instanceof M}function g(a,b,c){if("function"==typeof a.prependListener)return a.prependListener(b,c);a._events&&a._events[b]?I(a._events[b])?a._events[b].unshift(c):a._events[b]=[c,a._events[b]]:a.on(b,c)}function h(b,c){H=H||a("./_stream_duplex"),b=b||{};var d=c instanceof H;this.objectMode=!!b.objectMode,d&&(this.objectMode=this.objectMode||!!b.readableObjectMode);var e=b.highWaterMark,f=b.readableHighWaterMark,g=this.objectMode?16:16384;this.highWaterMark=e||0===e?e:d&&(f||0===f)?f:g,this.highWaterMark=Math.floor(this.highWaterMark),this.buffer=new R,this.length=0,this.pipes=null,this.pipesCount=0,this.flowing=null,this.ended=!1,this.endEmitted=!1,this.reading=!1,this.sync=!0,this.needReadable=!1,this.emittedReadable=!1,this.readableListening=!1,this.resumeScheduled=!1,this.destroyed=!1,this.defaultEncoding=b.defaultEncoding||"utf8",this.awaitDrain=0,this.readingMore=!1,this.decoder=null,this.encoding=null,b.encoding&&(Q||(Q=a("string_decoder/").StringDecoder),this.decoder=new Q(b.encoding),this.encoding=b.encoding)}function i(b){if(H=H||a("./_stream_duplex"),!(this instanceof i))return new i(b);this._readableState=new h(b,this),this.readable=!0,b&&("function"==typeof b.read&&(this._read=b.read),"function"==typeof b.destroy&&(this._destroy=b.destroy)),K.call(this)}function j(a,b,c,d,f){var g=a._readableState;if(null===b)g.reading=!1,p(a,g);else{var h;f||(h=l(g,b)),h?a.emit("error",h):g.objectMode||b&&b.length>0?("string"==typeof b||g.objectMode||Object.getPrototypeOf(b)===L.prototype||(b=e(b)),d?g.endEmitted?a.emit("error",new Error("stream.unshift() after end event")):k(a,g,b,!0):g.ended?a.emit("error",new Error("stream.push() after EOF")):(g.reading=!1,g.decoder&&!c?(b=g.decoder.write(b),g.objectMode||0!==b.length?k(a,g,b,!1):s(a,g)):k(a,g,b,!1))):d||(g.reading=!1)}return m(g)}function k(a,b,c,d){b.flowing&&0===b.length&&!b.sync?(a.emit("data",c),a.read(0)):(b.length+=b.objectMode?1:c.length,d?b.buffer.unshift(c):b.buffer.push(c),b.needReadable&&q(a)),s(a,b)}function l(a,b){var c;return f(b)||"string"==typeof b||void 0===b||a.objectMode||(c=new TypeError("Invalid non-string/buffer chunk")),c}function m(a){return!a.ended&&(a.needReadable||a.length<a.highWaterMark||0===a.length)}function n(a){return a>=U?a=U:(a--,a|=a>>>1,a|=a>>>2,a|=a>>>4,a|=a>>>8,a|=a>>>16,a++),a}function o(a,b){return a<=0||0===b.length&&b.ended?0:b.objectMode?1:a!==a?b.flowing&&b.length?b.buffer.head.data.length:b.length:(a>b.highWaterMark&&(b.highWaterMark=n(a)),a<=b.length?a:b.ended?b.length:(b.needReadable=!0,0))}function p(a,b){if(!b.ended){if(b.decoder){var c=b.decoder.end();c&&c.length&&(b.buffer.push(c),b.length+=b.objectMode?1:c.length)}b.ended=!0,q(a)}}function q(a){var b=a._readableState;b.needReadable=!1,b.emittedReadable||(P("emitReadable",b.flowing),b.emittedReadable=!0,b.sync?G.nextTick(r,a):r(a))}function r(a){P("emit readable"),a.emit("readable"),y(a)}function s(a,b){b.readingMore||(b.readingMore=!0,G.nextTick(t,a,b))}function t(a,b){for(var c=b.length;!b.reading&&!b.flowing&&!b.ended&&b.length<b.highWaterMark&&(P("maybeReadMore read 0"),a.read(0),c!==b.length);)c=b.length;b.readingMore=!1}function u(a){return function(){var b=a._readableState;P("pipeOnDrain",b.awaitDrain),b.awaitDrain&&b.awaitDrain--,0===b.awaitDrain&&J(a,"data")&&(b.flowing=!0,y(a))}}function v(a){P("readable nexttick read 0"),a.read(0)}function w(a,b){b.resumeScheduled||(b.resumeScheduled=!0,G.nextTick(x,a,b))}function x(a,b){b.reading||(P("resume read 0"),a.read(0)),b.resumeScheduled=!1,b.awaitDrain=0,a.emit("resume"),y(a),b.flowing&&!b.reading&&a.read(0)}function y(a){var b=a._readableState;for(P("flow",b.flowing);b.flowing&&null!==a.read(););}function z(a,b){if(0===b.length)return null;var c;return b.objectMode?c=b.buffer.shift():!a||a>=b.length?(c=b.decoder?b.buffer.join(""):1===b.buffer.length?b.buffer.head.data:b.buffer.concat(b.length),b.buffer.clear()):c=A(a,b.buffer,b.decoder),c}function A(a,b,c){var d;return a<b.head.data.length?(d=b.head.data.slice(0,a),b.head.data=b.head.data.slice(a)):d=a===b.head.data.length?b.shift():c?B(a,b):C(a,b),d}function B(a,b){var c=b.head,d=1,e=c.data;for(a-=e.length;c=c.next;){var f=c.data,g=a>f.length?f.length:a;if(g===f.length?e+=f:e+=f.slice(0,a),0===(a-=g)){g===f.length?(++d,c.next?b.head=c.next:b.head=b.tail=null):(b.head=c,c.data=f.slice(g));break}++d}return b.length-=d,e}function C(a,b){var c=L.allocUnsafe(a),d=b.head,e=1;for(d.data.copy(c),a-=d.data.length;d=d.next;){var f=d.data,g=a>f.length?f.length:a;if(f.copy(c,c.length-a,0,g),0===(a-=g)){g===f.length?(++e,d.next?b.head=d.next:b.head=b.tail=null):(b.head=d,d.data=f.slice(g));break}++e}return b.length-=e,c}function D(a){var b=a._readableState;if(b.length>0)throw new Error('"endReadable()" called on non-empty stream');b.endEmitted||(b.ended=!0,G.nextTick(E,b,a))}function E(a,b){a.endEmitted||0!==a.length||(a.endEmitted=!0,b.readable=!1,b.emit("end"))}function F(a,b){for(var c=0,d=a.length;c<d;c++)if(a[c]===b)return c;return-1}var G=a("process-nextick-args");b.exports=i;var H,I=a("isarray");i.ReadableState=h;var J=(a("events").EventEmitter,function(a,b){return a.listeners(b).length}),K=a("./internal/streams/stream"),L=a("safe-buffer").Buffer,M=d.Uint8Array||function(){},N=a("core-util-is");N.inherits=a("inherits");var O=a("util"),P=void 0;P=O&&O.debuglog?O.debuglog("stream"):function(){};var Q,R=a("./internal/streams/BufferList"),S=a("./internal/streams/destroy");N.inherits(i,K);var T=["error","close","destroy","pause","resume"];Object.defineProperty(i.prototype,"destroyed",{get:function(){return void 0!==this._readableState&&this._readableState.destroyed},set:function(a){this._readableState&&(this._readableState.destroyed=a)}}),i.prototype.destroy=S.destroy,i.prototype._undestroy=S.undestroy,i.prototype._destroy=function(a,b){this.push(null),b(a)},i.prototype.push=function(a,b){var c,d=this._readableState;return d.objectMode?c=!0:"string"==typeof a&&(b=b||d.defaultEncoding,b!==d.encoding&&(a=L.from(a,b),b=""),c=!0),j(this,a,b,!1,c)},i.prototype.unshift=function(a){return j(this,a,null,!0,!1)},i.prototype.isPaused=function(){return!1===this._readableState.flowing},i.prototype.setEncoding=function(b){return Q||(Q=a("string_decoder/").StringDecoder),this._readableState.decoder=new Q(b),this._readableState.encoding=b,this};var U=8388608;i.prototype.read=function(a){P("read",a),a=parseInt(a,10);var b=this._readableState,c=a;if(0!==a&&(b.emittedReadable=!1),0===a&&b.needReadable&&(b.length>=b.highWaterMark||b.ended))return P("read: emitReadable",b.length,b.ended),0===b.length&&b.ended?D(this):q(this),null;if(0===(a=o(a,b))&&b.ended)return 0===b.length&&D(this),null;var d=b.needReadable;P("need readable",d),(0===b.length||b.length-a<b.highWaterMark)&&(d=!0,P("length less than watermark",d)),b.ended||b.reading?(d=!1,P("reading or ended",d)):d&&(P("do read"),b.reading=!0,b.sync=!0,0===b.length&&(b.needReadable=!0),this._read(b.highWaterMark),b.sync=!1,b.reading||(a=o(c,b)));var e;return e=a>0?z(a,b):null,null===e?(b.needReadable=!0,a=0):b.length-=a,0===b.length&&(b.ended||(b.needReadable=!0),c!==a&&b.ended&&D(this)),null!==e&&this.emit("data",e),e},i.prototype._read=function(a){this.emit("error",new Error("_read() is not implemented"))},i.prototype.pipe=function(a,b){function d(a,b){P("onunpipe"),a===m&&b&&!1===b.hasUnpiped&&(b.hasUnpiped=!0,f())}function e(){P("onend"),a.end()}function f(){P("cleanup"),a.removeListener("close",j),a.removeListener("finish",k),a.removeListener("drain",q),a.removeListener("error",i),a.removeListener("unpipe",d),m.removeListener("end",e),m.removeListener("end",l),m.removeListener("data",h),r=!0,!n.awaitDrain||a._writableState&&!a._writableState.needDrain||q()}function h(b){P("ondata"),s=!1,!1!==a.write(b)||s||((1===n.pipesCount&&n.pipes===a||n.pipesCount>1&&-1!==F(n.pipes,a))&&!r&&(P("false write response, pause",m._readableState.awaitDrain),m._readableState.awaitDrain++,s=!0),m.pause())}function i(b){P("onerror",b),l(),a.removeListener("error",i),0===J(a,"error")&&a.emit("error",b)}function j(){a.removeListener("finish",k),l()}function k(){P("onfinish"),a.removeListener("close",j),l()}function l(){P("unpipe"),m.unpipe(a)}var m=this,n=this._readableState;switch(n.pipesCount){case 0:n.pipes=a;break;case 1:n.pipes=[n.pipes,a];break;default:n.pipes.push(a)}n.pipesCount+=1,P("pipe count=%d opts=%j",n.pipesCount,b);var o=(!b||!1!==b.end)&&a!==c.stdout&&a!==c.stderr,p=o?e:l;n.endEmitted?G.nextTick(p):m.once("end",p),a.on("unpipe",d);var q=u(m);a.on("drain",q);var r=!1,s=!1;return m.on("data",h),g(a,"error",i),a.once("close",j),a.once("finish",k),a.emit("pipe",m),n.flowing||(P("pipe resume"),m.resume()),a},i.prototype.unpipe=function(a){var b=this._readableState,c={hasUnpiped:!1};if(0===b.pipesCount)return this;if(1===b.pipesCount)return a&&a!==b.pipes?this:(a||(a=b.pipes),b.pipes=null,b.pipesCount=0,b.flowing=!1,a&&a.emit("unpipe",this,c),this);if(!a){var d=b.pipes,e=b.pipesCount;b.pipes=null,b.pipesCount=0,b.flowing=!1;for(var f=0;f<e;f++)d[f].emit("unpipe",this,c);return this}var g=F(b.pipes,a);return-1===g?this:(b.pipes.splice(g,1),b.pipesCount-=1,1===b.pipesCount&&(b.pipes=b.pipes[0]),a.emit("unpipe",this,c),this)},i.prototype.on=function(a,b){var c=K.prototype.on.call(this,a,b);if("data"===a)!1!==this._readableState.flowing&&this.resume();else if("readable"===a){var d=this._readableState;d.endEmitted||d.readableListening||(d.readableListening=d.needReadable=!0,d.emittedReadable=!1,d.reading?d.length&&q(this):G.nextTick(v,this))}return c},i.prototype.addListener=i.prototype.on,i.prototype.resume=function(){var a=this._readableState;return a.flowing||(P("resume"),a.flowing=!0,w(this,a)),this},i.prototype.pause=function(){return P("call pause flowing=%j",this._readableState.flowing),!1!==this._readableState.flowing&&(P("pause"),this._readableState.flowing=!1,this.emit("pause")),this},i.prototype.wrap=function(a){var b=this,c=this._readableState,d=!1;a.on("end",function(){if(P("wrapped end"),c.decoder&&!c.ended){var a=c.decoder.end();a&&a.length&&b.push(a)}b.push(null)}),a.on("data",function(e){if(P("wrapped data"),c.decoder&&(e=c.decoder.write(e)),(!c.objectMode||null!==e&&void 0!==e)&&(c.objectMode||e&&e.length)){b.push(e)||(d=!0,a.pause())}});for(var e in a)void 0===this[e]&&"function"==typeof a[e]&&(this[e]=function(b){return function(){return a[b].apply(a,arguments)}}(e));for(var f=0;f<T.length;f++)a.on(T[f],this.emit.bind(this,T[f]));return this._read=function(b){P("wrapped _read",b),d&&(d=!1,a.resume())},this},i._fromList=z}).call(this,a("_process"),"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./_stream_duplex":17,"./internal/streams/BufferList":22,"./internal/streams/destroy":23,"./internal/streams/stream":24,_process:15,"core-util-is":6,events:7,inherits:9,isarray:25,"process-nextick-args":14,"safe-buffer":31,"string_decoder/":26,util:3}],20:[function(a,b,c){"use strict";function d(a,b){var c=this._transformState;c.transforming=!1;var d=c.writecb;if(!d)return this.emit("error",new Error("write callback called multiple times"));c.writechunk=null,c.writecb=null,null!=b&&this.push(b),d(a);var e=this._readableState;e.reading=!1,(e.needReadable||e.length<e.highWaterMark)&&this._read(e.highWaterMark)}function e(a){if(!(this instanceof e))return new e(a);h.call(this,a),this._transformState={afterTransform:d.bind(this),needTransform:!1,transforming:!1,writecb:null,writechunk:null,writeencoding:null},this._readableState.needReadable=!0,this._readableState.sync=!1,a&&("function"==typeof a.transform&&(this._transform=a.transform),"function"==typeof a.flush&&(this._flush=a.flush)),this.on("prefinish",f)}function f(){var a=this;"function"==typeof this._flush?this._flush(function(b,c){g(a,b,c)}):g(this,null,null)}function g(a,b,c){if(b)return a.emit("error",b);if(null!=c&&a.push(c),a._writableState.length)throw new Error("Calling transform done when ws.length != 0");if(a._transformState.transforming)throw new Error("Calling transform done when still transforming");return a.push(null)}b.exports=e;var h=a("./_stream_duplex"),i=a("core-util-is");i.inherits=a("inherits"),i.inherits(e,h),e.prototype.push=function(a,b){return this._transformState.needTransform=!1,h.prototype.push.call(this,a,b)},e.prototype._transform=function(a,b,c){throw new Error("_transform() is not implemented")},e.prototype._write=function(a,b,c){var d=this._transformState;if(d.writecb=c,d.writechunk=a,d.writeencoding=b,!d.transforming){var e=this._readableState;(d.needTransform||e.needReadable||e.length<e.highWaterMark)&&this._read(e.highWaterMark)}},e.prototype._read=function(a){var b=this._transformState;null!==b.writechunk&&b.writecb&&!b.transforming?(b.transforming=!0,this._transform(b.writechunk,b.writeencoding,b.afterTransform)):b.needTransform=!0},e.prototype._destroy=function(a,b){var c=this;h.prototype._destroy.call(this,a,function(a){b(a),c.emit("close")})}},{"./_stream_duplex":17,"core-util-is":6,inherits:9}],21:[function(a,b,c){(function(c,d){"use strict";function e(a){var b=this;this.next=null,this.entry=null,this.finish=function(){A(b,a)}}function f(a){return H.from(a)}function g(a){return H.isBuffer(a)||a instanceof I}function h(){}function i(b,c){C=C||a("./_stream_duplex"),b=b||{};var d=c instanceof C;this.objectMode=!!b.objectMode,d&&(this.objectMode=this.objectMode||!!b.writableObjectMode);var f=b.highWaterMark,g=b.writableHighWaterMark,h=this.objectMode?16:16384;this.highWaterMark=f||0===f?f:d&&(g||0===g)?g:h,this.highWaterMark=Math.floor(this.highWaterMark),this.finalCalled=!1,this.needDrain=!1,this.ending=!1,this.ended=!1,this.finished=!1,this.destroyed=!1;var i=!1===b.decodeStrings;this.decodeStrings=!i,this.defaultEncoding=b.defaultEncoding||"utf8",this.length=0,this.writing=!1,this.corked=0,this.sync=!0,this.bufferProcessing=!1,this.onwrite=function(a){r(c,a)},this.writecb=null,this.writelen=0,this.bufferedRequest=null,this.lastBufferedRequest=null,this.pendingcb=0,this.prefinished=!1,this.errorEmitted=!1,this.bufferedRequestCount=0,this.corkedRequestsFree=new e(this)}function j(b){if(C=C||a("./_stream_duplex"),!(K.call(j,this)||this instanceof C))return new j(b);this._writableState=new i(b,this),this.writable=!0,b&&("function"==typeof b.write&&(this._write=b.write),"function"==typeof b.writev&&(this._writev=b.writev),"function"==typeof b.destroy&&(this._destroy=b.destroy),"function"==typeof b.final&&(this._final=b.final)),G.call(this)}function k(a,b){var c=new Error("write after end");a.emit("error",c),B.nextTick(b,c)}function l(a,b,c,d){var e=!0,f=!1;return null===c?f=new TypeError("May not write null values to stream"):"string"==typeof c||void 0===c||b.objectMode||(f=new TypeError("Invalid non-string/buffer chunk")),f&&(a.emit("error",f),B.nextTick(d,f),e=!1),e}function m(a,b,c){return a.objectMode||!1===a.decodeStrings||"string"!=typeof b||(b=H.from(b,c)),b}function n(a,b,c,d,e,f){if(!c){var g=m(b,d,e);d!==g&&(c=!0,e="buffer",d=g)}var h=b.objectMode?1:d.length;b.length+=h;var i=b.length<b.highWaterMark;if(i||(b.needDrain=!0),b.writing||b.corked){var j=b.lastBufferedRequest;b.lastBufferedRequest={chunk:d,encoding:e,isBuf:c,callback:f,next:null},j?j.next=b.lastBufferedRequest:b.bufferedRequest=b.lastBufferedRequest,b.bufferedRequestCount+=1}else o(a,b,!1,h,d,e,f);return i}function o(a,b,c,d,e,f,g){b.writelen=d,b.writecb=g,b.writing=!0,b.sync=!0,c?a._writev(e,b.onwrite):a._write(e,f,b.onwrite),b.sync=!1}function p(a,b,c,d,e){--b.pendingcb,c?(B.nextTick(e,d),B.nextTick(y,a,b),a._writableState.errorEmitted=!0,a.emit("error",d)):(e(d),a._writableState.errorEmitted=!0,a.emit("error",d),y(a,b))}function q(a){a.writing=!1,a.writecb=null,a.length-=a.writelen,a.writelen=0}function r(a,b){var c=a._writableState,d=c.sync,e=c.writecb;if(q(c),b)p(a,c,d,b,e);else{var f=v(c);f||c.corked||c.bufferProcessing||!c.bufferedRequest||u(a,c),d?D(s,a,c,f,e):s(a,c,f,e)}}function s(a,b,c,d){c||t(a,b),b.pendingcb--,d(),y(a,b)}function t(a,b){0===b.length&&b.needDrain&&(b.needDrain=!1,a.emit("drain"))}function u(a,b){b.bufferProcessing=!0;var c=b.bufferedRequest;if(a._writev&&c&&c.next){var d=b.bufferedRequestCount,f=new Array(d),g=b.corkedRequestsFree;g.entry=c;for(var h=0,i=!0;c;)f[h]=c,c.isBuf||(i=!1),c=c.next,h+=1;f.allBuffers=i,o(a,b,!0,b.length,f,"",g.finish),b.pendingcb++,b.lastBufferedRequest=null,g.next?(b.corkedRequestsFree=g.next,g.next=null):b.corkedRequestsFree=new e(b),b.bufferedRequestCount=0}else{for(;c;){var j=c.chunk,k=c.encoding,l=c.callback;if(o(a,b,!1,b.objectMode?1:j.length,j,k,l),c=c.next,b.bufferedRequestCount--,b.writing)break}null===c&&(b.lastBufferedRequest=null)}b.bufferedRequest=c,b.bufferProcessing=!1}function v(a){return a.ending&&0===a.length&&null===a.bufferedRequest&&!a.finished&&!a.writing}function w(a,b){a._final(function(c){b.pendingcb--,c&&a.emit("error",c),b.prefinished=!0,a.emit("prefinish"),y(a,b)})}function x(a,b){b.prefinished||b.finalCalled||("function"==typeof a._final?(b.pendingcb++,b.finalCalled=!0,B.nextTick(w,a,b)):(b.prefinished=!0,a.emit("prefinish")))}function y(a,b){var c=v(b);return c&&(x(a,b),0===b.pendingcb&&(b.finished=!0,a.emit("finish"))),c}function z(a,b,c){b.ending=!0,y(a,b),c&&(b.finished?B.nextTick(c):a.once("finish",c)),b.ended=!0,a.writable=!1}function A(a,b,c){var d=a.entry;for(a.entry=null;d;){var e=d.callback;b.pendingcb--,e(c),d=d.next}b.corkedRequestsFree?b.corkedRequestsFree.next=a:b.corkedRequestsFree=a}var B=a("process-nextick-args");b.exports=j;var C,D=!c.browser&&["v0.10","v0.9."].indexOf(c.version.slice(0,5))>-1?setImmediate:B.nextTick;j.WritableState=i;var E=a("core-util-is");E.inherits=a("inherits");var F={deprecate:a("util-deprecate")},G=a("./internal/streams/stream"),H=a("safe-buffer").Buffer,I=d.Uint8Array||function(){},J=a("./internal/streams/destroy");E.inherits(j,G),i.prototype.getBuffer=function(){for(var a=this.bufferedRequest,b=[];a;)b.push(a),a=a.next;return b},function(){try{Object.defineProperty(i.prototype,"buffer",{get:F.deprecate(function(){return this.getBuffer()},"_writableState.buffer is deprecated. Use _writableState.getBuffer instead.","DEP0003")})}catch(a){}}();var K;"function"==typeof Symbol&&Symbol.hasInstance&&"function"==typeof Function.prototype[Symbol.hasInstance]?(K=Function.prototype[Symbol.hasInstance],Object.defineProperty(j,Symbol.hasInstance,{value:function(a){return!!K.call(this,a)||this===j&&(a&&a._writableState instanceof i)}})):K=function(a){return a instanceof this},j.prototype.pipe=function(){this.emit("error",new Error("Cannot pipe, not readable"))},j.prototype.write=function(a,b,c){var d=this._writableState,e=!1,i=!d.objectMode&&g(a);return i&&!H.isBuffer(a)&&(a=f(a)),"function"==typeof b&&(c=b,b=null),i?b="buffer":b||(b=d.defaultEncoding),"function"!=typeof c&&(c=h),d.ended?k(this,c):(i||l(this,d,a,c))&&(d.pendingcb++,e=n(this,d,i,a,b,c)),e},j.prototype.cork=function(){this._writableState.corked++},j.prototype.uncork=function(){var a=this._writableState;a.corked&&(a.corked--,a.writing||a.corked||a.finished||a.bufferProcessing||!a.bufferedRequest||u(this,a))},j.prototype.setDefaultEncoding=function(a){if("string"==typeof a&&(a=a.toLowerCase()),!(["hex","utf8","utf-8","ascii","binary","base64","ucs2","ucs-2","utf16le","utf-16le","raw"].indexOf((a+"").toLowerCase())>-1))throw new TypeError("Unknown encoding: "+a);return this._writableState.defaultEncoding=a,this},j.prototype._write=function(a,b,c){c(new Error("_write() is not implemented"))},j.prototype._writev=null,j.prototype.end=function(a,b,c){var d=this._writableState;"function"==typeof a?(c=a,a=null,b=null):"function"==typeof b&&(c=b,b=null),null!==a&&void 0!==a&&this.write(a,b),d.corked&&(d.corked=1,this.uncork()),d.ending||d.finished||z(this,d,c)},Object.defineProperty(j.prototype,"destroyed",{get:function(){return void 0!==this._writableState&&this._writableState.destroyed},set:function(a){this._writableState&&(this._writableState.destroyed=a)}}),j.prototype.destroy=J.destroy,j.prototype._undestroy=J.undestroy,j.prototype._destroy=function(a,b){this.end(),b(a)}}).call(this,a("_process"),"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./_stream_duplex":17,"./internal/streams/destroy":23,"./internal/streams/stream":24,_process:15,"core-util-is":6,inherits:9,"process-nextick-args":14,"safe-buffer":31,"util-deprecate":36}],22:[function(a,b,c){"use strict";function d(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function e(a,b,c){a.copy(b,c)}var f=a("safe-buffer").Buffer,g=a("util");b.exports=function(){function a(){d(this,a),this.head=null,this.tail=null,this.length=0}return a.prototype.push=function(a){var b={data:a,next:null};this.length>0?this.tail.next=b:this.head=b,this.tail=b,++this.length},a.prototype.unshift=function(a){var b={data:a,next:this.head};0===this.length&&(this.tail=b),this.head=b,++this.length},a.prototype.shift=function(){if(0!==this.length){var a=this.head.data;return 1===this.length?this.head=this.tail=null:this.head=this.head.next,--this.length,a}},a.prototype.clear=function(){this.head=this.tail=null,this.length=0},a.prototype.join=function(a){if(0===this.length)return"";for(var b=this.head,c=""+b.data;b=b.next;)c+=a+b.data;return c},a.prototype.concat=function(a){if(0===this.length)return f.alloc(0);if(1===this.length)return this.head.data
;for(var b=f.allocUnsafe(a>>>0),c=this.head,d=0;c;)e(c.data,b,d),d+=c.data.length,c=c.next;return b},a}(),g&&g.inspect&&g.inspect.custom&&(b.exports.prototype[g.inspect.custom]=function(){var a=g.inspect({length:this.length});return this.constructor.name+" "+a})},{"safe-buffer":31,util:3}],23:[function(a,b,c){"use strict";function d(a,b){var c=this,d=this._readableState&&this._readableState.destroyed,e=this._writableState&&this._writableState.destroyed;return d||e?(b?b(a):!a||this._writableState&&this._writableState.errorEmitted||g.nextTick(f,this,a),this):(this._readableState&&(this._readableState.destroyed=!0),this._writableState&&(this._writableState.destroyed=!0),this._destroy(a||null,function(a){!b&&a?(g.nextTick(f,c,a),c._writableState&&(c._writableState.errorEmitted=!0)):b&&b(a)}),this)}function e(){this._readableState&&(this._readableState.destroyed=!1,this._readableState.reading=!1,this._readableState.ended=!1,this._readableState.endEmitted=!1),this._writableState&&(this._writableState.destroyed=!1,this._writableState.ended=!1,this._writableState.ending=!1,this._writableState.finished=!1,this._writableState.errorEmitted=!1)}function f(a,b){a.emit("error",b)}var g=a("process-nextick-args");b.exports={destroy:d,undestroy:e}},{"process-nextick-args":14}],24:[function(a,b,c){b.exports=a("events").EventEmitter},{events:7}],25:[function(a,b,c){arguments[4][5][0].apply(c,arguments)},{dup:5}],26:[function(a,b,c){"use strict";function d(a){if(!a)return"utf8";for(var b;;)switch(a){case"utf8":case"utf-8":return"utf8";case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return"utf16le";case"latin1":case"binary":return"latin1";case"base64":case"ascii":case"hex":return a;default:if(b)return;a=(""+a).toLowerCase(),b=!0}}function e(a){var b=d(a);if("string"!=typeof b&&(s.isEncoding===t||!t(a)))throw new Error("Unknown encoding: "+a);return b||a}function f(a){this.encoding=e(a);var b;switch(this.encoding){case"utf16le":this.text=m,this.end=n,b=4;break;case"utf8":this.fillLast=j,b=4;break;case"base64":this.text=o,this.end=p,b=3;break;default:return this.write=q,void(this.end=r)}this.lastNeed=0,this.lastTotal=0,this.lastChar=s.allocUnsafe(b)}function g(a){return a<=127?0:a>>5==6?2:a>>4==14?3:a>>3==30?4:-1}function h(a,b,c){var d=b.length-1;if(d<c)return 0;var e=g(b[d]);return e>=0?(e>0&&(a.lastNeed=e-1),e):--d<c?0:(e=g(b[d]))>=0?(e>0&&(a.lastNeed=e-2),e):--d<c?0:(e=g(b[d]),e>=0?(e>0&&(2===e?e=0:a.lastNeed=e-3),e):0)}function i(a,b,c){if(128!=(192&b[0]))return a.lastNeed=0,"�".repeat(c);if(a.lastNeed>1&&b.length>1){if(128!=(192&b[1]))return a.lastNeed=1,"�".repeat(c+1);if(a.lastNeed>2&&b.length>2&&128!=(192&b[2]))return a.lastNeed=2,"�".repeat(c+2)}}function j(a){var b=this.lastTotal-this.lastNeed,c=i(this,a,b);return void 0!==c?c:this.lastNeed<=a.length?(a.copy(this.lastChar,b,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal)):(a.copy(this.lastChar,b,0,a.length),void(this.lastNeed-=a.length))}function k(a,b){var c=h(this,a,b);if(!this.lastNeed)return a.toString("utf8",b);this.lastTotal=c;var d=a.length-(c-this.lastNeed);return a.copy(this.lastChar,0,d),a.toString("utf8",b,d)}function l(a){var b=a&&a.length?this.write(a):"";return this.lastNeed?b+"�".repeat(this.lastTotal-this.lastNeed):b}function m(a,b){if((a.length-b)%2==0){var c=a.toString("utf16le",b);if(c){var d=c.charCodeAt(c.length-1);if(d>=55296&&d<=56319)return this.lastNeed=2,this.lastTotal=4,this.lastChar[0]=a[a.length-2],this.lastChar[1]=a[a.length-1],c.slice(0,-1)}return c}return this.lastNeed=1,this.lastTotal=2,this.lastChar[0]=a[a.length-1],a.toString("utf16le",b,a.length-1)}function n(a){var b=a&&a.length?this.write(a):"";if(this.lastNeed){var c=this.lastTotal-this.lastNeed;return b+this.lastChar.toString("utf16le",0,c)}return b}function o(a,b){var c=(a.length-b)%3;return 0===c?a.toString("base64",b):(this.lastNeed=3-c,this.lastTotal=3,1===c?this.lastChar[0]=a[a.length-1]:(this.lastChar[0]=a[a.length-2],this.lastChar[1]=a[a.length-1]),a.toString("base64",b,a.length-c))}function p(a){var b=a&&a.length?this.write(a):"";return this.lastNeed?b+this.lastChar.toString("base64",0,3-this.lastNeed):b}function q(a){return a.toString(this.encoding)}function r(a){return a&&a.length?this.write(a):""}var s=a("safe-buffer").Buffer,t=s.isEncoding||function(a){switch((a=""+a)&&a.toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":case"raw":return!0;default:return!1}};c.StringDecoder=f,f.prototype.write=function(a){if(0===a.length)return"";var b,c;if(this.lastNeed){if(void 0===(b=this.fillLast(a)))return"";c=this.lastNeed,this.lastNeed=0}else c=0;return c<a.length?b?b+this.text(a,c):this.text(a,c):b||""},f.prototype.end=l,f.prototype.text=k,f.prototype.fillLast=function(a){if(this.lastNeed<=a.length)return a.copy(this.lastChar,this.lastTotal-this.lastNeed,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal);a.copy(this.lastChar,this.lastTotal-this.lastNeed,0,a.length),this.lastNeed-=a.length}},{"safe-buffer":31}],27:[function(a,b,c){b.exports=a("./readable").PassThrough},{"./readable":28}],28:[function(a,b,c){c=b.exports=a("./lib/_stream_readable.js"),c.Stream=c,c.Readable=c,c.Writable=a("./lib/_stream_writable.js"),c.Duplex=a("./lib/_stream_duplex.js"),c.Transform=a("./lib/_stream_transform.js"),c.PassThrough=a("./lib/_stream_passthrough.js")},{"./lib/_stream_duplex.js":17,"./lib/_stream_passthrough.js":18,"./lib/_stream_readable.js":19,"./lib/_stream_transform.js":20,"./lib/_stream_writable.js":21}],29:[function(a,b,c){b.exports=a("./readable").Transform},{"./readable":28}],30:[function(a,b,c){b.exports=a("./lib/_stream_writable.js")},{"./lib/_stream_writable.js":21}],31:[function(a,b,c){function d(a,b){for(var c in a)b[c]=a[c]}function e(a,b,c){return g(a,b,c)}var f=a("buffer"),g=f.Buffer;g.from&&g.alloc&&g.allocUnsafe&&g.allocUnsafeSlow?b.exports=f:(d(f,c),c.Buffer=e),d(g,e),e.from=function(a,b,c){if("number"==typeof a)throw new TypeError("Argument must not be a number");return g(a,b,c)},e.alloc=function(a,b,c){if("number"!=typeof a)throw new TypeError("Argument must be a number");var d=g(a);return void 0!==b?"string"==typeof c?d.fill(b,c):d.fill(b):d.fill(0),d},e.allocUnsafe=function(a){if("number"!=typeof a)throw new TypeError("Argument must be a number");return g(a)},e.allocUnsafeSlow=function(a){if("number"!=typeof a)throw new TypeError("Argument must be a number");return f.SlowBuffer(a)}},{buffer:4}],32:[function(a,b,c){(function(b){!function(c){function d(a,b){if(!(this instanceof d))return new d(a,b);var e=this;f(e),e.q=e.c="",e.bufferCheckPosition=c.MAX_BUFFER_LENGTH,e.opt=b||{},e.opt.lowercase=e.opt.lowercase||e.opt.lowercasetags,e.looseCase=e.opt.lowercase?"toLowerCase":"toUpperCase",e.tags=[],e.closed=e.closedRoot=e.sawRoot=!1,e.tag=e.error=null,e.strict=!!a,e.noscript=!(!a&&!e.opt.noscript),e.state=Q.BEGIN,e.strictEntities=e.opt.strictEntities,e.ENTITIES=e.strictEntities?Object.create(c.XML_ENTITIES):Object.create(c.ENTITIES),e.attribList=[],e.opt.xmlns&&(e.ns=Object.create(L)),e.trackPosition=!1!==e.opt.position,e.trackPosition&&(e.position=e.line=e.column=0),o(e,"onready")}function e(a){for(var b=Math.max(c.MAX_BUFFER_LENGTH,10),d=0,e=0,f=E.length;e<f;e++){var g=a[E[e]].length;if(g>b)switch(E[e]){case"textNode":q(a);break;case"cdata":p(a,"oncdata",a.cdata),a.cdata="";break;case"script":p(a,"onscript",a.script),a.script="";break;default:s(a,"Max buffer length exceeded: "+E[e])}d=Math.max(d,g)}var h=c.MAX_BUFFER_LENGTH-d;a.bufferCheckPosition=h+a.position}function f(a){for(var b=0,c=E.length;b<c;b++)a[E[b]]=""}function g(a){q(a),""!==a.cdata&&(p(a,"oncdata",a.cdata),a.cdata=""),""!==a.script&&(p(a,"onscript",a.script),a.script="")}function h(a,b){return new i(a,b)}function i(a,b){if(!(this instanceof i))return new i(a,b);F.apply(this),this._parser=new d(a,b),this.writable=!0,this.readable=!0;var c=this;this._parser.onend=function(){c.emit("end")},this._parser.onerror=function(a){c.emit("error",a),c._parser.error=null},this._decoder=null,G.forEach(function(a){Object.defineProperty(c,"on"+a,{get:function(){return c._parser["on"+a]},set:function(b){if(!b)return c.removeAllListeners(a),c._parser["on"+a]=b,b;c.on(a,b)},enumerable:!0,configurable:!1})})}function j(a){return" "===a||"\n"===a||"\r"===a||"\t"===a}function k(a){return'"'===a||"'"===a}function l(a){return">"===a||j(a)}function m(a,b){return a.test(b)}function n(a,b){return!m(a,b)}function o(a,b,c){a[b]&&a[b](c)}function p(a,b,c){a.textNode&&q(a),o(a,b,c)}function q(a){a.textNode=r(a.opt,a.textNode),a.textNode&&o(a,"ontext",a.textNode),a.textNode=""}function r(a,b){return a.trim&&(b=b.trim()),a.normalize&&(b=b.replace(/\s+/g," ")),b}function s(a,b){return q(a),a.trackPosition&&(b+="\nLine: "+a.line+"\nColumn: "+a.column+"\nChar: "+a.c),b=new Error(b),a.error=b,o(a,"onerror",b),a}function t(a){return a.sawRoot&&!a.closedRoot&&u(a,"Unclosed root tag"),a.state!==Q.BEGIN&&a.state!==Q.BEGIN_WHITESPACE&&a.state!==Q.TEXT&&s(a,"Unexpected end"),q(a),a.c="",a.closed=!0,o(a,"onend"),d.call(a,a.strict,a.opt),a}function u(a,b){if("object"!=typeof a||!(a instanceof d))throw new Error("bad call to strictFail");a.strict&&s(a,b)}function v(a){a.strict||(a.tagName=a.tagName[a.looseCase]());var b=a.tags[a.tags.length-1]||a,c=a.tag={name:a.tagName,attributes:{}};a.opt.xmlns&&(c.ns=b.ns),a.attribList.length=0,p(a,"onopentagstart",c)}function w(a,b){var c=a.indexOf(":"),d=c<0?["",a]:a.split(":"),e=d[0],f=d[1];return b&&"xmlns"===a&&(e="xmlns",f=""),{prefix:e,local:f}}function x(a){if(a.strict||(a.attribName=a.attribName[a.looseCase]()),-1!==a.attribList.indexOf(a.attribName)||a.tag.attributes.hasOwnProperty(a.attribName))return void(a.attribName=a.attribValue="");if(a.opt.xmlns){var b=w(a.attribName,!0),c=b.prefix,d=b.local;if("xmlns"===c)if("xml"===d&&a.attribValue!==J)u(a,"xml: prefix must be bound to "+J+"\nActual: "+a.attribValue);else if("xmlns"===d&&a.attribValue!==K)u(a,"xmlns: prefix must be bound to "+K+"\nActual: "+a.attribValue);else{var e=a.tag,f=a.tags[a.tags.length-1]||a;e.ns===f.ns&&(e.ns=Object.create(f.ns)),e.ns[d]=a.attribValue}a.attribList.push([a.attribName,a.attribValue])}else a.tag.attributes[a.attribName]=a.attribValue,p(a,"onattribute",{name:a.attribName,value:a.attribValue});a.attribName=a.attribValue=""}function y(a,b){if(a.opt.xmlns){var c=a.tag,d=w(a.tagName);c.prefix=d.prefix,c.local=d.local,c.uri=c.ns[d.prefix]||"",c.prefix&&!c.uri&&(u(a,"Unbound namespace prefix: "+JSON.stringify(a.tagName)),c.uri=d.prefix);var e=a.tags[a.tags.length-1]||a;c.ns&&e.ns!==c.ns&&Object.keys(c.ns).forEach(function(b){p(a,"onopennamespace",{prefix:b,uri:c.ns[b]})});for(var f=0,g=a.attribList.length;f<g;f++){var h=a.attribList[f],i=h[0],j=h[1],k=w(i,!0),l=k.prefix,m=k.local,n=""===l?"":c.ns[l]||"",o={name:i,value:j,prefix:l,local:m,uri:n};l&&"xmlns"!==l&&!n&&(u(a,"Unbound namespace prefix: "+JSON.stringify(l)),o.uri=l),a.tag.attributes[i]=o,p(a,"onattribute",o)}a.attribList.length=0}a.tag.isSelfClosing=!!b,a.sawRoot=!0,a.tags.push(a.tag),p(a,"onopentag",a.tag),b||(a.noscript||"script"!==a.tagName.toLowerCase()?a.state=Q.TEXT:a.state=Q.SCRIPT,a.tag=null,a.tagName=""),a.attribName=a.attribValue="",a.attribList.length=0}function z(a){if(!a.tagName)return u(a,"Weird empty close tag."),a.textNode+="</>",void(a.state=Q.TEXT);if(a.script){if("script"!==a.tagName)return a.script+="</"+a.tagName+">",a.tagName="",void(a.state=Q.SCRIPT);p(a,"onscript",a.script),a.script=""}var b=a.tags.length,c=a.tagName;a.strict||(c=c[a.looseCase]());for(var d=c;b--;){if(a.tags[b].name===d)break;u(a,"Unexpected close tag")}if(b<0)return u(a,"Unmatched closing tag: "+a.tagName),a.textNode+="</"+a.tagName+">",void(a.state=Q.TEXT);a.tagName=c;for(var e=a.tags.length;e-- >b;){var f=a.tag=a.tags.pop();a.tagName=a.tag.name,p(a,"onclosetag",a.tagName);var g={};for(var h in f.ns)g[h]=f.ns[h];var i=a.tags[a.tags.length-1]||a;a.opt.xmlns&&f.ns!==i.ns&&Object.keys(f.ns).forEach(function(b){var c=f.ns[b];p(a,"onclosenamespace",{prefix:b,uri:c})})}0===b&&(a.closedRoot=!0),a.tagName=a.attribValue=a.attribName="",a.attribList.length=0,a.state=Q.TEXT}function A(a){var b,c=a.entity,d=c.toLowerCase(),e="";return a.ENTITIES[c]?a.ENTITIES[c]:a.ENTITIES[d]?a.ENTITIES[d]:(c=d,"#"===c.charAt(0)&&("x"===c.charAt(1)?(c=c.slice(2),b=parseInt(c,16),e=b.toString(16)):(c=c.slice(1),b=parseInt(c,10),e=b.toString(10))),c=c.replace(/^0+/,""),isNaN(b)||e.toLowerCase()!==c?(u(a,"Invalid character entity"),"&"+a.entity+";"):String.fromCodePoint(b))}function B(a,b){"<"===b?(a.state=Q.OPEN_WAKA,a.startTagPosition=a.position):j(b)||(u(a,"Non-whitespace before first tag."),a.textNode=b,a.state=Q.TEXT)}function C(a,b){var c="";return b<a.length&&(c=a.charAt(b)),c}function D(a){var b=this;if(this.error)throw this.error;if(b.closed)return s(b,"Cannot write after close. Assign an onready handler.");if(null===a)return t(b);"object"==typeof a&&(a=a.toString());for(var c=0,d="";;){if(d=C(a,c++),b.c=d,!d)break;switch(b.trackPosition&&(b.position++,"\n"===d?(b.line++,b.column=0):b.column++),b.state){case Q.BEGIN:if(b.state=Q.BEGIN_WHITESPACE,"\ufeff"===d)continue;B(b,d);continue;case Q.BEGIN_WHITESPACE:B(b,d);continue;case Q.TEXT:if(b.sawRoot&&!b.closedRoot){for(var f=c-1;d&&"<"!==d&&"&"!==d;)(d=C(a,c++))&&b.trackPosition&&(b.position++,"\n"===d?(b.line++,b.column=0):b.column++);b.textNode+=a.substring(f,c-1)}"<"!==d||b.sawRoot&&b.closedRoot&&!b.strict?(j(d)||b.sawRoot&&!b.closedRoot||u(b,"Text data outside of root node."),"&"===d?b.state=Q.TEXT_ENTITY:b.textNode+=d):(b.state=Q.OPEN_WAKA,b.startTagPosition=b.position);continue;case Q.SCRIPT:"<"===d?b.state=Q.SCRIPT_ENDING:b.script+=d;continue;case Q.SCRIPT_ENDING:"/"===d?b.state=Q.CLOSE_TAG:(b.script+="<"+d,b.state=Q.SCRIPT);continue;case Q.OPEN_WAKA:if("!"===d)b.state=Q.SGML_DECL,b.sgmlDecl="";else if(j(d));else if(m(M,d))b.state=Q.OPEN_TAG,b.tagName=d;else if("/"===d)b.state=Q.CLOSE_TAG,b.tagName="";else if("?"===d)b.state=Q.PROC_INST,b.procInstName=b.procInstBody="";else{if(u(b,"Unencoded <"),b.startTagPosition+1<b.position){var g=b.position-b.startTagPosition;d=new Array(g).join(" ")+d}b.textNode+="<"+d,b.state=Q.TEXT}continue;case Q.SGML_DECL:(b.sgmlDecl+d).toUpperCase()===H?(p(b,"onopencdata"),b.state=Q.CDATA,b.sgmlDecl="",b.cdata=""):b.sgmlDecl+d==="--"?(b.state=Q.COMMENT,b.comment="",b.sgmlDecl=""):(b.sgmlDecl+d).toUpperCase()===I?(b.state=Q.DOCTYPE,(b.doctype||b.sawRoot)&&u(b,"Inappropriately located doctype declaration"),b.doctype="",b.sgmlDecl=""):">"===d?(p(b,"onsgmldeclaration",b.sgmlDecl),b.sgmlDecl="",b.state=Q.TEXT):k(d)?(b.state=Q.SGML_DECL_QUOTED,b.sgmlDecl+=d):b.sgmlDecl+=d;continue;case Q.SGML_DECL_QUOTED:d===b.q&&(b.state=Q.SGML_DECL,b.q=""),b.sgmlDecl+=d;continue;case Q.DOCTYPE:">"===d?(b.state=Q.TEXT,p(b,"ondoctype",b.doctype),b.doctype=!0):(b.doctype+=d,"["===d?b.state=Q.DOCTYPE_DTD:k(d)&&(b.state=Q.DOCTYPE_QUOTED,b.q=d));continue;case Q.DOCTYPE_QUOTED:b.doctype+=d,d===b.q&&(b.q="",b.state=Q.DOCTYPE);continue;case Q.DOCTYPE_DTD:b.doctype+=d,"]"===d?b.state=Q.DOCTYPE:k(d)&&(b.state=Q.DOCTYPE_DTD_QUOTED,b.q=d);continue;case Q.DOCTYPE_DTD_QUOTED:b.doctype+=d,d===b.q&&(b.state=Q.DOCTYPE_DTD,b.q="");continue;case Q.COMMENT:"-"===d?b.state=Q.COMMENT_ENDING:b.comment+=d;continue;case Q.COMMENT_ENDING:"-"===d?(b.state=Q.COMMENT_ENDED,b.comment=r(b.opt,b.comment),b.comment&&p(b,"oncomment",b.comment),b.comment=""):(b.comment+="-"+d,b.state=Q.COMMENT);continue;case Q.COMMENT_ENDED:">"!==d?(u(b,"Malformed comment"),b.comment+="--"+d,b.state=Q.COMMENT):b.state=Q.TEXT;continue;case Q.CDATA:"]"===d?b.state=Q.CDATA_ENDING:b.cdata+=d;continue;case Q.CDATA_ENDING:"]"===d?b.state=Q.CDATA_ENDING_2:(b.cdata+="]"+d,b.state=Q.CDATA);continue;case Q.CDATA_ENDING_2:">"===d?(b.cdata&&p(b,"oncdata",b.cdata),p(b,"onclosecdata"),b.cdata="",b.state=Q.TEXT):"]"===d?b.cdata+="]":(b.cdata+="]]"+d,b.state=Q.CDATA);continue;case Q.PROC_INST:"?"===d?b.state=Q.PROC_INST_ENDING:j(d)?b.state=Q.PROC_INST_BODY:b.procInstName+=d;continue;case Q.PROC_INST_BODY:if(!b.procInstBody&&j(d))continue;"?"===d?b.state=Q.PROC_INST_ENDING:b.procInstBody+=d;continue;case Q.PROC_INST_ENDING:">"===d?(p(b,"onprocessinginstruction",{name:b.procInstName,body:b.procInstBody}),b.procInstName=b.procInstBody="",b.state=Q.TEXT):(b.procInstBody+="?"+d,b.state=Q.PROC_INST_BODY);continue;case Q.OPEN_TAG:m(N,d)?b.tagName+=d:(v(b),">"===d?y(b):"/"===d?b.state=Q.OPEN_TAG_SLASH:(j(d)||u(b,"Invalid character in tag name"),b.state=Q.ATTRIB));continue;case Q.OPEN_TAG_SLASH:">"===d?(y(b,!0),z(b)):(u(b,"Forward-slash in opening tag not followed by >"),b.state=Q.ATTRIB);continue;case Q.ATTRIB:if(j(d))continue;">"===d?y(b):"/"===d?b.state=Q.OPEN_TAG_SLASH:m(M,d)?(b.attribName=d,b.attribValue="",b.state=Q.ATTRIB_NAME):u(b,"Invalid attribute name");continue;case Q.ATTRIB_NAME:"="===d?b.state=Q.ATTRIB_VALUE:">"===d?(u(b,"Attribute without value"),b.attribValue=b.attribName,x(b),y(b)):j(d)?b.state=Q.ATTRIB_NAME_SAW_WHITE:m(N,d)?b.attribName+=d:u(b,"Invalid attribute name");continue;case Q.ATTRIB_NAME_SAW_WHITE:if("="===d)b.state=Q.ATTRIB_VALUE;else{if(j(d))continue;u(b,"Attribute without value"),b.tag.attributes[b.attribName]="",b.attribValue="",p(b,"onattribute",{name:b.attribName,value:""}),b.attribName="",">"===d?y(b):m(M,d)?(b.attribName=d,b.state=Q.ATTRIB_NAME):(u(b,"Invalid attribute name"),b.state=Q.ATTRIB)}continue;case Q.ATTRIB_VALUE:if(j(d))continue;k(d)?(b.q=d,b.state=Q.ATTRIB_VALUE_QUOTED):(u(b,"Unquoted attribute value"),b.state=Q.ATTRIB_VALUE_UNQUOTED,b.attribValue=d);continue;case Q.ATTRIB_VALUE_QUOTED:if(d!==b.q){"&"===d?b.state=Q.ATTRIB_VALUE_ENTITY_Q:b.attribValue+=d;continue}x(b),b.q="",b.state=Q.ATTRIB_VALUE_CLOSED;continue;case Q.ATTRIB_VALUE_CLOSED:j(d)?b.state=Q.ATTRIB:">"===d?y(b):"/"===d?b.state=Q.OPEN_TAG_SLASH:m(M,d)?(u(b,"No whitespace between attributes"),b.attribName=d,b.attribValue="",b.state=Q.ATTRIB_NAME):u(b,"Invalid attribute name");continue;case Q.ATTRIB_VALUE_UNQUOTED:if(!l(d)){"&"===d?b.state=Q.ATTRIB_VALUE_ENTITY_U:b.attribValue+=d;continue}x(b),">"===d?y(b):b.state=Q.ATTRIB;continue;case Q.CLOSE_TAG:if(b.tagName)">"===d?z(b):m(N,d)?b.tagName+=d:b.script?(b.script+="</"+b.tagName,b.tagName="",b.state=Q.SCRIPT):(j(d)||u(b,"Invalid tagname in closing tag"),b.state=Q.CLOSE_TAG_SAW_WHITE);else{if(j(d))continue;n(M,d)?b.script?(b.script+="</"+d,b.state=Q.SCRIPT):u(b,"Invalid tagname in closing tag."):b.tagName=d}continue;case Q.CLOSE_TAG_SAW_WHITE:if(j(d))continue;">"===d?z(b):u(b,"Invalid characters in closing tag");continue;case Q.TEXT_ENTITY:case Q.ATTRIB_VALUE_ENTITY_Q:case Q.ATTRIB_VALUE_ENTITY_U:var h,i;switch(b.state){case Q.TEXT_ENTITY:h=Q.TEXT,i="textNode";break;case Q.ATTRIB_VALUE_ENTITY_Q:h=Q.ATTRIB_VALUE_QUOTED,i="attribValue";break;case Q.ATTRIB_VALUE_ENTITY_U:h=Q.ATTRIB_VALUE_UNQUOTED,i="attribValue"}";"===d?(b[i]+=A(b),b.entity="",b.state=h):m(b.entity.length?P:O,d)?b.entity+=d:(u(b,"Invalid character in entity name"),b[i]+="&"+b.entity+d,b.entity="",b.state=h);continue;default:throw new Error(b,"Unknown state: "+b.state)}}return b.position>=b.bufferCheckPosition&&e(b),b}c.parser=function(a,b){return new d(a,b)},c.SAXParser=d,c.SAXStream=i,c.createStream=h,c.MAX_BUFFER_LENGTH=65536;var E=["comment","sgmlDecl","textNode","tagName","doctype","procInstName","procInstBody","entity","attribName","attribValue","cdata","script"];c.EVENTS=["text","processinginstruction","sgmldeclaration","doctype","comment","opentagstart","attribute","opentag","closetag","opencdata","cdata","closecdata","error","end","ready","script","opennamespace","closenamespace"],Object.create||(Object.create=function(a){function b(){}return b.prototype=a,new b}),Object.keys||(Object.keys=function(a){var b=[];for(var c in a)a.hasOwnProperty(c)&&b.push(c);return b}),d.prototype={end:function(){t(this)},write:D,resume:function(){return this.error=null,this},close:function(){return this.write(null)},flush:function(){g(this)}};var F;try{F=a("stream").Stream}catch(S){F=function(){}}var G=c.EVENTS.filter(function(a){return"error"!==a&&"end"!==a});i.prototype=Object.create(F.prototype,{constructor:{value:i}}),i.prototype.write=function(c){if("function"==typeof b&&"function"==typeof b.isBuffer&&b.isBuffer(c)){if(!this._decoder){var d=a("string_decoder").StringDecoder;this._decoder=new d("utf8")}c=this._decoder.write(c)}return this._parser.write(c.toString()),this.emit("data",c),!0},i.prototype.end=function(a){return a&&a.length&&this.write(a),this._parser.end(),!0},i.prototype.on=function(a,b){var c=this;return c._parser["on"+a]||-1===G.indexOf(a)||(c._parser["on"+a]=function(){var b=1===arguments.length?[arguments[0]]:Array.apply(null,arguments);b.splice(0,0,a),c.emit.apply(c,b)}),F.prototype.on.call(c,a,b)};var H="[CDATA[",I="DOCTYPE",J="http://www.w3.org/XML/1998/namespace",K="http://www.w3.org/2000/xmlns/",L={xml:J,xmlns:K},M=/[:_A-Za-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD]/,N=/[:_A-Za-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\u00B7\u0300-\u036F\u203F-\u2040.\d-]/,O=/[#:_A-Za-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD]/,P=/[#:_A-Za-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\u00B7\u0300-\u036F\u203F-\u2040.\d-]/,Q=0;c.STATE={BEGIN:Q++,BEGIN_WHITESPACE:Q++,TEXT:Q++,TEXT_ENTITY:Q++,OPEN_WAKA:Q++,SGML_DECL:Q++,SGML_DECL_QUOTED:Q++,DOCTYPE:Q++,DOCTYPE_QUOTED:Q++,DOCTYPE_DTD:Q++,DOCTYPE_DTD_QUOTED:Q++,COMMENT_STARTING:Q++,COMMENT:Q++,COMMENT_ENDING:Q++,COMMENT_ENDED:Q++,CDATA:Q++,CDATA_ENDING:Q++,CDATA_ENDING_2:Q++,PROC_INST:Q++,PROC_INST_BODY:Q++,PROC_INST_ENDING:Q++,OPEN_TAG:Q++,OPEN_TAG_SLASH:Q++,ATTRIB:Q++,ATTRIB_NAME:Q++,ATTRIB_NAME_SAW_WHITE:Q++,ATTRIB_VALUE:Q++,ATTRIB_VALUE_QUOTED:Q++,ATTRIB_VALUE_CLOSED:Q++,ATTRIB_VALUE_UNQUOTED:Q++,ATTRIB_VALUE_ENTITY_Q:Q++,ATTRIB_VALUE_ENTITY_U:Q++,CLOSE_TAG:Q++,CLOSE_TAG_SAW_WHITE:Q++,SCRIPT:Q++,SCRIPT_ENDING:Q++},c.XML_ENTITIES={amp:"&",gt:">",lt:"<",quot:'"',apos:"'"},c.ENTITIES={amp:"&",gt:">",lt:"<",quot:'"',apos:"'",AElig:198,Aacute:193,Acirc:194,Agrave:192,Aring:197,Atilde:195,Auml:196,Ccedil:199,ETH:208,Eacute:201,Ecirc:202,Egrave:200,Euml:203,Iacute:205,Icirc:206,Igrave:204,Iuml:207,Ntilde:209,Oacute:211,Ocirc:212,Ograve:210,Oslash:216,Otilde:213,Ouml:214,THORN:222,Uacute:218,Ucirc:219,Ugrave:217,Uuml:220,Yacute:221,aacute:225,acirc:226,aelig:230,agrave:224,aring:229,atilde:227,auml:228,ccedil:231,eacute:233,ecirc:234,egrave:232,eth:240,euml:235,iacute:237,icirc:238,igrave:236,iuml:239,ntilde:241,oacute:243,ocirc:244,ograve:242,oslash:248,otilde:245,ouml:246,szlig:223,thorn:254,uacute:250,ucirc:251,ugrave:249,uuml:252,yacute:253,yuml:255,copy:169,reg:174,nbsp:160,iexcl:161,cent:162,pound:163,curren:164,yen:165,brvbar:166,sect:167,uml:168,ordf:170,laquo:171,not:172,shy:173,macr:175,deg:176,plusmn:177,sup1:185,sup2:178,sup3:179,acute:180,micro:181,para:182,middot:183,cedil:184,ordm:186,raquo:187,frac14:188,frac12:189,frac34:190,iquest:191,times:215,divide:247,OElig:338,oelig:339,Scaron:352,scaron:353,Yuml:376,fnof:402,circ:710,tilde:732,Alpha:913,Beta:914,Gamma:915,Delta:916,Epsilon:917,Zeta:918,Eta:919,Theta:920,Iota:921,Kappa:922,Lambda:923,Mu:924,Nu:925,Xi:926,Omicron:927,Pi:928,Rho:929,Sigma:931,Tau:932,Upsilon:933,Phi:934,Chi:935,Psi:936,Omega:937,alpha:945,beta:946,gamma:947,delta:948,epsilon:949,zeta:950,eta:951,theta:952,iota:953,kappa:954,lambda:955,mu:956,nu:957,xi:958,omicron:959,pi:960,rho:961,sigmaf:962,sigma:963,tau:964,upsilon:965,phi:966,chi:967,psi:968,omega:969,thetasym:977,upsih:978,piv:982,ensp:8194,emsp:8195,thinsp:8201,zwnj:8204,zwj:8205,lrm:8206,rlm:8207,ndash:8211,mdash:8212,lsquo:8216,rsquo:8217,sbquo:8218,ldquo:8220,rdquo:8221,bdquo:8222,dagger:8224,Dagger:8225,bull:8226,hellip:8230,permil:8240,prime:8242,Prime:8243,lsaquo:8249,rsaquo:8250,oline:8254,frasl:8260,euro:8364,image:8465,weierp:8472,real:8476,trade:8482,alefsym:8501,larr:8592,uarr:8593,rarr:8594,darr:8595,harr:8596,crarr:8629,lArr:8656,uArr:8657,rArr:8658,dArr:8659,hArr:8660,forall:8704,part:8706,exist:8707,empty:8709,nabla:8711,isin:8712,notin:8713,ni:8715,prod:8719,sum:8721,minus:8722,lowast:8727,radic:8730,prop:8733,infin:8734,ang:8736,and:8743,or:8744,cap:8745,cup:8746,int:8747,there4:8756,sim:8764,cong:8773,asymp:8776,ne:8800,equiv:8801,le:8804,ge:8805,sub:8834,sup:8835,nsub:8836,sube:8838,supe:8839,oplus:8853,otimes:8855,perp:8869,sdot:8901,lceil:8968,rceil:8969,lfloor:8970,rfloor:8971,lang:9001,rang:9002,loz:9674,spades:9824,clubs:9827,hearts:9829,diams:9830},Object.keys(c.ENTITIES).forEach(function(a){var b=c.ENTITIES[a],d="number"==typeof b?String.fromCharCode(b):b;c.ENTITIES[a]=d});for(var R in c.STATE)c.STATE[c.STATE[R]]=R;Q=c.STATE,String.fromCodePoint||function(){var a=String.fromCharCode,b=Math.floor,c=function(){var c,d,e=16384,f=[],g=-1,h=arguments.length;if(!h)return"";for(var i="";++g<h;){var j=Number(arguments[g]);if(!isFinite(j)||j<0||j>1114111||b(j)!==j)throw RangeError("Invalid code point: "+j);j<=65535?f.push(j):(j-=65536,c=55296+(j>>10),d=j%1024+56320,f.push(c,d)),(g+1===h||f.length>e)&&(i+=a.apply(null,f),f.length=0)}return i};Object.defineProperty?Object.defineProperty(String,"fromCodePoint",{value:c,configurable:!0,writable:!0}):String.fromCodePoint=c}()}(void 0===c?this.sax={}:c)}).call(this,a("buffer").Buffer)},{buffer:4,stream:33,string_decoder:34}],33:[function(a,b,c){function d(){e.call(this)}b.exports=d;var e=a("events").EventEmitter;a("inherits")(d,e),d.Readable=a("readable-stream/readable.js"),d.Writable=a("readable-stream/writable.js"),d.Duplex=a("readable-stream/duplex.js"),d.Transform=a("readable-stream/transform.js"),d.PassThrough=a("readable-stream/passthrough.js"),d.Stream=d,d.prototype.pipe=function(a,b){function c(b){a.writable&&!1===a.write(b)&&j.pause&&j.pause()}function d(){j.readable&&j.resume&&j.resume()}function f(){k||(k=!0,a.end())}function g(){k||(k=!0,"function"==typeof a.destroy&&a.destroy())}function h(a){if(i(),0===e.listenerCount(this,"error"))throw a}function i(){j.removeListener("data",c),a.removeListener("drain",d),j.removeListener("end",f),j.removeListener("close",g),j.removeListener("error",h),a.removeListener("error",h),j.removeListener("end",i),j.removeListener("close",i),a.removeListener("close",i)}var j=this;j.on("data",c),a.on("drain",d),a._isStdio||b&&!1===b.end||(j.on("end",f),j.on("close",g));var k=!1;return j.on("error",h),a.on("error",h),j.on("end",i),j.on("close",i),a.on("close",i),a.emit("pipe",j),a}},{events:7,inherits:9,"readable-stream/duplex.js":16,"readable-stream/passthrough.js":27,"readable-stream/readable.js":28,"readable-stream/transform.js":29,"readable-stream/writable.js":30}],34:[function(a,b,c){function d(a){if(a&&!i(a))throw new Error("Unknown encoding: "+a)}function e(a){return a.toString(this.encoding)}function f(a){this.charReceived=a.length%2,this.charLength=this.charReceived?2:0}function g(a){this.charReceived=a.length%3,this.charLength=this.charReceived?3:0}var h=a("buffer").Buffer,i=h.isEncoding||function(a){switch(a&&a.toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":case"raw":return!0;default:return!1}},j=c.StringDecoder=function(a){switch(this.encoding=(a||"utf8").toLowerCase().replace(/[-_]/,""),d(a),this.encoding){case"utf8":this.surrogateSize=3;break;case"ucs2":case"utf16le":this.surrogateSize=2,this.detectIncompleteChar=f;break;case"base64":this.surrogateSize=3,this.detectIncompleteChar=g;break;default:return void(this.write=e)}this.charBuffer=new h(6),this.charReceived=0,this.charLength=0};j.prototype.write=function(a){for(var b="";this.charLength;){var c=a.length>=this.charLength-this.charReceived?this.charLength-this.charReceived:a.length;if(a.copy(this.charBuffer,this.charReceived,0,c),this.charReceived+=c,this.charReceived<this.charLength)return"";a=a.slice(c,a.length),b=this.charBuffer.slice(0,this.charLength).toString(this.encoding);var d=b.charCodeAt(b.length-1);if(!(d>=55296&&d<=56319)){if(this.charReceived=this.charLength=0,0===a.length)return b;break}this.charLength+=this.surrogateSize,b=""}this.detectIncompleteChar(a);var e=a.length;this.charLength&&(a.copy(this.charBuffer,0,a.length-this.charReceived,e),e-=this.charReceived),b+=a.toString(this.encoding,0,e);var e=b.length-1,d=b.charCodeAt(e);if(d>=55296&&d<=56319){var f=this.surrogateSize;return this.charLength+=f,this.charReceived+=f,this.charBuffer.copy(this.charBuffer,f,0,f),a.copy(this.charBuffer,0,0,f),b.substring(0,e)}return b},j.prototype.detectIncompleteChar=function(a){for(var b=a.length>=3?3:a.length;b>0;b--){var c=a[a.length-b];if(1==b&&c>>5==6){this.charLength=2;break}if(b<=2&&c>>4==14){this.charLength=3;break}if(b<=3&&c>>3==30){this.charLength=4;break}}this.charReceived=b},j.prototype.end=function(a){var b="";if(a&&a.length&&(b=this.write(a)),this.charReceived){var c=this.charReceived,d=this.charBuffer,e=this.encoding;b+=d.slice(0,c).toString(e)}return b}},{buffer:4}],35:[function(a,b,c){function d(a,b){this._id=a,this._clearFn=b}var e=a("process/browser.js").nextTick,f=Function.prototype.apply,g=Array.prototype.slice,h={},i=0;c.setTimeout=function(){return new d(f.call(setTimeout,window,arguments),clearTimeout)},c.setInterval=function(){return new d(f.call(setInterval,window,arguments),clearInterval)},c.clearTimeout=c.clearInterval=function(a){a.close()},d.prototype.unref=d.prototype.ref=function(){},d.prototype.close=function(){this._clearFn.call(window,this._id)},c.enroll=function(a,b){clearTimeout(a._idleTimeoutId),a._idleTimeout=b},c.unenroll=function(a){clearTimeout(a._idleTimeoutId),a._idleTimeout=-1},c._unrefActive=c.active=function(a){clearTimeout(a._idleTimeoutId);var b=a._idleTimeout;b>=0&&(a._idleTimeoutId=setTimeout(function(){a._onTimeout&&a._onTimeout()},b))},c.setImmediate="function"==typeof setImmediate?setImmediate:function(a){var b=i++,d=!(arguments.length<2)&&g.call(arguments,1);return h[b]=!0,e(function(){h[b]&&(d?a.apply(null,d):a.call(null),c.clearImmediate(b))}),b},c.clearImmediate="function"==typeof clearImmediate?clearImmediate:function(a){delete h[a]}},{"process/browser.js":15}],36:[function(a,b,c){(function(a){function c(a,b){function c(){if(!e){if(d("throwDeprecation"))throw new Error(b);d("traceDeprecation")?console.trace(b):console.warn(b),e=!0}return a.apply(this,arguments)}if(d("noDeprecation"))return a;var e=!1;return c}function d(b){try{if(!a.localStorage)return!1}catch(d){return!1}var c=a.localStorage[b];return null!=c&&"true"===String(c).toLowerCase()}b.exports=c}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],37:[function(a,c,d){!function(){function a(a,b,c){return a.call.apply(a.bind,arguments)}function d(a,b,c){if(!a)throw Error();if(2<arguments.length){var d=Array.prototype.slice.call(arguments,2);return function(){var c=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(c,d),a.apply(b,c)}}return function(){return a.apply(b,arguments)}}function e(b,c,f){return e=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?a:d,e.apply(null,arguments)}function f(a,b){this.a=a,this.o=b||a,this.c=this.o.document}function g(a,b,c,d){if(b=a.c.createElement(b),c)for(var e in c)c.hasOwnProperty(e)&&("style"==e?b.style.cssText=c[e]:b.setAttribute(e,c[e]));return d&&b.appendChild(a.c.createTextNode(d)),b}function h(a,b,c){a=a.c.getElementsByTagName(b)[0],a||(a=document.documentElement),a.insertBefore(c,a.lastChild)}function i(a){a.parentNode&&a.parentNode.removeChild(a)}function j(a,b,c){b=b||[],c=c||[];for(var d=a.className.split(/\s+/),e=0;e<b.length;e+=1){
for(var f=!1,g=0;g<d.length;g+=1)if(b[e]===d[g]){f=!0;break}f||d.push(b[e])}for(b=[],e=0;e<d.length;e+=1){for(f=!1,g=0;g<c.length;g+=1)if(d[e]===c[g]){f=!0;break}f||b.push(d[e])}a.className=b.join(" ").replace(/\s+/g," ").replace(/^\s+|\s+$/,"")}function k(a,b){for(var c=a.className.split(/\s+/),d=0,e=c.length;d<e;d++)if(c[d]==b)return!0;return!1}function l(a){return a.o.location.hostname||a.a.location.hostname}function m(a,b,c){function d(){j&&e&&f&&(j(i),j=null)}b=g(a,"link",{rel:"stylesheet",href:b,media:"all"});var e=!1,f=!0,i=null,j=c||null;da?(b.onload=function(){e=!0,d()},b.onerror=function(){e=!0,i=Error("Stylesheet failed to load"),d()}):setTimeout(function(){e=!0,d()},0),h(a,"head",b)}function n(a,b,c,d){var e=a.c.getElementsByTagName("head")[0];if(e){var f=g(a,"script",{src:b}),h=!1;return f.onload=f.onreadystatechange=function(){h||this.readyState&&"loaded"!=this.readyState&&"complete"!=this.readyState||(h=!0,c&&c(null),f.onload=f.onreadystatechange=null,"HEAD"==f.parentNode.tagName&&e.removeChild(f))},e.appendChild(f),setTimeout(function(){h||(h=!0,c&&c(Error("Script load timeout")))},d||5e3),f}return null}function o(){this.a=0,this.c=null}function p(a){return a.a++,function(){a.a--,r(a)}}function q(a,b){a.c=b,r(a)}function r(a){0==a.a&&a.c&&(a.c(),a.c=null)}function s(a){this.a=a||"-"}function t(a,b){this.c=a,this.f=4,this.a="n";var c=(b||"n4").match(/^([nio])([1-9])$/i);c&&(this.a=c[1],this.f=parseInt(c[2],10))}function u(a){return x(a)+" "+a.f+"00 300px "+v(a.c)}function v(a){var b=[];a=a.split(/,\s*/);for(var c=0;c<a.length;c++){var d=a[c].replace(/['"]/g,"");-1!=d.indexOf(" ")||/^\d/.test(d)?b.push("'"+d+"'"):b.push(d)}return b.join(",")}function w(a){return a.a+a.f}function x(a){var b="normal";return"o"===a.a?b="oblique":"i"===a.a&&(b="italic"),b}function y(a){var b=4,c="n",d=null;return a&&((d=a.match(/(normal|oblique|italic)/i))&&d[1]&&(c=d[1].substr(0,1).toLowerCase()),(d=a.match(/([1-9]00|normal|bold)/i))&&d[1]&&(/bold/i.test(d[1])?b=7:/[1-9]00/.test(d[1])&&(b=parseInt(d[1].substr(0,1),10)))),c+b}function z(a,b){this.c=a,this.f=a.o.document.documentElement,this.h=b,this.a=new s("-"),this.j=!1!==b.events,this.g=!1!==b.classes}function A(a){a.g&&j(a.f,[a.a.c("wf","loading")]),C(a,"loading")}function B(a){if(a.g){var b=k(a.f,a.a.c("wf","active")),c=[],d=[a.a.c("wf","loading")];b||c.push(a.a.c("wf","inactive")),j(a.f,c,d)}C(a,"inactive")}function C(a,b,c){a.j&&a.h[b]&&(c?a.h[b](c.c,w(c)):a.h[b]())}function D(){this.c={}}function E(a,b,c){var d,e=[];for(d in b)if(b.hasOwnProperty(d)){var f=a.c[d];f&&e.push(f(b[d],c))}return e}function F(a,b){this.c=a,this.f=b,this.a=g(this.c,"span",{"aria-hidden":"true"},this.f)}function G(a){h(a.c,"body",a.a)}function H(a){return"display:block;position:absolute;top:-9999px;left:-9999px;font-size:300px;width:auto;height:auto;line-height:normal;margin:0;padding:0;font-variant:normal;white-space:nowrap;font-family:"+v(a.c)+";font-style:"+x(a)+";font-weight:"+a.f+"00;"}function I(a,b,c,d,e,f){this.g=a,this.j=b,this.a=d,this.c=c,this.f=e||3e3,this.h=f||void 0}function J(a,b,c,d,e,f,g){this.v=a,this.B=b,this.c=c,this.a=d,this.s=g||"BESbswy",this.f={},this.w=e||3e3,this.u=f||null,this.m=this.j=this.h=this.g=null,this.g=new F(this.c,this.s),this.h=new F(this.c,this.s),this.j=new F(this.c,this.s),this.m=new F(this.c,this.s),a=new t(this.a.c+",serif",w(this.a)),a=H(a),this.g.a.style.cssText=a,a=new t(this.a.c+",sans-serif",w(this.a)),a=H(a),this.h.a.style.cssText=a,a=new t("serif",w(this.a)),a=H(a),this.j.a.style.cssText=a,a=new t("sans-serif",w(this.a)),a=H(a),this.m.a.style.cssText=a,G(this.g),G(this.h),G(this.j),G(this.m)}function K(){if(null===fa){var a=/AppleWebKit\/([0-9]+)(?:\.([0-9]+))/.exec(window.navigator.userAgent);fa=!!a&&(536>parseInt(a[1],10)||536===parseInt(a[1],10)&&11>=parseInt(a[2],10))}return fa}function L(a,b,c){for(var d in ea)if(ea.hasOwnProperty(d)&&b===a.f[ea[d]]&&c===a.f[ea[d]])return!0;return!1}function M(a){var b,c=a.g.a.offsetWidth,d=a.h.a.offsetWidth;(b=c===a.f.serif&&d===a.f["sans-serif"])||(b=K()&&L(a,c,d)),b?ca()-a.A>=a.w?K()&&L(a,c,d)&&(null===a.u||a.u.hasOwnProperty(a.a.c))?O(a,a.v):O(a,a.B):N(a):O(a,a.v)}function N(a){setTimeout(e(function(){M(this)},a),50)}function O(a,b){setTimeout(e(function(){i(this.g.a),i(this.h.a),i(this.j.a),i(this.m.a),b(this.a)},a),0)}function P(a,b,c){this.c=a,this.a=b,this.f=0,this.m=this.j=!1,this.s=c}function Q(a){0==--a.f&&a.j&&(a.m?(a=a.a,a.g&&j(a.f,[a.a.c("wf","active")],[a.a.c("wf","loading"),a.a.c("wf","inactive")]),C(a,"active")):B(a.a))}function R(a){this.j=a,this.a=new D,this.h=0,this.f=this.g=!0}function S(a,b,c,d,f){var g=0==--a.h;(a.f||a.g)&&setTimeout(function(){var a=f||null,h=d||null||{};if(0===c.length&&g)B(b.a);else{b.f+=c.length,g&&(b.j=g);var i,k=[];for(i=0;i<c.length;i++){var l=c[i],m=h[l.c],n=b.a,o=l;if(n.g&&j(n.f,[n.a.c("wf",o.c,w(o).toString(),"loading")]),C(n,"fontloading",o),n=null,null===ga)if(window.FontFace){var o=/Gecko.*Firefox\/(\d+)/.exec(window.navigator.userAgent),p=/OS X.*Version\/10\..*Safari/.exec(window.navigator.userAgent)&&/Apple/.exec(window.navigator.vendor);ga=o?42<parseInt(o[1],10):!p}else ga=!1;n=ga?new I(e(b.g,b),e(b.h,b),b.c,l,b.s,m):new J(e(b.g,b),e(b.h,b),b.c,l,b.s,a,m),k.push(n)}for(i=0;i<k.length;i++)k[i].start()}},0)}function T(a,b,c){var d=[],e=c.timeout;A(b);var d=E(a.a,c,a.c),f=new P(a.c,b,e);for(a.h=d.length,b=0,c=d.length;b<c;b++)d[b].load(function(b,c,d){S(a,f,b,c,d)})}function U(a,b){this.c=a,this.a=b}function V(a,b){this.c=a,this.a=b}function W(a,b){this.c=a||ha,this.a=[],this.f=[],this.g=b||""}function X(a,b){for(var c=b.length,d=0;d<c;d++){var e=b[d].split(":");3==e.length&&a.f.push(e.pop());var f="";2==e.length&&""!=e[1]&&(f=":"),a.a.push(e.join(f))}}function Y(a){if(0==a.a.length)throw Error("No fonts to load!");if(-1!=a.c.indexOf("kit="))return a.c;for(var b=a.a.length,c=[],d=0;d<b;d++)c.push(a.a[d].replace(/ /g,"+"));return b=a.c+"?family="+c.join("%7C"),0<a.f.length&&(b+="&subset="+a.f.join(",")),0<a.g.length&&(b+="&text="+encodeURIComponent(a.g)),b}function Z(a){this.f=a,this.a=[],this.c={}}function $(a){for(var b=a.f.length,c=0;c<b;c++){var d=a.f[c].split(":"),e=d[0].replace(/\+/g," "),f=["n4"];if(2<=d.length){var g,h=d[1];if(g=[],h)for(var h=h.split(","),i=h.length,j=0;j<i;j++){var k;if(k=h[j],k.match(/^[\w-]+$/)){var l=la.exec(k.toLowerCase());if(null==l)k="";else{if(k=l[2],k=null==k||""==k?"n":ka[k],null==(l=l[1])||""==l)l="4";else var m=ja[l],l=m||(isNaN(l)?"4":l.substr(0,1));k=[k,l].join("")}}else k="";k&&g.push(k)}0<g.length&&(f=g),3==d.length&&(d=d[2],g=[],d=d?d.split(","):g,0<d.length&&(d=ia[d[0]])&&(a.c[e]=d))}for(a.c[e]||(d=ia[e])&&(a.c[e]=d),d=0;d<f.length;d+=1)a.a.push(new t(e,f[d]))}}function _(a,b){this.c=a,this.a=b}function aa(a,b){this.c=a,this.a=b}function ba(a,b){this.c=a,this.f=b,this.a=[]}var ca=Date.now||function(){return+new Date},da=!!window.FontFace;s.prototype.c=function(a){for(var b=[],c=0;c<arguments.length;c++)b.push(arguments[c].replace(/[\W_]+/g,"").toLowerCase());return b.join(this.a)},I.prototype.start=function(){var a=this.c.o.document,b=this,c=ca(),d=new Promise(function(d,e){function f(){ca()-c>=b.f?e():a.fonts.load(u(b.a),b.h).then(function(a){1<=a.length?d():setTimeout(f,25)},function(){e()})}f()}),e=null,f=new Promise(function(a,c){e=setTimeout(c,b.f)});Promise.race([f,d]).then(function(){e&&(clearTimeout(e),e=null),b.g(b.a)},function(){b.j(b.a)})};var ea={D:"serif",C:"sans-serif"},fa=null;J.prototype.start=function(){this.f.serif=this.j.a.offsetWidth,this.f["sans-serif"]=this.m.a.offsetWidth,this.A=ca(),M(this)};var ga=null;P.prototype.g=function(a){var b=this.a;b.g&&j(b.f,[b.a.c("wf",a.c,w(a).toString(),"active")],[b.a.c("wf",a.c,w(a).toString(),"loading"),b.a.c("wf",a.c,w(a).toString(),"inactive")]),C(b,"fontactive",a),this.m=!0,Q(this)},P.prototype.h=function(a){var b=this.a;if(b.g){var c=k(b.f,b.a.c("wf",a.c,w(a).toString(),"active")),d=[],e=[b.a.c("wf",a.c,w(a).toString(),"loading")];c||d.push(b.a.c("wf",a.c,w(a).toString(),"inactive")),j(b.f,d,e)}C(b,"fontinactive",a),Q(this)},R.prototype.load=function(a){this.c=new f(this.j,a.context||this.j),this.g=!1!==a.events,this.f=!1!==a.classes,T(this,new z(this.c,a),a)},U.prototype.load=function(a){function b(){if(f["__mti_fntLst"+d]){var c,e=f["__mti_fntLst"+d](),g=[];if(e)for(var h=0;h<e.length;h++){var i=e[h].fontfamily;void 0!=e[h].fontStyle&&void 0!=e[h].fontWeight?(c=e[h].fontStyle+e[h].fontWeight,g.push(new t(i,c))):g.push(new t(i))}a(g)}else setTimeout(function(){b()},50)}var c=this,d=c.a.projectId,e=c.a.version;if(d){var f=c.c.o;n(this.c,(c.a.api||"https://fast.fonts.net/jsapi")+"/"+d+".js"+(e?"?v="+e:""),function(e){e?a([]):(f["__MonotypeConfiguration__"+d]=function(){return c.a},b())}).id="__MonotypeAPIScript__"+d}else a([])},V.prototype.load=function(a){var b,c,d=this.a.urls||[],e=this.a.families||[],f=this.a.testStrings||{},g=new o;for(b=0,c=d.length;b<c;b++)m(this.c,d[b],p(g));var h=[];for(b=0,c=e.length;b<c;b++)if(d=e[b].split(":"),d[1])for(var i=d[1].split(","),j=0;j<i.length;j+=1)h.push(new t(d[0],i[j]));else h.push(new t(d[0]));q(g,function(){a(h,f)})};var ha="https://fonts.googleapis.com/css",ia={latin:"BESbswy","latin-ext":"çöüğş",cyrillic:"йяЖ",greek:"αβΣ",khmer:"កខគ",Hanuman:"កខគ"},ja={thin:"1",extralight:"2","extra-light":"2",ultralight:"2","ultra-light":"2",light:"3",regular:"4",book:"4",medium:"5","semi-bold":"6",semibold:"6","demi-bold":"6",demibold:"6",bold:"7","extra-bold":"8",extrabold:"8","ultra-bold":"8",ultrabold:"8",black:"9",heavy:"9",l:"3",r:"4",b:"7"},ka={i:"i",italic:"i",n:"n",normal:"n"},la=/^(thin|(?:(?:extra|ultra)-?)?light|regular|book|medium|(?:(?:semi|demi|extra|ultra)-?)?bold|black|heavy|l|r|b|[1-9]00)?(n|i|normal|italic)?$/,ma={Arimo:!0,Cousine:!0,Tinos:!0};_.prototype.load=function(a){var b=new o,c=this.c,d=new W(this.a.api,this.a.text),e=this.a.families;X(d,e);var f=new Z(e);$(f),m(c,Y(d),p(b)),q(b,function(){a(f.a,f.c,ma)})},aa.prototype.load=function(a){var b=this.a.id,c=this.c.o;b?n(this.c,(this.a.api||"https://use.typekit.net")+"/"+b+".js",function(b){if(b)a([]);else if(c.Typekit&&c.Typekit.config&&c.Typekit.config.fn){b=c.Typekit.config.fn;for(var d=[],e=0;e<b.length;e+=2)for(var f=b[e],g=b[e+1],h=0;h<g.length;h++)d.push(new t(f,g[h]));try{c.Typekit.load({events:!1,classes:!1,async:!0})}catch(i){}a(d)}},2e3):a([])},ba.prototype.load=function(a){var b=this.f.id,c=this.c.o,d=this;b?(c.__webfontfontdeckmodule__||(c.__webfontfontdeckmodule__={}),c.__webfontfontdeckmodule__[b]=function(b,c){for(var e=0,f=c.fonts.length;e<f;++e){var g=c.fonts[e];d.a.push(new t(g.name,y("font-weight:"+g.weight+";font-style:"+g.style)))}a(d.a)},n(this.c,(this.f.api||"https://f.fontdeck.com/s/css/js/")+l(this.c)+"/"+b+".js",function(b){b&&a([])})):a([])};var na=new R(window);na.a.c.custom=function(a,b){return new V(b,a)},na.a.c.fontdeck=function(a,b){return new ba(b,a)},na.a.c.monotype=function(a,b){return new U(b,a)},na.a.c.typekit=function(a,b){return new aa(b,a)},na.a.c.google=function(a,b){return new _(b,a)};var oa={load:e(na.load,na)};"function"==typeof b&&b.amd?b(function(){return oa}):void 0!==c&&c.exports?c.exports=oa:(window.WebFont=oa,window.WebFontConfig&&na.load(window.WebFontConfig))}()},{}],38:[function(a,b,c){(function(){"use strict";c.stripBOM=function(a){return"\ufeff"===a[0]?a.substring(1):a}}).call(this)},{}],39:[function(a,b,c){(function(){"use strict";var b,d,e,f,g,h={}.hasOwnProperty;b=a("xmlbuilder"),d=a("./defaults").defaults,f=function(a){return"string"==typeof a&&(a.indexOf("&")>=0||a.indexOf(">")>=0||a.indexOf("<")>=0)},g=function(a){return"<![CDATA["+e(a)+"]]>"},e=function(a){return a.replace("]]>","]]]]><![CDATA[>")},c.Builder=function(){function a(a){var b,c,e;this.options={},c=d[.2];for(b in c)h.call(c,b)&&(e=c[b],this.options[b]=e);for(b in a)h.call(a,b)&&(e=a[b],this.options[b]=e)}return a.prototype.buildObject=function(a){var c,e,i,j,k;return c=this.options.attrkey,e=this.options.charkey,1===Object.keys(a).length&&this.options.rootName===d[.2].rootName?(k=Object.keys(a)[0],a=a[k]):k=this.options.rootName,i=function(a){return function(b,d){var j,k,l,m,n,o;if("object"!=typeof d)a.options.cdata&&f(d)?b.raw(g(d)):b.txt(d);else if(Array.isArray(d)){for(m in d)if(h.call(d,m)){k=d[m];for(n in k)l=k[n],b=i(b.ele(n),l).up()}}else for(n in d)if(h.call(d,n))if(k=d[n],n===c){if("object"==typeof k)for(j in k)o=k[j],b=b.att(j,o)}else if(n===e)b=a.options.cdata&&f(k)?b.raw(g(k)):b.txt(k);else if(Array.isArray(k))for(m in k)h.call(k,m)&&(l=k[m],b="string"==typeof l?a.options.cdata&&f(l)?b.ele(n).raw(g(l)).up():b.ele(n,l).up():i(b.ele(n),l).up());else"object"==typeof k?b=i(b.ele(n),k).up():"string"==typeof k&&a.options.cdata&&f(k)?b=b.ele(n).raw(g(k)).up():(null==k&&(k=""),b=b.ele(n,k.toString()).up());return b}}(this),j=b.create(k,this.options.xmldec,this.options.doctype,{headless:this.options.headless,allowSurrogateChars:this.options.allowSurrogateChars}),i(j,a).end(this.options.renderOpts)},a}()}).call(this)},{"./defaults":40,xmlbuilder:65}],40:[function(a,b,c){(function(){c.defaults={.1:{explicitCharkey:!1,trim:!0,normalize:!0,normalizeTags:!1,attrkey:"@",charkey:"#",explicitArray:!1,ignoreAttrs:!1,mergeAttrs:!1,explicitRoot:!1,validator:null,xmlns:!1,explicitChildren:!1,childkey:"@@",charsAsChildren:!1,includeWhiteChars:!1,async:!1,strict:!0,attrNameProcessors:null,attrValueProcessors:null,tagNameProcessors:null,valueProcessors:null,emptyTag:""},.2:{explicitCharkey:!1,trim:!1,normalize:!1,normalizeTags:!1,attrkey:"$",charkey:"_",explicitArray:!0,ignoreAttrs:!1,mergeAttrs:!1,explicitRoot:!0,validator:null,xmlns:!1,explicitChildren:!1,preserveChildrenOrder:!1,childkey:"$$",charsAsChildren:!1,includeWhiteChars:!1,async:!1,strict:!0,attrNameProcessors:null,attrValueProcessors:null,tagNameProcessors:null,valueProcessors:null,rootName:"root",xmldec:{version:"1.0",encoding:"UTF-8",standalone:!0},doctype:null,renderOpts:{pretty:!0,indent:"  ",newline:"\n"},headless:!1,chunkSize:1e4,emptyTag:"",cdata:!1}}}).call(this)},{}],41:[function(a,b,c){(function(){"use strict";var b,d,e,f,g,h,i,j,k=function(a,b){return function(){return a.apply(b,arguments)}},l=function(a,b){function c(){this.constructor=a}for(var d in b)m.call(b,d)&&(a[d]=b[d]);return c.prototype=b.prototype,a.prototype=new c,a.__super__=b.prototype,a},m={}.hasOwnProperty;i=a("sax"),e=a("events"),b=a("./bom"),h=a("./processors"),j=a("timers").setImmediate,d=a("./defaults").defaults,f=function(a){return"object"==typeof a&&null!=a&&0===Object.keys(a).length},g=function(a,b,c){var d,e,f;for(d=0,e=a.length;d<e;d++)f=a[d],b=f(b,c);return b},c.Parser=function(a){function e(a){this.parseString=k(this.parseString,this),this.reset=k(this.reset,this),this.assignOrPush=k(this.assignOrPush,this),this.processAsync=k(this.processAsync,this);var b,e,f;if(!(this instanceof c.Parser))return new c.Parser(a);this.options={},e=d[.2];for(b in e)m.call(e,b)&&(f=e[b],this.options[b]=f);for(b in a)m.call(a,b)&&(f=a[b],this.options[b]=f);this.options.xmlns&&(this.options.xmlnskey=this.options.attrkey+"ns"),this.options.normalizeTags&&(this.options.tagNameProcessors||(this.options.tagNameProcessors=[]),this.options.tagNameProcessors.unshift(h.normalize)),this.reset()}return l(e,a),e.prototype.processAsync=function(){var a,b;try{return this.remaining.length<=this.options.chunkSize?(a=this.remaining,this.remaining="",this.saxParser=this.saxParser.write(a),this.saxParser.close()):(a=this.remaining.substr(0,this.options.chunkSize),this.remaining=this.remaining.substr(this.options.chunkSize,this.remaining.length),this.saxParser=this.saxParser.write(a),j(this.processAsync))}catch(c){if(b=c,!this.saxParser.errThrown)return this.saxParser.errThrown=!0,this.emit(b)}},e.prototype.assignOrPush=function(a,b,c){return b in a?(a[b]instanceof Array||(a[b]=[a[b]]),a[b].push(c)):this.options.explicitArray?a[b]=[c]:a[b]=c},e.prototype.reset=function(){var a,b,c,d;return this.removeAllListeners(),this.saxParser=i.parser(this.options.strict,{trim:!1,normalize:!1,xmlns:this.options.xmlns}),this.saxParser.errThrown=!1,this.saxParser.onerror=function(a){return function(b){if(a.saxParser.resume(),!a.saxParser.errThrown)return a.saxParser.errThrown=!0,a.emit("error",b)}}(this),this.saxParser.onend=function(a){return function(){if(!a.saxParser.ended)return a.saxParser.ended=!0,a.emit("end",a.resultObject)}}(this),this.saxParser.ended=!1,this.EXPLICIT_CHARKEY=this.options.explicitCharkey,this.resultObject=null,d=[],a=this.options.attrkey,b=this.options.charkey,this.saxParser.onopentag=function(c){return function(e){var f,h,i,j,k;if(i={},i[b]="",!c.options.ignoreAttrs){k=e.attributes;for(f in k)m.call(k,f)&&(a in i||c.options.mergeAttrs||(i[a]={}),h=c.options.attrValueProcessors?g(c.options.attrValueProcessors,e.attributes[f],f):e.attributes[f],j=c.options.attrNameProcessors?g(c.options.attrNameProcessors,f):f,c.options.mergeAttrs?c.assignOrPush(i,j,h):i[a][j]=h)}return i["#name"]=c.options.tagNameProcessors?g(c.options.tagNameProcessors,e.name):e.name,c.options.xmlns&&(i[c.options.xmlnskey]={uri:e.uri,local:e.local}),d.push(i)}}(this),this.saxParser.onclosetag=function(a){return function(){var c,e,h,i,j,k,l,n,o,p;if(k=d.pop(),j=k["#name"],a.options.explicitChildren&&a.options.preserveChildrenOrder||delete k["#name"],!0===k.cdata&&(c=k.cdata,delete k.cdata),o=d[d.length-1],k[b].match(/^\s*$/)&&!c?(e=k[b],delete k[b]):(a.options.trim&&(k[b]=k[b].trim()),a.options.normalize&&(k[b]=k[b].replace(/\s{2,}/g," ").trim()),k[b]=a.options.valueProcessors?g(a.options.valueProcessors,k[b],j):k[b],1===Object.keys(k).length&&b in k&&!a.EXPLICIT_CHARKEY&&(k=k[b])),f(k)&&(k=""!==a.options.emptyTag?a.options.emptyTag:e),null!=a.options.validator&&(p="/"+function(){var a,b,c;for(c=[],a=0,b=d.length;a<b;a++)i=d[a],c.push(i["#name"]);return c}().concat(j).join("/"),function(){var b;try{k=a.options.validator(p,o&&o[j],k)}catch(c){return b=c,a.emit("error",b)}}()),a.options.explicitChildren&&!a.options.mergeAttrs&&"object"==typeof k)if(a.options.preserveChildrenOrder){if(o){o[a.options.childkey]=o[a.options.childkey]||[],l={};for(h in k)m.call(k,h)&&(l[h]=k[h]);o[a.options.childkey].push(l),delete k["#name"],1===Object.keys(k).length&&b in k&&!a.EXPLICIT_CHARKEY&&(k=k[b])}}else i={},a.options.attrkey in k&&(i[a.options.attrkey]=k[a.options.attrkey],delete k[a.options.attrkey]),!a.options.charsAsChildren&&a.options.charkey in k&&(i[a.options.charkey]=k[a.options.charkey],delete k[a.options.charkey]),Object.getOwnPropertyNames(k).length>0&&(i[a.options.childkey]=k),k=i;return d.length>0?a.assignOrPush(o,j,k):(a.options.explicitRoot&&(n=k,k={},k[j]=n),a.resultObject=k,a.saxParser.ended=!0,a.emit("end",a.resultObject))}}(this),c=function(a){return function(c){var e,f;if(f=d[d.length-1])return f[b]+=c,a.options.explicitChildren&&a.options.preserveChildrenOrder&&a.options.charsAsChildren&&(a.options.includeWhiteChars||""!==c.replace(/\\n/g,"").trim())&&(f[a.options.childkey]=f[a.options.childkey]||[],e={"#name":"__text__"},e[b]=c,a.options.normalize&&(e[b]=e[b].replace(/\s{2,}/g," ").trim()),f[a.options.childkey].push(e)),f}}(this),this.saxParser.ontext=c,this.saxParser.oncdata=function(a){return function(a){var b;if(b=c(a))return b.cdata=!0}}()},e.prototype.parseString=function(a,c){var d;null!=c&&"function"==typeof c&&(this.on("end",function(a){return this.reset(),c(null,a)}),this.on("error",function(a){return this.reset(),c(a)}));try{return a=a.toString(),""===a.trim()?(this.emit("end",null),!0):(a=b.stripBOM(a),this.options.async?(this.remaining=a,j(this.processAsync),this.saxParser):this.saxParser.write(a).close())}catch(e){if(d=e,!this.saxParser.errThrown&&!this.saxParser.ended)return this.emit("error",d),this.saxParser.errThrown=!0;if(this.saxParser.ended)throw d}},e}(e.EventEmitter),c.parseString=function(a,b,d){var e,f,g;return null!=d?("function"==typeof d&&(e=d),"object"==typeof b&&(f=b)):("function"==typeof b&&(e=b),f={}),g=new c.Parser(f),g.parseString(a,e)}}).call(this)},{"./bom":38,"./defaults":40,"./processors":42,events:7,sax:32,timers:35}],42:[function(a,b,c){(function(){"use strict";var a;a=new RegExp(/(?!xmlns)^.*:/),c.normalize=function(a){return a.toLowerCase()},c.firstCharLowerCase=function(a){return a.charAt(0).toLowerCase()+a.slice(1)},c.stripPrefix=function(b){return b.replace(a,"")},c.parseNumbers=function(a){return isNaN(a)||(a=a%1==0?parseInt(a,10):parseFloat(a)),a},c.parseBooleans=function(a){return/^(?:true|false)$/i.test(a)&&(a="true"===a.toLowerCase()),a}}).call(this)},{}],43:[function(a,b,c){(function(){"use strict";var b,d,e,f,g=function(a,b){function c(){this.constructor=a}for(var d in b)h.call(b,d)&&(a[d]=b[d]);return c.prototype=b.prototype,a.prototype=new c,a.__super__=b.prototype,a},h={}.hasOwnProperty;d=a("./defaults"),b=a("./builder"),e=a("./parser"),f=a("./processors"),c.defaults=d.defaults,c.processors=f,c.ValidationError=function(a){function b(a){this.message=a}return g(b,a),b}(Error),c.Builder=b.Builder,c.Parser=e.Parser,c.parseString=e.parseString}).call(this)},{"./builder":39,"./defaults":40,"./parser":41,"./processors":42}],44:[function(a,b,c){(function(){var a,c,d,e,f,g,h=[].slice,i={}.hasOwnProperty;a=function(){var a,b,c,d,f,g;if(g=arguments[0],f=2<=arguments.length?h.call(arguments,1):[],e(Object.assign))Object.assign.apply(null,arguments);else for(a=0,c=f.length;a<c;a++)if(null!=(d=f[a]))for(b in d)i.call(d,b)&&(g[b]=d[b]);return g},e=function(a){return!!a&&"[object Function]"===Object.prototype.toString.call(a)},f=function(a){var b;return!!a&&("function"==(b=typeof a)||"object"===b)},c=function(a){return e(Array.isArray)?Array.isArray(a):"[object Array]"===Object.prototype.toString.call(a)},d=function(a){var b;if(c(a))return!a.length;for(b in a)if(i.call(a,b))return!1;return!0},g=function(a){var b,c;return f(a)&&(c=Object.getPrototypeOf(a))&&(b=c.constructor)&&"function"==typeof b&&b instanceof b&&Function.prototype.toString.call(b)===Function.prototype.toString.call(Object)},b.exports.assign=a,b.exports.isFunction=e,b.exports.isObject=f,b.exports.isArray=c,b.exports.isEmpty=d,b.exports.isPlainObject=g}).call(this)},{}],45:[function(a,b,c){(function(){b.exports=function(){function a(a,b,c){if(this.options=a.options,this.stringify=a.stringify,null==b)throw new Error("Missing attribute name of element "+a.name);if(null==c)throw new Error("Missing attribute value for attribute "+b+" of element "+a.name);this.name=this.stringify.attName(b),this.value=this.stringify.attValue(c)}return a.prototype.clone=function(){return Object.create(this)},a.prototype.toString=function(a){return this.options.writer.set(a).attribute(this)},a}()}).call(this)},{}],46:[function(a,b,c){(function(){var c,d=function(a,b){function c(){this.constructor=a}for(var d in b)e.call(b,d)&&(a[d]=b[d]);return c.prototype=b.prototype,a.prototype=new c,a.__super__=b.prototype,a},e={}.hasOwnProperty;c=a("./XMLNode"),b.exports=function(a){function b(a,c){if(b.__super__.constructor.call(this,a),null==c)throw new Error("Missing CDATA text");this.text=this.stringify.cdata(c)}return d(b,a),b.prototype.clone=function(){return Object.create(this)},b.prototype.toString=function(a){return this.options.writer.set(a).cdata(this)},b}(c)}).call(this)},{"./XMLNode":57}],47:[function(a,b,c){(function(){var c,d=function(a,b){function c(){this.constructor=a}for(var d in b)e.call(b,d)&&(a[d]=b[d]);return c.prototype=b.prototype,a.prototype=new c,a.__super__=b.prototype,a},e={}.hasOwnProperty;c=a("./XMLNode"),b.exports=function(a){function b(a,c){if(b.__super__.constructor.call(this,a),null==c)throw new Error("Missing comment text");this.text=this.stringify.comment(c)}return d(b,a),b.prototype.clone=function(){return Object.create(this)},b.prototype.toString=function(a){return this.options.writer.set(a).comment(this)},b}(c)}).call(this)},{"./XMLNode":57}],48:[function(a,b,c){(function(){var c,d=function(a,b){function c(){this.constructor=a}for(var d in b)e.call(b,d)&&(a[d]=b[d]);return c.prototype=b.prototype,a.prototype=new c,a.__super__=b.prototype,a},e={}.hasOwnProperty;c=a("./XMLNode"),b.exports=function(a){function b(a,c,d,e,f,g){if(b.__super__.constructor.call(this,a),null==c)throw new Error("Missing DTD element name");if(null==d)throw new Error("Missing DTD attribute name");if(!e)throw new Error("Missing DTD attribute type");if(!f)throw new Error("Missing DTD attribute default");if(0!==f.indexOf("#")&&(f="#"+f),!f.match(/^(#REQUIRED|#IMPLIED|#FIXED|#DEFAULT)$/))throw new Error("Invalid default value type; expected: #REQUIRED, #IMPLIED, #FIXED or #DEFAULT");if(g&&!f.match(/^(#FIXED|#DEFAULT)$/))throw new Error("Default value only applies to #FIXED or #DEFAULT");this.elementName=this.stringify.eleName(c),this.attributeName=this.stringify.attName(d),this.attributeType=this.stringify.dtdAttType(e),this.defaultValue=this.stringify.dtdAttDefault(g),this.defaultValueType=f}return d(b,a),b.prototype.toString=function(a){return this.options.writer.set(a).dtdAttList(this)},b}(c)}).call(this)},{"./XMLNode":57}],49:[function(a,b,c){(function(){var c,d=function(a,b){function c(){this.constructor=a}for(var d in b)e.call(b,d)&&(a[d]=b[d]);return c.prototype=b.prototype,a.prototype=new c,a.__super__=b.prototype,a},e={}.hasOwnProperty;c=a("./XMLNode"),b.exports=function(a){function b(a,c,d){if(b.__super__.constructor.call(this,a),null==c)throw new Error("Missing DTD element name");d||(d="(#PCDATA)"),Array.isArray(d)&&(d="("+d.join(",")+")"),this.name=this.stringify.eleName(c),this.value=this.stringify.dtdElementValue(d)}return d(b,a),b.prototype.toString=function(a){return this.options.writer.set(a).dtdElement(this)},b}(c)}).call(this)},{"./XMLNode":57}],50:[function(a,b,c){(function(){var c,d,e=function(a,b){function c(){this.constructor=a}for(var d in b)f.call(b,d)&&(a[d]=b[d]);return c.prototype=b.prototype,a.prototype=new c,a.__super__=b.prototype,a},f={}.hasOwnProperty;d=a("./Utility").isObject,c=a("./XMLNode"),b.exports=function(a){function b(a,c,e,f){if(b.__super__.constructor.call(this,a),null==e)throw new Error("Missing entity name");if(null==f)throw new Error("Missing entity value");if(this.pe=!!c,this.name=this.stringify.eleName(e),d(f)){if(!f.pubID&&!f.sysID)throw new Error("Public and/or system identifiers are required for an external entity");if(f.pubID&&!f.sysID)throw new Error("System identifier is required for a public external entity");if(null!=f.pubID&&(this.pubID=this.stringify.dtdPubID(f.pubID)),null!=f.sysID&&(this.sysID=this.stringify.dtdSysID(f.sysID)),null!=f.nData&&(this.nData=this.stringify.dtdNData(f.nData)),this.pe&&this.nData)throw new Error("Notation declaration is not allowed in a parameter entity")}else this.value=this.stringify.dtdEntityValue(f)}return e(b,a),b.prototype.toString=function(a){return this.options.writer.set(a).dtdEntity(this)},b}(c)}).call(this)},{"./Utility":44,"./XMLNode":57}],51:[function(a,b,c){(function(){var c,d=function(a,b){function c(){this.constructor=a}for(var d in b)e.call(b,d)&&(a[d]=b[d]);return c.prototype=b.prototype,a.prototype=new c,a.__super__=b.prototype,a},e={}.hasOwnProperty;c=a("./XMLNode"),b.exports=function(a){function b(a,c,d){if(b.__super__.constructor.call(this,a),null==c)throw new Error("Missing notation name");if(!d.pubID&&!d.sysID)throw new Error("Public or system identifiers are required for an external entity");this.name=this.stringify.eleName(c),null!=d.pubID&&(this.pubID=this.stringify.dtdPubID(d.pubID)),null!=d.sysID&&(this.sysID=this.stringify.dtdSysID(d.sysID))}return d(b,a),b.prototype.toString=function(a){return this.options.writer.set(a).dtdNotation(this)},b}(c)}).call(this)},{"./XMLNode":57}],52:[function(a,b,c){(function(){var c,d,e=function(a,b){function c(){this.constructor=a}for(var d in b)f.call(b,d)&&(a[d]=b[d]);return c.prototype=b.prototype,a.prototype=new c,a.__super__=b.prototype,a},f={}.hasOwnProperty;d=a("./Utility").isObject,c=a("./XMLNode"),b.exports=function(a){function b(a,c,e,f){var g;b.__super__.constructor.call(this,a),d(c)&&(g=c,c=g.version,e=g.encoding,f=g.standalone),c||(c="1.0"),this.version=this.stringify.xmlVersion(c),null!=e&&(this.encoding=this.stringify.xmlEncoding(e)),null!=f&&(this.standalone=this.stringify.xmlStandalone(f))}return e(b,a),b.prototype.toString=function(a){return this.options.writer.set(a).declaration(this)},b}(c)}).call(this)},{"./Utility":44,"./XMLNode":57}],53:[function(a,b,c){(function(){var c,d,e,f,g,h,i=function(a,b){function c(){this.constructor=a}for(var d in b)j.call(b,d)&&(a[d]=b[d]);return c.prototype=b.prototype,a.prototype=new c,a.__super__=b.prototype,a},j={}.hasOwnProperty;h=a("./Utility").isObject,g=a("./XMLNode"),c=a("./XMLDTDAttList"),e=a("./XMLDTDEntity"),d=a("./XMLDTDElement"),f=a("./XMLDTDNotation"),b.exports=function(a){function b(a,c,d){var e,f;b.__super__.constructor.call(this,a),this.documentObject=a,h(c)&&(e=c,c=e.pubID,d=e.sysID),null==d&&(f=[c,d],d=f[0],c=f[1]),null!=c&&(this.pubID=this.stringify.dtdPubID(c)),null!=d&&(this.sysID=this.stringify.dtdSysID(d))}return i(b,a),b.prototype.element=function(a,b){var c;return c=new d(this,a,b),this.children.push(c),this},b.prototype.attList=function(a,b,d,e,f){var g;return g=new c(this,a,b,d,e,f),this.children.push(g),this},b.prototype.entity=function(a,b){var c;return c=new e(this,!1,a,b),this.children.push(c),this},b.prototype.pEntity=function(a,b){var c;return c=new e(this,!0,a,b),this.children.push(c),this},b.prototype.notation=function(a,b){var c;return c=new f(this,a,b),this.children.push(c),this},b.prototype.toString=function(a){return this.options.writer.set(a).docType(this)},b.prototype.ele=function(a,b){return this.element(a,b)},b.prototype.att=function(a,b,c,d,e){return this.attList(a,b,c,d,e)},b.prototype.ent=function(a,b){return this.entity(a,b)},b.prototype.pent=function(a,b){return this.pEntity(a,b)},b.prototype.not=function(a,b){return this.notation(a,b)},b.prototype.up=function(){return this.root()||this.documentObject},b}(g)}).call(this)},{"./Utility":44,"./XMLDTDAttList":48,"./XMLDTDElement":49,"./XMLDTDEntity":50,"./XMLDTDNotation":51,"./XMLNode":57}],54:[function(a,b,c){(function(){var c,d,e,f,g=function(a,b){function c(){this.constructor=a}for(var d in b)h.call(b,d)&&(a[d]=b[d]);return c.prototype=b.prototype,a.prototype=new c,a.__super__=b.prototype,a},h={}.hasOwnProperty;f=a("./Utility").isPlainObject,c=a("./XMLNode"),e=a("./XMLStringifier"),d=a("./XMLStringWriter"),b.exports=function(a){function b(a){b.__super__.constructor.call(this,null),a||(a={}),a.writer||(a.writer=new d),this.options=a,this.stringify=new e(a),this.isDocument=!0}return g(b,a),b.prototype.end=function(a){var b;return a?f(a)&&(b=a,a=this.options.writer.set(b)):a=this.options.writer,a.document(this)},b.prototype.toString=function(a){return this.options.writer.set(a).document(this)},b}(c)}).call(this)},{"./Utility":44,"./XMLNode":57,"./XMLStringWriter":61,"./XMLStringifier":62}],55:[function(a,b,c){(function(){var c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v={}.hasOwnProperty;u=a("./Utility"),s=u.isObject,r=u.isFunction,t=u.isPlainObject,l=a("./XMLElement"),d=a("./XMLCData"),e=a("./XMLComment"),n=a("./XMLRaw"),q=a("./XMLText"),m=a("./XMLProcessingInstruction"),j=a("./XMLDeclaration"),k=a("./XMLDocType"),f=a("./XMLDTDAttList"),h=a("./XMLDTDEntity"),g=a("./XMLDTDElement"),i=a("./XMLDTDNotation"),c=a("./XMLAttribute"),p=a("./XMLStringifier"),o=a("./XMLStringWriter"),b.exports=function(){function a(a,b,c){var d;a||(a={}),a.writer?t(a.writer)&&(d=a.writer,a.writer=new o(d)):a.writer=new o(a),this.options=a,this.writer=a.writer,this.stringify=new p(a),this.onDataCallback=b||function(){},this.onEndCallback=c||function(){},this.currentNode=null,this.currentLevel=-1,this.openTags={},this.documentStarted=!1,this.documentCompleted=!1,this.root=null}return a.prototype.node=function(a,b,c){var d;if(null==a)throw new Error("Missing node name");if(this.root&&-1===this.currentLevel)throw new Error("Document can only have one root node");return this.openCurrent(),a=a.valueOf(),null==b&&(b={}),b=b.valueOf(),s(b)||(d=[b,c],c=d[0],b=d[1]),
this.currentNode=new l(this,a,b),this.currentNode.children=!1,this.currentLevel++,this.openTags[this.currentLevel]=this.currentNode,null!=c&&this.text(c),this},a.prototype.element=function(a,b,c){return this.currentNode&&this.currentNode instanceof k?this.dtdElement.apply(this,arguments):this.node(a,b,c)},a.prototype.attribute=function(a,b){var d,e;if(!this.currentNode||this.currentNode.children)throw new Error("att() can only be used immediately after an ele() call in callback mode");if(null!=a&&(a=a.valueOf()),s(a))for(d in a)v.call(a,d)&&(e=a[d],this.attribute(d,e));else r(b)&&(b=b.apply()),this.options.skipNullAttributes&&null==b||(this.currentNode.attributes[a]=new c(this,a,b));return this},a.prototype.text=function(a){var b;return this.openCurrent(),b=new q(this,a),this.onData(this.writer.text(b,this.currentLevel+1)),this},a.prototype.cdata=function(a){var b;return this.openCurrent(),b=new d(this,a),this.onData(this.writer.cdata(b,this.currentLevel+1)),this},a.prototype.comment=function(a){var b;return this.openCurrent(),b=new e(this,a),this.onData(this.writer.comment(b,this.currentLevel+1)),this},a.prototype.raw=function(a){var b;return this.openCurrent(),b=new n(this,a),this.onData(this.writer.raw(b,this.currentLevel+1)),this},a.prototype.instruction=function(a,b){var c,d,e,f,g;if(this.openCurrent(),null!=a&&(a=a.valueOf()),null!=b&&(b=b.valueOf()),Array.isArray(a))for(c=0,f=a.length;c<f;c++)d=a[c],this.instruction(d);else if(s(a))for(d in a)v.call(a,d)&&(e=a[d],this.instruction(d,e));else r(b)&&(b=b.apply()),g=new m(this,a,b),this.onData(this.writer.processingInstruction(g,this.currentLevel+1));return this},a.prototype.declaration=function(a,b,c){var d;if(this.openCurrent(),this.documentStarted)throw new Error("declaration() must be the first node");return d=new j(this,a,b,c),this.onData(this.writer.declaration(d,this.currentLevel+1)),this},a.prototype.doctype=function(a,b,c){if(this.openCurrent(),null==a)throw new Error("Missing root node name");if(this.root)throw new Error("dtd() must come before the root node");return this.currentNode=new k(this,b,c),this.currentNode.rootNodeName=a,this.currentNode.children=!1,this.currentLevel++,this.openTags[this.currentLevel]=this.currentNode,this},a.prototype.dtdElement=function(a,b){var c;return this.openCurrent(),c=new g(this,a,b),this.onData(this.writer.dtdElement(c,this.currentLevel+1)),this},a.prototype.attList=function(a,b,c,d,e){var g;return this.openCurrent(),g=new f(this,a,b,c,d,e),this.onData(this.writer.dtdAttList(g,this.currentLevel+1)),this},a.prototype.entity=function(a,b){var c;return this.openCurrent(),c=new h(this,!1,a,b),this.onData(this.writer.dtdEntity(c,this.currentLevel+1)),this},a.prototype.pEntity=function(a,b){var c;return this.openCurrent(),c=new h(this,!0,a,b),this.onData(this.writer.dtdEntity(c,this.currentLevel+1)),this},a.prototype.notation=function(a,b){var c;return this.openCurrent(),c=new i(this,a,b),this.onData(this.writer.dtdNotation(c,this.currentLevel+1)),this},a.prototype.up=function(){if(this.currentLevel<0)throw new Error("The document node has no parent");return this.currentNode?(this.currentNode.children?this.closeNode(this.currentNode):this.openNode(this.currentNode),this.currentNode=null):this.closeNode(this.openTags[this.currentLevel]),delete this.openTags[this.currentLevel],this.currentLevel--,this},a.prototype.end=function(){for(;this.currentLevel>=0;)this.up();return this.onEnd()},a.prototype.openCurrent=function(){if(this.currentNode)return this.currentNode.children=!0,this.openNode(this.currentNode)},a.prototype.openNode=function(a){if(!a.isOpen)return!this.root&&0===this.currentLevel&&a instanceof l&&(this.root=a),this.onData(this.writer.openNode(a,this.currentLevel)),a.isOpen=!0},a.prototype.closeNode=function(a){if(!a.isClosed)return this.onData(this.writer.closeNode(a,this.currentLevel)),a.isClosed=!0},a.prototype.onData=function(a){return this.documentStarted=!0,this.onDataCallback(a)},a.prototype.onEnd=function(){return this.documentCompleted=!0,this.onEndCallback()},a.prototype.ele=function(){return this.element.apply(this,arguments)},a.prototype.nod=function(a,b,c){return this.node(a,b,c)},a.prototype.txt=function(a){return this.text(a)},a.prototype.dat=function(a){return this.cdata(a)},a.prototype.com=function(a){return this.comment(a)},a.prototype.ins=function(a,b){return this.instruction(a,b)},a.prototype.dec=function(a,b,c){return this.declaration(a,b,c)},a.prototype.dtd=function(a,b,c){return this.doctype(a,b,c)},a.prototype.e=function(a,b,c){return this.element(a,b,c)},a.prototype.n=function(a,b,c){return this.node(a,b,c)},a.prototype.t=function(a){return this.text(a)},a.prototype.d=function(a){return this.cdata(a)},a.prototype.c=function(a){return this.comment(a)},a.prototype.r=function(a){return this.raw(a)},a.prototype.i=function(a,b){return this.instruction(a,b)},a.prototype.att=function(){return this.currentNode&&this.currentNode instanceof k?this.attList.apply(this,arguments):this.attribute.apply(this,arguments)},a.prototype.a=function(){return this.currentNode&&this.currentNode instanceof k?this.attList.apply(this,arguments):this.attribute.apply(this,arguments)},a.prototype.ent=function(a,b){return this.entity(a,b)},a.prototype.pent=function(a,b){return this.pEntity(a,b)},a.prototype.not=function(a,b){return this.notation(a,b)},a}()}).call(this)},{"./Utility":44,"./XMLAttribute":45,"./XMLCData":46,"./XMLComment":47,"./XMLDTDAttList":48,"./XMLDTDElement":49,"./XMLDTDEntity":50,"./XMLDTDNotation":51,"./XMLDeclaration":52,"./XMLDocType":53,"./XMLElement":56,"./XMLProcessingInstruction":58,"./XMLRaw":59,"./XMLStringWriter":61,"./XMLStringifier":62,"./XMLText":63}],56:[function(a,b,c){(function(){var c,d,e,f,g,h=function(a,b){function c(){this.constructor=a}for(var d in b)i.call(b,d)&&(a[d]=b[d]);return c.prototype=b.prototype,a.prototype=new c,a.__super__=b.prototype,a},i={}.hasOwnProperty;g=a("./Utility"),f=g.isObject,e=g.isFunction,d=a("./XMLNode"),c=a("./XMLAttribute"),b.exports=function(a){function b(a,c,d){if(b.__super__.constructor.call(this,a),null==c)throw new Error("Missing element name");this.name=this.stringify.eleName(c),this.attributes={},null!=d&&this.attribute(d),a.isDocument&&(this.isRoot=!0,this.documentObject=a,a.rootObject=this)}return h(b,a),b.prototype.clone=function(){var a,b,c,d;c=Object.create(this),c.isRoot&&(c.documentObject=null),c.attributes={},d=this.attributes;for(b in d)i.call(d,b)&&(a=d[b],c.attributes[b]=a.clone());return c.children=[],this.children.forEach(function(a){var b;return b=a.clone(),b.parent=c,c.children.push(b)}),c},b.prototype.attribute=function(a,b){var d,g;if(null!=a&&(a=a.valueOf()),f(a))for(d in a)i.call(a,d)&&(g=a[d],this.attribute(d,g));else e(b)&&(b=b.apply()),this.options.skipNullAttributes&&null==b||(this.attributes[a]=new c(this,a,b));return this},b.prototype.removeAttribute=function(a){var b,c,d;if(null==a)throw new Error("Missing attribute name");if(a=a.valueOf(),Array.isArray(a))for(c=0,d=a.length;c<d;c++)b=a[c],delete this.attributes[b];else delete this.attributes[a];return this},b.prototype.toString=function(a){return this.options.writer.set(a).element(this)},b.prototype.att=function(a,b){return this.attribute(a,b)},b.prototype.a=function(a,b){return this.attribute(a,b)},b}(d)}).call(this)},{"./Utility":44,"./XMLAttribute":45,"./XMLNode":57}],57:[function(a,b,c){(function(){var c,d,e,f,g,h,i,j,k,l,m,n,o={}.hasOwnProperty;n=a("./Utility"),m=n.isObject,l=n.isFunction,k=n.isEmpty,g=null,c=null,d=null,e=null,f=null,i=null,j=null,h=null,b.exports=function(){function b(b){this.parent=b,this.parent&&(this.options=this.parent.options,this.stringify=this.parent.stringify),this.children=[],g||(g=a("./XMLElement"),c=a("./XMLCData"),d=a("./XMLComment"),e=a("./XMLDeclaration"),f=a("./XMLDocType"),i=a("./XMLRaw"),j=a("./XMLText"),h=a("./XMLProcessingInstruction"))}return b.prototype.element=function(a,b,c){var d,e,f,g,h,i,j,n,p,q;if(i=null,null==b&&(b={}),b=b.valueOf(),m(b)||(p=[b,c],c=p[0],b=p[1]),null!=a&&(a=a.valueOf()),Array.isArray(a))for(f=0,j=a.length;f<j;f++)e=a[f],i=this.element(e);else if(l(a))i=this.element(a.apply());else if(m(a)){for(h in a)if(o.call(a,h))if(q=a[h],l(q)&&(q=q.apply()),m(q)&&k(q)&&(q=null),!this.options.ignoreDecorators&&this.stringify.convertAttKey&&0===h.indexOf(this.stringify.convertAttKey))i=this.attribute(h.substr(this.stringify.convertAttKey.length),q);else if(!this.options.separateArrayItems&&Array.isArray(q))for(g=0,n=q.length;g<n;g++)e=q[g],d={},d[h]=e,i=this.element(d);else m(q)?(i=this.element(h),i.element(q)):i=this.element(h,q)}else i=!this.options.ignoreDecorators&&this.stringify.convertTextKey&&0===a.indexOf(this.stringify.convertTextKey)?this.text(c):!this.options.ignoreDecorators&&this.stringify.convertCDataKey&&0===a.indexOf(this.stringify.convertCDataKey)?this.cdata(c):!this.options.ignoreDecorators&&this.stringify.convertCommentKey&&0===a.indexOf(this.stringify.convertCommentKey)?this.comment(c):!this.options.ignoreDecorators&&this.stringify.convertRawKey&&0===a.indexOf(this.stringify.convertRawKey)?this.raw(c):!this.options.ignoreDecorators&&this.stringify.convertPIKey&&0===a.indexOf(this.stringify.convertPIKey)?this.instruction(a.substr(this.stringify.convertPIKey.length),c):this.node(a,b,c);if(null==i)throw new Error("Could not create any elements with: "+a);return i},b.prototype.insertBefore=function(a,b,c){var d,e,f;if(this.isRoot)throw new Error("Cannot insert elements at root level");return e=this.parent.children.indexOf(this),f=this.parent.children.splice(e),d=this.parent.element(a,b,c),Array.prototype.push.apply(this.parent.children,f),d},b.prototype.insertAfter=function(a,b,c){var d,e,f;if(this.isRoot)throw new Error("Cannot insert elements at root level");return e=this.parent.children.indexOf(this),f=this.parent.children.splice(e+1),d=this.parent.element(a,b,c),Array.prototype.push.apply(this.parent.children,f),d},b.prototype.remove=function(){var a;if(this.isRoot)throw new Error("Cannot remove the root element");return a=this.parent.children.indexOf(this),[].splice.apply(this.parent.children,[a,a-a+1].concat([])),this.parent},b.prototype.node=function(a,b,c){var d,e;return null!=a&&(a=a.valueOf()),b||(b={}),b=b.valueOf(),m(b)||(e=[b,c],c=e[0],b=e[1]),d=new g(this,a,b),null!=c&&d.text(c),this.children.push(d),d},b.prototype.text=function(a){var b;return b=new j(this,a),this.children.push(b),this},b.prototype.cdata=function(a){var b;return b=new c(this,a),this.children.push(b),this},b.prototype.comment=function(a){var b;return b=new d(this,a),this.children.push(b),this},b.prototype.commentBefore=function(a){var b,c;return b=this.parent.children.indexOf(this),c=this.parent.children.splice(b),this.parent.comment(a),Array.prototype.push.apply(this.parent.children,c),this},b.prototype.commentAfter=function(a){var b,c;return b=this.parent.children.indexOf(this),c=this.parent.children.splice(b+1),this.parent.comment(a),Array.prototype.push.apply(this.parent.children,c),this},b.prototype.raw=function(a){var b;return b=new i(this,a),this.children.push(b),this},b.prototype.instruction=function(a,b){var c,d,e,f,g;if(null!=a&&(a=a.valueOf()),null!=b&&(b=b.valueOf()),Array.isArray(a))for(f=0,g=a.length;f<g;f++)c=a[f],this.instruction(c);else if(m(a))for(c in a)o.call(a,c)&&(d=a[c],this.instruction(c,d));else l(b)&&(b=b.apply()),e=new h(this,a,b),this.children.push(e);return this},b.prototype.instructionBefore=function(a,b){var c,d;return c=this.parent.children.indexOf(this),d=this.parent.children.splice(c),this.parent.instruction(a,b),Array.prototype.push.apply(this.parent.children,d),this},b.prototype.instructionAfter=function(a,b){var c,d;return c=this.parent.children.indexOf(this),d=this.parent.children.splice(c+1),this.parent.instruction(a,b),Array.prototype.push.apply(this.parent.children,d),this},b.prototype.declaration=function(a,b,c){var d,f;return d=this.document(),f=new e(d,a,b,c),d.children[0]instanceof e?d.children[0]=f:d.children.unshift(f),d.root()||d},b.prototype.doctype=function(a,b){var c,d,e,g,h,i,j,k,l,m;for(d=this.document(),e=new f(d,a,b),l=d.children,g=h=0,j=l.length;h<j;g=++h)if((c=l[g])instanceof f)return d.children[g]=e,e;for(m=d.children,g=i=0,k=m.length;i<k;g=++i)if(c=m[g],c.isRoot)return d.children.splice(g,0,e),e;return d.children.push(e),e},b.prototype.up=function(){if(this.isRoot)throw new Error("The root node has no parent. Use doc() if you need to get the document object.");return this.parent},b.prototype.root=function(){var a;for(a=this;a;){if(a.isDocument)return a.rootObject;if(a.isRoot)return a;a=a.parent}},b.prototype.document=function(){var a;for(a=this;a;){if(a.isDocument)return a;a=a.parent}},b.prototype.end=function(a){return this.document().end(a)},b.prototype.prev=function(){var a;if((a=this.parent.children.indexOf(this))<1)throw new Error("Already at the first node");return this.parent.children[a-1]},b.prototype.next=function(){var a;if(-1===(a=this.parent.children.indexOf(this))||a===this.parent.children.length-1)throw new Error("Already at the last node");return this.parent.children[a+1]},b.prototype.importDocument=function(a){var b;return b=a.root().clone(),b.parent=this,b.isRoot=!1,this.children.push(b),this},b.prototype.ele=function(a,b,c){return this.element(a,b,c)},b.prototype.nod=function(a,b,c){return this.node(a,b,c)},b.prototype.txt=function(a){return this.text(a)},b.prototype.dat=function(a){return this.cdata(a)},b.prototype.com=function(a){return this.comment(a)},b.prototype.ins=function(a,b){return this.instruction(a,b)},b.prototype.doc=function(){return this.document()},b.prototype.dec=function(a,b,c){return this.declaration(a,b,c)},b.prototype.dtd=function(a,b){return this.doctype(a,b)},b.prototype.e=function(a,b,c){return this.element(a,b,c)},b.prototype.n=function(a,b,c){return this.node(a,b,c)},b.prototype.t=function(a){return this.text(a)},b.prototype.d=function(a){return this.cdata(a)},b.prototype.c=function(a){return this.comment(a)},b.prototype.r=function(a){return this.raw(a)},b.prototype.i=function(a,b){return this.instruction(a,b)},b.prototype.u=function(){return this.up()},b.prototype.importXMLBuilder=function(a){return this.importDocument(a)},b}()}).call(this)},{"./Utility":44,"./XMLCData":46,"./XMLComment":47,"./XMLDeclaration":52,"./XMLDocType":53,"./XMLElement":56,"./XMLProcessingInstruction":58,"./XMLRaw":59,"./XMLText":63}],58:[function(a,b,c){(function(){var c,d=function(a,b){function c(){this.constructor=a}for(var d in b)e.call(b,d)&&(a[d]=b[d]);return c.prototype=b.prototype,a.prototype=new c,a.__super__=b.prototype,a},e={}.hasOwnProperty;c=a("./XMLNode"),b.exports=function(a){function b(a,c,d){if(b.__super__.constructor.call(this,a),null==c)throw new Error("Missing instruction target");this.target=this.stringify.insTarget(c),d&&(this.value=this.stringify.insValue(d))}return d(b,a),b.prototype.clone=function(){return Object.create(this)},b.prototype.toString=function(a){return this.options.writer.set(a).processingInstruction(this)},b}(c)}).call(this)},{"./XMLNode":57}],59:[function(a,b,c){(function(){var c,d=function(a,b){function c(){this.constructor=a}for(var d in b)e.call(b,d)&&(a[d]=b[d]);return c.prototype=b.prototype,a.prototype=new c,a.__super__=b.prototype,a},e={}.hasOwnProperty;c=a("./XMLNode"),b.exports=function(a){function b(a,c){if(b.__super__.constructor.call(this,a),null==c)throw new Error("Missing raw text");this.value=this.stringify.raw(c)}return d(b,a),b.prototype.clone=function(){return Object.create(this)},b.prototype.toString=function(a){return this.options.writer.set(a).raw(this)},b}(c)}).call(this)},{"./XMLNode":57}],60:[function(a,b,c){(function(){var c,d,e,f,g,h,i,j,k,l,m,n,o,p=function(a,b){function c(){this.constructor=a}for(var d in b)q.call(b,d)&&(a[d]=b[d]);return c.prototype=b.prototype,a.prototype=new c,a.__super__=b.prototype,a},q={}.hasOwnProperty;i=a("./XMLDeclaration"),j=a("./XMLDocType"),c=a("./XMLCData"),d=a("./XMLComment"),k=a("./XMLElement"),m=a("./XMLRaw"),n=a("./XMLText"),l=a("./XMLProcessingInstruction"),e=a("./XMLDTDAttList"),f=a("./XMLDTDElement"),g=a("./XMLDTDEntity"),h=a("./XMLDTDNotation"),o=a("./XMLWriterBase"),b.exports=function(a){function b(a,c){b.__super__.constructor.call(this,c),this.stream=a}return p(b,a),b.prototype.document=function(a){var b,c,e,f,g,h,k,m;for(h=a.children,c=0,f=h.length;c<f;c++)b=h[c],b.isLastRootNode=!1;for(a.children[a.children.length-1].isLastRootNode=!0,k=a.children,m=[],e=0,g=k.length;e<g;e++)switch(b=k[e],!1){case!(b instanceof i):m.push(this.declaration(b));break;case!(b instanceof j):m.push(this.docType(b));break;case!(b instanceof d):m.push(this.comment(b));break;case!(b instanceof l):m.push(this.processingInstruction(b));break;default:m.push(this.element(b))}return m},b.prototype.attribute=function(a){return this.stream.write(" "+a.name+'="'+a.value+'"')},b.prototype.cdata=function(a,b){return this.stream.write(this.space(b)+"<![CDATA["+a.text+"]]>"+this.endline(a))},b.prototype.comment=function(a,b){return this.stream.write(this.space(b)+"\x3c!-- "+a.text+" --\x3e"+this.endline(a))},b.prototype.declaration=function(a,b){return this.stream.write(this.space(b)),this.stream.write('<?xml version="'+a.version+'"'),null!=a.encoding&&this.stream.write(' encoding="'+a.encoding+'"'),null!=a.standalone&&this.stream.write(' standalone="'+a.standalone+'"'),this.stream.write(this.spacebeforeslash+"?>"),this.stream.write(this.endline(a))},b.prototype.docType=function(a,b){var i,j,k,m;if(b||(b=0),this.stream.write(this.space(b)),this.stream.write("<!DOCTYPE "+a.root().name),a.pubID&&a.sysID?this.stream.write(' PUBLIC "'+a.pubID+'" "'+a.sysID+'"'):a.sysID&&this.stream.write(' SYSTEM "'+a.sysID+'"'),a.children.length>0){for(this.stream.write(" ["),this.stream.write(this.endline(a)),m=a.children,j=0,k=m.length;j<k;j++)switch(i=m[j],!1){case!(i instanceof e):this.dtdAttList(i,b+1);break;case!(i instanceof f):this.dtdElement(i,b+1);break;case!(i instanceof g):this.dtdEntity(i,b+1);break;case!(i instanceof h):this.dtdNotation(i,b+1);break;case!(i instanceof c):this.cdata(i,b+1);break;case!(i instanceof d):this.comment(i,b+1);break;case!(i instanceof l):this.processingInstruction(i,b+1);break;default:throw new Error("Unknown DTD node type: "+i.constructor.name)}this.stream.write("]")}return this.stream.write(this.spacebeforeslash+">"),this.stream.write(this.endline(a))},b.prototype.element=function(a,b){var e,f,g,h,i,j,o,p;b||(b=0),p=this.space(b),this.stream.write(p+"<"+a.name),j=a.attributes;for(i in j)q.call(j,i)&&(e=j[i],this.attribute(e));if(0===a.children.length||a.children.every(function(a){return""===a.value}))this.allowEmpty?this.stream.write("></"+a.name+">"):this.stream.write(this.spacebeforeslash+"/>");else if(this.pretty&&1===a.children.length&&null!=a.children[0].value)this.stream.write(">"),this.stream.write(a.children[0].value),this.stream.write("</"+a.name+">");else{for(this.stream.write(">"+this.newline),o=a.children,g=0,h=o.length;g<h;g++)switch(f=o[g],!1){case!(f instanceof c):this.cdata(f,b+1);break;case!(f instanceof d):this.comment(f,b+1);break;case!(f instanceof k):this.element(f,b+1);break;case!(f instanceof m):this.raw(f,b+1);break;case!(f instanceof n):this.text(f,b+1);break;case!(f instanceof l):this.processingInstruction(f,b+1);break;default:throw new Error("Unknown XML node type: "+f.constructor.name)}this.stream.write(p+"</"+a.name+">")}return this.stream.write(this.endline(a))},b.prototype.processingInstruction=function(a,b){return this.stream.write(this.space(b)+"<?"+a.target),a.value&&this.stream.write(" "+a.value),this.stream.write(this.spacebeforeslash+"?>"+this.endline(a))},b.prototype.raw=function(a,b){return this.stream.write(this.space(b)+a.value+this.endline(a))},b.prototype.text=function(a,b){return this.stream.write(this.space(b)+a.value+this.endline(a))},b.prototype.dtdAttList=function(a,b){return this.stream.write(this.space(b)+"<!ATTLIST "+a.elementName+" "+a.attributeName+" "+a.attributeType),"#DEFAULT"!==a.defaultValueType&&this.stream.write(" "+a.defaultValueType),a.defaultValue&&this.stream.write(' "'+a.defaultValue+'"'),this.stream.write(this.spacebeforeslash+">"+this.endline(a))},b.prototype.dtdElement=function(a,b){return this.stream.write(this.space(b)+"<!ELEMENT "+a.name+" "+a.value),this.stream.write(this.spacebeforeslash+">"+this.endline(a))},b.prototype.dtdEntity=function(a,b){return this.stream.write(this.space(b)+"<!ENTITY"),a.pe&&this.stream.write(" %"),this.stream.write(" "+a.name),a.value?this.stream.write(' "'+a.value+'"'):(a.pubID&&a.sysID?this.stream.write(' PUBLIC "'+a.pubID+'" "'+a.sysID+'"'):a.sysID&&this.stream.write(' SYSTEM "'+a.sysID+'"'),a.nData&&this.stream.write(" NDATA "+a.nData)),this.stream.write(this.spacebeforeslash+">"+this.endline(a))},b.prototype.dtdNotation=function(a,b){return this.stream.write(this.space(b)+"<!NOTATION "+a.name),a.pubID&&a.sysID?this.stream.write(' PUBLIC "'+a.pubID+'" "'+a.sysID+'"'):a.pubID?this.stream.write(' PUBLIC "'+a.pubID+'"'):a.sysID&&this.stream.write(' SYSTEM "'+a.sysID+'"'),this.stream.write(this.spacebeforeslash+">"+this.endline(a))},b.prototype.endline=function(a){return a.isLastRootNode?"":this.newline},b}(o)}).call(this)},{"./XMLCData":46,"./XMLComment":47,"./XMLDTDAttList":48,"./XMLDTDElement":49,"./XMLDTDEntity":50,"./XMLDTDNotation":51,"./XMLDeclaration":52,"./XMLDocType":53,"./XMLElement":56,"./XMLProcessingInstruction":58,"./XMLRaw":59,"./XMLText":63,"./XMLWriterBase":64}],61:[function(a,b,c){(function(){var c,d,e,f,g,h,i,j,k,l,m,n,o,p=function(a,b){function c(){this.constructor=a}for(var d in b)q.call(b,d)&&(a[d]=b[d]);return c.prototype=b.prototype,a.prototype=new c,a.__super__=b.prototype,a},q={}.hasOwnProperty;i=a("./XMLDeclaration"),j=a("./XMLDocType"),c=a("./XMLCData"),d=a("./XMLComment"),k=a("./XMLElement"),m=a("./XMLRaw"),n=a("./XMLText"),l=a("./XMLProcessingInstruction"),e=a("./XMLDTDAttList"),f=a("./XMLDTDElement"),g=a("./XMLDTDEntity"),h=a("./XMLDTDNotation"),o=a("./XMLWriterBase"),b.exports=function(a){function b(a){b.__super__.constructor.call(this,a)}return p(b,a),b.prototype.document=function(a){var b,c,e,f,g;for(this.textispresent=!1,f="",g=a.children,c=0,e=g.length;c<e;c++)b=g[c],f+=function(){switch(!1){case!(b instanceof i):return this.declaration(b);case!(b instanceof j):return this.docType(b);case!(b instanceof d):return this.comment(b);case!(b instanceof l):return this.processingInstruction(b);default:return this.element(b,0)}}.call(this);return this.pretty&&f.slice(-this.newline.length)===this.newline&&(f=f.slice(0,-this.newline.length)),f},b.prototype.attribute=function(a){return" "+a.name+'="'+a.value+'"'},b.prototype.cdata=function(a,b){return this.space(b)+"<![CDATA["+a.text+"]]>"+this.newline},b.prototype.comment=function(a,b){return this.space(b)+"\x3c!-- "+a.text+" --\x3e"+this.newline},b.prototype.declaration=function(a,b){var c;return c=this.space(b),c+='<?xml version="'+a.version+'"',null!=a.encoding&&(c+=' encoding="'+a.encoding+'"'),null!=a.standalone&&(c+=' standalone="'+a.standalone+'"'),c+=this.spacebeforeslash+"?>",c+=this.newline},b.prototype.docType=function(a,b){var i,j,k,m,n;if(b||(b=0),m=this.space(b),m+="<!DOCTYPE "+a.root().name,a.pubID&&a.sysID?m+=' PUBLIC "'+a.pubID+'" "'+a.sysID+'"':a.sysID&&(m+=' SYSTEM "'+a.sysID+'"'),a.children.length>0){for(m+=" [",m+=this.newline,n=a.children,j=0,k=n.length;j<k;j++)i=n[j],m+=function(){switch(!1){case!(i instanceof e):return this.dtdAttList(i,b+1);case!(i instanceof f):return this.dtdElement(i,b+1);case!(i instanceof g):return this.dtdEntity(i,b+1);case!(i instanceof h):return this.dtdNotation(i,b+1);case!(i instanceof c):return this.cdata(i,b+1);case!(i instanceof d):return this.comment(i,b+1);case!(i instanceof l):return this.processingInstruction(i,b+1);default:throw new Error("Unknown DTD node type: "+i.constructor.name)}}.call(this);m+="]"}return m+=this.spacebeforeslash+">",m+=this.newline},b.prototype.element=function(a,b){var e,f,g,h,i,j,o,p,r,s,t,u,v;b||(b=0),v=!1,this.textispresent?(this.newline="",this.pretty=!1):(this.newline=this.newlinedefault,this.pretty=this.prettydefault),u=this.space(b),p="",p+=u+"<"+a.name,r=a.attributes;for(o in r)q.call(r,o)&&(e=r[o],p+=this.attribute(e));if(0===a.children.length||a.children.every(function(a){return""===a.value}))this.allowEmpty?p+="></"+a.name+">"+this.newline:p+=this.spacebeforeslash+"/>"+this.newline;else if(this.pretty&&1===a.children.length&&null!=a.children[0].value)p+=">",p+=a.children[0].value,p+="</"+a.name+">"+this.newline;else{if(this.dontprettytextnodes)for(s=a.children,g=0,i=s.length;g<i;g++)if(f=s[g],null!=f.value){this.textispresent++,v=!0;break}for(this.textispresent&&(this.newline="",this.pretty=!1,u=this.space(b)),p+=">"+this.newline,t=a.children,h=0,j=t.length;h<j;h++)f=t[h],p+=function(){switch(!1){case!(f instanceof c):return this.cdata(f,b+1);case!(f instanceof d):return this.comment(f,b+1);case!(f instanceof k):return this.element(f,b+1);case!(f instanceof m):return this.raw(f,b+1);case!(f instanceof n):return this.text(f,b+1);case!(f instanceof l):return this.processingInstruction(f,b+1);default:throw new Error("Unknown XML node type: "+f.constructor.name)}}.call(this);v&&this.textispresent--,this.textispresent||(this.newline=this.newlinedefault,this.pretty=this.prettydefault),p+=u+"</"+a.name+">"+this.newline}return p},b.prototype.processingInstruction=function(a,b){var c;return c=this.space(b)+"<?"+a.target,a.value&&(c+=" "+a.value),c+=this.spacebeforeslash+"?>"+this.newline},b.prototype.raw=function(a,b){return this.space(b)+a.value+this.newline},b.prototype.text=function(a,b){return this.space(b)+a.value+this.newline},b.prototype.dtdAttList=function(a,b){var c;return c=this.space(b)+"<!ATTLIST "+a.elementName+" "+a.attributeName+" "+a.attributeType,"#DEFAULT"!==a.defaultValueType&&(c+=" "+a.defaultValueType),a.defaultValue&&(c+=' "'+a.defaultValue+'"'),c+=this.spacebeforeslash+">"+this.newline},b.prototype.dtdElement=function(a,b){return this.space(b)+"<!ELEMENT "+a.name+" "+a.value+this.spacebeforeslash+">"+this.newline},b.prototype.dtdEntity=function(a,b){var c;return c=this.space(b)+"<!ENTITY",a.pe&&(c+=" %"),c+=" "+a.name,a.value?c+=' "'+a.value+'"':(a.pubID&&a.sysID?c+=' PUBLIC "'+a.pubID+'" "'+a.sysID+'"':a.sysID&&(c+=' SYSTEM "'+a.sysID+'"'),a.nData&&(c+=" NDATA "+a.nData)),c+=this.spacebeforeslash+">"+this.newline},b.prototype.dtdNotation=function(a,b){var c;return c=this.space(b)+"<!NOTATION "+a.name,a.pubID&&a.sysID?c+=' PUBLIC "'+a.pubID+'" "'+a.sysID+'"':a.pubID?c+=' PUBLIC "'+a.pubID+'"':a.sysID&&(c+=' SYSTEM "'+a.sysID+'"'),c+=this.spacebeforeslash+">"+this.newline},b.prototype.openNode=function(a,b){var c,d,e,f;if(b||(b=0),a instanceof k){e=this.space(b)+"<"+a.name,f=a.attributes;for(d in f)q.call(f,d)&&(c=f[d],e+=this.attribute(c));return e+=(a.children?">":"/>")+this.newline}return e=this.space(b)+"<!DOCTYPE "+a.rootNodeName,a.pubID&&a.sysID?e+=' PUBLIC "'+a.pubID+'" "'+a.sysID+'"':a.sysID&&(e+=' SYSTEM "'+a.sysID+'"'),e+=(a.children?" [":">")+this.newline},b.prototype.closeNode=function(a,b){switch(b||(b=0),!1){case!(a instanceof k):return this.space(b)+"</"+a.name+">"+this.newline;case!(a instanceof j):return this.space(b)+"]>"+this.newline}},b}(o)}).call(this)},{"./XMLCData":46,"./XMLComment":47,"./XMLDTDAttList":48,"./XMLDTDElement":49,"./XMLDTDEntity":50,"./XMLDTDNotation":51,"./XMLDeclaration":52,"./XMLDocType":53,"./XMLElement":56,"./XMLProcessingInstruction":58,"./XMLRaw":59,"./XMLText":63,"./XMLWriterBase":64}],62:[function(a,b,c){(function(){var a=function(a,b){return function(){return a.apply(b,arguments)}},c={}.hasOwnProperty;b.exports=function(){function b(b){this.assertLegalChar=a(this.assertLegalChar,this);var d,e,f;b||(b={}),this.noDoubleEncoding=b.noDoubleEncoding,e=b.stringify||{};for(d in e)c.call(e,d)&&(f=e[d],this[d]=f)}return b.prototype.eleName=function(a){return a=""+a||"",this.assertLegalChar(a)},b.prototype.eleText=function(a){return a=""+a||"",this.assertLegalChar(this.elEscape(a))},b.prototype.cdata=function(a){return a=""+a||"",a=a.replace("]]>","]]]]><![CDATA[>"),this.assertLegalChar(a)},b.prototype.comment=function(a){if(a=""+a||"",a.match(/--/))throw new Error("Comment text cannot contain double-hypen: "+a);return this.assertLegalChar(a)},b.prototype.raw=function(a){return""+a||""},b.prototype.attName=function(a){return a=""+a||""},b.prototype.attValue=function(a){return a=""+a||"",this.attEscape(a)},b.prototype.insTarget=function(a){return""+a||""},b.prototype.insValue=function(a){if(a=""+a||"",a.match(/\?>/))throw new Error("Invalid processing instruction value: "+a);return a},b.prototype.xmlVersion=function(a){if(a=""+a||"",!a.match(/1\.[0-9]+/))throw new Error("Invalid version number: "+a);return a},b.prototype.xmlEncoding=function(a){if(a=""+a||"",!a.match(/^[A-Za-z](?:[A-Za-z0-9._-])*$/))throw new Error("Invalid encoding: "+a);return a},b.prototype.xmlStandalone=function(a){return a?"yes":"no"},b.prototype.dtdPubID=function(a){return""+a||""},b.prototype.dtdSysID=function(a){return""+a||""},b.prototype.dtdElementValue=function(a){return""+a||""},b.prototype.dtdAttType=function(a){return""+a||""},b.prototype.dtdAttDefault=function(a){return null!=a?""+a||"":a},b.prototype.dtdEntityValue=function(a){return""+a||""},b.prototype.dtdNData=function(a){return""+a||""},b.prototype.convertAttKey="@",b.prototype.convertPIKey="?",b.prototype.convertTextKey="#text",b.prototype.convertCDataKey="#cdata",b.prototype.convertCommentKey="#comment",b.prototype.convertRawKey="#raw",b.prototype.assertLegalChar=function(a){var b;if(b=a.match(/[\0\uFFFE\uFFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF]/))throw new Error("Invalid character in string: "+a+" at index "+b.index);return a},b.prototype.elEscape=function(a){var b;return b=this.noDoubleEncoding?/(?!&\S+;)&/g:/&/g,a.replace(b,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/\r/g,"&#xD;")},b.prototype.attEscape=function(a){var b;return b=this.noDoubleEncoding?/(?!&\S+;)&/g:/&/g,a.replace(b,"&amp;").replace(/</g,"&lt;").replace(/"/g,"&quot;").replace(/\t/g,"&#x9;").replace(/\n/g,"&#xA;").replace(/\r/g,"&#xD;")},b}()}).call(this)},{}],63:[function(a,b,c){(function(){var c,d=function(a,b){function c(){this.constructor=a}for(var d in b)e.call(b,d)&&(a[d]=b[d]);return c.prototype=b.prototype,a.prototype=new c,a.__super__=b.prototype,a},e={}.hasOwnProperty;c=a("./XMLNode"),b.exports=function(a){function b(a,c){if(b.__super__.constructor.call(this,a),null==c)throw new Error("Missing element text");this.value=this.stringify.eleText(c)}return d(b,a),b.prototype.clone=function(){return Object.create(this)},b.prototype.toString=function(a){return this.options.writer.set(a).text(this)},b}(c)}).call(this)},{"./XMLNode":57}],64:[function(a,b,c){(function(){var a={}.hasOwnProperty;b.exports=function(){function b(b){var c,d,e,f,g,h,i,j,k;b||(b={}),this.pretty=b.pretty||!1,this.allowEmpty=null!=(d=b.allowEmpty)&&d,this.pretty?(this.indent=null!=(e=b.indent)?e:"  ",this.newline=null!=(f=b.newline)?f:"\n",this.offset=null!=(g=b.offset)?g:0,this.dontprettytextnodes=null!=(h=b.dontprettytextnodes)?h:0):(this.indent="",this.newline="",this.offset=0,this.dontprettytextnodes=0),this.spacebeforeslash=null!=(i=b.spacebeforeslash)?i:"",!0===this.spacebeforeslash&&(this.spacebeforeslash=" "),this.newlinedefault=this.newline,this.prettydefault=this.pretty,j=b.writer||{};for(c in j)a.call(j,c)&&(k=j[c],this[c]=k)}return b.prototype.set=function(b){var c,d,e;b||(b={}),"pretty"in b&&(this.pretty=b.pretty),"allowEmpty"in b&&(this.allowEmpty=b.allowEmpty),this.pretty?(this.indent="indent"in b?b.indent:"  ",this.newline="newline"in b?b.newline:"\n",this.offset="offset"in b?b.offset:0,this.dontprettytextnodes="dontprettytextnodes"in b?b.dontprettytextnodes:0):(this.indent="",this.newline="",this.offset=0,this.dontprettytextnodes=0),this.spacebeforeslash="spacebeforeslash"in b?b.spacebeforeslash:"",
!0===this.spacebeforeslash&&(this.spacebeforeslash=" "),this.newlinedefault=this.newline,this.prettydefault=this.pretty,d=b.writer||{};for(c in d)a.call(d,c)&&(e=d[c],this[c]=e);return this},b.prototype.space=function(a){var b;return this.pretty?(b=(a||0)+this.offset+1,b>0?new Array(b).join(this.indent):""):""},b}()}).call(this)},{}],65:[function(a,b,c){(function(){var c,d,e,f,g,h,i;i=a("./Utility"),g=i.assign,h=i.isFunction,c=a("./XMLDocument"),d=a("./XMLDocumentCB"),f=a("./XMLStringWriter"),e=a("./XMLStreamWriter"),b.exports.create=function(a,b,d,e){var f,h;if(null==a)throw new Error("Root element needs a name");return e=g({},b,d,e),f=new c(e),h=f.element(a),e.headless||(f.declaration(e),null==e.pubID&&null==e.sysID||f.doctype(e)),h},b.exports.begin=function(a,b,e){var f;return h(a)&&(f=[a,b],b=f[0],e=f[1],a={}),b?new d(a,b,e):new c(a)},b.exports.stringWriter=function(a){return new f(a)},b.exports.streamWriter=function(a,b){return new e(a,b)}}).call(this)},{"./Utility":44,"./XMLDocument":54,"./XMLDocumentCB":55,"./XMLStreamWriter":60,"./XMLStringWriter":61}],66:[function(a,b,c){"use strict";function d(b){[a("./nodes/visual/group"),a("./nodes/visual/image"),a("./nodes/visual/rectangle"),a("./nodes/visual/circle"),a("./nodes/visual/text"),a("./nodes/visual/stacklayout"),a("./nodes/visual/flowlayout"),a("./nodes/visual/scrollview"),a("./nodes/visual/htmlcontent"),a("./nodes/visual/cssdefinition"),a("./nodes/counter"),a("./nodes/expression"),a("./nodes/and"),a("./nodes/or"),a("./nodes/switch"),a("./nodes/numberblend"),a("./nodes/stringselector"),a("./nodes/stringmapper"),a("./nodes/drag"),a("./nodes/inverter"),a("./nodes/timer"),a("./nodes/velocity"),a("./nodes/variables/number"),a("./nodes/variables/string"),a("./nodes/variables/boolean"),a("./nodes/variables/color"),a("./nodes/touchposition"),a("./nodes/signaltoindex"),a("./nodes/substring"),a("./nodes/gyroscope"),a("./nodes/reload"),a("./nodes/colorblend"),a("./nodes/globals"),a("./nodes/eventsender"),a("./nodes/eventreceiver"),a("./nodes/screenresolution"),a("./nodes/javascript"),a("./nodes/javascript2"),a("./nodes/animation"),a("./nodes/transition"),a("./nodes/numberremapper"),a("./nodes/websocket"),a("./nodes/componentinputs"),a("./nodes/componentoutputs"),a("./nodes/valuechanged"),a("./nodes/visual/textinput"),a("./nodes/visual/page"),a("./nodes/visual/pages"),a("./nodes/pagenavigation"),a("./nodes/pagenavigationback"),a("./nodes/states"),a("./nodes/stringformat"),a("./nodes/data/foreach"),a("./nodes/data/foreachactions"),a("./nodes/data/modelnode"),a("./nodes/data/collectionnode"),a("./nodes/data/staticdata"),a("./nodes/data/restnode"),a("./nodes/shadernode"),a("./nodes/visual/video"),a("./nodes/sendmessage"),a("./nodes/receivemessage"),a("./nodes/scriptdownloader"),a("./nodes/uniqueid"),a("./nodes/visual/effect"),a("./nodes/applicationevents")].forEach(function(a){b.registerNode(a)})}function e(a){if(!a)return{};for(var b={},c=a.substr(1).split("&"),d=0;d<c.length;d++){var e=c[d].split("=");b[decodeURIComponent(e[0])]=decodeURIComponent(e[1]||"")}return b}function f(a){function b(a,b){if(c.rootComponent){c.rootComponent.nodeScope.getNodesWithIdRecursive(a).forEach(function(a){a.setHighlightEnabled&&a.setHighlightEnabled(b)})}}var c=this;if(a=a||{},f.instance=this,this.frameScheduled=!1,this.rootComponent=null,this._currentLoadedData=null,this.isWaitingForExport=!0,this.graphModel=new l,this.errorHandlers=[],this.runningInEditor=!a.runStandalone,o.instance.setIsRunningInEditor(this.runningInEditor),this.editorConnection=new h,this.editorConnection.on("exportDataFull",function(a){!1===c.patchExportData(a)?(c.isWaitingForExport=!1,!1===x.isEqual(c._currentLoadedData,a)&&c.setData(a)):c.editorConnection.requestFullExport()}),this.editorConnection.on("hoverStart",function(a){b(a,!0)}),this.editorConnection.on("hoverEnd",function(a){b(a,!1)}),this.editorConnection.on("reload",this.reload.bind(this)),this.editorConnection.on("selectNodes",function(a){c.rootComponent&&(c.inspector.clearSelected(),a.forEach(function(a){c.rootComponent.nodeScope.getNodesWithIdRecursive(a).forEach(function(a){c.inspector.selectNode(a._internal.uiControl)})}))}),this.editorConnection.on("selectNode",function(a){if(c.rootComponent){var b=c.rootComponent.nodeScope.getNodesWithIdRecursive(a);c.inspector.multiSelection||c.inspector.clearSelected(),b.forEach(function(a){c.inspector.selectNode(a._internal.uiControl)})}}),this.editorConnection.on("editStart",this.enableInspector.bind(this)),this.editorConnection.on("editEnd",this.disableInspector.bind(this)),this.editorConnection.on("modelUpdate",this.onModelUpdateReceived.bind(this)),this.context=new g({uiEngineClass:t,runningInEditor:this.runningInEditor,editorConnection:this.editorConnection}),this.editorConnection.isRunningLocally()){this.context.setOutputCollectionEnabled(!0);var e=this;this.context.uiEngine.on("rightButtonClick",function(a){e.editorConnection.send({cmd:"showeditmenu",type:"viewer",content:JSON.stringify({insertX:a.x,insertY:a.y,x:a.domEvent.pageX,y:a.domEvent.pageY})})}),this.editorConnection.on("connected",function(){c.sendNodeLibrary()})}this.editorConnection.on("debuggingEnabledChanged",this.context.setOutputCollectionEnabled.bind(this.context)),this.editorConnection.on("captureScreenShot",function(a){c.context.uiEngine.captureScreenShot(a.width,a.height,function(b){a.callback(b)})}),this.context.eventEmitter.on("scheduleFrame",this.scheduleFrame.bind(this)),this.context.eventEmitter.on("reloadApplication",this.reload.bind(this)),this.registerGraphModelListeners(),this._resetData(),d(this);for(var i=0;i<__noodl_modules.length;i++){var j=__noodl_modules[i];if(j.nodes)for(var k=0;k<j.nodes.length;k++){var m=j.nodes[k];m.node||(m={node:m}),this.registerNode(m)}}this.inspector=new v,q.pubsub=new r,q.pubsub.setConnection(this.editorConnection)}var g=a("./nodecontext"),h=a("./editorconnection"),i=a("./nodelibraryexport"),j=a("./projectsettings"),k=a("./projectpatchers"),l=a("./models/graphmodel"),m=a("./nodedefinition"),n=a("./node"),o=a("./fontloader"),p=a("./editormodeleventshandler"),q=a("./services/services"),r=a("./services/pubsub"),s=a("./services/mqtt-connection"),t=a("./uiengine/uiengine"),u=a("./uiengine/renderer"),v=a("./inspector"),w=a("./useragent-utils"),x=(a("./guid"),a("lodash"));f.prototype.registerGraphModelListeners=function(){var a=this;this.graphModel.on("componentAdded",function(b){a.context.registerComponentModel(b)},this),this.graphModel.on("componentRemoved",function(b){a.context.deregisterComponentModel(b)},this),this.graphModel.on("settingsUpdated",function(){a.setViewportSettings(a.graphModel.getDeviceSettings(a.deviceName)),a.sendNodeLibrary()})},f.prototype.reload=function(){this._currentLoadedData&&this.setData(this._currentLoadedData)},f.prototype._resetData=function(){this.frameNumber=0,null!==this.rootComponent&&this.rootComponent.getVisualRoot()&&this.context.uiEngine.root.removeChild(this.rootComponent.getVisualRoot()._internal.uiControl),this.rootComponent=null,this._currentLoadedData=null,this.graphModel.reset(),this.context.reset()},f.prototype.registerNode=function(a){a.node?(this.context.nodeRegister.register(m.defineNode(a.node)),a.setup&&a.setup(this.context,this.graphModel)):this.context.nodeRegister.register(a)},f.prototype.patchExportData=function(a){var b=k.collectPatches(a),c=Object.keys(b),d=j.collectPatch(a.settings),e=this;return!!(c.length>0||d)&&(this.editorConnection.isRunningLocally()&&(c.forEach(function(a){e.editorConnection.sendPatches(b[a])}),d&&e.editorConnection.sendPatches(d)),!0)},f.prototype.setRenderer=function(a,b){var c=this.context.uiEngine;c.removeAllRenderers();w.isMobile.any();!0===b&&document.styleSheets[0].cssRules[0].style.removeProperty("background-color"),"canvas2d"===a?(c.setRendererType(u.TypeCanvas,b),c.imageCache.setCrossOrigin(!1)):"webgl"===a?(c.setRendererType(u.TypeWebGL,b),c.imageCache.setCrossOrigin(!0)):c.setRendererType(u.TypeDOM,b)},f.prototype.setViewportSettings=function(a){this.currentRenderer!==a.renderer&&(this.setRenderer(a.renderer,a.transparent),this.currentRenderer=a.renderer),this.context.uiEngine.setFillMode(a.fillMode),"aspectFit"===a.fillMode&&this.context.uiEngine.setAspectFitViewport(a.canvasWidth,a.canvasHeight)},f.prototype.findMQTTBrokerWithType=function(a){for(var b=0;b<__noodl_modules.length;b++){var c=__noodl_modules[b].mqttBrokers;if(c)for(var d=0;d<c.length;d++){var e=c[d];if(e.id===a)return e}}},f.prototype.showDeviceMenu=function(a){var b=JSON.stringify({settings:{devices:"Default Device","Default.fillMode":"fill","Default.renderer":"canvas2d","Default.rootComponent":"/Main","Default Device.fillMode":"fill","Default Device.canvasWidth":1080,"Default Device.canvasHeight":1920,"Default Device.renderer":"canvas2d"},components:[{name:"/Main",nodes:[{id:"2d3ccd33-f1ef-2dc5-3e1a-ca9d61cd222b",type:"Group",parameters:{fill:"parent"},ports:[],children:[{id:"fa90ea16-1232-0437-deea-5dd6263d8247",type:"Rectangle",parameters:{color:"#222222"},ports:[],children:[]},{id:"84ce46fb-1240-c8b1-6cf8-d49b466af961",type:"Scroll View",parameters:{sizeMode:"explicit",alignX:"left",alignY:"top",clip:!0,paddingTop:50,paddingBottom:50},ports:[],children:[{id:"919460fe-c10e-9656-1924-3b39afe0a908",type:"Text",version:2,parameters:{text:"DEVICE LIST",color:"#F7BC41",fontSize:26,x:30,fontFamily:"fonts/OpenSans-Regular.ttf"},ports:[],children:[]},{id:"01d3bb07-74e9-f7c5-442b-dda6601882b7",type:"Text",version:2,parameters:{text:"Choose a device from the list",color:"#7a7a7a",fontSize:16,x:30,fontFamily:"fonts/OpenSans-Light.ttf"},ports:[],children:[]},{id:"0a2e4207-be74-0e10-e3c7-c53c1f4cd287",type:"Group",version:2,parameters:{height:{value:15,unit:"px"}},ports:[],children:[]},{id:"88e5bc50-f85b-7cfc-61a9-8a8e947a91e0",type:"Stack Layout",parameters:{sizeMode:"childHeight",itemSpacing:5},ports:[],children:[{id:"6fff1cb1-b58c-aafd-8790-951dd51e2230",type:"For Each",parameters:{template:"/Device Item"},ports:[{name:"template",plug:"input",type:"component",displayName:"Component",group:"Appearance",index:3}],children:[]}]}]}]},{id:"23a6c0c0-859b-cf8d-af06-95dba0c57d78",type:"Collection",parameters:{collectionId:"Devices"},ports:[],children:[]},{id:"55b1046f-9c39-c183-7a7e-f7d0a0afd7a3",type:"Static Data",parameters:{csv:"DeviceName\nDevice 1\nMy Other Device\nSome third device"},ports:[{name:"csv",plug:"input",type:{name:"string",codeeditor:"text"},displayName:"CSV",group:"General",index:2}],children:[]}],connections:[{sourceId:"55b1046f-9c39-c183-7a7e-f7d0a0afd7a3",sourcePort:"items",targetId:"23a6c0c0-859b-cf8d-af06-95dba0c57d78",targetPort:"items"},{sourceId:"23a6c0c0-859b-cf8d-af06-95dba0c57d78",sourcePort:"items",targetId:"6fff1cb1-b58c-aafd-8790-951dd51e2230",targetPort:"items"}],ports:[],roots:["2d3ccd33-f1ef-2dc5-3e1a-ca9d61cd222b"]},{name:"/Device Item",nodes:[{id:"ccd8d324-7db3-d669-1099-dd84a0da6cf1",type:"Group",version:2,parameters:{sizeMode:"explicit",height:{value:55,unit:"px"}},ports:[],children:[{id:"73bb365b-38c7-efde-1516-d06c61315551",type:"Rectangle",parameters:{color:"#363637"},ports:[],children:[]},{id:"0e012b10-9938-cedd-cb1d-8f643353367d",type:"Group",version:2,parameters:{sizeMode:"explicit",paddingLeft:30,paddingRight:30},ports:[],children:[{id:"84669e81-f629-9b95-e309-a409ef64ff2e",type:"Text",version:2,parameters:{color:"#f8f8f8",fontFamily:"fonts/OpenSans-Light.ttf",alignX:"left",alignY:"center",sizeMode:"childHeight",fontSize:20},ports:[],children:[]},{id:"7e35cfcb-81a5-14d4-6e30-cf04ff69ec6f",type:"Group",version:2,parameters:{alignY:"center",sizeMode:"childSize",alignX:"right"},ports:[],children:[{id:"7210c16d-d9cf-604f-cd4e-c3014d6487ee",type:"Rectangle",parameters:{height:{value:2,unit:"px"},width:{value:10,unit:"px"},color:"#f8f8f8",rotationZ:45,y:-3},ports:[],children:[]},{id:"5faf645f-3c87-219c-3371-3eeda03986bc",type:"Rectangle",parameters:{height:{value:2,unit:"px"},width:{value:10,unit:"px"},color:"#f8f8f8",rotationZ:-45,y:4},ports:[],children:[]}]}]}]},{id:"26f178df-a067-6a5f-1d93-d146462b9c0b",type:"Model",parameters:{idType:"instance",properties:"DeviceName"},ports:[{type:{name:"*",allowConnectionsOnly:!0},plug:"input/output",group:"Properties",name:"DeviceName",index:7}],children:[]},{id:"28d2af23-0c6e-db12-ad4f-8b5e1099e083",type:"Event Sender",parameters:{channelName:"Device Chosen"},ports:[{name:"DeviceName",plug:"input",type:{name:"*",allowConnectionOnly:!0},index:1}],children:[]},{id:"7b90a527-a414-14b0-497f-ff4bc902f6df",type:"For Each Actions",parameters:{},ports:[],children:[]}],connections:[{sourceId:"26f178df-a067-6a5f-1d93-d146462b9c0b",sourcePort:"DeviceName",targetId:"84669e81-f629-9b95-e309-a409ef64ff2e",targetPort:"text"},{sourceId:"26f178df-a067-6a5f-1d93-d146462b9c0b",sourcePort:"DeviceName",targetId:"28d2af23-0c6e-db12-ad4f-8b5e1099e083",targetPort:"DeviceName"},{sourceId:"ccd8d324-7db3-d669-1099-dd84a0da6cf1",sourcePort:"touch.tap",targetId:"28d2af23-0c6e-db12-ad4f-8b5e1099e083",targetPort:"sendEvent"},{sourceId:"7b90a527-a414-14b0-497f-ff4bc902f6df",sourcePort:"itemId",targetId:"26f178df-a067-6a5f-1d93-d146462b9c0b",targetPort:"modelId"}],ports:[],roots:["ccd8d324-7db3-d669-1099-dd84a0da6cf1"]}],rootComponent:"/Main",rootNode:"2d3ccd33-f1ef-2dc5-3e1a-ca9d61cd222b"});b=b.replace(/fonts\//g,"external/viewer/fonts/"),b=JSON.parse(b),this._currentLoadedData=b,this.graphModel.importEditorData(b),this.graphModel.getComponentWithName("/Main").removeNodeWithId(this.graphModel.getNodesWithType("Static Data")[0].id),this.deviceName="Default Device",this.context.eventSenderEmitter.once("Device Chosen",function(a){window.location=window.location.href+(window.location.search?"&":"?")+"device="+a.DeviceName}),this.editorConnection.close();var c=a.split(",").map(function(a){return{DeviceName:a}}),d=this;this.context.eventEmitter.once("frameStart",function(){d.rootComponent.nodeScope.noodlJavascriptAPI.Collection.get("Devices").set(c)})},f.prototype.setupMQTT=function(a,b){var c=("000000"+(Math.random()*Math.pow(36,6)<<0).toString(36)).slice(-6),d=c+"-"+(b||"Noodl Editor"),e=this;if((!this.mqttConnection||!this.mqttConnection.isConnected())&&(a.mqttUseExternalBroker||this.runningInEditor)){if(this.mqttConnection||(this.mqttConnection=new s),a.mqttUseExternalBroker){var f=a.mqttBrokerUrl;if(a.mqttBrokerType&&"default"!==a.mqttBrokerType){var g=this.findMQTTBrokerWithType(a.mqttBrokerType);f=function(){return g.url(e.graphModel.projectSettings)}}this.mqttConnection.connect({url:f,clientId:d})}else{var h="https:"===location.protocol?"mqtts://":"mqtt://",i="https:"===location.protocol?8444:1884;this.mqttConnection.connect({url:h+location.hostname+":"+i,clientId:d})}q.pubsub.setConnection(this.mqttConnection)}},f.prototype.setData=function(b){var c=this;!1===this.graphModel.isEmpty()&&this._resetData();var d=b.settings.devices&&b.settings.devices.split(",").length>1,f=e(window.location.search);if(!1===this.editorConnection.isRunningLocally()&&d>0&&!f.device)this.showDeviceMenu(b.settings.devices);else{this._currentLoadedData=b,this.graphModel.importEditorData(b);var g=this.graphModel.getSettings();!1===this.runningInEditor&&g.analyticsEnabled&&this.recordSession(this.graphModel.getSettings().analyticsServerUrl);var h=this.graphModel.getDeviceSettings(f.device);this.setupMQTT(g,h.name)}var i,j,h=this.graphModel.getDeviceSettings(f.device);this.deviceName=h.name,this.editorConnection.isRunningLocally()&&!f.device?(i=this.graphModel.rootComponent,j=this.graphModel.rootNode):(i=h.rootComponent||this.graphModel.rootComponent,j=h.rootId),j||(j=this.graphModel.getComponentWithName(i).getFirstRootId()),window.Noodl.PubSub=q.pubsub,window.Noodl.getProjectSettings=function(){return c.graphModel.projectSettings},window.Noodl.Collection=a("./nodes/data/collection"),window.Noodl.Model=a("./nodes/data/model");for(var k=0;k<__noodl_modules.length;k++)"function"==typeof __noodl_modules[k].setup&&__noodl_modules[k].setup();this.rootComponent=this.context.createComponentInstanceNode(i),this.rootComponent.setRoot(j),this.context.setRootComponent(this.rootComponent),this.setViewportSettings(h),x.extend(window.Noodl,this.rootComponent.nodeScope.noodlJavascriptAPI),this.scheduleFrame()},f.prototype.scheduleFrame=function(){this.frameScheduled||(window.requestAnimationFrame(f.prototype._doFrame.bind(this)),this.frameScheduled=!0)},f.prototype._doFrame=function(){this.frameScheduled=!1,this.context.currentFrameTime=window.performance.now(),this.context.eventEmitter.emit("frameStart"),n.numberOfSignalsSentThisFrame=0,n.numberOfQueuedSignalsThisFrame=0,this.context.update(),this.context.layout(),this.context.update(),this.context.uiEngine.renderFrame(),this.context.eventEmitter.emit("frameEnd"),this.frameNumber++},f.prototype.getNodeLibrary=function(){var a=j.generateProjectSettings(this.graphModel.getRawProjectSettings()),b=i(this.context.nodeRegister);return b.projectsettings=a,JSON.stringify(b,null,3)},f.prototype.sendNodeLibrary=function(){var a=this.getNodeLibrary();this.lastSentNodeLibrary!==a&&(this.lastSentNodeLibrary=a,this.editorConnection.send({cmd:"nodelibrary",type:"viewer",content:this.getNodeLibrary()}))},f.prototype.enableInspector=function(){this.inspector.enable(this.context.uiEngine,this.editorConnection,this.rootComponent)},f.prototype.disableInspector=function(){this.inspector.disable()},f.prototype.connectToEditor=function(a){this.editorConnection.connect(a)},f.prototype.onModelUpdateReceived=function(a){this.isWaitingForExport||("projectInstanceChanged"===a.type?(this.context.uiEngine.clearImageCache(),this._resetData(),this.scheduleFrame(),this.isWaitingForExport=!0):p.handleEvent(this.context,this.graphModel,a))},f.prototype.addErrorHandler=function(a){this.errorHandlers.push(a)},f.prototype.reportError=function(a){this.errorHandlers.forEach(function(b){b(a)})},b.exports=f},{"./editorconnection":69,"./editormodeleventshandler":70,"./fontloader":72,"./guid":73,"./inspector":74,"./models/graphmodel":77,"./node":79,"./nodecontext":80,"./nodedefinition":81,"./nodelibraryexport":82,"./nodes/and":84,"./nodes/animation":85,"./nodes/applicationevents":86,"./nodes/colorblend":87,"./nodes/componentinputs":88,"./nodes/componentoutputs":90,"./nodes/counter":91,"./nodes/data/collection":92,"./nodes/data/collectionnode":93,"./nodes/data/foreach":94,"./nodes/data/foreachactions":95,"./nodes/data/model":96,"./nodes/data/modelnode":97,"./nodes/data/restnode":99,"./nodes/data/staticdata":100,"./nodes/drag":101,"./nodes/eventreceiver":102,"./nodes/eventsender":103,"./nodes/expression":104,"./nodes/globals":105,"./nodes/gyroscope":106,"./nodes/inverter":107,"./nodes/javascript":108,"./nodes/javascript2":109,"./nodes/numberblend":110,"./nodes/numberremapper":111,"./nodes/or":112,"./nodes/pagenavigation":113,"./nodes/pagenavigationback":114,"./nodes/receivemessage":115,"./nodes/reload":116,"./nodes/screenresolution":117,"./nodes/scriptdownloader":118,"./nodes/sendmessage":119,"./nodes/shadernode":120,"./nodes/signaltoindex":121,"./nodes/states":122,"./nodes/stringformat":123,"./nodes/stringmapper":124,"./nodes/stringselector":125,"./nodes/substring":126,"./nodes/switch":127,"./nodes/timer":128,"./nodes/touchposition":129,"./nodes/transition":130,"./nodes/uniqueid":131,"./nodes/valuechanged":132,"./nodes/variables/boolean":133,"./nodes/variables/color":134,"./nodes/variables/number":135,"./nodes/variables/string":136,"./nodes/velocity":138,"./nodes/visual/circle":139,"./nodes/visual/cssdefinition":140,"./nodes/visual/effect":141,"./nodes/visual/flowlayout":142,"./nodes/visual/group":143,"./nodes/visual/htmlcontent":144,"./nodes/visual/image":145,"./nodes/visual/page":147,"./nodes/visual/pages":148,"./nodes/visual/rectangle":149,"./nodes/visual/scrollview":151,"./nodes/visual/stacklayout":152,"./nodes/visual/text":153,"./nodes/visual/textinput":154,"./nodes/visual/video":156,"./nodes/websocket":158,"./projectpatchers":162,"./projectsettings":163,"./services/mqtt-connection":164,"./services/pubsub":165,"./services/services":166,"./uiengine/renderer":196,"./uiengine/uiengine":222,"./useragent-utils":223,lodash:12}],67:[function(a,b,c){"use strict";var d={easeOutQuartic:function(a,b,c){return c--,-(b-a)*(c*c*c*c-1)+a},easeInQuartic:function(a,b,c){return c*c*c*c*(b-a)+a},easeInOutQuartic:function(a,b,c){return(c*=2)<1?(b-a)/2*c*c*c*c+a:(c-=2,-(b-a)/2*(c*c*c*c-2)+a)},easeOutCubic:function(a,b,c){return c--,(b-a)*(c*c*c+1)+a},easeInCubic:function(a,b,c){return c*c*c*(b-a)+a},easeInOutCubic:function(a,b,c){return(c*=2)<1?(b-a)/2*c*c*c+a:(c-=2,(b-a)/2*(c*c*c+2)+a)},easeOutQuadratic:function(a,b,c){return-(b-a)*c*(c-2)+a},easeInQuadratic:function(a,b,c){return c*c*(b-a)+a},easeInOutQuadratic:function(a,b,c){return(c*=2)<1?(b-a)/2*c*c+a:(c-=1,-(b-a)/2*(c*(c-2)-1)+a)},linear:function(a,b,c){return a+(b-a)*c}};d.easeIn=d.easeInCubic,d.easeOut=d.easeOutCubic,d.easeInOut=d.easeInOutCubic,b.exports=d},{}],68:[function(a,b,c){"use strict";function d(a){var b=!1;return function(c){c=!!c,c&&!1===b&&a.valueChangedToTrue.call(this),b=c}}b.exports={createSetter:d}},{}],69:[function(a,b,c){"use strict";function d(a){var b=a||{};e.call(this),this.ws=a&&a.webSocketClass||WebSocket,this.reconnectOnClose=!0,this.forceDebugger=b.forceDebugger||"undefined"!=typeof document&&-1!==document.location.href.indexOf("forceDebugger=true")}var e=a("./eventsender"),f=a("./services/services"),g=a("./guid");d.prototype=Object.create(e.prototype),d.prototype.constructor=d,d.prototype.isRunningLocally=function(){return"undefined"!=typeof document&&("localhost"===document.location.hostname||"127.0.0.1"===document.location.hostname)},d.prototype.connect=function(a){this.socket=new this.ws(a);var b=this;this.socket.addEventListener("open",function(){b.clientId=g(),b.socket.send(JSON.stringify({cmd:"register",type:"viewer",clientId:b.clientId})),b.emit("connected")}),this.socket.addEventListener("close",function(){b.reconnectOnClose&&b.reconnect(a),b.emit("connectionClosed")}),this.socket.addEventListener("error",function(c){console.log("Editor connection error, trying to reconnect"),b.reconnect(a)}),this.socket.addEventListener("message",function(a){var c,d=JSON.parse(a.data);"registered"===d.cmd||("export"===d.cmd?(c=JSON.parse(d.content),"full"===d.type&&b.emit("exportDataFull",c)):"selectNode"===d.cmd?b.emit("selectNode",d.content.id):"selectNodes"===d.cmd?b.emit("selectNodes",d.content.ids):"hoverStart"===d.cmd?b.emit("hoverStart",d.content.id):"hoverEnd"===d.cmd?b.emit("hoverEnd",d.content.id):"requestAlign"===d.cmd?b.emit("requestAlign",d.content.mode):"refresh"===d.cmd?b.emit("reload"):"editStart"===d.cmd?b.emit("editStart"):"editEnd"===d.cmd?b.emit("editEnd"):"editMultipleSelectionStart"===d.cmd?b.emit("editMultipleSelectionStart"):"editMultipleSelectionEnd"===d.cmd?b.emit("editMultipleSelectionEnd"):"capture"===d.cmd?b.isRunningLocally()&&(c=JSON.parse(d.content),b.sendThumbnailCapture(c.width,c.height)):"connectionInspectors"===d.cmd?(b.isRunningLocally()||b.forceDebugger)&&(c=JSON.parse(d.content),b.emit("connectionInspectorsUpdated",c.connectionsToInspect)):"debuggingEnabled"===d.cmd?(b.isRunningLocally()||b.forceDebugger)&&(c=JSON.parse(d.content),b.emit("debuggingEnabledChanged",c.enabled)):"modelUpdate"===d.cmd?b.emit("modelUpdate",d.content):"publish"===d.cmd?f.pubsub.routeMessage(d):console.log("Command not implemented",d))})},d.prototype.reconnect=function(a){var b=this;setTimeout(function(){b.connect(a)},2e3)},d.prototype.isConnected=function(){return void 0!==this.socket&&this.socket.readyState===this.ws.OPEN},d.prototype.send=function(a){!1!==this.isConnected()&&this.socket.send(JSON.stringify(a))},d.prototype.sendPulsingConnections=function(a){var b=[];Object.keys(a).forEach(function(c){var d=a[c];b=b.concat(d.connections)}),this.send({cmd:"connectiondebugpulse",type:"viewer",content:JSON.stringify({connectionsToPulse:b})})},d.prototype.sendConnectionValues=function(a){this.send({cmd:"connectionvalue",type:"viewer",content:JSON.stringify({connections:a})})},d.prototype.sendDynamicPorts=function(a,b,c){this.send({cmd:"instanceports",type:"viewer",content:JSON.stringify({nodeid:a,ports:b,options:c})})},d.prototype.sendThumbnailCapture=function(a,b){var c=this;this.emit("captureScreenShot",{width:a,height:b,callback:function(a){a&&c.send({cmd:"captured",type:"viewer",content:JSON.stringify({data:a})})}})},d.prototype.sendWarning=function(a,b,c,d){this.send({cmd:"showwarning",type:"viewer",content:JSON.stringify({componentName:a,nodeId:b,key:c,warning:d})})},d.prototype.clearWarnings=function(a,b){this.send({cmd:"clearwarnings",type:"viewer",content:JSON.stringify({componentName:a,nodeId:b})})},d.prototype.sendPatches=function(a){this.send({cmd:"patchproject",type:"viewer",content:JSON.stringify(a)})},d.prototype.requestFullExport=function(){this.send({cmd:"register",type:"viewer"})};var h={};d.prototype.sendServiceRequest=function(a,b){a.token=g(),a.clientId=this.clientId,h[a.token]=b,this.send(a)},d.prototype.close=function(){this.reconnectOnClose=!1,!1!==this.isConnected()&&this.socket.close()},b.exports=d},{"./eventsender":71,"./guid":73,"./services/services":166}],70:[function(a,b,c){"use strict";function d(a,b,c){function d(b,c){var d={},f={};c.forEach(function(a){a&&"outputs"===a.plug&&(a.plug="output"),"input"!==a.plug&&"input/output"!==a.plug||(d[a.name]=a),"output"!==a.plug&&"input/output"!==a.plug||(f[a.name]=a)});var h=Object.keys(b.getInputPorts()),i=e.difference(h,Object.keys(d)),j=e.difference(Object.keys(d),h);i.forEach(b.removeInputPortWithName.bind(b)),j.forEach(function(c){b.addInputPort(d[c]),b.parameters&&b.parameters.hasOwnProperty(c)&&g(a.rootComponent.nodeScope,b,c,b.parameters[c])});var k=Object.keys(b.getOutputPorts()),l=e.difference(k,Object.keys(f)),m=e.difference(Object.keys(f),k);l.forEach(b.removeOutputPortWithName.bind(b)),m.forEach(function(a){b.addOutputPort(f[a])})}function f(a,b,c){if(!1!==a.hasNode(b)){var d=a.getNodeMetadata(b),e=d.inputs[c];if(e)return e.type.defaultUnit?{value:e.default,unit:e.type.defaultUnit}:e.default}}function g(a,b,c,d){a.getNodesWithIdRecursive(b.id).forEach(function(a){a.queueInput(c,d)})}var h;c.componentName&&(h=b.getComponentWithName(c.componentName)),c.port&&"outputs"===c.port.plug&&(c.port.plug="output");var i={nodeAdded:function(a){h.importEditorNodeData(a.model,a.parentId,a.childIndex)},nodeRemoved:function(a){h.removeNodeWithId(a.model.id)},connectionAdded:function(a){h.addConnection(a.model)},connectionRemoved:function(b){h.removeConnection(b.model);var c=h.getNodeWithId(b.model.targetId);if(0===h.getConnectionsToPort(c.id,b.model.targetId).length){var d=c.parameters[b.model.targetPort];void 0===d&&(d=f(a.nodeRegister,c.type,b.model.targetPort)),g(a.rootComponent.nodeScope,c,b.model.targetPort,d)}},multipleParametersChanged:function(b){var c=h.getNodeWithId(b.nodeId);if(void 0===c)return void console.log("parameterChanged: Unkown node id",b);b.parameters.forEach(function(b){var d=b.value;void 0===d&&(d=f(a.nodeRegister,c.type,b.name)),c.setParameter(b.name,d)})},parameterChanged:function(b){var c=h.getNodeWithId(b.nodeId);if(void 0===c)return void console.log("parameterChanged: Unkown node id",b);var d=b.parameterValue;void 0===d&&(d=f(a.nodeRegister,c.type,b.parameterName)),c.setParameter(b.parameterName,d)},nodeAttached:function(a){h.setNodeParent(h.getNodeWithId(a.nodeId),h.getNodeWithId(a.parentId),a.childIndex)},nodeDetached:function(a){h.setNodeParent(h.getNodeWithId(a.nodeId),null)},componentAdded:function(a){b.importComponentFromEditorData(a.model)},componentRemoved:function(a){b.removeComponentWithName(a.componentName)},rootAdded:function(a){h.addRootId(a.nodeId)},portAdded:function(b){var c=h.getNodeWithId(b.nodeId);"input"!==b.port.plug&&"input/output"!==b.port.plug||(c.addInputPort(b.port),c.parameters.hasOwnProperty(b.port)&&g(a.rootComponent.nodeScope,c,b.port,c.parameters[b.port])),"output"!==b.port.plug&&"input/output"!==b.port.plug||c.addOutputPort(b.port)},portRemoved:function(a){var b=h.getNodeWithId(a.nodeId);"input"!==a.port.plug&&"input/output"!==a.port.plug||b.removeInputPortWithName(a.port.name),"output"!==a.port.plug&&"input/output"!==a.port.plug||b.removeOutputPortWithName(a.port.name)},nodePortRenamed:function(a){"input"!==a.port.plug&&"input/output"!==a.port.plug||h.renameInputPortOnNodeWithId(a.nodeId,a.oldName,a.port.name),"output"!==a.port.plug&&"input/output"!==a.port.plug||h.renameOutputPortOnNodeWithId(a.nodeId,a.oldName,a.port.name);var c=h.getNodeWithId(a.nodeId);"Component Inputs"===c.type?(h.addInputPort(a.port),b.getNodesWithType(h.name).forEach(function(b){b.component.renameInputPortOnNodeWithId(b.id,a.oldName,a.port.name)}),h.removeInputPortWithName(a.oldName)):"Component Outputs"===c.type&&(h.addOutputPort(a.port),b.getNodesWithType(h.name).forEach(function(b){b.component.renameOutputPortOnNodeWithId(b.id,a.oldName,a.port.name)}),h.removeOutputPortWithName(a.oldName))},componentPortsUpdated:function(a){d(h,a.ports)},instancePortsChanged:function(a){d(h.getNodeWithId(a.nodeId),a.ports)},componentRenamed:function(a){b.renameComponent(a.oldName,a.newName)},settingsChanged:function(a){b.setSettings(a.settings)}};i.hasOwnProperty(c.type)?(i[c.type](c),a.scheduleFrame()):console.log("Unknown event",c)}var e=a("lodash");b.exports={handleEvent:d}},{lodash:12}],71:[function(a,b,c){"use strict";function d(){this.listeners={},this.numListeners={}}var e=a("lodash");d.prototype.on=function(a,b,c){this.listeners.hasOwnProperty(a)||(this.listeners[a]=[],this.numListeners[a]=0),this.listeners[a].push({callback:b,ref:c}),++this.numListeners[a]>1e3&&console.trace("too many events",a,this.numListeners[a])},d.prototype.removeListenersWithRef=function(a){var b=this.numListeners;e.forIn(this.listeners,function(c,d){var f=e.remove(c,function(b){return b.ref===a});b[d]-=f.length})},d.prototype.removeAllListeners=function(a){a?(delete this.listeners[a],delete this.numListeners[a]):(this.listeners={},this.numListeners={})},d.prototype.emit=function(a,b){var c=this.listeners[a];c&&c.forEach(function(a){a.callback.call(a.ref,b)})},b.exports=d},{lodash:12}],72:[function(a,b,c){"use strict";function d(){this.loadedFontFamilies={},this.fontCssFamiliesAdded={},this.fontCallbacks={};var a=this;["Arial","Arial Black","Courier New","Helvetica","Impact","Lucida Console","Tahoma","Times New Roman"].forEach(function(b){a.loadedFontFamilies[b]=!0})}function e(a){return a.replace(/\.[^\/.]+$/,"")}var f=a("webfontloader");d.prototype.setIsRunningInEditor=function(a){this.isRunningInEditor=a},d.prototype.loadFont=function(a){var b=e(a).split("/").pop();if(this.loadedFontFamilies[b])return void(this.fontCallbacks[b]&&this.fontCallbacks[b].forEach(function(a){a()}));if(!this.fontCssFamiliesAdded[b]){this.fontCssFamiliesAdded[b]=!0;var c=document.createElement("style");c.type="text/css",this.isRunningInEditor&&"/"!==a[0]&&(a="/"+a),c.appendChild(document.createTextNode("                    @font-face {                        font-family: '"+b+"';                        src: url('"+a+"');                    }                ")),document.head.appendChild(c);var d=this;f.load({timeout:6e5,custom:{families:[b]},fontactive:function(a){d.loadedFontFamilies[a]=!0,d.fontCallbacks[a]&&d.fontCallbacks[a].forEach(function(a){a()})}})}},d.prototype.callWhenFontIsActive=function(a,b){if(this.loadedFontFamilies[a])return void b();this.fontCallbacks[a]||(this.fontCallbacks[a]=[]),this.fontCallbacks[a].push(b)},d.instance=new d,b.exports=d},{webfontloader:37}],73:[function(a,b,c){function d(){function a(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}return a()+a()+"-"+a()+"-"+a()+"-"+a()+"-"+a()+a()+a()}b.exports=d},{}],74:[function(a,b,c){"use strict";function d(){this.mouseMoveListener=this._onMouseMove.bind(this),this.mouseDownListener=this._onMouseDown.bind(this),this.mouseUpListener=this._onMouseUp.bind(this),this.cycleIndex=0,this.multiHighlighted={},this.editorConnection=void 0,this.focusedSelectedControl=void 0,
this.selectedControls=[],this.multiSelection=!1,this.resizeMode="none",this.isDragging=!1,this.dragDistance=0,this.highlightedControl=void 0}function e(a,b){return a-b}function f(a){if(a.parent&&a.parent.layoutRect&&a.layoutRect){var b=a.parent.layoutRect,c=a.layoutRect;return b.x>=c.x&&b.y>=c.y&&b.width<=c.width&&b.height<=c.height&&0===a.parent.children.indexOf(a)}return!1}function g(a){return i.some(function(b){return a instanceof b})&&!f(a)}var h=a("./uiengine/math/aabb"),i=(a("./nodes/visual/group"),[a("./uiengine/controls/circlecontrol"),a("./uiengine/controls/imagecontrol"),a("./uiengine/controls/rectanglecontrol"),a("./uiengine/controls/textcontrol"),a("./uiengine/controls/textinputcontrol"),a("./uiengine/controls/htmlcontrol")]);d.prototype.getHitTestBox=function(a){var b=this.positionFromEvent(a),c=Math.min(b[0],this.multiDragStart[0]),d=Math.min(b[1],this.multiDragStart[1]),e=Math.max(b[0],this.multiDragStart[0]),f=Math.max(b[1],this.multiDragStart[1]);return h.createFrom(c,d,e,f)},d.prototype.selectFromMultiBox=function(a){var b=this.getHitTestBox(a),c=this.uiEngine.hitTestBox(b),d=Object.keys(c);d.sort(e);for(var f=!1,h=d.length-1;h>=0&&!1===f;h--)for(var i=c[d[h]],j=i.length-1;j>=0;j--)g(i[j])&&!this.nodeIsAmongSelected(i[j])&&(this.selectNode(i[j]),this.sendToEditor("select",{id:i[j].noodlNode.id,singleSelect:!1}))},d.prototype.highlightFromMultiBox=function(a){var b=this.getHitTestBox(a),c=this.uiEngine.hitTestBox(b),d=Object.keys(c);d.sort(e);for(var f=!1,h={},i=Object.keys(this.multiHighlighted),j=d.length-1;j>=0&&!1===f;j--)for(var k=c[d[j]],l=k.length-1;l>=0;l--)g(k[l])&&!this.nodeIsAmongSelected(k[l])&&(h[k[l].id]=k[l],this.multiHighlighted[k[l].id]=k[l],k[l].setHighlightEnabled(!0));for(var l=0;l<i.length;l++){var m=i[l];if(!h.hasOwnProperty(m)){this.multiHighlighted[m].setHighlightEnabled(!1),delete this.multiHighlighted[m]}}},d.prototype.clearHighlightedBox=function(){for(var a=Object.keys(this.multiHighlighted),b=0;b<a.length;b++){var c=a[b],d=this.multiHighlighted[c];d!==this.highlightedControl&&d.setHighlightEnabled(!1)}this.multiHighlighted={}},d.prototype.setHighlightedControl=function(a){var b=this.positionFromEvent(a),c=null,d=null,f=this.cycleIndex;if(this.focusedSelectedControl){if(0==f&&h.isPointInside(this.focusedSelectedControl.extendedScreenAABB,b))return this.highlightedControl&&this.highlightedControl!==this.focusedSelectedControl&&this.highlightedControl.setHighlightEnabled(!1),void(this.highlightedControl=this.focusedSelectedControl);c=this.focusedSelectedControl.screenAABB,this.focusedSelectedControl.screenAABB=this.focusedSelectedControl.extendedScreenAABB,d=this.focusedSelectedControl.childAABB,this.focusedSelectedControl.childAABB&&(this.focusedSelectedControl.childAABB=this.focusedSelectedControl.extendedScreenAABB)}var i=this.uiEngine.hitTest(b[0],b[1]);this.focusedSelectedControl&&(this.focusedSelectedControl.screenAABB=c,this.focusedSelectedControl.childAABB=d),this.highlightedControl&&(this.highlightedControl.setHighlightEnabled(!1),this.highlightedControl=void 0);var j=Object.keys(i);j.sort(e);for(var k=!1,l=void 0,m=j.length-1;m>=0&&!1===k;m--)for(var n=i[j[m]],o=n.length-1;o>=0;o--)if(g(n[o])){if(l||(l=n[o]),f>0){f--;continue}this.highlightedControl=n[o],this.highlightedControl.setHighlightEnabled(!0),k=!0;break}!k&&l&&(this.cycleIndex=0,this.highlightedControl=l,this.highlightedControl.setHighlightEnabled(!0))},d.prototype.updateDragging=function(a,b){var c=this.positionFromEvent(a),d=c[0]-this.dragLastPos[0],e=c[1]-this.dragLastPos[1];this.dragDistance+=Math.abs(d)+Math.abs(e);for(var f={type:this.resizeMode,phase:b,nodes:[]},g=0;g<this.selectedControls.length;g++){var h=this.selectedControls[g],i=d,j=e;if(h&&"move"!==this.resizeMode&&h.parent){if("%"===h.widthUnit){i=d/h.parent.layoutRect.width*100}if("%"===h.heightUnit){j=e/h.parent.layoutRect.height*100}}f.nodes.push({id:h.noodlNode.id,delta:[d,e,i,j]})}this.sendToEditor("resizenodes",f),this.dragLastPos=c},d.prototype.sendToEditor=function(a,b){this.editorConnection&&this.editorConnection.send({cmd:a,type:"viewer",content:JSON.stringify(b)})},d.prototype.updateMultiDragControl=function(a){var b=this.positionFromEvent(a),c=Math.min(b[0],this.multiDragStart[0]),d=Math.min(b[1],this.multiDragStart[1]),e=Math.max(b[0],this.multiDragStart[0]),f=Math.max(b[1],this.multiDragStart[1]);this.multiDragControl.setPositionX(c),this.multiDragControl.setPositionY(d),this.multiDragControl.setWidth(e-c),this.multiDragControl.setHeight(f-d)},d.prototype._onMouseMove=function(a){var b=this.positionFromEvent(a);if(this.lastMousePos=b,this.isMultiDragging&&(this.updateMultiDragControl(a),this.highlightFromMultiBox(a)),this.isDragging)return void this.updateDragging(a,"move");this.selectedControls.length>0&&this.useForEditing&&this.updateCursorAndResizeArea(a),this.setHighlightedControl(a)},d.prototype.positionFromEvent=function(a){return[this._getTouchX(a)*this.uiEngine.renderer.viewportWidth,this._getTouchY(a)*this.uiEngine.renderer.viewportHeight]},d.prototype.updateCursorAndResizeArea=function(a){if(0!==this.selectedControls.length){var b=this.positionFromEvent(a);this.focusedSelectedControl=void 0;for(var c=0;c<this.selectedControls.length;c++){var d=this.selectedControls[c],e=d.layoutRect,f=Math.min(40,Math.min(e.width,e.height)/4),g=h.create(),i=h.create(),j=h.create(),k=h.create();h.copy(g,d.screenAABB),h.copy(i,d.screenAABB),h.copy(j,d.screenAABB),h.copy(k,d.screenAABB);var l=h.create();h.copy(l,d.screenAABB),l.min[0]-=f/2,l.min[1]-=f/2,l.max[0]+=f/2,l.max[1]+=f/2,d.extendedScreenAABB=l,g.min[0]-=f/2,g.min[1]-=f/2,g.max[0]=g.min[0]+f,g.max[1]=g.min[1]+f,i.min[0]+=e.width-f/2,i.min[1]-=f/2,i.max[0]=i.min[0]+f,i.max[1]=i.min[1]+f,j.min[0]+=e.width-f/2,j.min[1]+=e.height-f/2,j.max[0]=j.min[0]+f,j.max[1]=j.min[1]+f,k.min[0]-=f/2,k.min[1]+=e.height-f/2,k.max[0]=k.min[0]+f,k.max[1]=k.min[1]+f;var m=h.createFrom(g.max[0],g.min[1],i.min[0],g.max[1]),n=h.createFrom(i.min[0],i.max[1],i.max[0],j.min[1]),o=h.createFrom(k.max[0],k.min[1],j.min[0],j.max[1]),p=h.createFrom(g.min[0],g.max[1],g.max[0],k.min[1]),q="auto";if(h.isPointInside(l,b)){var r=d.sizeMode||"explicit",s="explicit"===r||"childHeight"===r,t="explicit"===r||"childWidth"===r;h.isPointInside(g,b)&&s&&t?(q="nwse-resize",this.resizeMode="expandTopLeft"):h.isPointInside(i,b)&&s&&t?(q="nesw-resize",this.resizeMode="expandTopRight"):h.isPointInside(j,b)&&s&&t?(q="nwse-resize",this.resizeMode="expandBottomRight"):h.isPointInside(k,b)&&s&&t?(q="nesw-resize",this.resizeMode="expandBottomLeft"):h.isPointInside(m,b)&&t?(q="ns-resize",this.resizeMode="expandTop"):h.isPointInside(n,b)&&s?(q="ew-resize",this.resizeMode="expandRight"):h.isPointInside(o,b)&&t?(q="ns-resize",this.resizeMode="expandBottom"):h.isPointInside(p,b)&&s?(q="ew-resize",this.resizeMode="expandLeft"):(q="move",this.resizeMode="move"),this.focusedSelectedControl=d,document.body.style.cursor=q;break}document.body.style.cursor="auto",document.body.style.cursor=q}}},d.prototype.startDragging=function(a){this.isDragging=!0,this.dragLastPos=this.positionFromEvent(a),this.updateDragging(a,"enter")},d.prototype.sendRoundValues=function(){for(var a={type:"roundValues",phase:"exit",nodes:[]},b=0;b<this.selectedControls.length;b++){var c=this.selectedControls[b];a.nodes.push({type:"roundValues",phase:"exit",id:c.noodlNode.id,delta:[0,0]})}this.sendToEditor("resizenodes",a)},d.prototype.clearSelected=function(){for(var a=0;a<this.selectedControls.length;a++){this.selectedControls[a].setSelectionEnabled(!1)}this.selectedControls=[]},d.prototype.selectNode=function(a){if(this.uiEngine){var b=this.rootComponent.nodeScope.getNodesWithIdRecursive(a.noodlNode.id),c=this;b.forEach(function(a){for(var b=a._internal.uiControl,d=0;d<c.selectedControls.length;d++)if(b===c.selectedControls[d])return;b.setSelectionEnabled(!0),c.selectedControls.push(b)})}},d.prototype.deselectNode=function(a){if(this.uiEngine){var b=this;this.rootComponent.nodeScope.getNodesWithIdRecursive(a.noodlNode.id).forEach(function(a){var c=a._internal.uiControl,d=b.selectedControls.indexOf(c);-1!==d&&b.selectedControls.splice(d,1),c.setSelectionEnabled(!1),b.sendToEditor("deselect",{id:c.noodlNode.id})})}},d.prototype.setMultipleSelectionEnabled=function(a){this.multiSelection=a},d.prototype.nodeIsAmongSelected=function(a){for(var b=0;b<this.selectedControls.length;b++){if(this.selectedControls[b]===a)return!0}return!1},d.prototype._onMouseUp=function(a){if(0===a.button&&this.nodeIsAmongSelected(this.highlightedControl)&&this.dragDistance<10){if(!this.multiSelection&&this.selectedControls.length>1)this.cycleIndex=0,this.clearSelected(),this.selectNode(this.highlightedControl),this.sendToEditor("select",{id:this.highlightedControl.noodlNode.id,singleSelect:!0});else if(this.multiSelection&&this.highlightedControl!==this.lastSelectedNode){var b=this.highlightedControl;this.deselectNode(this.highlightedControl),this.cycleIndex++,this.setHighlightedControl(a),this.highlightedControl!==b?(this.selectNode(this.highlightedControl),this.sendToEditor("select",{id:this.highlightedControl.noodlNode.id,singleSelect:!0})):this.cycleIndex=0}else this.cycleIndex=0;this.lastSelectedNode=null}else this.cycleIndex=0;if(this.isMultiDragging){var c=this.positionFromEvent(a),d=c[0]-this.multiDragStart[0],e=c[1]-this.multiDragStart[1];Math.sqrt(d*d+e*e)>10&&this.selectFromMultiBox(a),this.clearHighlightedBox(),this.uiEngine.setOverlayNode(null),this.isMultiDragging=!1}this.isDragging=!1,this.dragDistance=null,this.sendRoundValues()},d.prototype._onMouseDown=function(a){var b=this.positionFromEvent(a);if(2===a.button){var c=null;this.highlightedControl&&(c=this.highlightedControl.noodlNode.id),this.sendToEditor("showeditmenu",{x:a.pageX,y:a.pageY,insertX:b[0],insertY:b[1],sourceNode:c})}else this.sendToEditor("hideeditmenu",{});if(0===a.button&&this.highlightedControl)this.nodeIsAmongSelected(this.highlightedControl)||(this.multiSelection||this.clearSelected(),this.selectNode(this.highlightedControl),this.sendToEditor("select",{id:this.highlightedControl.noodlNode.id,singleSelect:!1}),this.lastSelectedNode=this.highlightedControl),this.isDragging=!1,this.setHighlightedControl(a),this.updateCursorAndResizeArea(a),this.startDragging(a);else if(0===a.button){var d=this;this.selectedControls.forEach(function(a){a.setSelectionEnabled(!1),d.sendToEditor("deselect",{id:a.noodlNode.id})}),this.isDragging=!1,this.lastSelectedNode=null,this.selectedControls=[]}0===a.button&&this.multiSelection&&!this.isDragging&&(this.multiDragStart=this.positionFromEvent(a),this.isMultiDragging=!0,this.uiEngine.setOverlayNode(this.multiDragControl),this.updateMultiDragControl(a)),this.dragDistance=0},d.prototype.requestAlign=function(a){var b;if("left"===a||"centerHorizontal"===a||"right"===a){for(var c=0,d=Number.MAX_VALUE,e=Number.NEGATIVE_INFINITY,f=0;f<this.selectedControls.length;f++){var g=this.selectedControls[f];d=Math.min(d,g.layoutRect.x),c+=g.layoutRect.x+g.layoutRect.width/2,e=Math.max(e,g.layoutRect.x+g.layoutRect.width)}var h;h="left"===a?d:"right"===a?e:c/this.selectedControls.length,b=this.selectedControls.map(function(b){var c=b.layoutRect.x-h;return"right"===a?c+=b.layoutRect.width:"centerHorizontal"===a&&(c+=b.layoutRect.width/2),{id:b.noodlNode.id,x:Math.round(b.positionX-c),y:b.positionY}})}else{for(var i=0,j=Number.MAX_VALUE,k=Number.NEGATIVE_INFINITY,f=0;f<this.selectedControls.length;f++){var g=this.selectedControls[f];j=Math.min(j,g.layoutRect.y),i+=g.layoutRect.y+g.layoutRect.height/2,k=Math.max(k,g.layoutRect.y+g.layoutRect.height)}var l;l="top"===a?j:"bottom"===a?k:i/this.selectedControls.length,b=this.selectedControls.map(function(b){var c=b.layoutRect.y-l;return"bottom"===a?c+=b.layoutRect.height:"centerVertical"===a&&(c+=b.layoutRect.height/2),{id:b.noodlNode.id,x:b.positionX,y:Math.round(b.positionY-c)}})}this.sendToEditor("alignnodes",b)},d.prototype._getTouchX=function(a){return this.uiEngine?this.uiEngine.touchListener.getTouchX(a):0},d.prototype._getTouchY=function(a){return this.uiEngine?this.uiEngine.touchListener.getTouchY(a):0},d.prototype.enable=function(a,b,c){this.uiEngine=a,this.rootComponent=c,this.cycleIndex=0,this.multiDragControl||(this.multiDragControl=a.createRectangleControl(),this.multiDragControl.setColor("#33333"),this.multiDragControl.setSizeMode("explicit"),this.multiDragControl.setWidthUnit("px"),this.multiDragControl.setHeightUnit("px"),this.multiDragControl.setWidth(150),this.multiDragControl.setHeight(176),this.multiDragControl.setOpacity(.2),this.multiDragControl.setDepth(Number.MAX_VALUE)),this.uiEngine.touchListener.setTouchInterceptCallbacks(this.mouseMoveListener,this.mouseDownListener,this.mouseUpListener),this.editorConnection=b,this.useForEditing=!0,this.editorConnection.on("requestAlign",this.requestAlign.bind(this),this);var d=this;this.editorConnection.on("editMultipleSelectionStart",function(){d.setMultipleSelectionEnabled(!0)}),this.editorConnection.on("editMultipleSelectionEnd",function(){d.setMultipleSelectionEnabled(!1)},this),this.clearSelected(),void 0!==this.uiEngine.touchListener.lastMouseMove&&this._onMouseMove(this.uiEngine.touchListener.lastMouseMove)},d.prototype.disable=function(){this.editorConnection&&this.editorConnection.removeListenersWithRef(this),this.uiEngine&&(this.uiEngine.touchListener.setTouchInterceptCallbacks(void 0,void 0,void 0),this.editorConnection=void 0,this.lastSelectedNode=void 0,this.rootComponent=void 0,this.highlightedControl&&(this.highlightedControl.setHighlightEnabled(!1),this.highlightedControl=void 0),this.uiEngine.setOverlayNode(null),this.clearHighlightedBox(),this.isMultiDragging=!1,this.clearSelected(),this.focusedSelectedControl=void 0,document.body.style.cursor="auto",this.uiEngine=void 0)},b.exports=d},{"./nodes/visual/group":143,"./uiengine/controls/circlecontrol":169,"./uiengine/controls/htmlcontrol":173,"./uiengine/controls/imagecontrol":175,"./uiengine/controls/rectanglecontrol":178,"./uiengine/controls/textcontrol":183,"./uiengine/controls/textinputcontrol":184,"./uiengine/math/aabb":193}],75:[function(a,b,c){"use strict";function d(a,b){this.inputs={},this.outputs={},this.error=void 0;var c=f[a];if(!c)try{c=new Function("define","Noodl",a),f[a]=c}catch(e){this.error=e.message}if(c)try{c(this.define.bind(this),b)}catch(e){this.error=e.message}}var f={};d.prototype.define=function(a){this.inputs=a.inputs||{},this.outputs=a.outputs||{},this.setup=a.setup,this.run=a.run,this.destroy=a.destroy,this.definedObject=a},d.createFromCode=function(a,b){return new d(a,b)},d.createFromURL=function(a,b,c){var e=new window.XMLHttpRequest;e.open("GET",a,!0),e.onreadystatechange=function(){4!==this.readyState&&this.readyState!==XMLHttpRequest.DONE||c(new d(this.response,b))},e.onerror=function(){console.log("Failed to request",a)},e.send()},d.prototype.getPorts=function(){var a=[],b=this;return Object.keys(this.inputs).forEach(function(c){var d=b.inputs[c],e={name:c,plug:"input"};if("string"==typeof d)e.type={name:d},e.group="Inputs";else for(var f in d)e[f]=d[f];a.push(e)}),Object.keys(this.outputs).forEach(function(c){a.push({name:c,type:{name:b.outputs[c]},plug:"output",group:"Outputs"})}),a},b.exports=d},{}],76:[function(a,b,c){"use strict";function d(a){f.call(this),this.name=a,this.nodes={},this.connections=[],this.roots=[],this.inputPorts={},this.outputPorts={}}var e=a("./nodemodel"),f=a("./../eventsender"),g=a("lodash");d.prototype=Object.create(f.prototype),d.prototype.addNode=function(a){a.component=this,this.nodes[a.id]=a,this.emit("nodeAdded",a)},d.prototype.getNodeWithId=function(a){return this.nodes[a]},d.prototype.getAllNodes=function(){return g.values(this.nodes)},d.prototype.getNodesWithType=function(a){var b=[],c=this;return Object.keys(this.nodes).forEach(function(d){var e=c.nodes[d];e.type===a&&b.push(e)}),b},d.prototype.addConnection=function(a){this.connections.push(a),this.emit("connectionAdded",a)},d.prototype.removeConnection=function(a){var b=g.findIndex(this.connections,function(b){return g.isEqual(b,a)});this.connections.splice(b,1),this.emit("connectionRemoved",a)},d.prototype.getConnectionsFromPort=function(a,b){return this.connections.filter(function(c){return c.sourceId===a&&c.sourcePort===b})},d.prototype.getConnectionsToPort=function(a,b){return this.connections.filter(function(c){return c.targetId===a&&c.targetPort===b})},d.prototype.getConnectionsFrom=function(a){return this.connections.filter(function(b){return b.sourceId===a})},d.prototype.getConnectionsTo=function(a){return this.connections.filter(function(b){return b.targetId===a})},d.prototype.addRootId=function(a){-1===this.roots.indexOf(a)&&(this.roots.push(a),this.emit("rootAdded",a))},d.prototype.getFirstRootId=function(){return this.roots[0]},d.prototype.removeNodeWithId=function(a){var b=this.getNodeWithId(a);if(!b)return console.warn("ERROR: Attempted to remove non-existing node with ID:",a," - duplicate nodes in tree?"),!1;for(;b.children.length>0;){var c=b.children[0];this.removeNodeWithId(c.id)||b.children.shift()}for(var d=this.getConnectionsTo(a).concat(this.getConnectionsFrom(a)),e=0;e<d.length;e++)this.removeConnection(d[e]);this.setNodeParent(b,null);var f=this.roots.indexOf(b.id);return-1!==f&&(this.roots.splice(f,1),this.emit("rootRemoved",b.id)),this.emit("nodeRemoved",b),b.removeAllListeners(),delete this.nodes[a],!0},d.prototype.getAllConnections=function(){return this.connections},d.prototype.getInputPorts=function(){return this.inputPorts},d.prototype.getOutputPorts=function(){return this.outputPorts},d.prototype.addInputPort=function(a){this.inputPorts[a.name]=a,this.emit("inputPortAdded",a)},d.prototype.addOutputPort=function(a){this.outputPorts[a.name]=a,this.emit("outputPortAdded",a)},d.prototype.removeOutputPortWithName=function(a){if(this.outputPorts.hasOwnProperty(a)){var b=this.outputPorts[a];delete this.outputPorts[a],this.emit("outputPortRemoved",b)}},d.prototype.removeInputPortWithName=function(a){if(this.inputPorts.hasOwnProperty(a)){var b=this.inputPorts[a];delete this.inputPorts[a],this.emit("inputPortRemoved",b)}},d.prototype.renameInputPortOnNodeWithId=function(a,b,c){var d=this.getConnectionsToPort(a,b);d.forEach(this.removeConnection.bind(this));var e=this.getNodeWithId(a),f=g.clone(e.getInputPort(b));f&&(e.removeInputPortWithName(b),f.name=c,e.addInputPort(f)),d.forEach(function(a){a.targetPort=c}),d.forEach(this.addConnection.bind(this))},d.prototype.renameOutputPortOnNodeWithId=function(a,b,c){var d=this.getConnectionsFromPort(a,b);d.forEach(this.removeConnection.bind(this));var e=this.getNodeWithId(a),f=g.clone(e.getOutputPort(b));e.removeOutputPortWithName(b),f.name=c,e.addOutputPort(f),d.forEach(function(a){a.sourcePort=c}),d.forEach(this.addConnection.bind(this))},d.prototype.setNodeParent=function(a,b,c){a.parent&&(this.emit("nodeParentWillBeRemoved",a),a.parent.removeChild(a)),a.emit("parentUpdated",b),b&&(b.addChild(a,c),this.emit("nodeParentUpdated",a))},d.prototype.importEditorNodeData=function(a,b,c){var d=e.createFromExportData(a);this.addNode(d),b&&this.setNodeParent(d,this.getNodeWithId(b),c);var f=this;a.children&&a.children.forEach(function(a,b){f.importEditorNodeData(a,d.id,b)})},d.prototype.reset=function(){for(;this.roots.length;)this.removeNodeWithId(this.roots[0]);if(Object.keys(this.nodes).forEach(this.removeNodeWithId.bind(this)),this.nodes.length>0)throw new Error("Not all nodes were removed during a reset");if(this.connections.length>0)throw new Error("Not all connections were removed during a reset")},d.prototype.rename=function(a){var b=this.name;this.name=a,this.emit("renamed",{oldName:b,newName:a})},d.createFromExportData=function(a){var b=new d(a.name);return a.ports&&a.ports.forEach(function(a){"input"!==a.plug&&"input/output"!==a.plug||b.addInputPort(a),"output"!==a.plug&&"input/output"!==a.plug||b.addOutputPort(a)}),a.nodes&&a.nodes.forEach(b.importEditorNodeData.bind(b)),a.connections&&a.connections.forEach(b.addConnection.bind(b)),a.roots&&a.roots.forEach(b.addRootId.bind(b)),b},b.exports=d},{"./../eventsender":71,"./nodemodel":78,lodash:12}],77:[function(a,b,c){"use strict";function d(){f.call(this),this.components={},this.defaultDevice={canvasWidth:1080,canvasHeight:1920,fillMode:"aspectFit",renderer:"webgl",name:"Default Device"},this.settings=g.clone(h)}var e=a("./componentmodel"),f=a("./../eventsender"),g=a("lodash"),h={analyticsEnabled:!1,analyticsServerUrl:"http://localhost:8080"};d.prototype=Object.create(f.prototype),d.prototype.importComponentFromEditorData=function(a){var b=e.createFromExportData(a);this.addComponent(b)},d.prototype.importEditorData=function(a){a.settings&&this.setSettings(a.settings),a.components.forEach(this.importComponentFromEditorData.bind(this)),this.setRootComponentName(a.rootComponent),this.setRootNodeId(a.rootNode)},d.prototype.setRootComponentName=function(a){this.rootComponent=a,this.emit("rootComponentNameUpdated",a)},d.prototype.setRootNodeId=function(a){this.rootNode=a,this.emit("rootNodeIdChanged",a)},d.prototype.getNodesWithType=function(a){for(var b=[],c=Object.keys(this.components),d=0;d<c.length;d++){var e=this.components[c[d]];b=b.concat(e.getNodesWithType(a))}return b},d.prototype.getComponentWithName=function(a){return this.components[a]},d.prototype.getAllNodes=function(){for(var a=[],b=Object.keys(this.components),c=0;c<b.length;c++){var d=this.components[b[c]];a=a.concat(d.getAllNodes())}return a},d.prototype.addComponent=function(a){this.components[a.name]=a,this.getNodesWithType(a.name).forEach(this._addComponentPorts.bind(this)),a.getAllNodes().forEach(this._onNodeAdded.bind(this)),a.on("nodeAdded",this._onNodeAdded.bind(this),this),this.emit("componentAdded",a)},d.prototype.removeComponentWithName=function(a){if(!1===this.components.hasOwnProperty(a))return void console.error("GraphModel: Component with name "+componentNamee+" not in graph");var b=this.components[a];b.reset(),b.removeAllListeners(),delete this.components[b.name],this.emit("componentRemoved",b)},d.prototype.renameComponent=function(a,b){if(!1===this.components.hasOwnProperty(a))return void console.error("GraphModel: Component with name "+componentNamee+" not in graph");this.getNodesWithType(a).forEach(function(a){a.type=b});var c=this.components[a];c.rename(b),delete this.components[a],this.components[b]=c},d.prototype._addComponentPorts=function(a){if(this.components.hasOwnProperty(a.type)){var b=this.components[a.type];g.forIn(b.getInputPorts(),a.addInputPort.bind(a)),g.forIn(b.getOutputPorts(),a.addOutputPort.bind(a))}},d.prototype._onNodeAdded=function(a){this._addComponentPorts(a),this.emit("nodeAdded",a),this.emit("nodeAdded."+a.type,a)},d.prototype.reset=function(){var a=this;Object.keys(this.components).forEach(function(b){a.removeComponentWithName(b)}),this.settings=g.clone(h),this.devices={}},d.prototype.isEmpty=function(){return 0===Object.keys(this.components).length},d.prototype.setSettings=function(a){if(a.hasOwnProperty("analyticsEnabed")&&(this.settings.analyticsEnabled=a.analyticsEnabled),a.hasOwnProperty("analyticsServerUrl")&&(this.settings.analyticsServerUrl=a.analyticsServerUrl),this.settings.mqttUseExternalBroker=a.mqttUseExternalBroker,this.settings.mqttBrokerUrl=a.mqttBrokerUrl,this.settings.mqttBrokerType=a.mqttBrokerType,a.devices){this.devices={};var b=this,c=a.devices.split(",");c.forEach(function(c){b.devices[c]={fillMode:a[c+".fillMode"]||b.defaultDevice.fillMode,canvasWidth:a[c+".canvasWidth"]||b.defaultDevice.canvasWidth,canvasHeight:a[c+".canvasHeight"]||b.defaultDevice.canvasHeight,renderer:a[c+".renderer"]||b.defaultDevice.renderer,transparent:a[c+".transparent"]||b.defaultDevice.transparent,rootComponent:a[c+".rootComponent"],name:c}}),this.defaultDeviceName=c[0]}this.projectSettings=a,this.emit("settingsUpdated")},d.prototype.getSettings=function(){return this.settings},d.prototype.getDeviceSettings=function(a){return a&&!1!==this.devices.hasOwnProperty(a)||(a=this.defaultDeviceName),a?this.devices[a]:this.defaultDevice},d.prototype.getRawProjectSettings=function(){return this.projectSettings||{}},b.exports=d},{"./../eventsender":71,"./componentmodel":76,lodash:12}],78:[function(a,b,c){"use strict";function d(a,b){e.call(this),this.id=a,this.type=b,this.inputs=[],this.outputs=[],this.children=[],this.parameters={},this.inputPorts={},this.outputPorts={}}var e=a("./../eventsender");d.prototype=Object.create(e.prototype),d.prototype.setParameter=function(a,b){this.parameters[a]=b,this.emit("parameterUpdated",{name:a,value:b})},d.prototype.setParameters=function(a){var b=this;Object.keys(a).forEach(function(c){b.setParameter(c,a[c])})},d.prototype.addInputPort=function(a){this.inputPorts[a.name]=a,this.emit("inputPortAdded",a)},d.prototype.getInputPort=function(a){return this.inputPorts[a]},d.prototype.getInputPorts=function(){return this.inputPorts},d.prototype.removeInputPortWithName=function(a){if(this.inputPorts.hasOwnProperty(a)){var b=this.inputPorts[a];delete this.inputPorts[a],this.emit("inputPortRemoved",b)}},d.prototype.addOutputPort=function(a){this.outputPorts[a.name]=a,this.emit("outputPortAdded",a)},d.prototype.getOutputPort=function(a){return this.outputPorts[a]},d.prototype.getOutputPorts=function(){return this.outputPorts},d.prototype.removeOutputPortWithName=function(a){if(this.outputPorts.hasOwnProperty(a)){var b=this.outputPorts[a];delete this.outputPorts[a],this.emit("outputPortRemoved",b)}},d.prototype.addChild=function(a,b){a.parent=this,void 0===b?this.children.push(a):this.children.splice(b,0,a)},d.prototype.removeChild=function(a){a.parent=void 0;var b=this.children.indexOf(a);this.children.splice(b,1)},d.prototype.reset=function(){this.removeAllListeners()},d.createFromExportData=function(a){var b=new d(a.id,a.type);return a.parameters&&b.setParameters(a.parameters),a.ports&&a.ports.forEach(function(a){"outputs"===a.plug&&(a.plug="output"),"input"!==a.plug&&"input/output"!==a.plug||b.addInputPort(a),"output"!==a.plug&&"input/output"!==a.plug||b.addOutputPort(a)}),b},b.exports=d},{"./../eventsender":71}],79:[function(a,b,c){"use strict";function d(a){this.context=a,this._dirty=!1,this._cachedInputValues={},this._inputs={},this.numberedInputs={},this._outputs={},this._inputConnections={},this._outputList=[],this._isUpdating=!1,this._inputValuesQueue={},this._afterInputsHaveUpdatedCallbacks=[],this._internal={},this._signalsSentThisUpdate={}}function f(a){var b=a.split(" ");return b.splice(-1,1),b.join(" ")}var g=a("./outputproperty");d.numberOfQueuedSignalsThisFrame=0,d.numberOfSignalsSentThisFrame=0,Object.defineProperties(d.prototype,{registerInput:{value:function(a,b){if(this.hasInput(a))throw new Error("Input property "+a+" already registered");this._inputs[a]=b,b.hasOwnProperty("default")&&(this._cachedInputValues[a]=b.default)}},deregisterInput:{value:function(a){if(!1===this.hasInput(a))throw new Error("Input property "+a+" doesn't exist");delete this._inputs[a],delete this._cachedInputValues[a]}},registerInputs:{value:function(a){for(var b in a)this.registerInput(b,a[b])}},_registerSelectors:{value:function(a){var b=this;Object.keys(a).forEach(function(c){var d=a[c],e={set:function(a){var c=a.split(" "),e=Number(c[c.length-1]);d.set.call(b,e)}};b.registerInput(c,e)})}},registerNumberedInput:{value:function(a,b){if(this.hasNumberedInput(a))throw new Error("Numbered input property "+a+" already registered");this.numberedInputs[a]=b,b.selectors&&this._registerSelectors(b.selectors)}},getInput:{value:function(a){if(!1===this.hasInput(a))throw new Error("Node "+this.name+": Invalid input property "+a);return this._inputs[a]}},hasInput:{value:function(a){return a in this._inputs}},hasNumberedInput:{value:function(a){return this.numberedInputs.hasOwnProperty(a)}},registerInputIfNeeded:{value:function(a){!1===this.hasInput(a)&&this._isUnregisteredNumberedInput(a)&&this._registerNumberedInputInstance(a)}},_isUnregisteredNumberedInput:{value:function(a){var b=f(a);return this.numberedInputs.hasOwnProperty(b)}},_registerNumberedInputInstance:{value:function(a){var b=a.split(" "),c=b[b.length-1];if(isNaN(c))throw new Error("Numbered input with name "+a+" doesn't end with a number");c=Number(c);var d=this.numberedInputs[f(a)],e={name:d.name,set:d.createSetter.call(this,c)};this.registerInput(a,e)}},setInputValue:{value:function(a,b,c){this._cachedInputValues[a]=b;var d=this.getInput(a);c?d.set.call(this,b,c):d.set.call(this,b)}},hasOutput:{value:function(a){return a in this._outputs}},registerOutput:{value:function(a,b){if(this.hasOutput(a))throw new Error("Output property "+a+" already registered");var c=new g({owner:this,getter:b.getter,name:a});this._outputs[a]=c,this._outputList.push(c)}},deregisterOutput:{value:function(a){if(!1===this.hasOutput(a))throw new Error("Output property "+a+" isn't registered");var b=this._outputs[a];if(b.hasConnections())throw new Error("Output property "+a+" has connections and can't be removed");delete this._outputs[a];var c=this._outputList.indexOf(b);this._outputList.splice(c,1)}},registerOutputs:{value:function(a){for(var b in a)this.registerOutput(b,a[b])}},registerOutputIfNeeded:{value:function(){}},getOutput:{value:function(a){if(!1===this.hasOutput(a))throw new Error("Node "+this.name+" doesn't have a port named "+a);return this._outputs[a]}},connectInput:{value:function(a,b,c){if(!1===this.hasInput(a))throw new Error("Invalid connection, input doesn't exist. Trying to connect from "+b.name+" output "+c+" to "+this.name+" input "+a);var d=b.getOutput(c);if(d.registerConnection(this,a),this._inputConnections[a]||(this._inputConnections[a]=[],this._inputValuesQueue[a]=[]),this._inputConnections[a].push(d),b._signalsSentThisUpdate[c])this.queueInput(a,!0),this.queueInput(a,!1);else{var e=d.value;void 0!==e&&this.queueInput(a,e)}this.flagDirty()}},removeInputConnection:{value:function(a,b,c){if(!this._inputConnections[a])throw new Error("Node removeInputConnection: Input doesn't exist");for(var d=this._inputConnections[a],e=0;e<d.length;e++){var f=d[e];if(f.owner.id===b&&f.name===c){d.splice(e,1);f.owner.getOutput(c).deregisterConnection(this,a);break}}}},isInputConnected:{value:function(a){return this._inputConnections.hasOwnProperty(a)}},update:{value:function(){if(!this._isUpdating&&!1!==this._dirty){this._isUpdating=!0;var a,b=0;try{for(;this._dirty&&b<100;){this._updateDependencies(),this._dirty=!1;for(var c=!0,d=Object.keys(this._inputValuesQueue);c;){for(c=!1,a=0;a<d.length;a++){var f=d[a],g=this._inputValuesQueue[f];if(g.length>0){var h=g.shift();null!==h&&"object"==typeof h&&h.hasOwnProperty("value")&&h.hasOwnProperty("unit")?this.setInputValue(f,h.value,h.unit):this.setInputValue(f,h),g.length>0&&(c=!0)}}var i=this._afterInputsHaveUpdatedCallbacks;for(this._afterInputsHaveUpdatedCallbacks=[],a=0;a<i.length;a++)i[a].call(this)}b++}}catch(e){throw this._isUpdating=!1,e}this._isUpdating=!1}}},_updateDependencies:{value:function(){for(var a in this._inputConnections)for(var b=this._inputConnections[a],c=0;c<b.length;++c)"reference"!==b[c].type&&b[c].owner.update()}},flagDirty:{value:function(){if(!this._dirty){this._dirty=!0,this.context&&this.context.nodeIsDirty(this);for(var a=0;a<this._outputList.length;++a)this._outputList[a].flagDependeesDirty()}}},sendValue:{value:function(a,b){if(!1===this.hasOutput(a))return void console.log("Error: Node",this.name,"doesn't have a output named",a);var c=this.getOutput(a);!1!==c.hasConnections()&&void 0!==b&&(d.numberOfSignalsSentThisFrame++,c.sendValue(b),this.context&&this.context.connectionSentValue(c,b))}},flagOutputDirty:{value:function(a){var b=this.getOutput(a);!1!==b.hasConnections()&&this.sendValue(a,b.value)}},flagAllOutputsDirty:{value:function(a){for(var b=0;b<this._outputList.length;++b){var c=this._outputList[b];this.sendValue(c.name,c.value)}}},sendSignalOnOutput:{value:function(a){this.sendValue(a,!0),this.sendValue(a,!1),this._signalsSentThisUpdate[a]=!0,this.scheduleAfterInputsHaveUpdated(function(){
this._signalsSentThisUpdate[a]=!1})}},queueInput:{value:function(a,b,c){d.numberOfQueuedSignalsThisFrame++,this._inputValuesQueue[a]||(this._inputValuesQueue[a]=[]),c?this._inputValuesQueue[a].push({value:b,unit:c}):this._inputValuesQueue[a].push(b),this.flagDirty()}},scheduleAfterInputsHaveUpdated:{value:function(a){d.numberOfQueuedSignalsThisFrame++,this._afterInputsHaveUpdatedCallbacks.push(a),this.flagDirty()}},setNodeModel:{value:function(a){this.model=a,a.on("parameterUpdated",this._onNodeModelParameterUpdated,this);var b=this;a.on("inputPortRemoved",function(a){b.hasInput(a.name)&&b.deregisterInput(a.name)},this),a.on("outputPortRemoved",function(a){b.hasOutput(a.name)&&b.deregisterOutput(a.name)},this)}},_onNodeDeleted:{value:function(){this.model&&(this.model.removeListenersWithRef(this),this.model=void 0)}},_onNodeModelParameterUpdated:{value:function(a){this.registerInputIfNeeded(a.name),"object"==typeof a.value&&a.value.hasOwnProperty("unit")?this.queueInput(a.name,a.value.value,a.value.unit):this.queueInput(a.name,a.value)}}}),b.exports=d},{"./outputproperty":161}],80:[function(a,b,c){"use strict";function d(a){if(a=a||{},a.runningInEditor=!!a.hasOwnProperty("runningInEditor")&&a.runningInEditor,this._dirtyNodes=[],this.callbacksAfterUpdate=[],this.eventEmitter=new e,this.eventEmitter.setMaxListeners(1e3),this.eventSenderEmitter=new e,this.eventSenderEmitter.setMaxListeners(1e4),this.globalValues={},this.globalsEventEmitter=new e,this.globalsEventEmitter.setMaxListeners(1e3),this.runningInEditor=a.runningInEditor,this.currentFrameTime=0,this.nodeRegister=new f(this),this.timerScheduler=new g(this.scheduleFrame.bind(this)),this.componentModels={},this.outputCollectionEnabled=!1,this.connectionsToPulse={},this.connectionsToPulseChanged=!1,this.connectionsToInspect={},this.inspectedConnectionValuesToSendQueue=[],this.connectionPulsingCallbackScheduled=!1,this.editorConnection=a.editorConnection,this.rootComponent=void 0,this.editorConnection&&this.editorConnection.on("connectionInspectorsUpdated",this.onConnectionInspectorsUpdated.bind(this)),a.uiEngineClass){var b=a.uiEngineClass;this.uiEngine=new b(this.timerScheduler,document.body),this.uiEngine.eventSender.on("requestFrame",this.scheduleFrame.bind(this))}}var e=a("events").EventEmitter,f=a("./noderegister"),g=a("./timerscheduler");d.prototype.setRootComponent=function(a){this.rootComponent=a,a.getVisualRoot()&&this.uiEngine.root.addChild(a.getVisualRoot()._internal.uiControl)},d.prototype.onConnectionInspectorsUpdated=function(a){var b={};a.forEach(function(a){var c=a.fromId+a.fromProperty;b[c]=a}),this.connectionsToInspect=b,this.sendConnectionsToInspectValues()},d.prototype.layout=function(){this.uiEngine&&this.uiEngine.layout()},d.prototype.update=function(){for(var a,b,c=!0,d=0;c&&d<10;){this.layout();var e=this._dirtyNodes;for(this._dirtyNodes=[],a=0,b=e.length;a<b;++a)e[a].update();var f=this.callbacksAfterUpdate;for(this.callbacksAfterUpdate=[],a=0,b=f.length;a<b;a++)f[a]();this.layout(),c=this.callbacksAfterUpdate.length>0||this._dirtyNodes.length>0,d++}this.timerScheduler.hasPendingTimers()&&(this.scheduleFrame(),this.timerScheduler.runTimers(this.currentFrameTime)),this.flushConnectionsToInspect()},d.prototype.flushConnectionsToInspect=function(){this.connectionsToPulseChanged&&(this.connectionsToPulseChanged=!1,this.editorConnection.sendPulsingConnections(this.connectionsToPulse)),this.inspectedConnectionValuesToSendQueue.length>0&&(this.editorConnection.sendConnectionValues(this.inspectedConnectionValuesToSendQueue),this.inspectedConnectionValuesToSendQueue=[])},d.prototype.reset=function(){this.eventEmitter.emit("applicationDataReloaded");var a=this.eventEmitter;["frameStart","frameEnd"].forEach(function(b){a.removeAllListeners(b)}),this.globalValues={},this._dirtyNodes.length=0,this.callbacksAfterUpdate.length=0,this.timerScheduler.runningTimers=[],this.timerScheduler.newTimers=[],this.rootComponent=void 0,this.clearAllConnectionInspections()},d.prototype.nodeIsDirty=function(a){this._dirtyNodes.push(a),this.scheduleFrame()},d.prototype.scheduleFrame=function(){this.eventEmitter.emit("scheduleFrame")},d.prototype.scheduleAfterUpdate=function(a){this.callbacksAfterUpdate.push(a),this.scheduleFrame()},d.prototype.scheduleNextFrame=function(a){this.eventEmitter.once("frameStart",a),this.scheduleFrame()},d.prototype.setGlobalValue=function(a,b){this.globalValues[a]=b,this.globalsEventEmitter.emit(a)},d.prototype.getGlobalValue=function(a){return this.globalValues[a]},d.prototype.reloadApplication=function(){this.eventEmitter.emit("reloadApplication")},d.prototype.registerComponentModel=function(a){if(this.componentModels.hasOwnProperty(a.name))throw new Error("Duplicate component name "+a.name);this.componentModels[a.name]=a;var b=this;a.on("renamed",function(c){delete b.componentModels[c.oldName],b.componentModels[c.newName]=a},this)},d.prototype.deregisterComponentModel=function(a){this.componentModels.hasOwnProperty(a.name)&&(this.componentModels[a.name].removeListenersWithRef(this),delete this.componentModels[a.name])},d.prototype.getComponentModel=function(a){if(!a)throw new Error("Component instance must have a name");if(!1===this.componentModels.hasOwnProperty(a))throw new Error("Unknown component "+a);return this.componentModels[a]},d.prototype.hasComponentModelWithName=function(a){return this.componentModels.hasOwnProperty(a)},d.prototype.createComponentInstanceNode=function(b){var c=this.getComponentModel(b),d=a("./nodes/componentinstance"),e=new d(this);return e.name=b,e.setComponentModel(c),e},d.prototype._sendConnectionValue=function(a,b){if(this.connectionsToInspect.hasOwnProperty(a.id)&&this.inspectedConnectionValuesToSendQueue.push({id:a.id,value:b}),this.connectionsToPulse.hasOwnProperty(a.id))return void(this.connectionsToPulse[a.id].timestamp="undefined"!=typeof window?window.performance.now():+new Date);var c=[];a.connections.forEach(function(b){c.push(a.owner.id+a.name+b.node.id+b.inputPortName)}),this.connectionsToPulse[a.id]={timestamp:"undefined"!=typeof window?window.performance.now():+new Date,connections:c},this.connectionsToPulseChanged=!0,!1===this.connectionPulsingCallbackScheduled&&(this.connectionPulsingCallbackScheduled=!0,setTimeout(this.clearOldConnectionPulsing.bind(this),100))},d.prototype.connectionSentValue=function(a,b){this.editorConnection&&this.editorConnection.isConnected()&&this.outputCollectionEnabled&&this._sendConnectionValue(a,b)},d.prototype.clearAllConnectionInspections=function(){this.connectionsToInspect={},this.connectionsToPulse={},this.editorConnection.sendPulsingConnections(this.connectionsToPulse)},d.prototype.clearOldConnectionPulsing=function(){this.connectionPulsingCallbackScheduled=!1;var a="undefined"!=typeof window?window.performance.now():+new Date,b=this;Object.keys(this.connectionsToPulse).forEach(function(c){var d=b.connectionsToPulse[c];a-d.timestamp>100&&(b.connectionsToPulseChanged=!0,delete b.connectionsToPulse[c])}),this.connectionsToPulseChanged&&(this.connectionsToPulseChanged=!1,this.editorConnection.sendPulsingConnections(this.connectionsToPulse)),Object.keys(this.connectionsToPulse).length>0&&(this.connectionPulsingCallbackScheduled=!0,setTimeout(this.clearOldConnectionPulsing.bind(this),100))},d.prototype.sendConnectionsToInspectValues=function(){var a=this,b=[];Object.keys(this.connectionsToInspect).forEach(function(c){var d=a.connectionsToInspect[c],e=a.rootComponent.nodeScope.getNodesWithIdRecursive(d.toId);if(e.length>0){var f=e[e.length-1],g=f._cachedInputValues[d.toProperty];"object"==typeof g&&"Node"===g.constructor.name&&(g="<Node> "+g.name),b.push({id:c,value:g})}}),b.length>0&&this.editorConnection.sendConnectionValues(b)},d.prototype.setOutputCollectionEnabled=function(a){this.outputCollectionEnabled=a,a&&this.sendConnectionsToInspectValues()},d.prototype.sendGlobalEventFromEventSender=function(a,b){this.eventSenderEmitter.emit(a,b),this.sessionRecorder&&this.sessionRecorder.appendEvent(a)},d.prototype.setSessionRecorder=function(a){this.sessionRecorder=a},b.exports=d},{"./noderegister":83,"./nodes/componentinstance":89,"./timerscheduler":168,events:7}],81:[function(a,b,c){"use strict";function d(a,b,c,d){if(a.hasOwnProperty(c))throw new Error("Input property "+c+" already registered");d.set&&(a[c]={set:d.set}),d.setUnitType&&(a[c].setUnitType=d.setUnitType),b.inputs[c]={displayName:d.displayName,editorName:d.editorName,group:d.group,type:d.type,default:d.default,index:d.index,exportToEditor:!d.hasOwnProperty("exportToEditor")||d.exportToEditor,inputPriority:d.inputPriority||0},d.valueChangedToTrue&&(b.inputs[c].type={name:"boolean",allowConnectionsOnly:!0})}function e(a,b,c,d){if(a.hasOwnProperty(c))throw new Error("Input property "+c+" already registered");a[c]={createSetter:d.createSetter},b.numberedInputs[c]={displayPrefix:d.displayPrefix,group:d.group,name:d.name},d.selectors&&(b.numberedInputs[c].selectors={},a[c].selectors={},Object.keys(d.selectors).forEach(function(e){var f=d.selectors[e];b.numberedInputs[c].selectors[e]={displayName:f.displayName,editorName:f.editorName,group:f.group},a[c].selectors[e]={set:f.set}}))}function f(a,b,c){Object.keys(c).forEach(function(e){d(a,b,e,c[e])})}function g(a,b){Object.keys(b).forEach(function(c){var d=b[c];a.outputs[c]={displayName:d.displayName,editorName:d.editorName,group:d.group,type:d.type,index:d.index,exportToEditor:!d.hasOwnProperty("exportToEditor")||d.exportToEditor}})}function h(a,b){Object.keys(b).forEach(function(c){a[c]=b[c].default})}function i(a){function b(a){k.call(this,a)}if(!a.category)throw new Error("Node must have a category");if(!a.name)throw new Error("Node must have a name");var c={inputs:{},outputs:{},numberedInputs:{},category:a.category,dynamicports:a.dynamicports,allowChildren:a.allowChildren,allowChildrenWithCategory:a.allowChildrenWithCategory,allowAsChild:a.allowAsChild,panels:a.panels,color:a.color,usePortAsLabel:a.usePortAsLabel,portLabelTruncationMode:a.portLabelTruncationMode,name:a.name,displayNodeName:a.displayNodeName,deprecated:a.deprecated,haveComponentPorts:a.haveComponentPorts,version:a.version};a._internal=a._internal||{},a.prototypeExtensions=a.prototypeExtensions||{},a.inputs=a.inputs||{},a.outputs=a.outputs||{},a.numberedInputs=a.numberedInputs||{},a.initialize=a.initialize||function(){};var d={},i={};f(d,c,a.inputs),g(c,a.outputs),Object.keys(a.numberedInputs).forEach(function(b){e(i,c,b,a.numberedInputs[b])}),Object.keys(a.prototypeExtensions).forEach(function(b){a.prototypeExtensions[b].value||(a.prototypeExtensions[b]={value:a.prototypeExtensions[b]})}),b.prototype=Object.create(k.prototype,a.prototypeExtensions),Object.defineProperty(b.prototype,"name",{value:a.name});var j=function(e){var f=new b(e);return f._inputs=Object.create(d),Object.keys(a.inputs).forEach(function(b){var c=a.inputs[b];c.valueChangedToTrue&&(f._inputs[b]={set:l.createSetter({valueChangedToTrue:c.valueChangedToTrue})})}),Object.keys(a.outputs).forEach(function(b){var c=a.outputs[b];"signal"===c.type?f.registerOutput(b,{getter:function(){return!1}}):f.registerOutput(b,c)}),Object.keys(i).forEach(function(a){f.registerNumberedInput(a,i[a])}),h(f._cachedInputValues,c.inputs),a.initialize.call(f),f};return j.metadata=c,j}function j(a,b){for(var c in b)if("initialize"===c&&a.initialize){var d=a.initialize;a.initialize=function(){d.call(this),b.initialize.call(this)}}else b[c]&&b[c].constructor===Object?a[c]=j(a[c]||{},b[c]):b[c]&&b[c].constructor===Array&&a[c]&&a[c].constructor==Array?a[c]=a[c].concat(b[c]):a[c]=b[c];return a}var k=a("./node"),l=a("./edgetriggeredinput");b.exports={defineNode:i,extend:j}},{"./edgetriggeredinput":68,"./node":79}],82:[function(a,b,c){"use strict";function d(a){var b={typecasts:[{from:"boolean",to:["number","string","signal"]},{from:"number",to:["boolean","string"]},{from:"string",to:["number","boolean","image","color"]},{from:"signal",to:["boolean","number"]},{from:"image",to:[]},{from:"color",to:[]},{from:"enum",to:[]},{from:"object",to:[]},{from:"domelement",to:[]},{from:"reference",to:[]},{from:"font",to:[]}],dynamicports:[{type:"conditionalports",name:"basic"},{type:"expand",name:"basic"},{type:"portchannel",name:"event-sender-channel",channelPortname:"channelName",typename:"Event Sender",ignorePorts:["channelName","sendEvent","propagation"]},{type:"numbered",name:"simple-number",port:{type:"number"}},{type:"numbered",name:"simple-boolean",port:{type:"boolean"}},{type:"numbered",name:"simple-string",port:{type:"string"}},{type:"numbered",name:"simple-color",port:{type:"color"}}],colors:{nodes:{component:{base:"#6e3599",baseHighlighted:"#8440b8",header:"#6e3599",headerHighlighted:"#8440b8",outline:"#6e3599",outlineHighlighted:"#b58900",text:"#ffffff"},visual:{base:"#2a4e6e",baseHighlighted:"#376690",header:"#2a4e6e",headerHighlighted:"#376690",outline:"#2a4e6e",outlineHighlighted:"#b58900",text:"#ffffff"},data:{base:"#6d8241",baseHighlighted:"#2f8d22",header:"#6d8241",headerHighlighted:"#2f8d22",outline:"#6d8241",outlineHighlighted:"#b58900",text:"#ffffff"},javascript:{base:"#a24176",baseHighlighted:"#ab5484",header:"#a24176",headerHighlighted:"#ab5484",outline:"#ab5484",outlineHighlighted:"#d57bab",text:"#ffffff"},default:{base:"#3e434e",baseHighlighted:"#505768",header:"#3e434e",headerHighlighted:"#505768",outline:"#3e434e",outlineHighlighted:"#b58900",text:"#ffffff"}},connections:{signal:{normal:"#468c8c",highlighted:"#73babb",pulsing:"#92d9d8"},default:{normal:"#916311",highlighted:"#ffa300",pulsing:"#ffe85d"}}},nodetypes:[{name:"Component Children",color:"component",panels:"none",allowAsChild:!0,category:"Visual",haveComponentChildren:["Visual"]}]};return Object.keys(a._constructors).forEach(function(c){function d(a,b){var c={name:a,type:b.type,plug:"output"};b.group&&(c.group=b.group),b.displayName&&(c.displayName=b.displayName),b.editorName&&(c.editorName=b.editorName),f.ports.push(c)}var e=a._constructors[c].metadata,f={name:c};b.nodetypes.push(f),e.version&&(f.version=e.version),e.displayNodeName&&(f.displayNodeName=e.displayNodeName),e.deprecated&&(f.deprecated=!0),e.haveComponentPorts&&(f.haveComponentPorts=!0),"Visual"===e.category&&(f.allowAsChild=!0,f.allowAsExportRoot=!0,f.color="visual"),e.allowChildren&&(f.allowChildrenWithCategory=["Visual"],f.color="visual"),e.allowChildrenWithCategory&&(f.allowChildrenWithCategory=e.allowChildrenWithCategory),e.allowAsChild&&(f.allowAsChild=!0),f.category=e.category,e.panels&&(f.panels=e.panels),e.usePortAsLabel&&(f.usePortAsLabel=e.usePortAsLabel,f.portLabelTruncationMode=e.portLabelTruncationMode),e.color&&(f.color=e.color),e.dynamicports&&(f.dynamicports=e.dynamicports.slice()),f.ports=[];var g=f.dynamicports||[],h={},i={};e.dynamicports&&(e.dynamicports.filter(function(a){return"conditionalports/basic"===a.name}).forEach(function(a){a.ports.forEach(function(a){i[a.plug+"/"+a.name]=!0})}),e.dynamicports.filter(function(a){return void 0!==a.channelPort}).forEach(function(a){i[a.channelPort.plug+"/"+a.channelPort.name]=!0})),e.numberedInputs&&Object.keys(e.numberedInputs).forEach(function(a){var b=e.numberedInputs[a],c={name:b.name,prefix:a};b.displayPrefix&&(c.displayPrefix=b.displayPrefix);var d={plug:"input"};if(b.group&&(d.group=b.group),c.port=d,b.selectors){var f=[];Object.keys(b.selectors).forEach(function(a){var c=b.selectors[a];h[a]=!0;var d={name:a,plug:"input"};c.displayName&&(d.displayName=c.displayName),c.description&&(d.description=c.description),c.editorName&&(d.editorName=c.editorName),c.group&&(d.group=c.group),d.allowEditOnly=!0,f.push(d)}),c.selectors=f}g.push(c)}),g.length&&(f.dynamicports=g),Object.keys(e.inputs).forEach(function(a){if(!h.hasOwnProperty("input/"+a)&&!i.hasOwnProperty("input/"+a)){var b=e.inputs[a];if(!1!==b.exportToEditor){var c={name:a,type:b.type,plug:"input"};b.group&&(c.group=b.group),b.displayName&&(c.displayName=b.displayName),b.description&&(c.description=b.description),b.editorName&&(c.editorName=b.editorName),void 0!==b.default&&(c.default=b.default),b.hasOwnProperty("index")&&(c.index=b.index),f.ports.push(c)}}}),Object.keys(e.outputs).forEach(function(a){h.hasOwnProperty("output/"+a)||i.hasOwnProperty("output/"+a)||d(a,e.outputs[a])})}),b}b.exports=d},{}],83:[function(a,b,c){"use strict";function d(a){this._constructors={},this.context=a}d.prototype.register=function(a){var b=a.metadata.name;this._constructors[b]=a},d.prototype.createNode=function(a){if(!1===this._constructors.hasOwnProperty(a))throw new Error("Unknown node type with name "+a);return this._constructors[a](this.context)},d.prototype.getNodeMetadata=function(a){if(!1===this._constructors.hasOwnProperty(a))throw new Error("Unknown node type with name "+a);return this._constructors[a].metadata},d.prototype.hasNode=function(a){return this._constructors.hasOwnProperty(a)},b.exports=d},{}],84:[function(a,b,c){"use strict";function d(a){return!a}var e=a("../nodedefinition");b.exports=e.defineNode({name:"And",category:"Logic",initialize:function(){this._internal.inputs=[]},numberedInputs:{input:{name:"numbered/simple-boolean",displayPrefix:"Input",createSetter:function(a){return this._internal.inputs[a]=!1,function(b){this._internal.inputs[a]!==b&&(this._internal.inputs[a]=b,this.flagOutputDirty("result"))}}}},outputs:{result:{type:"boolean",displayName:"Result",getter:function(){var a=this._internal.inputs;return a.length>0&&!1===a.some(d)}}}})},{"../nodedefinition":81}],85:[function(a,b,c){"use strict";function d(a){this.name=a.name,this.startValue=0,this.endValue=0,this.currentValue=void 0,this.startMode="implicit",this.ease=a.ease,this.node=a.node,this.hasSampledStartValue=!1;var b=this;this.animation=a.node.context.timerScheduler.createTimer({startValue:0,endValue:0,onRunning:function(a){var c=b.ease(this.startValue,this.endValue,a);b.setCurrentValue(c)}}),this.animation.startValue=0,this.animation.endValue=0}var e=(a("../node"),a("../nodedefinition")),f=a("../easecurves"),g=a("bezier-easing");Object.defineProperties(d.prototype,{setCurrentValue:{value:function(a){this.currentValue=a,this.node.flagOutputDirty(this.name)}},play:{value:function(a,b){if(void 0===a&&(console.log("Animation warning, start value is undefined"),a=0),void 0===b)return void console.error("Animation error, start:",a,"end:",b);var c=this.animation;c.startValue=a,this.setCurrentValue(a),c.endValue=b,c.duration=this.node._internal.duration,c.start()}},playToEnd:{value:function(){!1!==this.hasConnections()&&(this.updateStartValue(),this.play(this.getTargetsCurrentValue(),this.endValue))}},playToStart:{value:function(){!1!==this.hasConnections()&&(this.updateStartValue(),this.play(this.getTargetsCurrentValue(),this.startValue))}},replayToEnd:{value:function(){!1!==this.hasConnections()&&(this.updateStartValue(),this.play(this.startValue,this.endValue))}},replayToStart:{value:function(){!1!==this.hasConnections()&&this.play(this.endValue,this.startValue)}},hasConnections:{value:function(){return this.node.getOutput(this.name).hasConnections()}},getTargetsCurrentValue:{value:function(){var a=this.node.getOutput(this.name).connections;return a[0].node._cachedInputValues[a[0].inputPortName]}},updateStartValue:{value:function(){"implicit"!==this.startMode||this.hasSampledStartValue||(this.hasSampledStartValue=!0,this.startValue=this.getTargetsCurrentValue())}},stop:{value:function(){this.animation.stop(),this.setCurrentValue(void 0)}},jumpToStart:{value:function(){this.animation.stop(),this.setCurrentValue(this.startValue)}},jumpToEnd:{value:function(){this.animation.stop(),this.setCurrentValue(this.endValue)}}});var h=[{value:"easeOut",label:"Ease Out"},{value:"easeIn",label:"Ease In"},{value:"linear",label:"Linear"},{value:"easeInOut",label:"Ease In Out"},{value:"cubicBezier",label:"Cubic Bezier"}],i=300,j={name:"Animation",category:"Animation",initialize:function(){var a=this._internal;a.duration=i,a.ease=f.easeOut,a._isPlayingToEnd=!1,a.animations=[],a.cubicBezierPoints=[0,0,0,0],a.cubicBezierFunction=void 0;var b=this;a.animation=this.context.timerScheduler.createTimer({onFinish:function(){!1===a._isPlayingToEnd?b.sendSignalOnOutput("hasReachedStart"):b.sendSignalOnOutput("hasReachedEnd")}})},inputs:{duration:{index:0,type:"number",displayName:"Duration (ms)",group:"Animation Properties",default:i,set:function(a){this._internal.duration=a}},easingCurve:{index:10,type:{name:"enum",enums:h},group:"Animation Properties",displayName:"Easing Curve",default:"easeOut",set:function(a){var b;"cubicBezier"===a?(this.updateCubicBezierFunction(),b=this._internal.cubicBezierFunction):b=f[a],this._internal.ease=b}},playToEnd:{index:20,group:"Play",displayName:"To End",editorName:"Play To End",valueChangedToTrue:function(){this._internal._isPlayingToEnd=!0;var a=this._internal.animation,b=this._internal.animations,c=this;this.scheduleAfterInputsHaveUpdated(function(){a.duration=c._internal.duration,a.start();for(var d=0;d<b.length;d++)b[d].ease=c._internal.ease,b[d].playToEnd()})}},playToStart:{index:21,group:"Play",displayName:"To Start",editorName:"Play To Start",valueChangedToTrue:function(){this._internal._isPlayingToEnd=!1;var a=this._internal.animation,b=this._internal.animations,c=this;this.scheduleAfterInputsHaveUpdated(function(){a.duration=c._internal.duration,a.start();for(var d=0;d<b.length;d++)b[d].ease=c._internal.ease,b[d].playToStart()})}},replayToEnd:{index:22,group:"Play",displayName:"From Start To End",editorName:"Play From Start To End",valueChangedToTrue:function(){var a=this._internal.animation,b=this._internal.animations,c=this;this._internal._isPlayingToEnd=!0,this.scheduleAfterInputsHaveUpdated(function(){a.duration=c._internal.duration,a.start();for(var d=0;d<b.length;d++)b[d].ease=c._internal.ease,b[d].replayToEnd()})}},replayToStart:{index:23,group:"Play",displayName:"From End To Start",editorName:"Play From End To Start",valueChangedToTrue:function(){this._internal._isPlayingToEnd=!1;var a=this._internal.animation,b=this._internal.animations,c=this;this.scheduleAfterInputsHaveUpdated(function(){a.duration=c._internal.duration,a.start();for(var d=0;d<b.length;d++)b[d].ease=c._internal.ease,b[d].replayToStart()})}},stop:{index:60,group:"Instant Actions",displayName:"Stop",valueChangedToTrue:function(){var a=this._internal.animation,b=this._internal.animations;a.stop();for(var c=0;c<b.length;c++)b[c].stop()}},jumpToStart:{index:61,group:"Instant Actions",displayName:"Jump To Start",valueChangedToTrue:function(){for(var a=this._internal.animations,b=0;b<a.length;b++)a[b].jumpToStart();this.sendSignalOnOutput("hasReachedStart")}},jumpToEnd:{index:62,group:"Instant Actions",displayName:"Jump To End",valueChangedToTrue:function(){for(var a=this._internal.animations,b=0;b<a.length;b++)a[b].jumpToEnd();this.sendSignalOnOutput("hasReachedEnd")}},cubicBezierP1X:{set:function(a){this._internal.cubicBezierPoints[0]=Math.min(1,Math.max(0,a)),this.updateCubicBezierFunction()}},cubicBezierP1Y:{set:function(a){this._internal.cubicBezierPoints[1]=a,this.updateCubicBezierFunction()}},cubicBezierP2X:{set:function(a){this._internal.cubicBezierPoints[2]=Math.min(1,Math.max(0,a)),this.updateCubicBezierFunction()}},cubicBezierP2Y:{set:function(a){this._internal.cubicBezierPoints[3]=a,this.updateCubicBezierFunction()}}},outputs:{hasReachedStart:{type:"signal",group:"Signals",displayName:"Has Reached Start"},hasReachedEnd:{type:"signal",group:"Signals",displayName:"Has Reached End"}},dynamicports:[{name:"conditionalports/basic",condition:"easingCurve = cubicBezier",ports:[{name:"cubicBezierP1X",displayName:"P1 X",group:"Cubic Bezier",plug:"input",type:{name:"number"},index:11},{name:"cubicBezierP1Y",displayName:"P1 Y",group:"Cubic Bezier",plug:"input",type:{name:"number"},index:12},{name:"cubicBezierP2X",displayName:"P2 X",group:"Cubic Bezier",plug:"input",type:{name:"number"},index:13},{name:"cubicBezierP2Y",displayName:"P2 Y",group:"Cubic Bezier",plug:"input",type:{name:"number"},index:14}]},{name:"expand/basic",indexStep:100,template:[{name:"{{portname}}.startMode",type:{name:"enum",enums:[{value:"explicit",label:"Explicit"},{value:"implicit",label:"Implicit"}],allowEditOnly:!0},plug:"input",group:"{{portname}} Animation",displayName:"Start Mode",default:"implicit",index:1e3},{name:"{{portname}}.endValue",type:"number",plug:"input",group:"{{portname}} Animation",displayName:"End Value",editorName:"End Value | {{portname}} ",default:0,index:1002}]},{name:"expand/basic",condition:"'{{portname}}.startMode' = explicit",indexStep:100,template:[{name:"{{portname}}.startValue",plug:"input",type:"number",displayName:"Start Value",editorName:"Start Value | {{portname}}",group:"{{portname}} Animation",default:0,index:1001}]}],panels:[{name:"PortEditor",title:"Animations",plug:"output",type:{name:"number"},group:"Animation Values"}],prototypeExtensions:{updateCubicBezierFunction:{value:function(){var a=this._internal.cubicBezierPoints,b=g(a);this._internal.cubicBezierFunction=function(a,c,d){return f.linear(a,c,b.get(d))},this._internal.ease=this._internal.cubicBezierFunction}},_registerAnimationGroup:{value:function(a){var b=new d({node:this,ease:this._internal.ease,name:a});this._internal.animations.push(b);var c={};c[a+".startMode"]={set:function(a){b.startMode=a}},c[a+".startValue"]={default:0,set:function(a){b.startValue=a}},c[a+".endValue"]={default:0,set:function(a){b.endValue=a}},this.registerInputs(c),this.registerOutput(a,{getter:function(){return b.currentValue}})}},registerInputIfNeeded:{value:function(a){if(!this.hasInput(a)){var b=a.indexOf("."),c=a.substr(0,b);this.hasOutput(c)||this._registerAnimationGroup(c)}}},registerOutputIfNeeded:{value:function(a){this.hasOutput(a)||this._registerAnimationGroup(a)}}}};b.exports=e.defineNode(j)},{"../easecurves":67,"../node":79,"../nodedefinition":81,"bezier-easing":2}],86:[function(a,b,c){"use strict";var d=a("../services/services"),e={name:"Application Events",category:"Events",color:"component",initialize:function(){var a=this,b=this._internal;d.pubsub.on("connected",function(){!1!==b._isEnabled&&a.sendSignalOnOutput("applicationLoaded")})},inputs:{enabled:{displayName:"Enabled",type:"boolean",default:!0,set:function(a){this._internal._isEnabled=!!a}}},outputs:{applicationLoaded:{displayName:"Started",type:"signal"}},prototypeExtensions:{}};b.exports={node:e}},{"../services/services":166}],87:[function(a,b,c){"use strict";function d(a,b,c){return Math.max(a,Math.min(b,c))}function e(a,b){for(var c=0;c<3;++c){var d=1+2*c;a[c]=parseInt(b.substring(d,d+2),16)}}function f(a){var b=a.toString(16);return 1==b.length?"0"+b:b}function g(a){return"#"+f(a[0])+f(a[1])+f(a[2])}var h=a("../easecurves"),i=[0,0,0],j=[0,0,0],k=[0,0,0],l={name:"Color Blend",category:"Interpolation",initialize:function(){var a=this._internal;a.resultColor="#000000",a.blendValue=0,a.colors=[]},numberedInputs:{color:{name:"numbered/simple-color",displayPrefix:"Color",createSetter:function(a){return function(b){this._internal.colors[a]=b,this.updateColor()}}}},inputs:{blendValue:{type:"number",displayName:"Blend Value",default:0,set:function(a){this._internal.blendValue=a,this.updateColor()}}},outputs:{result:{type:"color",displayName:"Result",getter:function(){return this._internal.resultColor}}},prototypeExtensions:{updateColor:function(){function a(a){return b[a]?b[a]:"#000000"}var b=this._internal.colors;if(0!==b.length){var c=d(0,b.length-1,this._internal.blendValue),f=Math.floor(c),l=c-f;0===l?this._internal.resultColor=a(f):(e(i,a(f)),e(j,a(f+1)),k[0]=Math.floor(h.linear(i[0],j[0],l)),k[1]=Math.floor(h.linear(i[1],j[1],l)),k[2]=Math.floor(h.linear(i[2],j[2],l)),this._internal.resultColor=g(k)),this.flagOutputDirty("result")}}}};b.exports={node:l}},{"../easecurves":67}],88:[function(a,b,c){"use strict";b.exports={node:{name:"Component Inputs",panels:[{name:"PortEditor",context:["select","connectFrom"],title:"Inputs",plug:"output",type:{name:"*"},canArrangeInGroups:!0},{name:"PropertyEditor",hidden:!0}],color:"component",haveComponentPorts:!0,category:"Component Utilities",initialize:function(){this._internal.outputs={}},prototypeExtensions:{registerOutputIfNeeded:function(a){this.hasOutput(a)||this.registerOutput(a,{getter:function(){return this.nodeScope.componentOwner._internal.inputValues[a]}})}}}}},{}],89:[function(a,b,c){"use strict";function d(a){e.call(this,a),this.nodeScope=new f(a,this),this._internal.childRoot=null,this._internal.componentOutputValues={},this._internal.componentOutputs=[],this._internal.componentInputs=[],this._internal.inputValues={}}var e=a("../node"),f=a("../nodescope"),g=a("lodash");d.prototype=Object.create(e.prototype,{setComponentModel:{value:function(a){this.model=a;var b=this;this.nodeScope.setComponentModel(a),this._internal.componentInputs=this.nodeScope.getNodesWithType("Component Inputs"),this._internal.componentOutputs=this.nodeScope.getNodesWithType("Component Outputs"),g.values(a.getInputPorts()).forEach(this.registerComponentInputPort.bind(this)),g.values(a.getOutputPorts()).forEach(this.registerComponentOutputPort.bind(this)),a.roots&&a.roots.length>0&&this.setRoot(a.roots[0]),a.on("rootAdded",function(a){b._internal.root||b.setRoot(a)},this),a.on("rootRemoved",function(c){if(b._internal.root&&b._internal.root.id===c){var d=b._internal.visualParent;b.resetRoot();var e=a.getFirstRootId();e&&this.nodeScope.hasNodeWithId(e)&&(b.setRoot(a.getFirstRootId()),d&&d.addChild(b))}},this),a.on("inputPortAdded",this.registerComponentInputPort.bind(this),this),a.on("outputPortAdded",this.registerComponentOutputPort.bind(this),this),a.on("inputPortRemoved",function(a){b.hasInput(a.name)&&b.deregisterInput(a.name)},this),a.on("outputPortRemoved",function(a){this.hasOutput(a.name)&&b.deregisterOutput(a.name)},this),a.on("nodeAdded",function(a){"Component Inputs"===a.type?b._internal.componentInputs.push(b.nodeScope.getNodeWithId(a.id)):"Component Outputs"===a.type&&b._internal.componentOutputs.push(b.nodeScope.getNodeWithId(a.id))},this),a.on("nodeRemoved",function(a){"Component Inputs"===a.type?g.remove(b._internal.componentInputs,{id:a.id}):"Component Outputs"===a.type&&g.remove(b._internal.componentOutputs,{id:a.id})},this),a.on("renamed",function(a){b.name=a.newName},this)}},_onNodeDeleted:{value:function(){this.model&&(this.model.removeListenersWithRef(this),this.model=void 0),this.nodeScope.reset(),e.prototype._onNodeDeleted.call(this)}},registerComponentInputPort:{value:function(a){this.registerInput(a.name,{set:function(b,c){this._internal.inputValues[a.name]=c?{value:b,unit:c}:b,this._internal.componentInputs.forEach(function(b){b.registerOutputIfNeeded(a.name),b.flagOutputDirty(a.name)})}})}},registerComponentOutputPort:{value:function(a){this.registerOutput(a.name,{getter:function(){return this._internal.componentOutputValues[a.name]}})}},setOutputFromComponentOutput:{value:function(a,b){!1!==this.hasOutput(a)&&(this._internal.componentOutputValues[a]=b,this.flagOutputDirty(a))}},setRoot:{value:function(a){if(!a)throw Error("id must be set");var b=this.nodeScope.getNodeWithId(a);if(b.getVisualRoot){this._internal.root&&this.resetRoot(),this._internal.root=b;var c=b.getVisualRoot();c&&(c._internal.visualParent&&c._internal.visualParent.removeChild(this._internal.root),void 0===c.componentIds&&(c.componentIds=[]),-1===c.componentIds.indexOf(this.id)&&c.componentIds.push(this.id))}}},resetRoot:{value:function(){this._internal.visualParent&&this._internal.visualParent.removeChild(this);var a=this._internal.root.getVisualRoot();if(this._internal.root=void 0,a&&a.componentIds){var b=a.componentIds.indexOf(this.id);-1!==b&&a.componentIds.splice(b,1)}}},setChildRoot:{value:function(a){var b=this._internal.childRoot,c=a;if(this._internal.childRoot=c,this.model.children){var d=this.parentNodeScope,e=this.model.children.map(function(a){return d.getNodeWithId(a.id)});if(b)for(var f=0;f<e.length;f++)b.isChild(e[f])&&b.removeChild(e[f]);if(c)for(var f=0;f<e.length;f++){var g=e[f],h=g.model.parent.children.indexOf(g.model);this.addChild(g,h)}}}},
getChildRootIndex:{value:function(){if(!this._internal.childRoot||!this._internal.childRoot.model||!this._internal.childRoot.model.children)return 0;for(var a=this._internal.childRoot.model.children,b=0;b<a.length;b++)if("Component Children"===a[b].type)return b;return 0}},getChildRoot:{value:function(){return this._internal.childRoot?this._internal.childRoot:this._internal.root.getChildRoot()}},getVisualRoot:{value:function(){if(this._internal.root)return this._internal.root.getVisualRoot()}},addChild:{value:function(a,b){this.getChildRoot().addChild(a,b+this.getChildRootIndex())}},flagDirty:{value:function(){if(!this._dirty){e.prototype.flagDirty.call(this);for(var a=this._internal.componentInputs,b=0,c=a.length;b<c;b++)a[b].flagDirty();this._internal.componentOutputs.forEach(function(a){a.flagDirty()})}}},setHighlightEnabled:{value:function(a){var b=this.getVisualRoot();b&&b.setHighlightEnabled&&b.setHighlightEnabled(a)}},update:{value:function(){e.prototype.update.call(this),this._internal.componentOutputs.forEach(function(a){a.update()})}}}),d.prototype.constructor=d,b.exports=d},{"../node":79,"../nodescope":159,lodash:12}],90:[function(a,b,c){"use strict";b.exports={node:{category:"Component Utilities",name:"Component Outputs",panels:[{name:"PortEditor",context:["select","connectTo"],title:"Outputs",plug:"input",type:{name:"*"},canArrangeInGroups:!0},{name:"PropertyEditor",hidden:!0}],color:"component",haveComponentPorts:!0,prototypeExtensions:{registerInputIfNeeded:function(a){this.hasInput(a)||this.registerInput(a,{set:function(b){this.nodeScope.componentOwner.setOutputFromComponentOutput(a,b)}})}}}}},{}],91:[function(a,b,c){"use strict";var d=a("../nodedefinition");b.exports=d.defineNode({name:"Counter",category:"Math",initialize:function(){this._internal.currentValue=0,this._internal.startValue=0,this._internal.startValueSet=!1,this._internal.limitsEnabled=!1,this._internal.limitsMin=0,this._internal.limitsMax=0},inputs:{increase:{displayName:"Increase Count",valueChangedToTrue:function(){this._internal.limitsEnabled&&this._internal.currentValue>=this._internal.limitsMax||(this._internal.currentValue++,this.flagOutputDirty("currentCount"),this.sendSignalOnOutput("countChanged"))}},decrease:{displayName:"Decrease Count",valueChangedToTrue:function(){this._internal.limitsEnabled&&this._internal.currentValue<=this._internal.limitsMin||(this._internal.currentValue--,this.flagOutputDirty("currentCount"),this.sendSignalOnOutput("countChanged"))}},reset:{displayName:"Reset To Start",valueChangedToTrue:function(){0!==this.currentValue&&(this._internal.currentValue=this._internal.startValue,this.flagOutputDirty("currentCount"),this.sendSignalOnOutput("countChanged"))}},startValue:{type:"number",displayName:"Start Value",default:0,set:function(a){this._internal.startValue=Number(a),!1===this._internal.startValueSet&&(this._internal.startValueSet=!0,this._internal.currentValue=this._internal.startValue,this.flagOutputDirty("currentCount"),this.sendSignalOnOutput("countChanged"))}},limitsMin:{type:{name:"number"},displayName:"Min Value",group:"Limits",default:0,set:function(a){this._internal.limitsMin=Number(a)}},limitsMax:{type:{name:"number"},displayName:"Max Value",group:"Limits",default:0,set:function(a){this._internal.limitsMax=Number(a)}},limitsEnabled:{type:{name:"boolean"},displayName:"Limits Enabled",group:"Limits",default:!1,set:function(a){this._internal.limitsEnabled=!!a}}},outputs:{currentCount:{displayName:"Current Count",type:"number",getter:function(){return this._internal.currentValue}},countChanged:{displayName:"Count Changed",type:"signal"}}})},{"../nodedefinition":81}],92:[function(a,b,c){"use strict";function d(){this.items=[]}var e=a("./model"),f=a("lodash"),g={};d.get=function(a){return void 0===a&&(a=e.guid()),g[a]||(g[a]=new d),g[a]},d.exists=function(a){return void 0!==g[a]},d.prototype.on=function(a,b){this.listeners||(this.listeners={}),this.listeners[a]||(this.listeners[a]=[]),this.listeners[a].push(b)},d.prototype.off=function(a,b){if(this.listeners&&this.listeners[a]){var c=this.listeners[a].indexOf(b);-1!==c&&this.listeners[a].splice(c,1)}},d.prototype.notify=function(a,b){if(this.listeners&&this.listeners[a])for(var c=f.clone(this.listeners[a]),d=0;d<c.length;d++)c[d](b)},d.prototype.set=function(a){function b(a){for(var b={},c=a.length,d=0;d<c;d++){var e=a[d];b[e.getId()]=e}return b}var c,f;if(a!==this){var a=a instanceof d?a.items:a,g=[];for(c=a.length,f=0;f<c;f++){var h=a[f];h instanceof e?g.push(h):g.push(e.create(h))}var i=this.items,j=b(i),k=b(g);for(c=i.length,f=0;f<c;f++)k.hasOwnProperty(i[f].getId())||(this.removeAtIndex(f),f--,c--);for(f=0;f<Math.min(i.length,g.length);f++)i[f]!==g[f]&&(j.hasOwnProperty(g[f].getId())&&this.remove(g[f]),this.addAtIndex(g[f],f));for(f=i.length;f<g.length;f++)this.add(g[f])}},d.prototype.contains=function(a){return-1!==this.items.indexOf(a)},d.prototype.add=function(a){this.contains(a)||(this.items.push(a),this.notify("add",{item:a}),this.notify("change"),a.notify("add",{collection:this}))},d.prototype.addAtIndex=function(a,b){this.contains(a)||(this.items.splice(b,0,a),this.notify("add",{item:a,index:b}),this.notify("change"),a.notify("add",{collection:this,index:b}))},d.prototype.removeAtIndex=function(a){var b=this.items[a];this.items.splice(a,1),this.notify("remove",{item:b,index:a}),this.notify("change"),b.notify("remove",{collection:this})},d.prototype.remove=function(a){var b=this.items.indexOf(a);-1!==b&&this.removeAtIndex(b)},d.prototype.size=function(){return this.items.length},d.prototype.get=function(a){return this.items[a]},d.prototype.each=function(a){for(var b=0;b<this.items.length;b++)a(this.items[b],b)},b.exports=d},{"./model":96,lodash:12}],93:[function(a,b,c){"use strict";var d=a("../../nodedefinition"),e=a("../../node"),f=a("./model"),g=a("./collection"),h=a("./persisthelper"),i=a("lodash");h.setDeltaHandlerForType("collection",function(a,b){for(var c=g.get(a),d=0,e=b.removed.length;d<e;d++){var h=b.removed[d];c.remove(f.get(h))}for(var d=0,e=b.added.length;d<e;d++){var i,j=b.added[d];i=f.exists(j.id)?f.get(j.id):f.create(j),c.add(i)}}),h.setInitialFetchHandlerForType("collection",function(a,b){var c=g.get(a);if(c){for(var d=[],e=0,h=b.length;e<h;e++){var i,j=b[e];i=f.exists(j.id)?f.get(j.id):f.create(j),d.push(i)}c.set(d)}});var j={name:"Collection",category:"Data",usePortAsLabel:"collectionId",color:"data",dynamicports:[{name:"conditionalports/basic",condition:"persistType = local OR persistType = global",ports:[{name:"persist",plug:"input",type:"signal",displayName:"Persist",group:"Persistence"},{name:"fetch",plug:"input",type:"signal",displayName:"Fetch",group:"Persistence"},{name:"persistWorking",plug:"output",type:"boolean",displayName:"In Progress",group:"Persistence"},{name:"persistSuccess",plug:"output",type:"signal",displayName:"Persist Success",group:"Persistence"},{name:"persistFailure",plug:"output",type:"signal",displayName:"Persist Failure",group:"Persistence"},{name:"fetchSuccess",plug:"output",type:"signal",displayName:"Fetch Success",group:"Persistence"},{name:"fetchFailure",plug:"output",type:"signal",displayName:"Fetch Failure",group:"Persistence"}]}],initialize:function(){var a=this,b=!1;this._internal.collectionChangedCallback=function(){b||(b=!0,a.scheduleAfterInputsHaveUpdated(function(){a.sendSignalOnOutput("modified"),a.flagOutputDirty("count"),b=!1}))},this._internal.copySourceItemsCallback=function(){a.copySourceItems()},this._internal.persistHelper=new h({scheduleFunction:this.scheduleAfterInputsHaveUpdated.bind(this),onPersistDataNeeded:function(){var b=a._internal.collection;if(b){var c=[];return b.each(function(a){c.push(a.getId())}),c}},onPersistSuccess:function(){a.sendSignalOnOutput("persistSuccess")},onPersistFailure:function(){a.sendSignalOnOutput("persistFailure")},onFetchSuccess:function(b){var c=a._internal.collection;if(c){for(var d=[],e=0,g=b.length;e<g;e++){var h,i=b[e];h=f.exists(i.id)?f.get(i.id):f.create(i),d.push(h)}c.set(d)}a.sendSignalOnOutput("fetchSuccess")},onFetchFailure:function(){a.sendSignalOnOutput("fetchFailure")},onWorkingChanged:function(){a.flagOutputDirty("persistWorking")}})},inputs:{collectionId:{type:"string",displayName:"Id",group:"General",set:function(a){this.setCollectionID(a)}},items:{type:"collection",group:"Modify",displayName:"Items",set:function(a){if(a&&a!==this._internal.sourceItems)if(a instanceof g)this.bindSourceCollection(a),this.scheduleCopySourceItems();else if(i.isArray(a)){var b=this._internal;this.scheduleAfterInputsHaveUpdated(function(){b.collection&&b.collection.set(a)})}}},modifyId:{type:{name:"string",allowConnectionsOnly:!0},displayName:"Item Id",group:"Modify",set:function(a){this._internal.modifyId=a}},add:{displayName:"Add",group:"Modify",valueChangedToTrue:function(){var a=this,b=this._internal;this.scheduleAfterInputsHaveUpdated(function(){if(b.modifyId){var c=f.get(b.modifyId);b.collection.add(c),"sync"===a._internal.persistHelper.persistType&&a._internal.persistHelper.schedulePersist()}})}},remove:{displayName:"Remove",group:"Modify",valueChangedToTrue:function(){var a=this,b=this._internal;this.scheduleAfterInputsHaveUpdated(function(){if(b.modifyId){var c=f.get(b.modifyId);b.collection.remove(c),"sync"===a._internal.persistHelper.persistType&&a._internal.persistHelper.schedulePersist()}})}},clear:{displayName:"Clear",group:"Modify",valueChangedToTrue:function(){var a=this,b=this._internal;this.scheduleAfterInputsHaveUpdated(function(){b.collection.set([]),a.sendSignalOnOutput("modified"),"sync"===a._internal.persistHelper.persistType&&a._internal.persistHelper.schedulePersist()})}},persistType:{displayName:"Type",group:"Persistence",type:{name:"enum",enums:[{value:"none",label:"None"},{value:"local",label:"Local"},{value:"global",label:"Global"},{value:"sync",label:"Sync"}]},default:"none",set:function(a){this._internal.persistHelper.setPersistType(a)}},persist:{displayName:"Persist",group:"Persistence",valueChangedToTrue:function(){this._internal.persistHelper.schedulePersist()}},fetch:{displayName:"Fetch",group:"Persistence",valueChangedToTrue:function(){this._internal.persistHelper.scheduleFetch()}}},outputs:{id:{type:"string",displayName:"Id",group:"General",getter:function(){return this._internal.name}},items:{type:"collection",displayName:"Items",group:"General",getter:function(){return this._internal.collection}},count:{type:"number",displayName:"Count",group:"General",getter:function(){return this._internal.collection?this._internal.collection.size():0}},modified:{group:"Events",type:"signal",displayName:"Modified"},persistWorking:{displayName:"In Progress",group:"Persistence",type:"boolean",getter:function(){return this._internal.persistHelper.isWorking()}},persistSuccess:{displayName:"Persist Success",group:"Persistence",type:"signal"},persistFailure:{displayName:"Persist Failure",group:"Persistence",type:"signal"},fetchSuccess:{displayName:"Fetch Success",group:"Persistence",type:"signal"},fetchFailure:{displayName:"Fetch Failure",group:"Persistence",type:"signal"}},prototypeExtensions:{setCollectionID:function(a){this._internal.name=a,this.setCollection(g.get(a)),this.flagOutputDirty("id"),this._internal.persistHelper.setId("collection/"+a)},setCollection:function(a){this.bindCollection(a),this.flagOutputDirty("items"),this.flagOutputDirty("count")},unbindSourceCollection:function(){var a=this._internal;a.sourceItems&&a.sourceItems instanceof g&&(a.sourceItems.off("change",this._internal.copySourceItemsCallback),a.sourceItems=void 0)},bindSourceCollection:function(a){var b=this._internal;this.unbindSourceCollection(),b.sourceItems=a,a instanceof g&&a.on("change",this._internal.copySourceItemsCallback)},unbindCurrentCollection:function(){var a=this._internal.collection;a&&(a.off("change",this._internal.collectionChangedCallback),this._internal.collection=void 0)},bindCollection:function(a){this.unbindCurrentCollection(),this._internal.collection=a,a.on("change",this._internal.collectionChangedCallback)},_onNodeDeleted:function(){e.prototype._onNodeDeleted.call(this),this.unbindCurrentCollection()},scheduleCopySourceItems:function(){var a=this._internal;a.hasScheduledCopySourceItems||(a.hasScheduledCopySourceItems=!0,this.scheduleAfterInputsHaveUpdated(this.copySourceItems.bind(this)))},copySourceItems:function(){var a=this._internal;a.hasScheduledCopySourceItems=!1,(a.collection||void 0!==a.idType&&"explicit"!==a.idType)&&(a.collection||"unique"!==a.idType||this.newCollectionID(),a.collection.set(a.sourceItems))}}},k=d.defineNode(j);b.exports=k},{"../../node":79,"../../nodedefinition":81,"./collection":92,"./model":96,"./persisthelper":98,lodash:12}],94:[function(a,b,c){"use strict";var d=a("../../nodedefinition"),f=a("../../node"),g=a("../../guid"),h="// model item is available in item variable\n// set the component variable to the name of the desired component for this\n// item. Component name must start with a '/'.\ncomponent = '/MyComponent';",i={name:"For Each",color:"data",category:"Visual",dynamicports:[{name:"conditionalports/basic",condition:"templateType = explicit OR templateType NOT SET",ports:[{name:"template",plug:"input",type:"component",displayName:"Component",group:"Appearance"}]},{name:"conditionalports/basic",condition:"templateType = dynamic",ports:[{name:"templateScript",plug:"input",type:{name:"string",codeeditor:"javascript",allowEditOnly:!0},displayName:"Script",default:h,group:"Appearance"}]}],initialize:function(){this._internal.itemNodes=[];var a=this;this._internal.onAddItem=function(b){a.addItem(b.item,b.index)},this._internal.onRemoveItem=function(b){a.removeItem(b.item)}},inputs:{items:{group:"Data",displayName:"Items",type:{name:"collection",allowConnectionsOnly:!0},set:function(a){a&&a!==this._internal.items&&(this.bindCollection(a),this.scheduleRefresh())}},templateType:{group:"Appearance",displayName:"Template Type",type:{name:"enum",enums:[{label:"Explicit",value:"explicit"},{label:"Dynamic",value:"dynamic"}]},default:"explicit",set:function(a){this._internal.templateType=a,this.scheduleRefresh()}},template:{set:function(a){this._internal.template=a,this.scheduleRefresh()}},templateScript:{set:function(a){try{this._internal.templateFunction=new Function("item","var component;"+a+";return component;")}catch(e){console.log(e),this.context.editorConnection&&this.context.editorConnection.sendWarning(this.nodeScope.componentOwner.name,this.id,"foreach-syntax-warning",{message:"<strong>Syntax</strong>: "+e.message})}this.scheduleRefresh()}},refresh:{group:"Appearance",displayName:"Refresh",type:"signal",valueChangedToTrue:function(){this.scheduleRefresh()}}},prototypeExtensions:{updateTarget:function(a){this._internal.target=a?this.nodeScope.getNodeWithId(a):void 0,this.scheduleRefresh()},setNodeModel:function(a){f.prototype.setNodeModel.call(this,a),a.parent&&this.updateTarget(a.parent.id);var b=this;a.on("parentUpdated",function(a){b.updateTarget(a?a.id:void 0)},this)},scheduleRefresh:function(){var a=this,b=this._internal;b.hasScheduledRefresh||(b.hasScheduledRefresh=!0,this.scheduleAfterInputsHaveUpdated(function(){a.refresh()}))},unbindCurrentCollection:function(){var a=this._internal.items;a&&(a.off("add",this._internal.onAddItem),a.off("remove",this._internal.onRemoveItem),this._internal.collection=void 0)},bindCollection:function(a){var b=this._internal;this.unbindCurrentCollection(),a.on("add",this._internal.onAddItem),a.on("remove",this._internal.onRemoveItem),b.items=a},getTemplateForModel:function(a){var b=this._internal;if(void 0===b.templateType||"explicit"===b.templateType)return b.template;if(b.templateFunction){try{var c=b.templateFunction(a)}catch(e){console.log(e),this.context.editorConnection&&this.context.editorConnection.sendWarning(this.nodeScope.componentOwner.name,this.id,"foreach-dynamic-warning",{message:"<strong>Dynamic template</strong>: "+e.message})}return c}},addItem:function(a,b){var c=this._internal,d=this.getTemplateForModel(a);if(d){var e=this.nodeScope.createNode(d,g());e._forEachModel=a;var f=e.nodeScope.getNodesWithType("For Each Actions");if(f&&f.length>0)for(var h=0;h<f.length;h++)f[h].setItemId(a.getId()),f[h].signalAdded();c.itemNodes.push(e),c.target.addChild(e,b)}},removeItem:function(a){function b(){var b=c.target._internal.children;for(var d in b){var e=b[d];if(e._forEachModel===a&&!e._forEachRemoveInProgress)return e}}var c=this._internal,d=b();if(d){var e=d.nodeScope.getNodesWithType("For Each Actions");e&&e.length>0?(d._forEachRemoveInProgress=!0,e[0].tryRemove(function(){d._deleted||(c.target.removeChild(d),c.target.nodeScope.deleteNode(d))})):d._deleted||(c.target.removeChild(d),c.target.nodeScope.deleteNode(d));var f=c.itemNodes.indexOf(d);-1!==f&&c.itemNodes.splice(f,1)}},refresh:function(){var a=this._internal;if(a.hasScheduledRefresh=!1,(a.template||a.templateFunction)&&a.items&&a.target){for(var b=0;b<a.itemNodes.length;b++)a.target.removeChild(a.itemNodes[b]);a.itemNodes=[];for(var b=0;b<a.items.size();b++){var c=a.items.get(b);this.addItem(c)}}},_onNodeDeleted:function(){f.prototype._onNodeDeleted.call(this),this.unbindCurrentCollection()}}};b.exports=d.defineNode(i)},{"../../guid":73,"../../node":79,"../../nodedefinition":81}],95:[function(a,b,c){"use strict";var d={name:"For Each Actions",displayNodeName:"For Each Item",category:"Data",color:"data",inputs:{removeCompleted:{type:{name:"boolean",allowConnectionsOnly:!0},displayName:"Remove Completed",group:"Events",valueChangedToTrue:function(){this._internal.removeCompletedCallback&&this._internal.removeCompletedCallback()}}},outputs:{added:{type:"signal",displayName:"Added",group:"Events"},tryRemove:{type:"signal",displayName:"Try Remove",group:"Events"},itemId:{type:"string",displayName:"Item Id",group:"General",getter:function(){return this._internal.itemId}}},prototypeExtensions:{setItemId:function(a){this._internal.itemId=a,this.flagOutputDirty("itemId")},signalAdded:function(){this.sendSignalOnOutput("added")},tryRemove:function(a){this.getOutput("tryRemove").hasConnections()?(this._internal.removeCompletedCallback=a,this.sendSignalOnOutput("tryRemove")):this.scheduleAfterInputsHaveUpdated(function(){a()})}}};b.exports={node:d}},{}],96:[function(a,b,c){function d(a,b){this.id=a,this.data=b}var e=a("lodash"),f={};d.get=function(a){return void 0===a&&(a=d.guid()),f[a]||(f[a]=new d(a,{})),f[a]},d.create=function(a){var b=a||{},c=d.get(b.id);for(var e in b)"id"!==e&&c.set(e,b[e]);return c},d.exists=function(a){return void 0!==f[a]},d.guid=function(){function a(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}return a()+a()+"-"+a()+"-"+a()+"-"+a()+"-"+a()+a()+a()},d.prototype.on=function(a,b){this.listeners||(this.listeners={}),this.listeners[a]||(this.listeners[a]=[]),this.listeners[a].push(b)},d.prototype.off=function(a,b){if(this.listeners&&this.listeners[a]){var c=this.listeners[a].indexOf(b);-1!==c&&this.listeners[a].splice(c,1)}},d.prototype.notify=function(a,b){if(this.listeners&&this.listeners[a])for(var c=e.clone(this.listeners[a]),d=0;d<c.length;d++)c[d](b)},d.prototype.setAll=function(a){for(var b in a)if("id"!==b&&this.data[b]!==a[b]){var c=this.data[b];this.data[b]=a[b],this.notify("change",{name:b,value:a[b],old:c})}},d.prototype.set=function(a,b,c){if(c&&c.resolve&&-1!==a.indexOf(".")){for(var e=a.split("."),f=this,g=0;g<e.length-1;g++){var h=f.get(e[g]);if(!(h instanceof d))return;f=h}return void f.set(e[e.length-1],b)}var i=this.data[a];this.data[a]=b,i!==b&&(!c||!c.silent)&&this.notify("change",{name:a,value:b,old:i})},d.prototype.getId=function(){return this.id},d.prototype.get=function(a,b){if(b&&b.resolve&&-1!==a.indexOf(".")){for(var c=a.split("."),e=this,f=0;f<c.length-1;f++){var g=e.get(c[f]);if(!(g instanceof d))return;e=g}return e.get(c[c.length-1])}return this.data[a]},b.exports=d},{lodash:12}],97:[function(a,b,c){"use strict";function d(a){return this._internal.model?this._internal.model.get(a,{resolve:!0}):void 0}function e(a,b){this._internal.inputValues[a]=b}function f(a,b){if(a&&b&&a.length===b.length){for(var c={},d=0;d<a.length;d++){if(-1===b.indexOf(a[d])){if(c.before)return;c.before=a[d]}if(-1===a.indexOf(b[d])){if(c.after)return;c.after=b[d]}}return c.before&&c.after?c:void 0}}function g(a,b,c){var d=[];b=b?b.split(","):void 0;for(var e in b){var g=b[e];d.push({type:{name:"*",allowConnectionsOnly:!0},plug:"input/output",group:"Properties",name:g})}var h=f(l[a],b);if(l[a]=b,h)var i={plug:"input/output",patterns:["{{*}}"],before:h.before,after:h.after};var j=JSON.stringify(d);k[a]!==j&&(k[a]=j,c.sendDynamicPorts(a,d,{renamed:i}))}var h=a("./model"),i=(a("../../edgetriggeredinput"),a("../../node")),j=a("./persisthelper"),k={},l={};j.setDeltaHandlerForType("model",function(a,b){var c=h.get(a);for(var d in b)c.set(d,b[d])}),j.setInitialFetchHandlerForType("model",function(a,b){var c=h.get(a);c&&c.setAll(b)});var m={name:"Model",category:"Data",usePortAsLabel:"modelId",color:"data",dynamicports:[{name:"conditionalports/basic",condition:"persistType = local OR persistType = global",ports:[{name:"persist",plug:"input",type:"signal",displayName:"Persist",group:"Persistence"},{name:"fetch",plug:"input",type:"signal",displayName:"Fetch",group:"Persistence"},{name:"persistWorking",plug:"output",type:"boolean",displayName:"In Progress",group:"Persistence"},{name:"persistSuccess",plug:"output",type:"signal",displayName:"Persist Success",group:"Persistence"},{name:"persistFailure",plug:"output",type:"signal",displayName:"Persist Failure",group:"Persistence"},{name:"fetchSuccess",plug:"output",type:"signal",displayName:"Fetch Success",group:"Persistence"},{name:"fetchFailure",plug:"output",type:"signal",displayName:"Fetch Failure",group:"Persistence"}]}],initialize:function(){var a=this._internal;a.inputValues={};var b=this;this._internal.onModelChangedCallback=function(a){b.hasOutput(a.name)&&b.flagOutputDirty(a.name)},this._internal.persistHelper=new j({scheduleFunction:this.scheduleAfterInputsHaveUpdated.bind(this),onPersistDataNeeded:function(){for(var c in a.inputValues)a.model.set(c,a.inputValues[c],{resolve:!0});return b.sendSignalOnOutput("stored"),a.model.data},onPersistSuccess:function(){b.sendSignalOnOutput("persistSuccess")},onPersistFailure:function(){b.sendSignalOnOutput("persistFailure")},onFetchSuccess:function(c){a.model.setAll(c),b.sendSignalOnOutput("fetchSuccess")},onFetchFailure:function(){b.sendSignalOnOutput("fetchFailure")},onWorkingChanged:function(){b.flagOutputDirty("persistWorking")}})},outputs:{id:{type:"string",displayName:"Id",group:"General",getter:function(){return this._internal.model?this._internal.model.getId():void 0}},stored:{type:"signal",displayName:"Stored",group:"Events"},persistWorking:{displayName:"In Progress",group:"Persistence",type:"boolean",getter:function(){return this._internal.persistHelper.isWorking()}},persistSuccess:{displayName:"Persist Success",group:"Persistence",type:"signal"},persistFailure:{displayName:"Persist Failure",group:"Persistence",type:"signal"},fetchSuccess:{displayName:"Fetch Success",group:"Persistence",type:"signal"},fetchFailure:{displayName:"Fetch Failure",group:"Persistence",type:"signal"}},inputs:{modelId:{type:"string",displayName:"Id",group:"General",set:function(a){this.setModelID(a)}},properties:{type:{name:"stringlist",allowEditOnly:!0},displayName:"Properties",group:"Properties",set:function(a){}},store:{displayName:"Store",group:"Actions",valueChangedToTrue:function(){this.scheduleStore()}},clear:{displayName:"Clear",group:"Actions",valueChangedToTrue:function(){var a=this._internal;if(a.model)for(var b in a.inputValues)a.model.set(b,void 0,{resolve:!0})}},persistType:{displayName:"Type",group:"Persistence",type:{name:"enum",enums:[{value:"none",label:"None"},{value:"local",label:"Local"},{value:"global",label:"Global"},{value:"sync",label:"Sync"}]},default:"none",set:function(a){this._internal.persistHelper.setPersistType(a)}},persist:{displayName:"Persist",group:"Persistence",valueChangedToTrue:function(){this._internal.persistHelper.schedulePersist()}},fetch:{displayName:"Fetch",group:"Persistence",valueChangedToTrue:function(){this._internal.persistHelper.scheduleFetch()}}},prototypeExtensions:{scheduleStore:function(){if(!this.hasScheduledStore){this.hasScheduledStore=!0;var a=this._internal;this.scheduleAfterInputsHaveUpdated(function(){if(this.hasScheduledStore=!1,a.model){for(var b in a.inputValues)a.model.set(b,a.inputValues[b],{resolve:!0});this.sendSignalOnOutput("stored"),"sync"===this._internal.persistHelper.persistType&&this._internal.persistHelper.schedulePersist()}})}},setModelID:function(a){var b=h.get(a);this.setModel(b),this._internal.persistHelper.setId("model/"+a)},setModel:function(a){this._internal.model&&this._internal.model.off("change",this._internal.onModelChangedCallback),this._internal.model=a,this.flagOutputDirty("id"),a.on("change",this._internal.onModelChangedCallback);for(var b in a.data)this.hasOutput(b)&&this.flagOutputDirty(b)},_onNodeDeleted:function(){i.prototype._onNodeDeleted.call(this),this._internal.model&&this._internal.model.off("change",this._internal.onModelChangedCallback),this._internal.persistHelper.unsubscribe()},registerOutputIfNeeded:function(a){this.hasOutput(a)||this.registerOutput(a,{getter:d.bind(this,a)})},registerInputIfNeeded:function(a){this.hasInput(a)||this.registerInput(a,{set:e.bind(this,a)})}}};b.exports={node:m,setup:function(a,b){a.editorConnection&&a.editorConnection.isRunningLocally()&&b.on("nodeAdded.Model",function(b){b.parameters.properties&&g(b.id,b.parameters.properties,a.editorConnection),b.on("parameterUpdated",function(c){"properties"===c.name&&g(b.id,b.parameters.properties,a.editorConnection)})})}}},{"../../edgetriggeredinput":68,"../../node":79,"./model":96,"./persisthelper":98}],98:[function(a,b,c){"use strict";function d(){function a(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}return a()+a()+"-"+a()+"-"+a()+"-"+a()+"-"+a()+a()+a()}function e(a){var b=a.topic.substring("ndl/persist/getaccepted/".length);if(m[b]===a.payload.clientToken){var c=b.split("/")[0],d=b.substring(c.length+1);n[c](d,a.payload.data)}}function f(a){m[a]||(k.pubsub.subscribe("ndl/persist/getaccepted/"+a,e),m[a]=d(),k.pubsub.publish("ndl/persist/get/"+a,{clientToken:m[a]}))}function g(){o||(o=!0,k.pubsub.on("connected",function(){for(var a in m)k.pubsub.publish("ndl/persist/get/"+a,{clientToken:m[a]})}))}function h(a){var b=a.topic.substring("ndl/persist/delta/".length);if(p[b]){var c=b.split("/")[0],d=b.substring(c.length+1);q[c](d,a.payload.delta)}}function i(a){p[a]?p[a].cnt++:(p[a]={cnt:1},k.pubsub.subscribe("ndl/persist/delta/"+a,h))}function j(a){p[a]&&0===--p[a].cnt&&(k.pubsub.unsubscribe("ndl/persist/delta/"+a,h),delete p[a],delete m[a])}var k=a("../../services/services"),l=function(a){for(var b in a)this[b]=a[b];this.hasScheduled={},g()},m={},n={};l.setInitialFetchHandlerForType=function(a,b){n[a]=b};var o=!1,p={},q={};l.setDeltaHandlerForType=function(a,b){q[a]=b},l.prototype.setId=function(a){this.id=a;var b=this;this.schedule("subscribeToPersistService",function(){b.subscribeToPersistService()})},l.prototype.isWorking=function(){return!!this.persistWorking},l.prototype.setPersistType=function(a){this.persistType=a;var b=this;this.schedule("subscribeToPersistService",function(){b.subscribeToPersistService()})},l.prototype.schedule=function(a,b){var c=this;this.hasScheduled[a]||(this.hasScheduled[a]=!0,this.scheduleFunction(function(){b(),c.hasScheduled[a]=!1}))},l.prototype.unsubscribe=function(){this.lastSubscribedId&&(k.pubsub.unsubscribe("ndl/persist/updateaccepted/"+this.lastSubscribedId,this.messageHandler),k.pubsub.unsubscribe("ndl/persist/updaterejected/"+this.lastSubscribedId,this.messageHandler),k.pubsub.unsubscribe("ndl/persist/getaccepted/"+this.lastSubscribedId,this.messageHandler),k.pubsub.unsubscribe("ndl/persist/getrejected/"+this.lastSubscribedId,this.messageHandler),j(this.lastSubscribedId))},l.prototype.handleMessage=function(a){0===a.topic.indexOf("ndl/persist/updateaccepted/")?a.payload.clientToken===this.persistUpdateClientToken&&(this.persistWorking=!1,this.onWorkingChanged(this.persistWorking),this.onPersistSuccess()):0===a.topic.indexOf("ndl/persist/updaterejected/")?a.payload.clientToken===this.persistUpdateClientToken&&(this.persistWorking=!1,this.onWorkingChanged(this.persistWorking),this.onPersistFailure()):0===a.topic.indexOf("ndl/persist/getaccepted/")?a.payload.clientToken===this.persistGetClientToken&&(this.persistWorking=!1,this.onWorkingChanged(this.persistWorking),this.onFetchSuccess(a.payload.data)):0===a.topic.indexOf("ndl/persist/getrejected/")&&a.payload.clientToken===this.persistGetClientToken&&(this.persistWorking=!1,this.onWorkingChanged(this.persistWorking),this.onFetchFailure())},l.prototype.subscribeToPersistService=function(){var a=""!==this.id?this.id:void 0;"global"!==this.persistType&&"sync"!==this.persistType||this.lastSubscribedId!==a&&(this.unsubscribe(),this.lastSubscribedId=a,void 0!==a&&("global"!==this.persistType&&"sync"!==this.persistType||(this.messageHandler=this.handleMessage.bind(this),k.pubsub.subscribe("ndl/persist/updateaccepted/"+a,this.messageHandler),k.pubsub.subscribe("ndl/persist/updaterejected/"+a,this.messageHandler),k.pubsub.subscribe("ndl/persist/getaccepted/"+a,this.messageHandler),k.pubsub.subscribe("ndl/persist/getrejected/"+a,this.messageHandler),"sync"===this.persistType&&(i(a),f(a)))))},l.prototype.schedulePersist=function(){var a=this;this.schedule("schedulePersist",function(){a.persistData(a.onPersistDataNeeded())})},l.prototype.persistData=function(a){if(a){var b=this.persistType,c=this.id;if("local"===b)try{localStorage["noodl-persist-"+c]=JSON.stringify(a),this.onPersistSuccess()}catch(e){this.onPersistFailure()}else"global"!==b&&"sync"!==b||(this.persistUpdateClientToken=d(),k.pubsub.publish("ndl/persist/update/"+c,{data:a,clientToken:this.persistUpdateClientToken}),this.persistWorking=!0,this.onWorkingChanged(this.persistWorking))}},l.prototype.scheduleFetch=function(){var a=this;this.schedule("scheduleFetch",function(){a.fetchData()})},l.prototype.fetchData=function(){var a=this.persistType,b=this.id;if("local"===a)try{var c=localStorage["noodl-persist-"+b],e=JSON.parse(c||"{}");if(0===b.indexOf("collection/")){for(var f=[],g=0;g<e.length;g++){var h=localStorage["noodl-persist-model/"+e[g]],i=JSON.parse(h||"{}");i.id=e[g],f.push(i)}this.onFetchSuccess(f)}else this.onFetchSuccess(e)}catch(e){this.onFetchFailure()}else"global"!==a&&"sync"!==a||(this.persistGetClientToken=d(),k.pubsub.publish("ndl/persist/get/"+b,{clientToken:this.persistGetClientToken}),this.persistWorking=!0,this.onWorkingChanged(this.persistWorking))},b.exports=l},{"../../services/services":166}],99:[function(a,b,c){"use strict";function d(a){return this._internal.responseOutputs[a]}function e(a,b){this._internal.requestInputs[a]=b}function f(a,b){function c(a){for(var b=0;b<d.length;b++)if(d[b].name===a)return!0;return!1}if(a.parameters){var d=[];if(a.parameters.resource){var e=a.parameters.resource.match(/\{[A-Za-z0-9_]*\}/g);for(var f in e){var h=e[f],i=h.replace("{","").replace("}","");d.push({name:i,type:"string",plug:"input",group:"Inputs"})}}if(a.parameters.externalFile&&"yes"===a.parameters.useExternalFile){var j=a.parameters.externalFile;void 0!==b&&"/"!==j[0]&&(j="/"+j),g.createFromURL(j,null,function(e){e.getPorts().forEach(function(a){c(a.name)||d.push(a)}),b.sendDynamicPorts(a.id,d)})}else if(a.parameters.code){var k=g.createFromCode(a.parameters.code,null);k.getPorts().forEach(function(a){c(a.name)||d.push(a)}),b.sendDynamicPorts(a.id,d)}}}var g=(a("../../nodedefinition"),a("../../node"),a("../../guid"),
a("../../javascriptnodeparser")),h=a("xml2js"),i="define({\n\t// The input ports of the REST node, name of input and type\n\tinputs:{\n\t    //ExampleInput:'number',\n\t},\n\t\n\t// The output ports of the REST node, name of output and type\n\toutputs:{\n\t    //ExampleOutput:'string',\n\t},\n\t\n\t//Add custom code to setup the request object before the request\n\t//is made.\n\t//\n\t//*request.resource     contains the resource path of the request.\n\t//*request.method       contains the method, GET, POST, PUT or DELETE.\n\t//*request.headers      is a map where you can add additional headers.\n\t//*request.parameters   is a map the parameters that will be appended\n\t//                      to the url.\n\t//*request.content      contains the content of the request as a javascript\n\t//                      object.\n\t//\n\t// The inputs and outputs maps can also be accessed via *this.inputs and\n\t// *this.outputs.\n\trequest:function(inputs,request) {\n\t},\n\t\n\t// Add custom code to convert the response content to outputs\n\t//\n\t//*response.status    The status code of the response\n\t//*response.content   The content of the response as a javascript\n\t//                    object.\n\t//*response.request   The request object that resulted in the response.\n\t//\n\t// The inputs and outputs maps can also be accessed via *this.inputs and\n\t// *this.outputs.\n\tresponse:function(outputs,response) {\n\t}\n})\n",j="//Add prototype backend code to response to the request\n//\n//*context.request                      contains the request object as passed from the\n//                                      request script.\n//*context.sendResponse(status,content) should be called to send a response back\n//                                      to the request script with status code\n//                                      and a javascript object with the content\n//                                      of the response.\ncontext.sendResponse(200,{result:'success'});\n",k={name:"REST",category:"Data",color:"data",initialize:function(){this._internal.requestInputs={},this._internal.responseOutputs={},this._internal.backendProperties={},this._internal.hasPendingFetch=!1,this._internal.useExternalFile=!1},dynamicports:[{name:"conditionalports/basic",condition:"backendType = external OR backendType NOT SET",ports:[{name:"backendEndpoint",plug:"input",type:{name:"string"},displayName:"Endpoint",group:"Backend"}]},{name:"conditionalports/basic",condition:"backendType = prototype",ports:[{name:"backendScript",plug:"input",type:{name:"string",codeeditor:"javascript",allowEditOnly:!0},displayName:"Script",default:j,group:"Backend"}]},{name:"conditionalports/basic",condition:"useExternalFile = no OR useExternalFile NOT SET",ports:[{name:"code",displayName:"Script",group:"Request",plug:"input",type:{name:"string",allowEditOnly:!0,codeeditor:"javascript"},default:i}]},{name:"conditionalports/basic",condition:"useExternalFile = yes",ports:[{name:"externalFile",displayName:"File Path",group:"Request",plug:"input",type:{name:"source",allowEditOnly:!0}}]}],inputs:{resource:{type:"string",displayName:"Resource",group:"Request",default:"/",set:function(a){this._internal.resource=a}},method:{type:{name:"enum",enums:[{label:"GET",value:"GET"},{label:"POST",value:"POST"},{label:"DELETE",value:"DELETE"},{label:"PUT",value:"PUT"}]},displayName:"Method",group:"Request",default:"GET",set:function(a){this._internal.method=a}},useExternalFile:{type:{name:"enum",enums:[{value:"yes",label:"Yes"},{value:"no",label:"No"}],allowEditOnly:!0},default:"no",displayName:"Use External File",group:"Request",set:function(a){this._internal.isWaitingForExternalFileToLoad="yes"===a,this._internal.useExternalFile="yes"===a}},code:{set:function(a){a&&this.scheduleAfterInputsHaveUpdated(function(){if(!1===this._internal.useExternalFile){var b=g.createFromCode(a,this.nodeScope.noodlJavascriptAPI);this._onCodeParsed(b)}})}},externalFile:{set:function(a){if(!1!==this._internal.useExternalFile){this.context.runningInEditor&&"/"!==a[0]&&(a="/"+a);var b=this;g.createFromURL(a,this.nodeScope.noodlJavascriptAPI,function(a){b._internal.isWaitingForExternalFileToLoad=!1,b._onCodeParsed(a),!0===b._internal.hasPendingFetch&&(b._internal.hasPendingFetch=!1,b.doFetch())})}}},fetch:{type:"signal",displayName:"Fetch",group:"Actions",valueChangedToTrue:function(){this.scheduleFetch()}},cancel:{type:"signal",displayName:"Cancel",group:"Actions",valueChangedToTrue:function(){this.cancelFetch()}},backendType:{type:{name:"enum",enums:[{label:"External",value:"external"},{label:"Prototype",value:"prototype"}],allowEditOnly:!0},displayName:"Backend type",group:"Backend",default:"external",set:function(a){this._internal.backendType=a}}},outputs:{fetching:{type:"boolean",displayName:"Fetching",group:"Status",getter:function(){return!!this._internal.fetching}},started:{type:"signal",displayName:"Started",group:"Signals"},completed:{type:"signal",displayName:"Completed",group:"Signals"},statusOK:{type:"signal",displayName:"Status OK",group:"Signals"},statusFail:{type:"signal",displayName:"Status Fail",group:"Signals"}},prototypeExtensions:{_onCodeParsed:function(a){if(this.context.editorConnection&&(this.context.editorConnection.clearWarnings(this.nodeScope.componentOwner.name,this.id),a.error&&this.context.editorConnection.sendWarning(this.nodeScope.componentOwner.name,this.id,"js-parse-waring",{message:a.error})),!a.error){var b=this;Object.keys(a.outputs).forEach(function(a){b.registerOutputIfNeeded(a)}),this._internal.requestFunction=a.definedObject.request,this._internal.responseFunction=a.definedObject.response}},registerOutputIfNeeded:function(a){this.hasOutput(a)||this.registerOutput(a,{getter:d.bind(this,a)})},registerInputIfNeeded:function(a){var b=this;this.hasInput(a)||(0===a.indexOf("backend")?this.registerInput(a,{set:function(c){b._internal.backendProperties[a]=c}}):this.registerInput(a,{set:e.bind(this,a)}))},scheduleFetch:function(){var a=this._internal;a.hasScheduledFetch||(a.hasScheduledFetch=!0,this.scheduleAfterInputsHaveUpdated(this.doFetch.bind(this)))},doResponse:function(a,b,c){if(this._internal.responseFunction){var d={inputs:this._internal.requestInputs,outputs:this._internal.responseOutputs};this._internal.responseFunction.apply(d,[this._internal.responseOutputs,{status:a,content:b,request:c}])}for(var e in this._internal.responseOutputs)this.hasOutput(e)&&this.flagOutputDirty(e);200===a?this.sendSignalOnOutput("statusOK"):this.sendSignalOnOutput("statusFail"),this._internal.fetching=!1,this.flagOutputDirty("fetching"),this.sendSignalOnOutput("completed")},doExternalFetch:function(a){var b=this,c=new window.XMLHttpRequest,d=this._internal.backendProperties.backendEndpoint+a.resource;if(Object.keys(a.parameters).length>0){d+="?";for(var e in a.parameters)d+=e+"="+a.parameters[e]+"&"}c.open(a.method,window.encodeURI(d),!0);for(var f in a.headers)c.setRequestHeader(f,a.headers[f]);c.onreadystatechange=function(){var c=(this.response,!1);if(4===this.readyState||this.readyState===XMLHttpRequest.DONE){var d=this.status,e=this.getResponseHeader("content-type"),f=this.response;e&&(e=e.toLowerCase(),-1!==e.indexOf("/json")?(b.doResponse(d,JSON.parse(f),a),c=!0):-1!==e.indexOf("/xml")&&(h.parseString(f,function(c,e){b.doResponse(d,c?f:e,a)}),c=!0)),!1===c&&b.doResponse(d,f,a)}},c.onerror=function(){console.log("REST: Failed to request",d)},a.content?(c.setRequestHeader("Content-Type","application/json"),c.send(JSON.stringify(a.content))):c.send()},doPrototypeFetch:function(a){var b=this,c=this._internal.backendProperties.backendScript;new Function("context",c)({request:a,sendResponse:function(c,d){b.doResponse(c,d,a)}})},doFetch:function(){if(this._internal.hasScheduledFetch=!1,!0===this._internal.useExternalFile&&!0===this._internal.isWaitingForExternalFileToLoad)return void(this._internal.hasPendingFetch=!0);this.sendSignalOnOutput("started"),this._internal.fetching=!0,this.flagOutputDirty("fetching");var a=this._internal.resource;for(var b in this._internal.requestInputs)a=a.replace("{"+b+"}",this._internal.requestInputs[b]);var c={resource:a,headers:{},method:void 0!==this._internal.method?this._internal.method:"GET",parameters:{}};if(this._internal.requestFunction){var d={inputs:this._internal.requestInputs,outputs:this._internal.responseOutputs};this._internal.requestFunction.apply(d,[this._internal.requestInputs,c])}void 0===this._internal.backendType||"external"===this._internal.backendType?this.doExternalFetch(c):this.doPrototypeFetch(c)}}};b.exports={node:k,setup:function(a,b){a.editorConnection&&b.on("nodeAdded.REST",function(b){f(b,a.editorConnection),b.on("parameterUpdated",function(c){f(b,a.editorConnection)})})}}},{"../../guid":73,"../../javascriptnodeparser":75,"../../node":79,"../../nodedefinition":81,xml2js:43}],100:[function(a,b,c){"use strict";function d(a,b){b=b||",";for(var c,d=new RegExp("(\\"+b+'|\\r?\\n|\\r|^)(?:"([^"]*(?:""[^"]*)*)"|([^"\\'+b+"\\r\\n]*))","gi"),e=[[]],f=null;(f=d.exec(a))&&c!==d.lastIndex;){c=d.lastIndex;var g=f[1];g.length&&g!==b&&e.push([]);var h;h=f[2]?f[2].replace(new RegExp('""',"g"),'"'):f[3],e[e.length-1].push(h)}return e}var e=a("../../nodedefinition"),f=a("./collection"),g={name:"Static Data",category:"Data",color:"data",dynamicports:[{name:"conditionalports/basic",condition:"type = csv OR type NOT SET",ports:[{name:"csv",plug:"input",type:{name:"string",codeeditor:"text"},displayName:"CSV",group:"General"}]},{name:"conditionalports/basic",condition:"type = json",ports:[{name:"json",plug:"input",type:{name:"string",codeeditor:"json"},displayName:"JSON",group:"General"}]}],inputs:{type:{type:{name:"enum",enums:[{label:"CSV",value:"csv"},{label:"JSON",value:"json"}]},displayName:"Type",group:"General",default:"csv",set:function(a){this._internal.type=a}},csv:{set:function(a){this._internal.csv=a,this.scheduleParseData()}},json:{set:function(a){this._internal.json=a,this.scheduleParseData()}}},outputs:{items:{type:"collection",displayName:"Items",group:"General",getter:function(){return this._internal.collection}}},prototypeExtensions:{scheduleParseData:function(){var a=this._internal;a.hasScheduledParseData||(a.hasScheduledParseData=!0,this.scheduleAfterInputsHaveUpdated(this.parseData.bind(this)))},parseData:function(){var a=this._internal;if(a.hasScheduledParseData=!1,a.collection||(a.collection=f.get()),void 0===a.type||"csv"===a.type){for(var b=d(a.csv),c=[],e=b[0],g=1;g<b.length;g++){for(var h=b[g],i={},j=0;j<e.length;j++)i[e[j]]=h[j];c.push(i)}a.collection.set(c),this.flagOutputDirty("items")}else if("json"===a.type){var c=JSON.parse(a.json);a.collection.set(c),this.flagOutputDirty("items")}}}};b.exports=e.defineNode(g)},{"../../nodedefinition":81,"./collection":92}],101:[function(a,b,c){"use strict";function d(a,b,c){return Math.max(a,Math.min(b,c))}function e(a){var b=this._internal.snapPositions.length-1;return this._internal.snapPositions.some(function(c,d){return c>a&&(b=d-1,!0)}),b}function f(a){this._internal.currentSnappedIndex!==a&&(this._internal.currentSnappedIndex=a,this.flagOutputDirty("currentIndex"))}function g(a,b,c){var e=b+(c>0?1:-1);return e=d(0,a.length-1,e)}function h(a,b,c,e){var f=.02,g=50,h=a.length-1,i=Math.abs(c-a[b]),j=Math.abs(e);if(i<g&&j<.5)return b;for(var k=0;k<a.length;++k){if((i=Math.abs(c-a[k]))<g&&j<f){h=k,e>0&&h--;break}if(a[k]>c){h=k-1;break}}return e>0&&h++,d(0,a.length-1,h)}function i(a,b,c){var d;if("none"!==this._internal.snapBehavior){d="everyPosition"===this._internal.snapBehavior?g(this._internal.snapPositions,a,c):h(this._internal.snapPositions,this._internal.currentSnappedIndex,b,c);var e=this._internal.snapAnimation;e.startPosition=b,e.endPosition=this._internal.snapPositions[d],e.start(),f.call(this,d)}}function j(a){var b=a;!0===this._internal.clampEnabled&&(b=d(this._internal.clampMin,this._internal.clampMax,a)),0===this._internal.dragGestureRecognizer.axis?this._internal.target.setPositionX(b):this._internal.target.setPositionY(b)}function k(){var a=this._internal.target._internal.uiControl;return 0===this._internal.dragGestureRecognizer.axis?a.positionX:a.positionY}function l(a,b){if(!1!==a._internal.dragEnabled){var c=a._internal.dragGestureRecognizer.onTouch(b);return a._internal.track?c:void 0}}var m=(a("../node"),a("../nodedefinition")),n=a("../easecurves"),o={name:"Drag",category:"Interaction",initialize:function(){var a=this,b=this._internal;b.snapPositions=[0],b.target=void 0,b.track=!0,b.startSnapIndex=0,b.currentSnappedIndex=0,b.snapBehavior="none",b.dragEnabled=!0,b.dragRatio=1,b.snapDuration=300,b.clampMin=0,b.clampMax=0,b.clampEnabled=!1,b.snapAnimation=this.context.timerScheduler.createTimer({duration:b.snapDuration,ease:n.easeOut,startPosition:0,endPosition:0,onRunning:function(b){j.call(a,this.ease(this.startPosition,this.endPosition,b))}}),b.controlStart=0,b.indexOnDragStart=0,b.snapIndex=0,b.dragGestureRecognizer={},b.dragGestureRecognizer=this.context.uiEngine.createDragGestureRecognizer({axis:0,threshold:5,onDragStart:function(){b.snapAnimation.stop(),a.sendSignalOnOutput("dragStart"),b.controlStart=k.call(a),b.indexOnDragStart=e.call(a,b.controlStart)},onDrag:function(){var c=b.controlStart+this.dragDistance*b.dragRatio;if("none"!==b.snapBehavior){c=d(b.snapPositions[0],b.snapPositions[b.snapPositions.length-1],c)}j.call(a,c)},onDragEnd:function(){a.sendSignalOnOutput("dragEnd"),i.call(a,b.indexOnDragStart,k.call(a),this.velocity)}})},inputs:{target:{type:"reference",displayName:"Target",group:"Target Node",set:function(a){if(this._internal.target&&(this._internal.target.removeTouchHandlersWithId(this),this._internal.target=void 0),a){var b=a.getVisualRoot();if(!b._internal.uiControl)throw new Error("target must be a visual node, not a "+b.name);this._internal.target=b,this._internal.target.addTouchHandler(l.bind(null,this),this);var c=this;this.context.scheduleAfterUpdate(function(){"none"!==c._internal.snapBehavior&&j.call(c,c._internal.snapPositions[c._internal.startSnapIndex])})}}},axis:{type:{name:"enum",enums:[{value:"0",label:"Horizontal"},{value:"1",label:"Vertical"}]},default:"0",displayName:"Drag Direction",group:"Drag Behavior",set:function(a){this._internal.dragGestureRecognizer.axis=Number(a)}},snapBehavior:{type:{name:"enum",enums:[{value:"none",label:"None"},{value:"everyPosition",label:"Every Position"},{value:"closestPosition",label:"Closest Position"}]},default:"none",group:"Drag Behavior",displayName:"Snap Behavior",set:function(a){this._internal.snapBehavior=a}},track:{type:"boolean",displayName:"Track Touch",group:"Drag Behavior",default:!0,set:function(a){this._internal.track=a}},dragThreshold:{type:{name:"number",allowEditOnly:!0},displayName:"Drag Threshold",group:"Drag Behavior",default:5,set:function(a){this._internal.dragGestureRecognizer.threshold=a}},dragEnabled:{type:{name:"boolean"},displayName:"Drag Enabled",group:"Drag Behavior",default:!0,set:function(a){this._internal.dragEnabled=!!a}},dragRatio:{type:"number",displayName:"Drag Ratio",default:1,group:"Drag Behavior",set:function(a){this._internal.dragRatio=Number(a)}},"snapToIndex.index":{type:"number",displayName:"Index",group:"Snap To Index",default:0,set:function(a){!0===a?a=1:!1===a&&(a=0),this._internal.snapIndex=Math.floor(a)}},"snapToIndex.duration":{type:"number",displayName:"Duration",editorName:"Duration|Snap To Index",group:"Snap To Index",default:300,set:function(a){this._internal.snapDuration=a}},"snapToIndex.do":{group:"Snap To Index",displayName:"Do",editorName:"Do|Snap To Index",valueChangedToTrue:function(){var a=this._internal.snapAnimation,b=this;this.scheduleAfterInputsHaveUpdated(function(){a.startPosition=k.call(b),a.endPosition=b._internal.snapPositions[b._internal.snapIndex],a.duration=b._internal.snapDuration,a.start(),f.call(b,b._internal.snapIndex)})}},"clampDragPosition.min":{type:{name:"number"},displayName:"Start",group:"Constrain",default:0,set:function(a){this._internal.clampMin=a}},"clampDragPosition.max":{type:{name:"number"},displayName:"End",group:"Constrain",default:0,set:function(a){this._internal.clampMax=a}},"clampDragPosition.enabled":{type:{name:"boolean"},displayName:"Constrain",group:"Constrain",default:!1,set:function(a){this._internal.clampEnabled=a}}},numberedInputs:{position:{name:"numbered/simple-number",displayPrefix:"Position",group:"Snap Positions",createSetter:function(a){return function(b){this._internal.snapPositions[a]=b}},selectors:{startAt:{displayName:"Start At",group:"Snap Positions",set:function(a){var b=this._internal;b.startSnapIndex=a,f.call(this,a),b.target&&a<b.snapPositions.length&&j.call(this,b.snapPositions[b.startSnapIndex])}}}}},outputs:{dragStart:{group:"Signals",type:"signal",displayName:"Drag Started"},dragEnd:{group:"Signals",type:"signal",displayName:"Drag Ended"},currentIndex:{group:"Current State",type:"number",displayName:"Current Index",getter:function(){return this._internal.currentSnappedIndex}}}};b.exports=m.defineNode(o)},{"../easecurves":67,"../node":79,"../nodedefinition":81}],102:[function(a,b,c){"use strict";var d={name:"Event Receiver",category:"Events",usePortAsLabel:"channelName",color:"component",initialize:function(){var a=this._internal;a.outputValues={},a.outputNames=[],a.eventReceived=!1,a._isEnabled=!0,a.channelName=""},dynamicports:[{name:"portchannel/event-sender-channel",channelPort:{name:"channelName",displayName:"Channel",plug:"input"},port:{type:"*",plug:"output",allowConnectionOnly:!0}}],inputs:{enabled:{displayName:"Enabled",type:"boolean",default:!0,set:function(a){this._internal._isEnabled=!!a}},channelName:{set:function(a){this._internal.onEventReceivedCallback&&(this.context.eventSenderEmitter.removeListener(this._internal.channelName,this._internal.onEventReceivedCallback),this._internal.onEventReceivedCallback=null),this._internal.channelName=a,this.registerListenersForChannel(a)}}},outputs:{eventReceived:{displayName:"Event Received",type:"signal"}},prototypeExtensions:{registerOutputIfNeeded:function(a){if(!this.hasOutput(a)){var b=this;this._internal.outputNames.push(a),this.registerOutput(a,{getter:function(){return b._internal.outputValues[a]}})}},handleEvent:function(a){if(!1!==this._internal._isEnabled){this.sendSignalOnOutput("eventReceived");for(var b in a)this.hasOutput(b)&&(this._internal.outputValues[b]=a[b],this.flagOutputDirty(b))}},onEventReceived:function(a){this.handleEvent(a)},registerListenersForChannel:function(a){var b=this.context.eventSenderEmitter;this._internal.onEventReceivedCallback=this.onEventReceived.bind(this),b.on(a,this._internal.onEventReceivedCallback);var c=this;this.context.eventEmitter.once("applicationDataReloaded",function(){c._internal.onEventReceivedCallback&&b.removeListener(a,c._internal.onEventReceivedCallback)})},getChannelName:function(){return this._internal.channelName}}};b.exports={node:d}},{}],103:[function(a,b,c){"use strict";var d={name:"Event Sender",category:"Events",usePortAsLabel:"channelName",color:"component",panels:[{name:"PortEditor",context:["select","connectFrom"],title:"Inputs",plug:"input",type:{name:"*",allowConnectionOnly:!0}}],initialize:function(){this._internal.inputValues={},this._internal.channelName="",this._internal.propagation="global"},inputs:{sendEvent:{displayName:"Send Event",valueChangedToTrue:function(){var a=this;this.scheduleAfterInputsHaveUpdated(function(){"global"===a._internal.propagation?a.context.sendGlobalEventFromEventSender(a._internal.channelName,a._internal.inputValues):a.nodeScope.sendEventFromThisScope(a._internal.channelName,a._internal.inputValues,a._internal.propagation)})}},channelName:{type:{name:"string",allowEditOnly:!0},default:"",group:"Settings",displayName:"Channel Name",set:function(a){this._internal.channelName=a,this._internal.inputValues._channelName=a}},propagation:{type:{name:"enum",enums:[{value:"global",label:"Global"},{value:"parent",label:"Parent"},{value:"children",label:"Children"}]},default:"global",group:"Settings",displayName:"Propagation",set:function(a){this._internal.propagation=a}}},prototypeExtensions:{registerInputIfNeeded:{value:function(a){if(!this.hasInput(a)){var b=this;this.registerInput(a,{set:function(c){b._internal.inputValues[a]=c}})}}}}};b.exports={node:d}},{}],104:[function(a,b,c){"use strict";function d(a,b){function c(){return a.apply(this,b)}return c.prototype=a.prototype,new c}function f(a){function b(a){-1===m.indexOf(a)&&(d.some(function(b){return b===a})||d.push(a))}function c(a){"Identifier"!==a.type||a.raw?"ConditionalExpression"===a.type?(c(a.test),c(a.consequent),c(a.alternate)):"MemberExpression"===a.type?c(a.object):"CallExpression"===a.type?(c(a.callee),a.arguments.forEach(c)):"UnaryExpression"===a.type?c(a.argument):"BinaryExpression"!==a.type&&"LogicalExpression"!==a.type||(c(a.left),c(a.right)):b(a.name)}var d=[];try{c(i(a))}catch(e){d=[]}return d}function g(a,b,c){var d=f(b),e=d.map(function(a){return{name:a,type:"number",plug:"input"}});c.sendDynamicPorts(a,e)}var h=(a("../node"),a("lodash")),i=a("jsep"),j={name:"Expression",category:"Math",usePortAsLabel:"expression",initialize:function(){var a=this._internal;a.scope={},a.hasScheduledEvaluation=!1,a.code=void 0,a.cachedValue=0,a.currentExpression="",a.compiledFunction=void 0,a.inputNames=[],a.inputValues=[]},inputs:{expression:{inputPriority:1,type:{name:"string",allowEditOnly:!0},displayName:"Expression",set:function(a){var b=this._internal;b.currentExpression=k+"return ("+a+");",b.compiledFunction=void 0;var c=f(a),d=h.difference(c,b.inputNames),e=h.difference(b.inputNames,c),g=this;e.forEach(function(a){g.deregisterInput(a),delete b.scope[a]}),d.forEach(function(a){g.registerInput(a,{set:function(c){b.scope[a]=c,this._scheduleEvaluateExpression()}}),b.scope[a]=0,g._cachedInputValues[a]=0}),b.inputNames=Object.keys(b.scope),this._scheduleEvaluateExpression()}}},outputs:{result:{type:"number",displayName:"Result",getter:function(){return this._internal.currentExpression?this._internal.cachedValue:0}}},prototypeExtensions:{_scheduleEvaluateExpression:{value:function(){var a=this._internal;!1===a.hasScheduledEvaluation&&(a.hasScheduledEvaluation=!0,this.flagDirty(),this.scheduleAfterInputsHaveUpdated(function(){var b=a.cachedValue;a.cachedValue=this._calculateExpression(),b!==a.cachedValue&&this.flagOutputDirty("result"),a.hasScheduledEvaluation=!1}))}},_calculateExpression:{value:function(){var a=this._internal;a.compiledFunction||(a.compiledFunction=this._compileFunction());for(var b=0;b<a.inputNames.length;++b){var c=a.scope[a.inputNames[b]];a.inputValues[b]=c}try{return a.compiledFunction.apply(null,a.inputValues)}catch(e){console.error("Error in expression:",e.message)}return 0}},_compileFunction:{value:function(){var a=this._internal.currentExpression,b=Object.keys(this._internal.scope),c=a+b.join(" ");if(!1===l.hasOwnProperty(c)){b.push(a);try{l[c]=d(Function,b)}catch(e){console.error("Failed to compile JS function",e.message)}}return l[c]}}}},k=["var min = Math.min,    max = Math.max,    cos = Math.cos,    sin = Math.sin,    tan = Math.tan,    sqrt = Math.sqrt,    pi = Math.PI,    round = Math.round,    floor = Math.floor,    ceil = Math.ceil,    abs = Math.abs,    random = Math.random;"].join(""),l={},m=["min","max","cos","sin","tan","sqrt","pi","round","floor","ceil","abs","random","Math","window","document"];b.exports={node:j,setup:function(a,b){a.editorConnection&&a.editorConnection.isRunningLocally()&&b.on("nodeAdded.Expression",function(b){b.parameters.expression&&g(b.id,b.parameters.expression,a.editorConnection),b.on("parameterUpdated",function(c){"expression"===c.name&&g(b.id,b.parameters.expression,a.editorConnection)})})}}},{"../node":79,jsep:11,lodash:12}],105:[function(a,b,c){"use strict";var d=a("../node"),e={name:"Globals",category:"Utilities",color:"component",initialize:function(){this._internal.listeners=[]},panels:[{name:"PortEditor",context:["select","connectTo","connectFrom"],title:"Globals",plug:"input/output",type:{name:"*"}}],prototypeExtensions:{_onNodeDeleted:function(){d.prototype._onNodeDeleted.call(this);for(var a=this.context.globalsEventEmitter,b=0;b<this._internal.listeners.length;b++){var c=this._internal.listeners[b];a.removeListener(c.name,c.listener)}this._internal.listeners=[]},_newOutputValueReceived:{value:function(a){this._cachedInputValues[a]=this.context.globalValues[a],this.flagOutputDirty(a)}},registerInputIfNeeded:{value:function(a){var b=this;this.hasInput(a)||this.registerInput(a,{set:b.context.setGlobalValue.bind(b.context,a)})}},registerOutputIfNeeded:{value:function(a){if(!this.hasOutput(a)){var b=this._newOutputValueReceived.bind(this,a),c=this.context.globalsEventEmitter;this._internal.listeners.push({name:a,listener:b}),c.on(a,b),this.registerOutput(a,{getter:function(){return this.context.globalValues[a]}})}}}}};b.exports={node:e}},{"../node":79}],106:[function(a,b,c){"use strict";function d(a){a.alpha!==this._internal.alpha&&(this._internal.alpha=a.alpha,this.flagOutputDirty("rotationZ")),a.beta!==this._internal.beta&&(this._internal.beta=a.beta,this.flagOutputDirty("rotationX")),a.gamma!==this._internal.gamma&&(this._internal.gamma=a.gamma,this.flagOutputDirty("rotationY"))}var e=a("../nodedefinition"),f={name:"Gyroscope",displayNodeName:"Device Orientation",category:"Sensors",initialize:function(){this._internal.alpha=0,this._internal.beta=0,this._internal.gamma=0;var a=d.bind(this);window.addEventListener("deviceorientation",a),this.context.eventEmitter.once("applicationDataReloaded",function(){window.removeEventListener("deviceorientation",a)})},outputs:{rotationX:{type:"number",displayName:"Rotation X",getter:function(){return-this._internal.beta}},rotationY:{type:"number",displayName:"Rotation Y",getter:function(){return this._internal.gamma}},rotationZ:{type:"number",displayName:"Rotation Z",getter:function(){return-this._internal.alpha}}}};b.exports=e.defineNode(f)},{"../nodedefinition":81}],107:[function(a,b,c){"use strict";var d=a("../nodedefinition"),e={name:"Inverter",category:"Math",initialize:function(){this._internal.currentValue=!1},inputs:{value:{type:{name:"boolean"},displayName:"Value",set:function(a){this._internal.currentValue=a,this.flagOutputDirty("result")}}},outputs:{result:{type:"boolean",displayName:"Result",getter:function(){return!this._internal.currentValue}}}};b.exports=d.defineNode(e)},{"../nodedefinition":81}],108:[function(a,b,c){"use strict";function d(){if(this._internal.isFirstFrame)return void(this._internal.isFirstFrame=!1);this._evaluateFunction(),this.context.nodeIsDirty(this),this.flagDirty()}function e(a,b){this._internal.needsToEval=!0,this._internal.inputValues[a]=b,this.flagDirty()}function f(a){return this._internal.needsToEval&&this._evaluateFunction(),this._internal.outputValues[a]}var g=a("../nodedefinition"),h=a("../node"),i={};b.exports=g.defineNode({name:"Javascript",category:"Javascript",displayNodeName:"Javascript (Deprecated)",deprecated:!0,panels:[{name:"PortEditor",context:["select"],title:"Inputs",plug:"input",type:{name:"*"}},{name:"PortEditor",context:["select"],title:"Outputs",plug:"output",type:{name:"*"}}],initialize:function(){var a=this._internal;a.inputValues={},a.outputValues={},a.needsToEval=!1;var b=this;a.userFunctionScope={flagOutputDirty:function(a){if(!a)throw new Error("Output port name must be specified");b.flagOutputDirty(a)}},a.isFirstFrame=!0,a.onFrameStart=d.bind(this)},inputs:{code:{type:{name:"string",allowEditOnly:!0,codeeditor:"javascript"},displayName:"code",group:"Code",set:function(a){i[a]||(i[a]=new Function("inputs","outputs",a)),this._internal.userFunction=i[a],this._internal.needsToEval=!0}},runEveryFrame:{type:"boolean",displayName:"Run Every Frame",group:"Settings",set:function(a){a=!!a;var b=this.context.eventEmitter;!0===a?b.on("frameStart",this._internal.onFrameStart):b.removeListener("frameStart",this._internal.onFrameStart)}}},prototypeExtensions:{update:{value:function(){!1===this._dirty||this._isUpdating||(h.prototype.update.call(this),this._internal.needsToEval&&(this._evaluateFunction(),this.flagDirty()))}},registerInputIfNeeded:{value:function(a){this.hasInput(a)||this.registerInput(a,{set:e.bind(this,a)})}},registerOutputIfNeeded:{value:function(a){this.hasOutput(a)||this.registerOutput(a,{getter:f.bind(this,a)})}},_evaluateFunction:{value:function(){var a=this._internal;a.userFunction.call(a.userFunctionScope,a.inputValues,a.outputValues),a.needsToEval=!1}},flagDirty:{value:function(){for(var a in this._internal.outputValues)this.flagOutputDirty(a);h.prototype.flagDirty.call(this)}}}})},{"../node":79,"../nodedefinition":81}],109:[function(a,b,c){"use strict";function d(){for(var a in this._internal.dirtyOutputs)this.flagOutputDirty(a);this._internal.dirtyOutputs={}}function f(){this._internal.setupScheduled||(this._internal.setupScheduled=!0,this.scheduleAfterInputsHaveUpdated(function(){this._internal.killed||(this._callSetupFunction(),this._internal.setupScheduled=!1,d.call(this))}))}function g(){this._internal.runScheduled||this._internal.killed||(this._internal.runScheduled=!0,this.scheduleAfterInputsHaveUpdated(function(){this._internal.killed||(this._callRunFunction(),this._internal.changedInputs={},this._internal.runScheduled=!1,d.call(this))}))}function h(){this._internal.runNextFrame=!1,g.call(this)}function i(a,b){this._internal.inputValues[a]=b,!0===this._internal.hasParsedCode&&(this._internal.changedInputs[a]=!0,g.call(this))}function j(a){return this._internal.outputValues[a]}function k(a,b){function c(b){b.error?d.sendWarning(a.component.name,a.id,"js-parse-waring",{message:b.error}):d.sendDynamicPorts(a.id,b.getPorts())}var d=b.editorConnection;if(a.parameters)if(a.parameters.externalFile&&"yes"===a.parameters.useExternalFile){var e=a.parameters.externalFile;b.runningInEditor&&"/"!==e[0]&&(e="/"+e),m.createFromURL(e,null,c)}else if(a.parameters.code){var f=m.createFromCode(a.parameters.code,null);c(f)}}var l=a("../node"),m=a("../javascriptnodeparser"),n=["define({","    inputs: {",'        inputValue: "number"',"    },","    outputs: {",'        outputValue: "number"',"    },","    destroy: function(inputs, outputs) {","","    },","    setup: function(inputs, outputs) {","","    },","    run: function(inputs, outputs, changedInputs) {","","    }","});"].join("\n"),o={name:"Javascript2",displayNodeName:"Javascript",category:"Javascript",color:"javascript",initialize:function(){var a=this._internal;a.inputValues={},a.outputValues={},a.outputProperties={},a.dirtyOutputs={},a.runScheduled=!1,a.setupScheduled=!1,a.runNextFrameScheduled=!1,a.isWaitingForExternalFileToLoad=!1,a.useExternalFile=!1,a.runFunction=void 0,a.destroyFunction=void 0,a.setupFunction=void 0,a.hasParsedCode=!1,a.changedInputs={},a.killed=!1;var b=this;a.userFunctionScope={flagOutputDirty:function(c){if(!c)throw new Error("Output port name must be specified");b.flagOutputDirty(c),a.dirtyOutputs.hasOwnProperty(c)&&delete a.dirtyOutputs[c]},runNextFrame:function(){a.runNextFrameScheduled||(a.runNextFrameScheduled=!0,b.context.scheduleNextFrame(function(){a.runNextFrameScheduled=!1,a.killed||g.call(b)}))},sendSignalOnOutput:function(c){a.outputValues[c]=!0,b.flagOutputDirty(c),a.outputValues[c]=!1,b.flagOutputDirty(c)}},a.onFrameStart=h.bind(this)},dynamicports:[{name:"conditionalports/basic",condition:"useExternalFile = no OR useExternalFile NOT SET",ports:[{name:"code",displayName:"Code",group:"Code",plug:"input",type:{name:"string",allowEditOnly:!0,codeeditor:"javascript"},default:n}]},{name:"conditionalports/basic",condition:"useExternalFile = yes",ports:[{name:"externalFile",displayName:"File Path",group:"Code",plug:"input",type:{name:"source",allowEditOnly:!0}}]}],inputs:{useExternalFile:{type:{name:"enum",enums:[{value:"yes",label:"Yes"},{value:"no",label:"No"}],allowEditOnly:!0},default:"no",displayName:"Use External File",group:"Code",set:function(a){this._internal.isWaitingForExternalFileToLoad="yes"===a,this._internal.useExternalFile="yes"===a}},code:{
set:function(a){if(a){var b=this;this.scheduleAfterInputsHaveUpdated(function(){if(!1===this._internal.useExternalFile){this._callDestroyFunction();var c=m.createFromCode(a,b.nodeScope.noodlJavascriptAPI);b._onCodeParsed(c)}})}}},externalFile:{set:function(a){if(!1!==this._internal.useExternalFile){this.context.runningInEditor&&"/"!==a[0]&&(a="/"+a);var b=this;m.createFromURL(a,this.nodeScope.noodlJavascriptAPI,function(a){b._internal.isWaitingForExternalFileToLoad=!1,b._onCodeParsed(a)})}}}},prototypeExtensions:{_onNodeDeleted:function(){l.prototype._onNodeDeleted.call(this),this._internal.killed=!0,this._callDestroyFunction()},update:function(){!0===this._internal.isWaitingForExternalFileToLoad?this._dirty=!1:l.prototype.update.call(this)},_onCodeParsed:function(a){if(this.context.editorConnection&&(this.context.editorConnection.clearWarnings(this.nodeScope.componentOwner.name,this.id),a.error?this.context.editorConnection.sendWarning(this.nodeScope.componentOwner.name,this.id,"js-parse-waring",{message:a.error}):this.context.editorConnection.sendDynamicPorts(this.id,a.getPorts())),!a.error){var b=this;Object.keys(a.outputs).forEach(function(a){b.registerOutputIfNeeded(a)}),this._internal.setupFunction=a.setup,this._internal.runFunction=a.run,this._internal.destroyFunction=a.destroy,this._internal.setupFunction&&f.call(this),this._internal.runFunction&&g.call(this),this._internal.hasParsedCode=!0}},registerInputIfNeeded:function(a){this.hasInput(a)||(this._internal.inputValues[a]=void 0,this.registerInput(a,{set:i.bind(this,a)}))},registerOutputIfNeeded:function(a){if(!this.hasOutput(a)){var b=this;Object.defineProperty(this._internal.outputProperties,a,{set:function(c){b._internal.outputValues[a]=c,b._internal.dirtyOutputs[a]=!0,b.context.scheduleFrame()},get:function(){return b._internal.outputValues[a]}}),this.registerOutput(a,{getter:j.bind(this,a)})}},_callRunFunction:function(){var a=this._internal;if(a.runFunction&&!a.killed)try{a.runFunction.call(a.userFunctionScope,a.inputValues,a.outputProperties,a.changedInputs)}catch(e){console.log("Error in JS node run code.",Object.getPrototypeOf(e).constructor.name+": "+e.message),this.context.editorConnection&&this.context.editorConnection.sendWarning(this.nodeScope.componentOwner.name,this.id,"js-run-waring",{message:"<strong>run</strong>: "+e.message})}},_callDestroyFunction:function(){var a=this._internal;if(a.destroyFunction)try{a.destroyFunction.call(a.userFunctionScope,a.inputValues,a.outputProperties)}catch(e){console.log("Error in JS node destroy code.",Object.getPrototypeOf(e).constructor.name+": "+e.message),this.context.editorConnection&&this.context.editorConnection.sendWarning(this.nodeScope.componentOwner.name,this.id,"js-destroy-waring",{message:"<strong>setup</strong>: "+e.message})}},_callSetupFunction:function(){var a=this._internal;if(a.setupFunction&&!a.killed)try{a.setupFunction.call(a.userFunctionScope,a.inputValues,a.outputProperties)}catch(e){console.log("Error in JS node setup code.",Object.getPrototypeOf(e).constructor.name+": "+e.message),this.context.editorConnection&&this.context.editorConnection.sendWarning(this.nodeScope.componentOwner.name,this.id,"js-setup-waring",{message:"<strong>setup</strong>: "+e.message})}}}};b.exports={node:o,setup:function(a,b){a.editorConnection&&a.editorConnection.isRunningLocally()&&b.on("nodeAdded.Javascript2",function(b){k(b,a),b.on("parameterUpdated",function(c){k(b,a)})})}}},{"../javascriptnodeparser":75,"../node":79}],110:[function(a,b,c){"use strict";var d=a("../nodedefinition"),e=a("../easecurves");b.exports=d.defineNode({name:"Number Blend",category:"Interpolation",initialize:function(){var a=this._internal;a.inputs=[],a.blendValue=0,a.result=0,a.clamp=!1},prototypeExtensions:{updateResult:function(){var a=this._internal.inputs;if(0===a.length)return 0;var b=Math.floor(this._internal.blendValue),c=this._internal.blendValue-b;b>=a.length-1?this._internal.clamp?(b=a.length-1,c=0):(c+=b-(a.length-1),b=a.length-1):b<=0&&(this._internal.clamp?(b=0,c=0):(c+=b,b=0)),0===c||1===a.length?this._internal.result=a[b]:b===a.length-1&&c>0?this._internal.result=e.linear(a[b-1],a[b],c+1):this._internal.result=e.linear(a[b],a[b+1],c),this.flagOutputDirty("result")}},numberedInputs:{input:{name:"numbered/simple-number",displayPrefix:"Number",createSetter:function(a){var b=this._internal.inputs;return b[a]=0,function(c){b[a]!==c&&(b[a]=c,this.updateResult())}}}},inputs:{blendValue:{type:"number",displayName:"Blend Value",default:0,set:function(a){this._internal.blendValue=a,this.updateResult()}},clamp:{type:"boolean",displayName:"Clamp",default:!1,set:function(a){this._internal.clamp=!!a,this.updateResult()}}},outputs:{result:{type:"number",displayName:"Result",getter:function(){return this._internal.result}}}})},{"../easecurves":67,"../nodedefinition":81}],111:[function(a,b,c){"use strict";var d=a("../nodedefinition");b.exports=d.defineNode({name:"Number Remapper",category:"Math",initialize:function(){var a=this._internal;a._currentInputValue=0,a._remappedValue=0,a._minInputValue=0,a._maxInputValue=0,a._minOutputValue=0,a._maxOutputValue=1,a._clampOutput=!0},inputs:{inputValue:{group:"Value to Remap",type:{name:"number",allowConnectionOnly:!0},default:0,displayName:"Input Value",set:function(a){this._internal._currentInputValue=a,this._calculateNewOutputValue()}},minInputValue:{group:"Input Parameters",type:{name:"number"},default:0,displayName:"Input Minimum",set:function(a){this._internal._minInputValue=a,this._calculateNewOutputValue()}},maxInputValue:{group:"Input Parameters",type:{name:"number"},default:0,displayName:"Input Maximum",set:function(a){this._internal._maxInputValue=a,this._calculateNewOutputValue()}},minOutputValue:{group:"Output Parameters",type:{name:"number"},default:0,displayName:"Output Minimum",set:function(a){this._internal._minOutputValue=a,this._calculateNewOutputValue()}},maxOutputValue:{group:"Output Parameters",type:{name:"number"},default:1,displayName:"Output Maximum",set:function(a){this._internal._maxOutputValue=a,this._calculateNewOutputValue()}},clamp:{group:"Output Parameters",type:{name:"boolean",allowEditOnly:!0},default:!0,displayName:"Clamp Output",set:function(a){this._internal._clampOutput=!!a,this._calculateNewOutputValue()}}},outputs:{remappedValue:{type:"number",displayName:"Remapped Value",group:"Outputs",getter:function(){return this._internal._remappedValue}}},prototypeExtensions:{_calculateNewOutputValue:{value:function(){var a,b=this._internal;a=b._maxInputValue===b._minInputValue?0:(b._currentInputValue-b._minInputValue)/(b._maxInputValue-b._minInputValue),b._clampOutput&&(a=Math.max(0,Math.min(1,a))),b._remappedValue=b._minOutputValue+a*(b._maxOutputValue-b._minOutputValue),this.flagOutputDirty("remappedValue")}}}})},{"../nodedefinition":81}],112:[function(a,b,c){"use strict";function d(a){return!!a}var e=a("../nodedefinition");b.exports=e.defineNode({name:"Or",category:"Logic",initialize:function(){this._internal.inputs=[]},numberedInputs:{input:{name:"numbered/simple-boolean",displayPrefix:"Input",createSetter:function(a){return function(b){this._internal.inputs[a]!==b&&(this._internal.inputs[a]=b,this.flagOutputDirty("result"))}}}},outputs:{result:{type:"boolean",displayName:"Result",getter:function(){return this._internal.inputs.some(d)}}}})},{"../nodedefinition":81}],113:[function(a,b,c){"use strict";function d(a){for(var b=a.getNodesWithTypeRecursive("Page");0===b.length&&a.componentOwner;)a=a.componentOwner.parentNodeScope,b=a.getNodesWithTypeRecursive("Page");return b[0]._internal.pagesNode}var e=a("../nodedefinition"),f=a("lodash"),g=a("../node");b.exports=e.defineNode({name:"Page Navigation",category:"Navigation",initialize:function(){this._internal.inputValues={},this._internal.portUpdateScheduled=!1,this._internal.targetPagesNode=null,this._internal.resetPageStack=!1},inputs:{navigate:{displayName:"Navigate To Page",group:"Navigation",valueChangedToTrue:function(){this.scheduleAfterInputsHaveUpdated(this._doNavigation.bind(this))}},destination:{displayName:"Destination",group:"Navigation",type:"component",set:function(a){var b=this._internal;if(b.destinationComponentModel&&(b.destinationComponentModel.removeListenersWithRef(this),b.destinationComponentModel=void 0),!1!==this.context.hasComponentModelWithName(a)){b.destinationComponentModel&&b.destinationComponentModel.removeListenersWithRef(this),b.destinationComponentName=a;var c=this.context.getComponentModel(a);b.destinationComponentModel=c,this.updateDestinationPagePorts(c),c.on("inputPortAdded",this.scheduleUpdateDestinationPagePorts.bind(this,c),this),c.on("inputPortRemoved",this.scheduleUpdateDestinationPagePorts.bind(this,c),this)}}},targetPages:{displayName:"Pages Target",group:"Navigation",type:"reference",set:function(a){this._internal.targetPagesNode=a}},resetPageStack:{displayName:"Reset history",group:"Navigation",default:!1,type:"boolean",set:function(a){this._internal.resetPageStack=!!a}}},prototypeExtensions:{_doNavigation:function(){var a=this._internal;if(a.destinationComponentName){var b=a.destinationComponentModel.getInputPorts();for(var c in a.inputValues)!1===b.hasOwnProperty(c)&&delete a.inputValues[c];var e=this._internal.targetPagesNode,f=e||d(this.nodeScope);this._internal.resetPageStack?f.resetTo(a.destinationComponentName,a.inputValues):f.navigateTo(a.destinationComponentName,a.inputValues)}},_onNodeDeleted:function(){g.prototype._onNodeDeleted.call(this);var a=this._internal;a.destinationComponentModel&&a.destinationComponentModel.removeListenersWithRef(this)},registerInputIfNeeded:function(a){this.hasInput(a)||this.registerInput(a,{set:function(b){this._internal.inputValues[a]=b}})},scheduleUpdateDestinationPagePorts:function(a){if(!this._internal.portUpdateScheduled){this._internal.portUpdateScheduled=!0;var b=this;this.context.scheduleAfterUpdate(function(){b.updateDestinationPagePorts(a),b._internal.portUpdateScheduled=!1})}},updateDestinationPagePorts:function(a){var b=f.values(a.getInputPorts()).map(function(a){return{name:a.name,plug:"input",type:a.type,group:"Destination Page Inputs"}});this.context.editorConnection.sendDynamicPorts(this.id,b)}}})},{"../node":79,"../nodedefinition":81,lodash:12}],114:[function(a,b,c){"use strict";function d(a){for(var b=a.getNodesWithTypeRecursive("Page");0===b.length&&a.componentOwner;)a=a.componentOwner.parentNodeScope,b=a.getNodesWithTypeRecursive("Page");return b[0]._internal.pagesNode}var e=a("../nodedefinition");b.exports=e.defineNode({name:"Page Navigation Back",category:"Navigation",inputs:{back:{displayName:"Back",group:"Navigation",valueChangedToTrue:function(){d(this.nodeScope).back()}}}})},{"../nodedefinition":81}],115:[function(a,b,c){"use strict";function d(a,b,c){for(var e in a){var f=c+e;"object"!=typeof a[e]||null===a[e]||Array.isArray(a[e])?b.push({key:f,value:a[e]}):d(a[e],b,f+".")}}function e(a,b){this._internal.topicComponents[a]=b,this.scheduleSubscribe()}function f(a){return this._internal.outputValues[a]}function g(a,b,c){var d=b.match(/\{([a-z]|[A-Z])([a-z]|[A-Z]|[0-9])*\}/g),e=[];for(var f in d)e.push({name:d[f].replace(/(\{|\})/g,""),group:"Topic components",plug:"input",type:"*"});var g=b.match(/\+([a-z]|[A-Z])([a-z]|[A-Z]|[0-9])*\+/g);for(var f in g)e.push({name:g[f].replace(/\+/g,""),group:"Topic components",plug:"output",type:"*"});c.sendDynamicPorts(a,e)}var h=a("../services/services"),i=a("../node"),j={name:"Receive Message",category:"Messages",usePortAsLabel:"topic",color:"component",panels:[{name:"PortEditor",context:["select","connectFrom"],title:"Payload",plug:"outputs",group:"Payload",type:{name:"*",allowConnectionOnly:!0}}],initialize:function(){var a=this._internal;a.payload={},a.messageReceived=!1,a.isEnabled=!0,a.topic="",a.topicComponents={},a.outputValues={},a.outputList=[]},inputs:{enabled:{displayName:"Enabled",type:"boolean",default:!0,set:function(a){this._internal.isEnabled=!!a}},topic:{displayName:"Topic",type:"string",default:"",set:function(a){this._internal.topic=a,this.scheduleSubscribe()}}},outputs:{messageReceived:{displayName:"Received",type:"signal"}},prototypeExtensions:{_onNodeDeleted:function(){i.prototype._onNodeDeleted.call(this),this.subscription&&(h.pubsub.unsubscribe(this.subscription.topic,this.subscription.subscriber),this.subscription=void 0)},registerInputIfNeeded:function(a){this.hasInput(a)||this.registerInput(a,{set:e.bind(this,a)})},registerOutputIfNeeded:function(a){this.hasOutput(a)||(this._internal.outputList.push(a),this.registerOutput(a,{getter:f.bind(this,a)}))},computeTopic:function(){var a=this._internal.topic,b=this._internal.topicComponents;for(var c in b)a=a.replace("{"+c+"}",b[c]);return a.replace(/\+([a-z]|[A-Z])([a-z]|[A-Z]|[0-9])*\+/g,"+")},handleMessage:function(a){if(!1!==this._internal.isEnabled){for(var b=this._internal.topic.split("/"),c=a.topic.split("/"),e=0;e<c.length;e++){var f=b[e];if("+"===f[0]&&"+"===f[f.length-1]){var g=f.substring(1,f.length-1);this._internal.outputValues[g]=c[e],this.flagOutputDirty(g)}}var h=[],i=a.payload;if("object"==typeof i)d(i,h,"");else{var j=this.model.outputPorts,k=Object.keys(j).sort(function(a,b){return j[a].index-j[b].index});i.split(",").forEach(function(a,b){h.push({key:k[b],value:a})})}for(var e=0;e<h.length;e++){var l=h[e];this._internal.outputValues[l.key]=l.value,this.hasOutput(l.key)&&this.flagOutputDirty(l.key)}this.sendSignalOnOutput("messageReceived"),this.context.scheduleFrame()}},onMessageReceived:function(a){this.handleMessage(a)},scheduleSubscribe:function(){var a=this;this._internal.subscribeScheduled||(this._internal.subscribeScheduled=!0,this.scheduleAfterInputsHaveUpdated(function(){a._internal.subscribeScheduled=!1,a.subscribe()}))},subscribe:function(){this.subscription&&(h.pubsub.unsubscribe(this.subscription.topic,this.subscription.subscriber),this.subscription=void 0);var a=this.computeTopic();if(a){var b=this.onMessageReceived.bind(this);this.subscription={topic:a,subscriber:b},h.pubsub.subscribe(a,b),this.context.eventEmitter.once("applicationDataReloaded",function(){h.pubsub.unsubscribe(a,b)})}}}};b.exports={node:j,setup:function(a,b){a.editorConnection&&a.editorConnection.isRunningLocally()&&b.on("nodeAdded.Receive Message",function(b){b.parameters.topic&&g(b.id,b.parameters.topic,a.editorConnection),b.on("parameterUpdated",function(c){"topic"===c.name&&g(b.id,b.parameters.topic,a.editorConnection)})})}}},{"../node":79,"../services/services":166}],116:[function(a,b,c){"use strict";var d=a("../nodedefinition");b.exports=d.defineNode({name:"Reload",category:"Utilities",inputs:{reload:{displayName:"Reload",valueChangedToTrue:function(){this.context.reloadApplication()}}}})},{"../nodedefinition":81}],117:[function(a,b,c){"use strict";var d={name:"Screen Resolution",category:"Utilities",initialize:function(){var a=this;this.context.uiEngine.on("viewportSizeChanged",this._viewportSizeChanged.bind(this),this),this.context.eventEmitter.once("applicationDataReloaded",function(){a.context.uiEngine.removeListenersWithRef(a)}),this._viewportSizeChanged(this.context.uiEngine.getViewportSize())},outputs:{width:{type:"number",displayName:"Width",getter:function(){return this._internal.width}},height:{type:"number",displayName:"Height",getter:function(){return this._internal.height}},aspectRatio:{type:"number",displayName:"Aspect Ratio",getter:function(){return this._internal.width/this._internal.height}}},prototypeExtensions:{_viewportSizeChanged:function(a){this._internal.width=a.width,this._internal.height=a.height,this.flagAllOutputsDirty()}}};b.exports={node:d}},{}],118:[function(a,b,c){"use strict";var d=(a("../node"),{name:"Script Downloader",category:"HTML",initialize:function(){var a=this._internal;a.loaded=!1,a.scripts=[],a.loadedScripts={},a.startLoad=!0,a.loadStarted=!1},inputs:{startLoad:{type:"boolean",default:!0,set:function(a){this._internal.startLoad!==a&&(this._internal.startLoad=a,a&&this.updateScripts())}}},outputs:{loaded:{type:"boolean",displayName:"Loaded",getter:function(){this._internal;return this._internal.loaded}}},numberedInputs:{input:{name:"numbered/simple-string",displayPrefix:"Script",group:"External scripts",index:3008,createSetter:function(a){var b=this;return function(c){c=c.toString(),b._internal.scripts[a]=c,b._internal.loadStarted||(b._internal.loadStarted=!0,this.scheduleAfterInputsHaveUpdated(function(){b.updateScripts()}))}}}},prototypeExtensions:{removeLoadTerminator:function(){var a="sentinel_"+this.id,b=document.getElementById(a);b&&b.parentNode&&b.parentNode.removeChild(b)},updateScripts:function(){if(this._internal.startLoad){this._internal.loadStarted=!1;var a="sentinel_"+this.id;this.removeLoadTerminator();var b=this._internal.scripts;b=b.filter(function(a){return""!==a});for(var c=document.head.getElementsByTagName("script"),d={},e=0;e<c.length;e++){var f=c[e];void 0!==f.src&&""!==f.src&&(d[f.src]=f)}for(var e=0;e<b.length;e++){var f=b[e].trim();if(!this._internal.loadedScripts.hasOwnProperty(f)){if(d.hasOwnProperty(f))continue;var g=document.createElement("script");g.src=f,g.async=!1,document.head.appendChild(g)}}var h=this,i=document.createElement("script");i.onload=i.onreadystatechange=function(a){this.readyState&&"loaded"!==this.readyState&&"complete"!==this.readyState||(h._internal.loaded=!0,h.flagOutputDirty("loaded"),h.removeLoadTerminator())},i.id=a,i.src="load_terminator.js",i.async=!1,document.head.appendChild(i)}}}});b.exports={node:d,setup:function(a,b){!a.editorConnection||a.editorConnection.isRunningLocally()}}},{"../node":79}],119:[function(a,b,c){"use strict";function d(){return"undefined"!=typeof window?window.performance.now():+new Date}function e(a,b,c){return a.length>0&&(a+=","),a+=c}function f(a,b,c){for(var d=b.split("."),e=0;e<d.length-1;e++)a[d[e]]||(a[d[e]]={}),a=a[d[e]];return a[d[d.length-1]]=c,a}function g(a,b){this._internal.inputValues[a]=b,this._internal.publishOnInputsChanged&&this.schedulePublish()}function h(a,b,c){var d=b.match(/\{([a-z]|[A-Z])([a-z]|[A-Z]|[0-9])*\}/g),e=[];for(var f in d)e.push({name:d[f].replace(/(\{|\})/g,""),group:"Topic components",plug:"input",type:"*"});c.sendDynamicPorts(a,e)}var i=a("../services/services"),j={name:"Send Message",category:"Messages",usePortAsLabel:"topic",color:"component",panels:[{name:"PortEditor",context:["select","connectFrom"],title:"Payload",plug:"input",group:"Payload",type:{name:"*",allowConnectionOnly:!0}}],initialize:function(){this._internal.payload={},this._internal.topic="",this._internal.inputValues={},this._internal.topicComponentsMap={},this._internal.hasScheduledPublish=!1,this._internal.publishOnInputsChanged=!1,this._internal.rateLimitEnabled=!1,this._internal.maxMessagesPerSecond=10,this._internal.lastPublishTime=0,this._internal.format="json"},dynamicports:[{name:"conditionalports/basic",condition:"rateLimit = true",ports:[{name:"maxMessagesPerSecond",type:"number",default:10,displayName:"Messages / Sec",group:"Rate Limit",plug:"input"}]}],inputs:{send:{displayName:"Send",valueChangedToTrue:function(){this.schedulePublish()}},topic:{type:{name:"string"},default:"",displayName:"Topic",group:"General",set:function(a){this._internal.topic=a;var b=a.match(/\{([a-z]|[A-Z])([a-z]|[A-Z]|[0-9])*\}/g);for(var c in b)this._internal.topicComponentsMap[b[c].replace(/(\{|\})/g,"")]=!0}},format:{type:{name:"enum",enums:[{value:"json",label:"JSON"},{value:"csv",label:"CSV"}]},displayName:"Format",group:"General",default:"json",set:function(a){this._internal.format=a}},publishOnInputsChanged:{type:"boolean",default:!1,displayName:"Send On Change",group:"General",set:function(a){this._internal.publishOnInputsChanged=!!a}},rateLimit:{type:"boolean",default:!1,displayName:"Rate Limit",group:"Rate Limit",set:function(a){this._internal.rateLimitEnabled=!!a}},maxMessagesPerSecond:{set:function(a){this._internal.maxMessagesPerSecond=Number(a)}}},prototypeExtensions:{registerInputIfNeeded:function(a){this.hasInput(a)||this.registerInput(a,{set:g.bind(this,a)})},computeTopic:function(){var a=this._internal.topic,b=this._internal.topicComponentsMap,c=this._internal.inputValues;for(var d in b)a=a.replace("{"+d+"}",c[d]);return a},schedulePublish:function(){if(!this._internal.hasScheduledPublish){if(this._internal.rateLimitEnabled){clearTimeout(this._internal.rateLimitTimeoutId);var a=d(),b=1e3/this._internal.maxMessagesPerSecond,c=a-this._internal.lastPublishTime;if(c<b)return void(this._internal.rateLimitTimeoutId=setTimeout(this.schedulePublish.bind(this),b-c))}this._internal.hasScheduledPublish=!0,this.scheduleAfterInputsHaveUpdated(function(){this._internal.hasScheduledPublish=!1;var a,b,c=this.computeTopic(),g=this._internal.inputValues,h=this._internal.topicComponentsMap;"csv"===this._internal.format?(b=e,a=""):(b=f,a={});for(var j in g)h[j]||(a=b(a,j,g[j]));i.pubsub.publish(c,a),this._internal.lastPublishTime=d()})}}}};b.exports={node:j,setup:function(a,b){a.editorConnection&&a.editorConnection.isRunningLocally()&&b.on("nodeAdded.Send Message",function(b){b.parameters.topic&&h(b.id,b.parameters.topic,a.editorConnection),b.on("parameterUpdated",function(c){"topic"===c.name&&h(b.id,b.parameters.topic,a.editorConnection)})})}}},{"../services/services":166}],120:[function(a,b,c){"use strict";var d=a("../nodedefinition"),e=a("../shaderparser"),f=a("../node"),g=["uniform mat4 u_projection;","uniform mat4 u_view;","attribute vec3 a_position;","attribute vec2 a_uv;","attribute vec4 a_color;","varying mediump vec2 uv;","varying lowp vec4 color;","","void main(void) {","   gl_Position = u_projection * u_view * vec4(a_position, 1.0);","   uv = a_uv;","   color = a_color;","}"].join("\n"),h=["uniform sampler2D texture;","varying mediump vec2 uv;","varying lowp vec4 color;","","void main(void) {","    gl_FragColor = texture2D(texture, uv)*color;","}"].join("\n"),i=d.defineNode({name:"Shader",category:"Graphics",initialize:function(){var a=this._internal;a.inputValues={},a.vertexShaderSource=g,a.fragmentShaderSource=h,this.context.uiEngine.on("shaderError",this.onShaderError.bind(this),this)},inputs:{vertexShader:{displayName:"Vertex shader",type:{name:"string",allowEditOnly:!0,codeeditor:"glsl"},default:g,set:function(a){this._internal.vertexShaderSource=a,this.context.editorConnection&&this.context.editorConnection.clearWarnings(this.nodeScope.componentOwner.name,this.id),this.flagOutputDirty("shader")}},fragmentShader:{displayName:"Fragment shader",type:{name:"string",allowEditOnly:!0,codeeditor:"glsl"},default:h,set:function(a){this._internal.fragmentShaderSource=a,this.context.editorConnection&&this.context.editorConnection.clearWarnings(this.nodeScope.componentOwner.name,this.id),this.flagOutputDirty("shader")}}},outputs:{shader:{displayName:"Shader",type:"object",getter:function(){var a=this._internal,b=e.extractUniforms(a.vertexShaderSource,a.fragmentShaderSource),c=[];return b.forEach(function(a){e.StandardUniformNames[a.name]||c.push(a)}),{vertexShaderSource:a.vertexShaderSource,fragmentShaderSource:a.fragmentShaderSource,id:this.id,uniforms:c}}}},prototypeExtensions:{_onNodeDeleted:function(){f.prototype._onNodeDeleted.call(this),this.context.uiEngine.removeListenersWithRef(this)},onShaderError:function(a){a.id===this.id&&this.context.editorConnection&&this.context.editorConnection.sendWarning(this.nodeScope.componentOwner.name,this.id,"glsl-syntax-error",{message:a.error,property:a.type})}}});b.exports=i},{"../node":79,"../nodedefinition":81,"../shaderparser":167}],121:[function(a,b,c){"use strict";var d=a("../nodedefinition"),e=a("../edgetriggeredinput");b.exports=d.defineNode({name:"Signal To Index",category:"Logic",initialize:function(){this._internal.currentIndex=0},numberedInputs:{input:{name:"numbered/simple-boolean",displayPrefix:"Signal",createSetter:function(a){return e.createSetter({valueChangedToTrue:this.onValueChangedToTrue.bind(this,a)})},selectors:{startIndex:{displayName:"Start Index",set:function(a){this._internal.currentIndex=a,this.flagOutputDirty("index")}}}}},outputs:{index:{displayName:"Index",type:"number",getter:function(){return this._internal.currentIndex}},signalTriggered:{displayName:"Signal Triggered",type:"signal"}},prototypeExtensions:{onValueChangedToTrue:function(a){this.sendSignalOnOutput("signalTriggered"),this._internal.currentIndex!==a&&(this._internal.currentIndex=a,this.flagOutputDirty("index"))}}})},{"../edgetriggeredinput":68,"../nodedefinition":81}],122:[function(a,b,c){"use strict";function d(a,b){if(a&&b&&a.length===b.length){for(var c={},d=0;d<a.length;d++){if(-1===b.indexOf(a[d])){if(c.before)return;c.before=a[d]}if(-1===a.indexOf(b[d])){if(c.after)return;c.after=b[d]}}return c.before&&c.after?c:void 0}}function e(a,b,c){var e=b.states,f=b.values,g=[];f=f?f.split(","):void 0;for(var h in f){var m=f[h];g.push({type:{name:"number",allowConnectionsOnly:!0},plug:"output",group:"Values",name:m})}e=e?e.split(","):void 0,e&&e.forEach(function(a){f&&f.forEach(function(b){g.push({plug:"input",type:"number",group:a+" Values",name:"value-"+a+"-"+b,displayName:b,editorName:a+"|"+b})}),g.push({plug:"input",type:{name:"enum",enums:[{value:"easeOut",label:"Ease Out"},{value:"easeIn",label:"Ease In"},{value:"linear",label:"Linear"},{value:"easeInOut",label:"Ease In Out"},{value:"cubicBezier",label:"Cubic Bezier"}]},default:"easeOut",displayName:"Easing Curve",group:a+" Transition",name:"transition-"+a}),"cubicBezier"===b["transition-"+a]&&(g=g.concat([{name:"cubicBezierP1X-"+a,editorName:a+"|P1 X",displayName:"P1 X",group:a+" Transition",plug:"input",type:"number",default:0},{name:"cubicBezierP1Y-"+a,editorName:a+"|P1 Y",displayName:"P1 Y",group:a+" Transition",plug:"input",type:"number",default:0},{name:"cubicBezierP2X-"+a,editorName:a+"|P2 X",displayName:"P2 X",group:a+" Transition",plug:"input",type:"number",default:0},{name:"cubicBezierP2Y-"+a,editorName:a+"|P2 Y",displayName:"P2 Y",group:a+" Transition",plug:"input",type:"number",default:0}])),g.push({plug:"input",type:"number",default:i,displayName:"Duration",group:a+" Transition",name:"duration-"+a}),g.push({plug:"input",type:{name:"boolean",allowConnectionsOnly:!0},displayName:"To "+a,name:"to-"+a,group:"Go to state"}),g.push({plug:"output",type:"boolean",displayName:"At "+a,name:"at-"+a,group:"Current state"}),g.push({plug:"output",type:"signal",displayName:"Has Reached "+a,name:"reached-"+a,group:"Current state"})}),e&&g.push({plug:"input",type:{name:"enum",enums:e},group:"States",displayName:"Start at",name:"startState",default:e[0]});var n=d(k[a],e);k[a]=e;var o=d(l[a],f);if(l[a]=f,n){var p={plug:"input",before:n.before,after:n.after,patterns:["transition-{{*}}","duration-{{*}}","cubicBezierP1X-{{*}}","cubicBezierP2X-{{*}}","cubicBezierP1Y-{{*}}","cubicBezierP2Y-{{*}}","to-{{*}}","at-{{*}}","reached-{{*}}"]};f&&f.forEach(function(a){p.patterns.push("value-{{*}}-"+a)})}else if(o)var p=[{plug:"output",before:o.before,after:o.after,patterns:["{{*}}"]},{plug:"input",before:o.before,after:o.after,patterns:e?e.map(function(a){return"value-"+a+"-{{*}}"}):void 0}];var q=JSON.stringify(g);j[a]!==q&&(j[a]=q,c.sendDynamicPorts(a,g,{renamed:p}))}var f=a("../edgetriggeredinput"),g=a("../easecurves"),h=a("bezier-easing"),i=300,j={},k={},l={},m={name:"States",category:"Animation",initialize:function(){var a=this,b=this._internal;b.currentValues={},b.stateParameters={},b.startValues={},b.bezierEaseCurves={},b.valuesAreInitialised=!1,b.animation=this.context.timerScheduler.createTimer({duration:i,ease:g.easeOut,onStart:function(){},onRunning:function(c){var d=this.ease(0,1,c),e=b.values,f=b.currentValues,g=b.stateParameters,h="value-"+b.state+"-",i=b.startValues;for(var j in e){var k=e[j];f[k]=i[k]*(1-d)+(g[h+k]||0)*d,a.flagOutputDirty(k)}},onFinish:function(){var c="reached-"+b.state;a.hasOutput(c)&&a.sendSignalOnOutput(c)}})},inputs:{states:{type:{name:"stringlist",allowEditOnly:!0},displayName:"States",group:"States",set:function(a){if(this._internal.states=a?a.split(","):[],this._internal.states.length>0){var b=this;this.scheduleAfterInputsHaveUpdated(function(){b._internal.state||b.goToState(b._internal.startState||b._internal.states[0])})}}},values:{type:{name:"stringlist",allowEditOnly:!0},displayName:"Values",group:"Values",set:function(a){var b=this._internal;b.values=a.split(",");for(var c in b.values)this.registerOutputIfNeeded(b.values[c])}},toggle:{group:"Go to state",displayName:"Toggle",valueChangedToTrue:function(){var a=this._internal,b=this;if(a.states){var c=a.states.indexOf(a.state),d=(c+1)%a.states.length;this._internal.scheduledToGoToState=a.states[d],this.scheduleAfterInputsHaveUpdated(function(){b.goToState(a.states[d])})}}},currentState:{type:{name:"string",allowConnectionsOnly:!0},displayName:"Current State",group:"Go to state",set:function(a){var b=this,c=this._internal;c.states&&-1!==c.states.indexOf(a)&&(c.scheduledToGoToState=a,this.scheduleAfterInputsHaveUpdated(function(){b.goToState(a)}))}}},outputs:{currentState:{type:"string",displayName:"Current State",group:"Current State",getter:function(){return this._internal.state}},stateChanged:{type:"signal",displayName:"State Changed",group:"Current State"}},prototypeExtensions:{registerOutputIfNeeded:function(a){var b=this._internal;this.hasOutput(a)||this.registerOutput(a,{getter:function(){return b.currentValues[a]}})},registerInputIfNeeded:function(a){var b=this,c=this._internal;if(!this.hasInput(a))if(0===a.indexOf("to-")){var d=a.substring(3);this.registerInput(a,{set:f.createSetter({valueChangedToTrue:function(){this._internal.scheduledToGoToState=d,this.scheduleAfterInputsHaveUpdated(function(){b.goToState(d)})}})})}else if("startState"===a)this.registerInput(a,{set:function(a){this._internal.scheduledToGoToState=a,this._internal.startState=a,this.scheduleAfterInputsHaveUpdated(function(){b.goToState(a)})}});else if(0===a.indexOf("value-")){var e=a.split("-"),d=e[1],g=e[2];this.registerInput(a,{set:function(e){c.stateParameters[a]=e,c.state===d&&(c.currentValues[g]=e,b.flagOutputDirty(g))}})}else if(0===a.search(/duration-/g))this.registerInput(a,{set:function(b){c.stateParameters[a]=b}});else if(0===a.search(/transition-/g)){var d=a.substring(11);this.registerInput(a,{set:function(b){c.stateParameters[a]=b,"cubicBezier"===b&&this.updateCubicBezierFunction(d)}})}else if(0===a.search(/cubicBezierP[1-2][X-Y]-/g)){var d=a.substring(15);this.registerInput(a,{set:function(b){c.stateParameters[a]=b,this.updateCubicBezierFunction(d)}})}},updateCubicBezierFunction:function(a){var b=[],c=this._internal;["1X","1Y","2X","2Y"].forEach(function(d,e){var f=c.stateParameters["cubicBezierP"+d+"-"+a]||0;e%2==0&&(f=Math.min(1,Math.max(0,f))),b.push(f)});var d=h(b);c.bezierEaseCurves[a]=function(a,b,c){return g.linear(a,b,d.get(c))}},jumpToState:function(a){var b=this._internal;if(b.states&&(a||(a=b.states[0]),b.state!==a)){b.animation.stop();var c="value-"+a+"-";for(var d in b.values){var e=b.values[d];b.currentValues[e]=b.stateParameters[c+e]||0,this.flagOutputDirty(e)}b.valuesAreInitialised=!0,b.state=a,this.sendSignalOnOutput("stateChanged"),this.updateAtStatePorts(),this.flagOutputDirty("currentState")}},goToState:function(a){var b=this._internal;if(b.states&&(a||(a=b.states[0]),b.state!==a))if(this._internal.scheduledToGoToState=void 0,b.valuesAreInitialised){for(var c in b.values){var d=b.values[c];b.startValues[d]=b.currentValues[d]}var e=b.stateParameters["transition-"+a]||"easeOut";b.animation.ease="cubicBezier"===e?b.bezierEaseCurves[a]:g[e];var f="duration-"+a;b.animation.duration=b.stateParameters.hasOwnProperty(f)?b.stateParameters[f]:i,b.animation.start(),b.state=a,this.sendSignalOnOutput("stateChanged"),this.updateAtStatePorts(),this.flagOutputDirty("currentState")}else this.jumpToState(a)},updateAtStatePorts:function(){var a=this._internal,b=a.states;for(var c in b){var d=b[c],e="at-"+d;a.currentValues[e]=a.state===d,this.hasOutput(e)&&this.flagOutputDirty(e)}}}};b.exports={node:m,setup:function(a,b){
a.editorConnection&&a.editorConnection.isRunningLocally()&&b.on("nodeAdded.States",function(b){b.parameters.states&&e(b.id,b.parameters,a.editorConnection),b.on("parameterUpdated",function(c){"states"!==c.name&&"values"!==c.name&&"transition-"!==c.name.substring(0,11)||e(b.id,b.parameters,a.editorConnection)})})}}},{"../easecurves":67,"../edgetriggeredinput":68,"bezier-easing":2}],123:[function(a,b,c){"use strict";function d(a,b){this._internal.inputValues[a]=b,this._internal.resultDirty=!0,this.flagOutputDirty("formatted")}function e(a,b,c){var d=b.match(/\{[A-Za-z0-9_]*\}/g),e=[];for(var f in d){var g=d[f],h=g.replace("{","").replace("}","");e.push({name:h,type:"*",plug:"input"})}c.sendDynamicPorts(a,e)}var f={name:"String Format",category:"String Manipulation",initialize:function(){var a=this._internal;a.format="",a.cachedResult="",a.resultDirty=!1,a.inputValues={}},inputs:{format:{type:{name:"string",multiline:!0},displayName:"Format",set:function(a){this._internal.format=a,this._internal.resultDirty=!0,this.flagOutputDirty("formatted")}}},outputs:{formatted:{type:"string",displayName:"Formatted",getter:function(){var a=this._internal;if(a.resultDirty){var b=a.format,c=a.format.match(/\{[A-Za-z0-9_]*\}/g),d=[];c&&(d=c.map(function(a){return a.replace("{","").replace("}","")})),d.forEach(function(c){var d=a.inputValues[c];b=b.replace("{"+c+"}",void 0!==d?d:"")}),a.cachedResult=b,a.resultDirty=!1}return a.cachedResult}}},prototypeExtensions:{registerInputIfNeeded:function(a){this.hasInput(a)||this.registerInput(a,{set:d.bind(this,a)})}}};b.exports={node:f,setup:function(a,b){a.editorConnection&&a.editorConnection.isRunningLocally()&&b.on("nodeAdded.String Format",function(b){b.parameters.format&&e(b.id,b.parameters.format,a.editorConnection),b.on("parameterUpdated",function(c){"format"===c.name&&e(b.id,b.parameters.format,a.editorConnection)})})}}},{}],124:[function(a,b,c){"use strict";var d=a("../nodedefinition");b.exports=d.defineNode({name:"String Mapper",category:"Utilities",initialize:function(){this._internal.inputs=[],this._internal.mappings=[]},numberedInputs:{input:{name:"numbered/simple-string",displayPrefix:"Input",group:"Inputs",index:11,createSetter:function(a){return function(b){b=b.toString(),this._internal.inputs[a]=b,this.scheduleMapping()}}},output:{name:"numbered/simple-string",displayPrefix:"Mapping",index:12,group:"Mappings",createSetter:function(a){return function(b){b=b.toString(),this._internal.mappings[a]=b,this.scheduleMapping()}}}},inputs:{inputString:{type:{name:"string"},index:1,displayName:"Input String",set:function(a){this._internal.currentInputString=a,this.scheduleMapping()}},defaultMapping:{type:"string",displayName:"Default",index:10,group:"Mappings",set:function(a){this._internal.defaultMapping=a,this.scheduleMapping()}}},outputs:{mappedString:{type:"string",displayName:"Mapped String",group:"Value",getter:function(){return this._internal.mappedString}}},prototypeExtensions:{doMapping:function(){this._internal.hasScheduledFetch=!1;var a=this._internal.inputs.indexOf(this._internal.currentInputString);this._internal.mappedString=-1!==a?this._internal.mappings[a]:this._internal.defaultMapping,this.flagOutputDirty("mappedString")},scheduleMapping:function(){var a=this._internal;a.hasScheduledFetch||(a.hasScheduledFetch=!0,this.scheduleAfterInputsHaveUpdated(this.doMapping.bind(this)))}}})},{"../nodedefinition":81}],125:[function(a,b,c){"use strict";var d=a("../nodedefinition");b.exports=d.defineNode({name:"String Selector",category:"Utilities",initialize:function(){this._internal.inputs=[],this._internal.currentSelectedIndex=0,this._internal.indexChanged=!1},numberedInputs:{input:{name:"numbered/simple-string",displayPrefix:"Input",group:"Inputs",createSetter:function(a){return function(b){b=b.toString(),this._internal.inputs[a]=b,this._internal.currentSelectedIndex===a&&this.flagOutputDirty("currentValue")}}}},inputs:{index:{type:{name:"number"},displayName:"Index",default:0,set:function(a){a|=0,this._internal.currentSelectedIndex=a,this.flagOutputDirty("currentValue"),this.sendSignalOnOutput("indexChanged")}}},outputs:{currentValue:{type:"string",displayName:"Current Value",group:"Value",getter:function(){return this._internal.inputs[this._internal.currentSelectedIndex]}},indexChanged:{type:"signal",displayName:"Index Changed",group:"Signals"}}})},{"../nodedefinition":81}],126:[function(a,b,c){"use strict";var d=a("../nodedefinition");b.exports=d.defineNode({name:"Substring",category:"String Manipulation",initialize:function(){var a=this._internal;a.startIndex=0,a.endIndex=-1,a.cachedResult="",a.inputString="",a.resultDirty=!1},inputs:{start:{type:"number",displayName:"Start",default:0,set:function(a){this._internal.startIndex=a,this._internal.resultDirty=!0,this.flagOutputDirty("result")}},end:{type:"number",displayName:"End",default:0,set:function(a){this._internal.endIndex=a,this._internal.resultDirty=!0,this.flagOutputDirty("result")}},string:{type:{name:"string"},displayName:"String",default:"",set:function(a){a=a.toString(),this._internal.inputString=a,this._internal.resultDirty=!0,this.flagOutputDirty("result")}}},outputs:{result:{type:"string",displayName:"Result",getter:function(){var a=this._internal;return a.resultDirty&&(-1===a.endIndex?a.cachedResult=a.inputString.substr(a.startIndex):a.cachedResult=a.inputString.substr(a.startIndex,a.endIndex-a.startIndex),a.resultDirty=!1),a.cachedResult}}}})},{"../nodedefinition":81}],127:[function(a,b,c){"use strict";var d={name:"Switch",category:"Logic",initialize:function(){this._internal.state=!1,this._internal.initialized=!1},inputs:{on:{displayName:"On",group:"Change State",valueChangedToTrue:function(){!0!==this._internal.state&&(this._internal.state=!0,this.flagOutputDirty("state"),this.emitSignals())}},off:{displayName:"Off",group:"Change State",valueChangedToTrue:function(){!1!==this._internal.state&&(this._internal.state=!1,this.flagOutputDirty("state"),this.emitSignals())}},flip:{displayName:"Flip",group:"Change State",valueChangedToTrue:function(){this._internal.state=!this._internal.state,this.flagOutputDirty("state"),this.emitSignals()}},onFromStart:{type:"boolean",displayName:"Start State",group:"Start State",default:!1,set:function(a){a&&!this._internal.initialized&&(this._internal.state=!0,this.flagOutputDirty("state"),this._internal.initialized=!0,this.emitSignals())}}},outputs:{state:{type:"boolean",displayName:"Current State",getter:function(){return this._internal.state}},switchedToOn:{displayName:"Switched To On",type:"signal",group:"Signals"},switchedToOff:{displayName:"Switched To Off",type:"signal",group:"Signals"}},prototypeExtensions:{emitSignals:function(){!0===this._internal.state?this.sendSignalOnOutput("switchedToOn"):this.sendSignalOnOutput("switchedToOff")}}};b.exports={node:d}},{}],128:[function(a,b,c){"use strict";var d=a("../nodedefinition");b.exports=d.defineNode({name:"Timer",category:"Utilities",initialize:function(){var a=this;this._internal._animation=this.context.timerScheduler.createTimer({duration:0,onStart:function(){a.sendSignalOnOutput("timerStarted")},onFinish:function(){a.sendSignalOnOutput("timerFinished")}})},inputs:{start:{displayName:"Start",valueChangedToTrue:function(){!1===this._internal._animation._isRunning&&this._internal._animation.start()}},restart:{displayName:"Restart",valueChangedToTrue:function(){this._internal._animation.start()}},duration:{type:"number",displayName:"Duration",default:0,set:function(a){this._internal._animation.duration=a}},startDelay:{type:"number",displayName:"Start Delay",default:0,set:function(a){this._internal._animation.delay=a}},stop:{displayName:"Stop",valueChangedToTrue:function(){this._internal._animation.stop()}}},outputs:{timerStarted:{type:"signal",displayName:"Started"},timerFinished:{type:"signal",displayName:"Finished"}}})},{"../nodedefinition":81}],129:[function(a,b,c){"use strict";var d=a("../node"),e={name:"Touch Position",category:"Interaction",initialize:function(){this._internal.x=0,this._internal.y=0,this.context.uiEngine.on("touchEvent",this.onTouchEvent.bind(this),this)},outputs:{x:{type:"number",displayName:"Position X",getter:function(){return this._internal.x}},y:{type:"number",displayName:"Position Y",getter:function(){return this._internal.y}}},prototypeExtensions:{_onNodeDeleted:function(){d.prototype._onNodeDeleted.call(this),this.context.uiEngine.removeListenersWithRef(this)},onTouchEvent:function(a){this._internal.x!==a.x&&(this._internal.x=a.x,this.flagOutputDirty("x")),this._internal.y!==a.y&&(this._internal.y=a.y,this.flagOutputDirty("y"))}}};b.exports={node:e}},{"../node":79}],130:[function(a,b,c){"use strict";function d(a){var b=this._internal._animation;b.stop(),b.startValue=a,this.scheduleAfterInputsHaveUpdated(function(){b.endValue!==a&&b.start()}),this._internal.currentNumber=a,this.flagOutputDirty("currentValue")}var e=a("../nodedefinition"),f=a("../easecurves"),g=300,h={name:"Transition",category:"Animation",initialize:function(){var a=this,b=this._internal;b.currentNumber=0,b.numberInitialized=!1,b.animationStarted=!1,b.setCurrentNumberEnabled=!1,b.overrideValue=0,b._animation=this.context.timerScheduler.createTimer({duration:g,startValue:0,endValue:0,ease:f.easeOut,onStart:function(){b.animationStarted=!0},onRunning:function(c){b.currentNumber=this.ease(this.startValue,this.endValue,c),a.flagOutputDirty("currentValue")},onFinish:function(){a.sendSignalOnOutput("atTargetValue")}})},inputs:{targetValue:{type:{name:"number"},displayName:"Value",group:"Target Value",default:void 0,set:function(a){if(!0===a?a=1:!1===a&&(a=0),a=Number(a),!isNaN(a)){var b=this._internal;if(!1===b.numberInitialized)return b.currentNumber=a,b.numberInitialized=!0,b._animation.endValue=a,void this.flagOutputDirty("currentValue");a!==b._animation.endValue&&(b._animation.startValue=b.currentNumber,b._animation.endValue=a,b._animation.start())}}},"overrideCurrentValue.value":{type:{name:"number"},group:"Override Value",displayName:"Value",editorName:"Value|Override Value",set:function(a){this._internal.overrideValue=a}},"overrideCurrentValue.do":{group:"Override Value",displayName:"Do",editorName:"Do|Override Value",valueChangedToTrue:function(){d.call(this,this._internal.overrideValue)}},duration:{type:"number",group:"Parameters",displayName:"Duration",default:g,set:function(a){this._internal._animation.duration=a}},delay:{type:"number",group:"Parameters",displayName:"Delay",default:0,set:function(a){this._internal._animation.delay=a}},easingCurve:{type:{name:"enum",enums:[{value:"easeOut",label:"Ease Out"},{value:"easeIn",label:"Ease In"},{value:"linear",label:"Linear"},{value:"easeInOut",label:"Ease In Out"}]},default:"easeOut",displayName:"Easing Curve",group:"Parameters",set:function(a){this._internal._animation.ease=f[a]}}},outputs:{currentValue:{type:"number",displayName:"Current Value",group:"Current State",getter:function(){return this._internal.currentNumber}},atTargetValue:{type:"signal",displayName:"At Target Value",group:"Signals"}}};b.exports=e.defineNode(h)},{"../easecurves":67,"../nodedefinition":81}],131:[function(a,b,c){"use strict";var d=a("../nodedefinition"),e=d.defineNode({name:"Unique Id",category:"String Manipulation",initialize:function(){this._internal.guid=this.guid()},inputs:{new:{displayName:"New",valueChangedToTrue:function(){this._internal.guid=this.guid(),this.flagOutputDirty("guid")}}},outputs:{guid:{type:"string",displayName:"Id",getter:function(){return this._internal.guid}}},prototypeExtensions:{guid:function(){function a(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}return a()+a()+"-"+a()+"-"+a()+"-"+a()+"-"+a()+a()+a()}}});b.exports=e},{"../nodedefinition":81}],132:[function(a,b,c){"use strict";var d=a("../nodedefinition");b.exports=d.defineNode({name:"Value Changed",category:"Logic",initialize:function(){this._internal.lastValue=void 0},inputs:{value:{type:"*",displayName:"Input",set:function(a){this._internal.lastValue!==a&&(this.sendSignalOnOutput("valueChanged"),this._internal.lastValue=a)}}},outputs:{valueChanged:{type:"signal",displayName:"Value Changed"}}})},{"../nodedefinition":81}],133:[function(a,b,c){"use strict";var d=a("./variablebase"),e=d.createDefinition({name:"Boolean",startValue:!1,type:{name:"boolean"},cast:function(a){return Boolean(a)}});b.exports={node:e}},{"./variablebase":137}],134:[function(a,b,c){"use strict";var d=a("./variablebase"),e=a("../../nodedefinition");b.exports=e.defineNode(d.createDefinition({name:"Color",startValue:"#f1f2f4",type:{name:"color"},cast:function(a){return a}}))},{"../../nodedefinition":81,"./variablebase":137}],135:[function(a,b,c){"use strict";var d=a("./variablebase"),e=d.createDefinition({name:"Number",startValue:0,type:{name:"number"},cast:function(a){return Number(a)}});b.exports={node:e}},{"./variablebase":137}],136:[function(a,b,c){"use strict";var d=a("./variablebase"),e=a("../../nodedefinition"),f=d.createDefinition({name:"String",startValue:"",type:{name:"string"},cast:function(a){return a.toString()}});e.extend(f,{outputs:{length:{type:"number",displayName:"Length",getter:function(){return this._internal.currentValue.length}}}}),b.exports=e.defineNode(f)},{"../../nodedefinition":81,"./variablebase":137}],137:[function(a,b,c){"use strict";function d(a){return{name:a.name,category:"Variables",initialize:function(){this._internal.currentValue=a.startValue,this._internal.latestValue=0},inputs:{value:{type:a.type,displayName:"Value",default:a.startValue,set:function(a){!1===this.isInputConnected("saveValue")?this.setValueTo(a):this._internal.latestValue=a}},saveValue:{displayName:"Save Value",valueChangedToTrue:function(){this.scheduleAfterInputsHaveUpdated(function(){this.setValueTo(this._internal.latestValue)})}}},outputs:{savedValue:{type:a.type.name,displayName:"Saved Value",getter:function(){return this._internal.currentValue}}},prototypeExtensions:{setValueTo:function(b){b=a.cast(b),this._internal.currentValue=b,this.flagAllOutputsDirty()}}}}b.exports={createDefinition:d}},{}],138:[function(a,b,c){"use strict";var d=a("../nodedefinition");b.exports=d.defineNode({name:"Velocity",category:"Math",initialize:function(){var a=this._internal;a.oldValue=0,a.sampledAtTime=0,a.velocity=0},inputs:{value:{type:"number",displayName:"Value",set:function(a){var b=this._internal;if(0===b.sampledAtTime)return b.oldValue=a,void(b.sampledAtTime=this.context.currentFrameTime);if(this.context.currentFrameTime!==b.sampledAtTime){var c=this.context.currentFrameTime-b.sampledAtTime;b.velocity=(a-b.oldValue)/c,b.sampledAtTime=this.context.currentFrameTime,b.oldValue=a,this.flagOutputDirty("velocity")}}}},outputs:{velocity:{type:"number",displayName:"Velocity",getter:function(){return this._internal.velocity}}}})},{"../nodedefinition":81}],139:[function(a,b,c){"use strict";var d=a("./renderable"),e=a("../../nodedefinition"),f="#f0f0f0",g=d.createDefinition({defaultSizeEnum:"explicit",defaultSizeUnit:"px",defaultWidth:200,defaultHeight:200,defaultColor:f,createControl:function(a){var b=a.createCircleControl();return b.setWidth(200),b.setColor(f),b}});delete g.inputs.height,g.inputs.width.displayName="Size",g.inputs.width.type.units=["px"],e.extend(g,{name:"Circle",inputs:{solid:{index:3004,type:"boolean",displayName:"Solid",group:"Appearance",default:!0,set:function(a){this._internal.uiControl.setSolid(!!a)}},lineWidth:{index:3005,type:"number",displayName:"Line Width",group:"Appearance",default:1,set:function(a){this._internal.uiControl.setLineWidth(a)}},blur:{index:3006,displayName:"Blur Length",group:"Appearance",type:"number",default:0,set:function(a){this._internal.uiControl.setBlur(a)}},arcAngle:{index:3007,displayName:"Arc Angle",group:"Appearance",type:"number",default:360,set:function(a){this._internal.uiControl.setArcAngle(a*Math.PI/180)}},image:{index:3500,displayName:"Image Path",group:"Image Properties",type:{name:"image"},set:function(a){"string"==typeof a&&this.context.runningInEditor&&"/"!==a[0]&&(a="/"+a),this._internal.uiControl.setImagePath(a)}}}}),b.exports={node:g}},{"../../nodedefinition":81,"./renderable":150}],140:[function(a,b,c){"use strict";function d(a,b){var c,d=/\s+([0-9]+)\s*vw/g,e=a+"";do{(c=d.exec(a))&&(e=e.replace(c[0]," "+Math.round(parseInt(c[1])*b)+"px"))}while(c);return e}var e=a("../../node"),f={name:"CSS Definition",category:"HTML",initialize:function(){this._internal.style="",this.context.uiEngine.on("viewportSizeChanged",this.viewPortSizeChanged.bind(this),this)},inputs:{style:{index:4005,type:{name:"string",allowEditOnly:!0,codeeditor:"css"},displayName:"Style",group:"Content",default:"",set:function(a){var b=this.context.uiEngine.getUIScale();this.updateStyle(a,b)}}},outputs:{},prototypeExtensions:{getStyleRefId:function(){return"style_"+this.id},viewPortSizeChanged:function(a){var b=this.context.uiEngine.getUIScale();this.updateStyle(this._internal.style,b)},removeStyleDeclaration:function(){var a=this.getStyleRefId(),b=(this._internal,document.getElementById(a));null!==b&&b.parentNode.removeChild(b)},_onNodeDeleted:function(){e.prototype._onNodeDeleted.call(this),this.context.uiEngine.removeListenersWithRef(this),this.removeStyleDeclaration()},updateStyle:function(a,b){var c=this._internal,e=this.getStyleRefId();if(c.style=a,null!==(a=d(a,b))){var f=document.getElementById(e);null===f&&(f=document.createElement("style"),f.id=e,f.type="text/css",document.head.appendChild(f)),f.innerHTML="\n"+a+"\n"}else this.removeStyleDeclaration()}}};b.exports={node:f,setup:function(a,b){!a.editorConnection||a.editorConnection.isRunningLocally()}}},{"../../node":79}],141:[function(a,b,c){"use strict";var d=a("./util/shadersupport"),e=a("./layoutbase"),f=a("../../node"),g=a("../../nodedefinition"),h=a("../../uiengine/controls/effectcontrol"),i=e.createDefinition({name:"Effect group",createControl:function(a){return a.createEffectControl()}}),j=[{name:"gaussianBlur.radius",plug:"input",type:"number",default:h.StandardGaussianBlurRadius,displayName:"Blur Radius",group:"Effects",index:2002}],k=[{name:"standardEffect.amount",plug:"input",type:"number",default:h.StandardEffectAmount,displayName:"Effect Amount",group:"Effects",index:2001}];g.extend(i,{initialize:function(){var a=this._internal;a.standardEffect="none",a.shaderSupport=new d(a.uiControl,!1),a.secondaryShaderSupport=new d(a.uiControl,!0);var b=this;a.uiControl.on("layoutWidthChanged",function(){b.flagOutputDirty("outputImage")}),a.uiControl.on("layoutHeightChanged",function(){b.flagOutputDirty("outputImage")})},dynamicports:[{name:"conditionalports/basic",condition:"standardEffect = gaussianBlur",ports:j},{name:"conditionalports/basic",condition:"standardEffect != none",ports:k}],inputs:{"gaussianBlur.radius":{set:function(a){this._internal.uiControl.setGaussianBlurRadius(a)}},"standardEffect.amount":{set:function(a){this._internal.uiControl.setEffectAmount(a)}},standardEffect:{type:{name:"enum",enums:[{value:"none",label:"None"},{value:"gaussianBlur",label:"Gaussian Blur"},{value:"desaturate",label:"Desaturate"}]},group:"Effects",displayName:"Standard Effect",default:"none",index:2e3,set:function(a){this._internal.standardEffect=a,this._internal.uiControl.setStandardEffect(a),this.scheduleAfterInputsHaveUpdated(function(){this.updatePorts()})}},vertices:{type:"object",displayName:"Vertices",group:"Effects",set:function(a){this._internal.uiControl.setVertices(a)}},renderScale:{group:"Effects",index:2003,type:{name:"number",units:["%"],defaultUnit:"%"},default:100,displayName:"Render Scale",set:function(a){var b=Math.max(.01,Math.min(4,a/100));this._internal.uiControl.setRenderScale(b)}},maskImage:{index:2004,type:{name:"image"},displayName:"Mask Image Path",group:"Effects",set:function(a){this.scheduleAfterInputsHaveUpdated(function(){this._internal.uiControl.setMaskImagePath(a)})}},drawToScreen:{index:2005,type:"boolean",group:"Effects",displayName:"Draw To Screen",default:!0,set:function(a){this._internal.uiControl.setDrawToScreen(a)}},shader:{type:"object",displayName:"Shader",group:"Shader properties",set:function(a){var b=this._internal;b.uiControl.setShader(a),b.shaderSupport.setShader(a,this.id),this.scheduleAfterInputsHaveUpdated(function(){this.updatePorts()})}},secondPassShader:{type:"object",displayName:"Second Pass Shader",group:"Shader properties",set:function(a){var b=this._internal;b.uiControl.setSecondaryShader(a),b.secondaryShaderSupport.setShader(a),this.scheduleAfterInputsHaveUpdated(function(){this.updatePorts()})}},cornerRadius:{index:3004,type:"number",displayName:"Corner Radius",group:"Appearance",default:0,set:function(a){this._internal.uiControl.setCornerRadius(a)}}},outputs:{outputImage:{type:"string",displayName:"Output Image",group:"Effects",getter:function(){return this._internal.uiControl.getOutputImageId()}}},prototypeExtensions:{_onNodeDeleted:function(){f.prototype._onNodeDeleted.call(this),this._internal.shaderSupport.control=null},registerOutputIfNeeded:function(a){f.prototype.registerOutputIfNeeded.call(this),"outputImage"===a&&(this._internal.uiControl.setFrameBufferIsExclusive(!0),this._internal.uiControl.setRenderEffectsToTexture(!0))},registerInputIfNeeded:function(a){this.hasInput(a)||this.registerInput(a,{set:this.uniformSetter.bind(this,a)})},updatePorts:function(){if(this.context.editorConnection&&this.context.editorConnection.isRunningLocally()){var a=this._internal.shaderSupport.ports;a=a.concat(this._internal.secondaryShaderSupport.ports),this.context.editorConnection.sendDynamicPorts(this.id,a)}},uniformSetter:function(a,b){var c=this._internal;this.scheduleAfterInputsHaveUpdated(function(){-1!==a.indexOf(c.secondaryShaderSupport.uniformPrefix)?c.secondaryShaderSupport.setUniform(a,b):c.shaderSupport.setUniform(a,b)})}},version:1}),b.exports={node:i}},{"../../node":79,"../../nodedefinition":81,"../../uiengine/controls/effectcontrol":171,"./layoutbase":146,"./util/shadersupport":155}],142:[function(a,b,c){"use strict";var d=a("./layoutbase"),e=a("../../nodedefinition"),f=d.createDefinition({name:"Flow Layout",hasOrientation:!0,createControl:function(a){return a.createFlowLayoutControl()}});e.extend(f,{inputs:{verticalItemSpacing:{index:2501,group:"Layout",displayName:"V. Spacing",type:"number",default:0,set:function(a){this._internal.uiControl.setVerticalItemSpacing(Number(a))}},horizontalItemSpacing:{index:2502,group:"Layout",displayName:"H. Spacing",type:"number",default:0,set:function(a){this._internal.uiControl.setHorizontalItemSpacing(Number(a))}},contentAlignX:{index:2503,type:{name:"enum",enums:[{value:"left",label:"Left"},{value:"center",label:"Center"},{value:"right",label:"Right"}]},group:"Layout",displayName:"Content Align X",default:"left",set:function(a){this._internal.uiControl.setContentAlignX(a)}},contentAlignY:{index:2504,type:{name:"enum",enums:[{value:"top",label:"Top"},{value:"center",label:"Center"},{value:"bottom",label:"Bottom"}]},group:"Layout",displayName:"Content Align Y",default:"top",set:function(a){this._internal.uiControl.setContentAlignY(a)}}}}),b.exports=e.defineNode(f)},{"../../nodedefinition":81,"./layoutbase":146}],143:[function(a,b,c){"use strict";var d=a("./layoutbase"),e=d.createDefinition({name:"Group",createControl:function(a){return a.createDockLayoutControl()},version:2});b.exports={node:e}},{"./layoutbase":146}],144:[function(a,b,c){"use strict";function d(){return/{{[{]?(.*?)[}]?}}/g}function e(a,b){this._internal.inputValues[a]=b,this.shouldUpdateHTML()&&f.call(this)}function f(){var a,b=this._internal.content,c=b+"",e=d(),f=this._internal.inputValues;do{if(a=e.exec(b)){var g="";a[1]in f&&f[a[1]]&&(g=f[a[1]]),c=c.replace(a[0],g)}}while(a);return this._internal.uiControl.setContent(c)}function g(a){var b,c=d(),e=[];do{(b=c.exec(a))&&e.push({group:"Inputs",plug:"input",name:b[1],type:"string"})}while(b);this.context.editorConnection&&this.context.editorConnection.isRunningLocally()&&this.context.editorConnection.sendDynamicPorts(this.id,e)}var h=a("../../nodedefinition"),i=a("../../node"),j=a("./visualbase"),k=j.createDefinition({sizeEnums:[{value:"explicit",label:"Explicit"}],defaultSizeEnum:"explicit",defaultSizeUnit:"%",defaultWidth:100,defaultHeight:100,createControl:function(a){return a.createHtmlControl()}}),l={name:"html",plug:"input",index:3004,type:{name:"string",allowEditOnly:!0,codeeditor:"html"},default:"<!DOCTYPE html>",displayName:"HTML",group:"Content"},m={name:"HTML Content",initialize:function(){var a=this._internal;a.content="",a.addedToDOM=!1,a.inputValues={},a.usesDynamicContent=!1,a.elementType="div"},dynamicports:[{name:"conditionalports/basic",condition:"elementType = div AND usesDynamicContent = false OR usesDynamicContent NOT SET",ports:[l]},{name:"conditionalports/basic",condition:"elementType NOT SET AND usesDynamicContent = false OR usesDynamicContent NOT SET",ports:[l]},{name:"conditionalports/basic",condition:"elementType = div OR elementType NOT SET",ports:[{index:3003,type:{name:"boolean"},displayName:"Dynamic Content",group:"Content",name:"usesDynamicContent",plug:"input"}]}],inputs:{elementType:{index:3002,group:"Content",displayName:"Element type",type:{name:"enum",enums:[{value:"div",label:"div"},{value:"canvas",label:"canvas"}]},default:"div",set:function(a){var b=this._internal,c=b.uiControl;null!==c.domNode&&c.domNode.element.tagName.toLowerCase().valueOf()===a.valueOf()||(c.domNode&&(c.domNode.removeListenersWithRef(this),c.domNode.dispose()),this._internal.addedToDOM=!1,this.hasOutput("isAddedToDOM")&&this.flagOutputDirty("isAddedToDOM"),this._internal.elementType=a,this.createDOMNodeWithElementType(a),this.hasOutput("domElement")&&this.flagOutputDirty("domElement"))}},usesDynamicContent:{default:!1,set:function(a){if(this._internal.uiControl.isAttached()&&"div"===this.internal.elementType)if(a&&!this._internal.usesDynamicContent){var b=this._internal.content;this._internal.content="",g.call(this,this._internal.content),f.call(this),this._internal.content=b}else!a&&this._internal.usesDynamicContent&&(g.call(this,this._internal.content),f.call(this));this._internal.usesDynamicContent=a}},html:{default:"",set:function(a){this._internal.content!==a&&(this._internal.content=a,this.shouldUpdateHTML()&&f.call(this),g.call(this,a))}},className:{index:3008,type:{name:"string"},displayName:"CSS Classes",group:"Content",default:"",set:function(a){this._internal.className!==a&&(this._internal.className=a,this._internal.uiControl.setClassName(a))}}},outputs:{isAddedToDOM:{type:"boolean",displayName:"Added to DOM",group:"General",getter:function(){return this._internal.addedToDOM}},domElement:{type:"domelement",displayName:"DOM Element",group:"General",getter:function(){return this._internal.uiControl.domNode.element}}},prototypeExtensions:{createDOMNodeWithElementType:function(a){var b=this._internal,c=b.uiControl,d=this.context.uiEngine.createDOMElement("html",a,c.id,!0);c.setDomNode(d);var e=this;d.on("addedToParent",function(a){b.addedToDOM||(e._internal.addedToParentCallback&&e._internal.addedToParentCallback(a),e.shouldUpdateHTML()&&(g.call(e,e._internal.content),f.call(e)),b.addedToDOM=!0,e.hasOutput("isAddedToDOM")&&e.flagOutputDirty("isAddedToDOM"),b.initialHTMLSetCallback&&b.initialHTMLSetCallback())},this),d.on("removedFromParent",function(a){b.addedToDOM=!1,e.hasOutput("isAddedToDOM")&&e.flagOutputDirty("isAddedToDOM")},this)},setNodeModel:function(a){var b=this._internal,c=a.parameters.elementType||"div";"canvas"!==c.valueOf()&&"div"!==c.valueOf()&&(c="div"),b.elementType=c,this.createDOMNodeWithElementType(c),i.prototype.setNodeModel.call(this,a)},shouldUpdateHTML:function(){return this._internal.uiControl.isAttached()&&!this._internal.usesDynamicContent&&"div"===this._internal.elementType},_onNodeDeleted:function(){i.prototype._onNodeDeleted.call(this);var a=this._internal;a.addedToParentCallback&&delete a.addedToParentCallback,a.initialHTMLSetCallback&&delete a.initialHTMLSetCallback;var b=a.uiControl;null!==b.domNode&&b.domNode.removeListenersWithRef(this),b.dispose()},registerInputIfNeeded:function(a){this.hasInput(a)||(this._internal.inputValues[a]=void 0,this.registerInput(a,{set:e.bind(this,a)}))}}},n=h.extend(k,m);b.exports={definition:m,node:n,setup:function(a,b){!a.editorConnection||a.editorConnection.isRunningLocally()}}},{"../../node":79,"../../nodedefinition":81,"./visualbase":157}],145:[function(a,b,c){"use strict";var d=a("./util/shadersupport"),e=a("./renderable"),f=a("../../nodedefinition"),g=a("../../node"),h=(a("../../uiengine/controls/effectcontrol"),e.createDefinition({sizeEnums:[{value:"explicit",label:"Explicit"},{value:"childWidth",label:"Content Width"},{value:"childHeight",label:"Content Height"},{value:"childSize",label:"Content Size"}],defaultSizeEnum:"childSize",defaultSizeUnit:"%",defaultWidth:100,defaultHeight:100,widthCondition:"sizeMode = explicit OR sizeMode = childHeight",heightCondition:"sizeMode = explicit OR sizeMode = childWidth",defaultColor:"#ffffff",createControl:function(a){return a.createImageControl()}}));f.extend(h,{name:"Image",version:2,usePortAsLabel:"image",portLabelTruncationMode:"filename",initialize:function(){var a=this._internal;a.shaderSupport=new d(a.uiControl)},inputs:{image:{index:2500,type:{name:"image"},displayName:"Image Path",group:"Image Properties",set:function(a){this._internal.uiControl.setImagePath(a||null)}},cornerRadius:{index:3004,type:"number",displayName:"Corner Radius",group:"Appearance",default:0,set:function(a){this._internal.uiControl.innerControl.setCornerRadius(a)}},fillMode:{index:2501,type:{name:"enum",enums:[{value:"original",label:"Original"},{value:"aspectFill",label:"Aspect Fill"},{value:"aspectFit",label:"Aspect Fit"},{value:"fill",label:"Fill"}],allowEditOnly:!0},displayName:"Fill Mode",group:"Image Properties",default:"original",set:function(a){this._internal.uiControl.setFillMode(a)}},clipImage:{index:2502,type:"boolean",displayName:"Clip Image",default:!0,group:"Image Properties",set:function(a){this._internal.uiControl.setClip(!!a)}},vertices:{type:"object",displayName:"Vertices",group:"Image properties",set:function(a){this._internal.uiControl.setVertices(a)}},shader:{type:"object",displayName:"Shader",group:"Image Properties",set:function(a){var b=this._internal;b.shader=a,b.uiControl.setShader(a),b.shaderSupport.setShader(a,this.id),this.updatePorts()}}},prototypeExtensions:{_onNodeDeleted:function(){g.prototype._onNodeDeleted.call(this),this._internal.shaderSupport.control=null},updatePorts:function(){this.context.editorConnection&&this.context.editorConnection.isRunningLocally()&&this.context.editorConnection.sendDynamicPorts(this.id,this._internal.shaderSupport.ports)},registerInputIfNeeded:function(a){this.hasInput(a)||this.registerInput(a,{set:this.uniformSetter.bind(this,a)})},uniformSetter:function(a,b){var c=this._internal;this.scheduleAfterInputsHaveUpdated(function(){c.shaderSupport.setUniform(a,b)})}}});var i=[{inputName:"cropStartX",index:0,default:0,displayName:"Crop Start X"},{inputName:"cropEndX",index:2,default:1,displayName:"Crop End X"},{inputName:"cropStartY",index:1,default:0,displayName:"Crop Start Y"},{inputName:"cropEndY",index:3,default:1,displayName:"Crop End Y"}],j={};i.forEach(function(a){var b=a.index;j[a.inputName]={index:2503+b,type:"number",group:"Image Properties",default:a.default,displayName:a.displayName,set:function(a){this._internal.innerControl._srcRect[b]=a,this._internal.innerControl.contentDirty=!0}}}),f.extend(h,j),b.exports=f.defineNode(h)},{"../../node":79,"../../nodedefinition":81,"../../uiengine/controls/effectcontrol":171,"./renderable":150,"./util/shadersupport":155}],146:[function(a,b,c){"use strict";function d(a){var b=e.createDefinition({createControl:a.createControl,sizeEnums:[{value:"explicit",label:"Explicit"},{value:"childWidth",label:"Content Width"},{value:"childHeight",label:"Content Height"},{value:"childSize",label:"Content Size"}],defaultSizeEnum:"explicit",defaultSizeUnit:"%",defaultWidth:100,defaultHeight:100})
;return f.extend(b,{name:a.name,version:a.version,initialize:function(){var a=this._internal;a.children=[],a.padding=0},allowChildren:!0,inputs:{clip:{group:"Appearance",displayName:"Clip",type:"boolean",index:3100,default:!1,set:function(a){this._internal.uiControl.setClip(a)}},padding:{group:"Padding",displayName:"Padding",type:"number",index:2800,default:0,set:function(a){var b=this._internal.uiControl;this._internal.padding=a,b.setPaddingTop(a),b.setPaddingLeft(a),b.setPaddingBottom(a),b.setPaddingRight(a)}},paddingLeft:{group:"Padding",displayName:"Pad Left",type:"number",index:2801,set:function(a){a=void 0!==a?a:this._internal.padding,this._internal.uiControl.setPaddingLeft(a)}},paddingRight:{group:"Padding",displayName:"Pad Right",type:"number",index:2802,set:function(a){a=void 0!==a?a:this._internal.padding,this._internal.uiControl.setPaddingRight(a)}},paddingTop:{group:"Padding",displayName:"Pad Top",type:"number",index:2803,set:function(a){a=void 0!==a?a:this._internal.padding,this._internal.uiControl.setPaddingTop(a)}},paddingBottom:{group:"Padding",displayName:"Pad Bottom",type:"number",index:2804,set:function(a){a=void 0!==a?a:this._internal.padding,this._internal.uiControl.setPaddingBottom(a)}}},outputs:{childCount:{displayName:"Child Count",type:"number",getter:function(){return this._internal.children.length}}},prototypeExtensions:{addChild:{value:function(a,b){if(!a.getVisualRoot)throw new Error("child must have a visual root");var c=this._internal.uiControl,d=this._internal.children;void 0===b&&(b=d.length),b=Math.max(0,b),c.addChild(a.getVisualRoot()._internal.uiControl,b),b===d.length?d.push(a):d.splice(b,0,a),this.flagOutputDirty("childCount");for(var e=b;e<d.length;e++)d[e].getVisualRoot().flagOutputDirty("childIndex");a._internal.visualParent=this,a.getVisualRoot()._internal.visualParent=this}},getChildren:{value:function(){return g.clone(this._internal.children)}},removeChild:{value:function(a){if(!a.getVisualRoot)throw new Error("child must be a visual node");var b=this._internal.children,c=b.indexOf(a);if(-1===c)throw new Error("child is not a child of this node");if(a.getVisualRoot()){var d=a.getVisualRoot()._internal.uiControl;d.parent&&d.parent.removeChild(d)}b.splice(c,1),this.flagOutputDirty("childCount");for(var e=c;e<b.length;e++)b[e].getVisualRoot().flagOutputDirty("childIndex");a._internal.visualParent=void 0,a.getVisualRoot()&&(a.getVisualRoot()._internal.visualParent=void 0)}},isChild:{value:function(a){return-1!==this._internal.children.indexOf(a)}},getChildRoot:{value:function(){return this}}}}),a.hasOrientation&&f.extend(b,{initialize:function(){this._internal.uiControl.setOrientation("vertical")},inputs:{orientation:{index:2500,group:"Layout",displayName:"Orientation",type:{name:"enum",enums:[{value:"horizontal",label:"Horizontal"},{value:"vertical",label:"Vertical"}]},default:"vertical",set:function(a){this._internal.uiControl.setOrientation(a)}}}}),b}var e=a("./visualbase"),f=a("../../nodedefinition"),g=a("lodash");b.exports={createDefinition:d}},{"../../nodedefinition":81,"./visualbase":157,lodash:12}],147:[function(a,b,c){"use strict";function d(a,b){var c=a.getLayoutRect().width;void 0===c&&(c=0);var d=.3*-c;b<=0?a.setPositionX(g.easeInOut(d,0,1+b)):a.setPositionX(g.easeInOut(0,c,b))}var e=a("./layoutbase"),f=a("../../nodedefinition"),g=a("../../easecurves"),h=e.createDefinition({name:"Page",createControl:function(a){return a.createDockLayoutControl()}});f.extend(h,{initialize:function(){this._internal.title="",this._internal.transition="default",this._internal.transitionPosition=0,this._internal.transitionDuration=350,this._internal.customTransitionDuration=350},dynamicports:[{name:"conditionalports/basic",condition:"transition = custom",ports:[{name:"customTransitionDuration",plug:"input",type:"number",displayName:"Transition Duration",group:"Page",default:350}]}],inputs:{title:{type:"string",displayName:"Title",group:"Page",set:function(a){this._internal.title=a,this._internal.pagesNode&&this._internal.pagesNode.flagOutputDirty("currentPageTitle")}},transition:{displayName:"Transition",group:"Page",default:"default",type:{name:"enum",enums:[{value:"none",label:"None"},{value:"default",label:"Default"},{value:"custom",label:"Custom"}]},set:function(a){this._internal.transition=a}},customTransitionDuration:{set:function(a){this._internal.customTransitionDuration=a}}},outputs:{transitionPosition:{index:0,type:"number",displayName:"Transition Position",group:"Page",getter:function(){return this._internal.transitionPosition}},pageShowing:{type:"signal",displayName:"Page Showing",group:"Page Signals"},pageHiding:{type:"signal",displayName:"Page Hiding",group:"Page Signals"},pageShown:{type:"signal",displayName:"Page Shown",group:"Page Signals"},pageHidden:{type:"signal",displayName:"Page Hidden",group:"Page Signals"}},prototypeExtensions:{setPagesNode:function(a){this._internal.pagesNode=a},setTransitionPosition:function(a){var b=this._internal;"default"===b.transition&&d(this,a),b.transitionPosition=a,this.flagOutputDirty("transitionPosition")},getAnimationDuration:function(){switch(this._internal.transition){case"none":return 0;case"default":case"ios":return 350;case"custom":return this._internal.customTransitionDuration}return 0},getAnimationPosition:function(){return this._internal.transitionPosition},sendPageShowingSignal:function(){this.sendSignalOnOutput("pageShowing")},sendPageHidingSignal:function(){this.sendSignalOnOutput("pageHiding")},sendPageShownSignal:function(){this.sendSignalOnOutput("pageShown")},sendPageHiddenSignal:function(){this.sendSignalOnOutput("pageHidden")},getTitle:function(){return this._internal.title}}}),b.exports=f.defineNode(h)},{"../../easecurves":67,"../../nodedefinition":81,"./layoutbase":146}],148:[function(a,b,c){"use strict";var d=a("./layoutbase"),e=a("../../nodedefinition"),f=a("../../guid"),g=a("../../easecurves"),h=a("lodash"),i=a("../../node"),j=d.createDefinition({name:"Pages",createControl:function(a){return a.createDockLayoutControl()}});e.extend(j,{initialize:function(){this._internal.pageStack=[],this._internal.isNavigating=!1,this._internal.portUpdateScheduled=!1},inputs:{startPage:{type:"component",displayName:"Start Page",group:"Navigation",set:function(a){if(this._cleanup(),a){var b=this._createPage(a);this.startPageComponent=b;var c=this._internal,d=this.context.getComponentModel(a);c.startPageComponentModel=d,this.updateStartPagePorts(d),d.on("inputPortAdded",this.scheduleUpdateStartPagePorts.bind(this,d),this),d.on("inputPortRemoved",this.scheduleUpdateStartPagePorts.bind(this,d),this),c.pageStack.push(b),this.addPageAtIndex(b,0),b.getVisualRoot().sendPageShowingSignal()}}},back:{displayName:"Back",group:"Navigation",valueChangedToTrue:function(){this.back()}}},outputs:{currentPageTitle:{type:"string",displayName:"Current Page Title",group:"Pages",getter:function(){var a=this._internal.pageStack;return 0===a.length?"":a[a.length-1].getVisualRoot().getTitle()}},prevPageTitle:{type:"string",displayName:"Previous Page Title",group:"Pages",getter:function(){var a=this._internal.pageStack;return a.length<2?"":a[a.length-2].getVisualRoot().getTitle()}},hasPreviousPage:{type:"boolean",displayName:"Has Previous Page",group:"Pages",getter:function(){return this._internal.pageStack.length>1}},navigatedForward:{type:"signal",displayName:"Navigated Forward",group:"Pages Signals"},navigatedBack:{type:"signal",displayName:"Navigated Back",group:"Pages Signals"}},prototypeExtensions:{_cleanup:function(){var a=this._internal;a.startPageComponentModel&&(a.startPageComponentModel.removeListenersWithRef(this),a.startPageComponentModel=void 0);var b=this;this.getChildren().forEach(function(a){b.removeChild(a),b.nodeScope.deleteNode(a)}),a.pageStack.forEach(function(a){a._onNodeDeleted()}),this.startPageComponent=void 0,a.pageStack=[]},_onNodeDeleted:function(){i.prototype._onNodeDeleted.call(this),this._cleanup()},addPageAtIndex:function(a,b){this.addChild(a,b),this.flagOutputDirty("currentPageTitle"),this.flagOutputDirty("prevPageTitle")},waitUntilNewPageLoaded:function(a,b){var c=this;this.context.uiEngine.renderer.setClipToViewport(!1);this._internal;this.context.uiEngine.setTouchEnabled(!1),this.context.scheduleNextFrame(function(){0===i.numberOfSignalsSentThisFrame&&0===i.numberOfQueuedSignalsThisFrame||a>=4?c.context.scheduleNextFrame(function(){c.context.uiEngine.setTouchEnabled(!0),b()}):c.waitUntilNewPageLoaded(a+1,b)})},navigateTo:function(a,b){if(!this._internal.isNavigating){var c=this._internal,d=c.pageStack,e=d[d.length-1],f=this._createPage(a,b),g=f.getVisualRoot();d.push(f),this.addPageAtIndex(f),this.context.layout(),g.setTransitionPosition(1),f.update();var h=this;this.waitUntilNewPageLoaded(0,function(){h._animationPageAnimationPositionTo(f,0),h._animationPageAnimationPositionTo(e,-1)}),d.length>1&&this.flagOutputDirty("hasPreviousPage"),this.sendSignalOnOutput("navigatedForward")}},resetTo:function(a,b){var c=this._internal,d=c.pageStack,e=this._createPage(a,b),f=e.getVisualRoot(),g=this;d.forEach(function(a){g.isChild(a)&&g.removeChild(a),g.nodeScope.deleteNode(a)}),d.length=0,d.push(e),this.addPageAtIndex(e),this.context.layout(),f.setTransitionPosition(0),e.update(),f.sendPageShownSignal(),this.flagOutputDirty("hasPreviousPage")},back:function(){var a=this._internal.pageStack;if(1!==a.length&&!this._internal.isNavigating){var b=a.pop();1===a.length&&this.flagOutputDirty("hasPreviousPage");var c=a[a.length-1];c.getVisualRoot()._internal.visualParent||this.addPageAtIndex(c,this._internal.children.indexOf(b)-1),this._animationPageAnimationPositionTo(c,0),this._animationPageAnimationPositionTo(b,1),this.sendSignalOnOutput("navigatedBack")}},_animationPageAnimationPositionTo:function(a,b){var c=a.getVisualRoot(),d=c.getAnimationPosition();if(d!==b){0===b?c.sendPageShowingSignal():c.sendPageHidingSignal(),this._internal.isNavigating=!0;var e=this;this.context.timerScheduler.createTimer({duration:c.getAnimationDuration(),onRunning:function(a){c.setTransitionPosition(g.linear(d,b,a))},onFinish:function(){e.context.uiEngine.renderer.setClipToViewport(!0),-1===b||1===b?(c.sendPageHiddenSignal(),e.isChild(a)&&e.removeChild(a),1===b&&e.context.scheduleNextFrame(function(){e.nodeScope.deleteNode(a)})):0===b&&c.sendPageShownSignal(),e._internal.isNavigating=!1}}).start()}},_createPage:function(a,b){var c=this.nodeScope.createNode(a,f());c.getVisualRoot().setPagesNode(this);for(var d in b)c.queueInput(d,b[d]);return c},registerInputIfNeeded:function(a){this.hasInput(a)||this.registerInput(a,{set:function(b){this.startPageComponent?this.startPageComponent.setInputValue(a,b):this.scheduleAfterInputsHaveUpdated(function(){this.startPageComponent.hasInput(a)&&this.startPageComponent.setInputValue(a,b)})}})},scheduleUpdateStartPagePorts:function(a){if(!this._internal.portUpdateScheduled){this._internal.portUpdateScheduled=!0;var b=this;this.context.scheduleAfterUpdate(function(){b.updateStartPagePorts(a),b._internal.portUpdateScheduled=!1})}},updateStartPagePorts:function(a){var b=h.values(a.getInputPorts()).map(function(a){return{name:a.name,plug:"input",type:a.type,group:"Start Page Inputs"}});this.context.editorConnection.sendDynamicPorts(this.id,b)}}}),b.exports=e.defineNode(j)},{"../../easecurves":67,"../../guid":73,"../../node":79,"../../nodedefinition":81,"./layoutbase":146,lodash:12}],149:[function(a,b,c){"use strict";var d=a("./renderable"),e=a("../../nodedefinition"),f="#f1f2f4",g=d.createDefinition({defaultSizeEnum:"explicit",defaultSizeUnit:"%",defaultWidth:100,defaultHeight:100,defaultColor:f,createControl:function(a){var b=a.createRectangleControl();return b.setColor(f),b}});e.extend(g,{name:"Rectangle",inputs:{cornerRadius:{index:3004,type:"number",displayName:"Corner Radius",group:"Appearance",default:0,set:function(a){this._internal.uiControl.setCornerRadius(a)}},blur:{index:3005,type:"number",displayName:"Blur Length",group:"Appearance",default:0,set:function(a){this._internal.uiControl.setBlur(a)}}}}),b.exports=e.defineNode(g)},{"../../nodedefinition":81,"./renderable":150}],150:[function(a,b,c){"use strict";function d(a){if(!a.defaultColor)throw new Error("No default color specified");var b=e.createDefinition(a),c=[{value:"alpha",label:"Alpha"},{value:"solid",label:"Solid"},{value:"additive",label:"Additive"},{value:"multiply",label:"Multiply"}];return f.extend(b,{inputs:{blendMode:{index:3003,type:{name:"enum",enums:c},default:"alpha",displayName:"Blend Mode",group:"Appearance",set:function(a){this._internal.uiControl.setBlendMode(a)}},color:{index:3002,type:"color",displayName:"Color",group:"Appearance",default:a.defaultColor,set:function(a){this._internal.uiControl.setColor(a)}}}}),b}var e=a("./visualbase"),f=a("../../nodedefinition");b.exports={createDefinition:d}},{"../../nodedefinition":81,"./visualbase":157}],151:[function(a,b,c){"use strict";function d(a,b,c){return Math.max(a,Math.min(b,c))}function e(a){var b=this.noodlNode,c=b._internal;if(!1===c.scrollEnabled||!1===c.uiControl.touchPropagation)return c.isTracking&&(c.isTracking=!1,b.sendSignalOnOutput("dragEnded")),void(c.hasReceivedEnter=!1);var d,e=c.uiControl.scroller,f=c.uiControl.scrollOffset;if(a.isEnter&&(c.hasReceivedEnter=!0),a.isExit)!0===c.isTracking?(b.sendSignalOnOutput("dragEnded"),c.isTracking=!1,b.context.scheduleAfterUpdate(function(){e.onTouch(f,a)})):e.onTouch(f,a),c.hasReceivedEnter=!1;else{if(!1===c.hasReceivedEnter){c.hasReceivedEnter=!0;var g={};for(var h in a)g[h]=a[h];g.type="isEnter",g.isEnter=!0,g.isDown=g.isUp=g.isMove=!1,c.uiControl.onTouch(g)}d=e.onTouch(f,a),"StartTracking"===d&&!1===c.isTracking&&(c.isTracking=!0,b.sendSignalOnOutput("dragStarted"))}return d}function f(a){var b=this._internal.children;if(b.length<=1)return 0;for(var c="horizontal"===this._internal.uiControl.orientation?"width":"height",d=0,e=this._internal.uiControl.getItemSpacing(),f=0,g=b.length;f<g;++f){var h=b[f].getVisualRoot().getLayoutRect(),i=h[c];if(Math.floor(d+i)>a)return f;d+=i+e}return console.error("Invalid position",a),b.length-1}function g(a){var b=this._internal.children;if(a<0||a>=b.length)return console.error("ScrollView: Invalid item index",index),0;for(var c="horizontal"===this._internal.uiControl.orientation?"width":"height",d=this._internal.uiControl.getItemSpacing(),e=0,f=0;f<a;f++)e+=b[f].getVisualRoot().getLayoutRect()[c]+d;return e}function h(a){return a=d(0,this._internal.children.length-1,a),g.call(this,a)}function i(a){var b=this._internal;a!==b.currentIndex&&(b.currentIndex=a,this.flagOutputDirty("index"),this.sendSignalOnOutput("indexChanged"))}function j(a,b){var c=this,d=Math.max(0,Math.min(a,this._internal.uiControl.getScrollObjectSize()-this._internal.uiControl.getScrollViewSize()));this.context.timerScheduler.createTimer({duration:b,startPosition:l.call(this),endPosition:-d,onRunning:function(a){c._internal.uiControl.setScrollOffset(q.easeOut(this.startPosition,this.endPosition,a))}}).start()}function k(a,b){return b}function l(){return this._internal.uiControl.scrollOffset}function m(a,b){var c=f.call(this,-l.call(this)),e=0;return e=a<0?c+1:c,e=d(0,this._internal.children.length-1,e),-h.call(this,e)}function n(a,b){var c="horizontal"===this._internal.uiControl.orientation?"width":"height",d=this._internal.children,e=this._internal.uiControl.getItemSpacing();if(1===d.length)return a<0?-d[0].getVisualRoot().getLayoutRect()[c]:0;for(var f=0,g=0,h=Number.MAX_VALUE,i=0;i<d.length-1;++i){var j=d[i].getVisualRoot().getLayoutRect()[c],k=f+j+e,m=Math.abs(f+b),n=Math.abs(k+b);if(m<h&&(h=m,f),n<h&&(h=n,k),n>m){var o=l.call(this);return a<0&&-f>o?-k:a>0&&-f<o?-g:-f}g=f,f+=j+e}return-f}var o=a("./layoutbase"),p=a("../../nodedefinition"),q=a("../../easecurves"),r=500,s=o.createDefinition({name:"Scroll View",createControl:function(a){return a.createScrollViewControl()},hasItemSpacing:!0});p.extend(s,{initialize:function(){var a=this._internal;a.scrollEnabled=!0,a.isTracking=!1,a.currentIndex=0,a.hasReceivedEnter=!1,a.scrollToPositionValue=0,a.scrollDuration=r,a.scrollToPositionDuration=r,a.scrollToIndexDuration=r,a.scrollToIndexValue=0,a.uiControl.scrollEndedPositionCallback=function(a,b){return b};var b=this;this._internal.uiControl.on("scrollOffsetChanged",function(a){b.flagOutputDirty("scrollPosition");var c=f.call(b,-a);if(c<b._internal.children.length){var d=b._internal.children[c].getVisualRoot().getLayoutRect(),e="horizontal"===b._internal.uiControl.orientation?"width":"height",g=-a+.5*d[e];i.call(b,f.call(b,g))}}),this.addTouchHandler(e,b)},inputs:{itemSpacing:{index:2400,group:"Layout",displayName:"Item Spacing",type:"number",default:0,set:function(a){this._internal.uiControl.setItemSpacing(Number(a))}},clip:{index:3100,type:"boolean",group:"Appearance",displayName:"Clip",default:!1,set:function(a){this._internal.uiControl.setClip(!!a)}},scrollDuration:{index:2500,type:"number",displayName:"Scroll Duration",group:"Scroll Behavior",default:r,set:function(a){this._internal.uiControl.setScrollDuration(Number(a))}},snap:{index:2501,type:{name:"enum",enums:[{value:"disabled",label:"Disabled"},{value:"item",label:"Item"},{value:"everyItem",label:"Every Item"}]},displayName:"Snap",group:"Scroll Behavior",default:"disabled",set:function(a){"disabled"===a?this._internal.uiControl.scrollEndedPositionCallback=k.bind(this):"everyItem"===a?this._internal.uiControl.scrollEndedPositionCallback=m.bind(this):"item"===a?this._internal.uiControl.scrollEndedPositionCallback=n.bind(this):console.error("Unknown snap value: "+a)}},scrollAxis:{index:2502,type:{name:"enum",enums:[{value:"0",label:"Horizontal"},{value:"1",label:"Vertical"}]},displayName:"Scroll Direction",group:"Scroll Behavior",default:"1",set:function(a){this._internal.uiControl.setOrientation(Number(a)?"vertical":"horizontal")}},scrollStartPosition:{index:2503,type:"number",displayName:"Start Position",group:"Scroll Behavior",default:0,set:function(a){this._internal.uiControl.setScrollOffset(Number(a))}},scrollEnabled:{index:2504,type:"boolean",displayName:"Scroll Enabled",group:"Scroll Behavior",default:!0,set:function(a){this._internal.scrollEnabled=!!a}},overscrollEnabled:{index:2505,type:"boolean",displayName:"Overscroll Enabled",group:"Scroll Behavior",default:!0,set:function(a){var b=!!a;this._internal.uiControl.setOverscrollEnabled(b)}},scrollThreshold:{index:2506,type:"number",displayName:"Scroll Threshold",group:"Scroll Behavior",default:50,set:function(a){this._internal.uiControl.setScrollThreshold(0|a)}},"scrollToPosition.value":{index:6e3,type:"number",displayName:"Position",editorName:"Position|Scroll To Position",group:"Scroll To Position",default:0,set:function(a){this._internal.scrollToPositionValue=a}},"scrollToPosition.do":{index:6001,group:"Scroll To Position",editorName:"Do|Scroll To Position",displayName:"Do",valueChangedToTrue:function(){this.scheduleAfterInputsHaveUpdated(function(){j.call(this,this._internal.scrollToPositionValue,this._internal.scrollToPositionDuration)})}},"scrollToPosition.duration":{index:6002,group:"Scroll To Position",displayName:"Duration",editorName:"Duration|Scroll To Position",type:"number",default:r,set:function(a){this._internal.scrollToPositionDuration=a}},"scrollToIndex.value":{index:6003,group:"Scroll To Index",editorName:"Index|Scroll To Index",displayName:"Index",type:"number",default:0,set:function(a){this._internal.scrollToIndexValue=Math.floor(a)}},"scrollToIndex.do":{index:6004,group:"Scroll To Index",editorName:"Do|Scroll To Index",displayName:"Do",valueChangedToTrue:function(){var a=this;this.scheduleAfterInputsHaveUpdated(function(){if(a._internal.children.length>0){var b=h.call(this,this._internal.scrollToIndexValue);j.call(this,b,this._internal.scrollToIndexDuration)}})}},"scrollToIndex.duration":{index:6005,type:"number",group:"Scroll To Index",displayName:"Duration",editorName:"Duration|Scroll To Index",default:r,set:function(a){this._internal.scrollToIndexDuration=a}}},outputs:{dragStarted:{type:"signal",displayName:"Drag Started",group:"Signals"},dragEnded:{type:"signal",displayName:"Drag Ended",group:"Signals"},indexChanged:{displayName:"Index Changed",group:"Signals",type:"signal"},scrollPosition:{displayName:"Scroll Position",type:"number",getter:function(){return this._internal.uiControl.scrollOffset}},index:{displayName:"Scroll Index",type:"number",getter:function(){return this._internal.currentIndex}},childCount:{displayName:"Child Count",type:"number",getter:function(){return this._internal.children.length}}}}),b.exports=p.defineNode(s)},{"../../easecurves":67,"../../nodedefinition":81,"./layoutbase":146}],152:[function(a,b,c){"use strict";var d=a("./layoutbase"),e=a("../../nodedefinition"),f=d.createDefinition({name:"Stack Layout",hasOrientation:!0,hasItemSpacing:!0,createControl:function(a){return a.createStackLayoutControl()}});e.extend(f,{inputs:{itemSpacing:{index:2501,group:"Layout",displayName:"Item Spacing",type:"number",default:0,set:function(a){this._internal.uiControl.setItemSpacing(Number(a))}}}}),b.exports=e.defineNode(f)},{"../../nodedefinition":81,"./layoutbase":146}],153:[function(a,b,c){"use strict";var d=a("./renderable"),e=a("../../nodedefinition"),f=a("../../fontloader"),g="Text",h=d.createDefinition({createControl:function(a){var b=a.createTextControl();return b.setColor("#ffffff"),b.setFontFamily("Helvetica"),b.setFontSize(40),b.setText(g),b},defaultColor:"#ffffff",sizeEnums:[{value:"explicit",label:"Explicit"},{value:"childWidth",label:"Content Width"},{value:"childHeight",label:"Content Height"},{value:"childSize",label:"Content Size"}],defaultSizeEnum:"childSize",widthCondition:"sizeMode = explicit OR sizeMode = childHeight",heightCondition:"sizeMode = explicit OR sizeMode = childWidth",defaultSizeUnit:"%",defaultWidth:100,defaultHeight:100});e.extend(h,{name:"Text",version:2,usePortAsLabel:"text",inputs:{text:{index:2500,group:"Text",displayName:"Text",type:{name:"string",multiline:!0},default:g,set:function(a){this._internal.uiControl.setText(a)}},fontFamily:{index:2501,type:"font",group:"Text",displayName:"Font Family",default:"Helvetica",set:function(a){var b=a.replace(/\.[^\/.]+$/,"");b=b.split("/").pop();var c=this._internal;f.instance.callWhenFontIsActive(b,function(){c.uiControl.setFontFamily(b)})}},fontSize:{index:2502,type:"number",group:"Text",displayName:"Font Size",default:40,set:function(a){this._internal.uiControl.setFontSize(a)}},lineHeight:{index:2503,type:"number",displayName:"Line Height",group:"Text",default:0,set:function(a){this._internal.uiControl.setLineHeight(a)}},alignment:{index:2504,type:{name:"enum",enums:[{value:"left",label:"Left"},{value:"center",label:"Center"},{value:"right",label:"Right"}],allowEditOnly:!0},displayName:"Horizontal",group:"Text Alignment",default:"left",set:function(a){this._internal.uiControl.setHorizontalAlignment(a)}},verticalAlignment:{index:2505,type:{name:"enum",enums:[{value:"top",label:"Top"},{value:"center",label:"Center"},{value:"bottom",label:"Bottom"}],allowEditOnly:!0},displayName:"Vertical",group:"Text Alignment",default:"top",set:function(a){this._internal.uiControl.setVerticalAlignment(a)}},clipText:{index:2999,type:"boolean",displayName:"Clip Text",default:!0,group:"Appearance",set:function(a){this._internal.uiControl.setClip(!!a)}}}}),b.exports={node:h,setup:function(a,b){b.on("nodeAdded.Text",function(a){a.parameters.fontFamily&&f.instance.loadFont(a.parameters.fontFamily),a.on("parameterUpdated",function(a){"fontFamily"===a.name&&f.instance.loadFont(a.value)})})}}},{"../../fontloader":72,"../../nodedefinition":81,"./renderable":150}],154:[function(a,b,c){"use strict";function d(a){var b=this.noodlNode;if(a.isUp)return b._internal.uiControl.focus(),"StopPropagation"}var e=a("./renderable"),f=a("../../nodedefinition"),g=a("../../fontloader"),h="Text",i=e.createDefinition({controlAttribute:"innerTextControl",createControl:function(a){var b=a.createTextInputControl();return b.setColor("#ffffff"),b.setFontFamily("Helvetica"),b.setFontSize(40),b.setText(h),b},defaultColor:"#ffffff",defaultSizeUnit:"%",defaultWidth:100,defaultHeight:100});f.extend(i,{name:"Text Input",initialize:function(){this.addTouchHandler(d),this._internal.confirmBlurs=!1;var a=this;this._internal.uiControl.on("confirmed",function(){a.sendSignalOnOutput("confirmed"),a._internal.confirmBlurs&&a._internal.uiControl.blur()}),this._internal.uiControl.on("textChanged",function(){a.flagOutputDirty("text")},this),this._internal.uiControl.on("focused",function(){a.flagOutputDirty("focused"),a.flagOutputDirty("blurred")},this),this._internal.uiControl.on("blurred",function(){a.flagOutputDirty("focused"),a.flagOutputDirty("blurred")},this)},inputs:{text:{index:2500,group:"Text",displayName:"Text",type:{name:"string",multiline:!0},default:h,set:function(a){this._internal.uiControl.getText()!==a&&this._internal.uiControl.setText(a)}},fontFamily:{index:2501,type:"font",group:"Text",displayName:"Font Family",default:"Helvetica",set:function(a){var b=a.replace(/\.[^\/.]+$/,"");b=b.split("/").pop();var c=this._internal;g.instance.callWhenFontIsActive(b,function(){c.uiControl.setFontFamily(b)})}},fontSize:{index:2502,type:"number",group:"Text",displayName:"Font Size",default:40,set:function(a){this._internal.uiControl.setFontSize(a)}},clear:{index:2600,group:"Actions",displayName:"Clear",valueChangedToTrue:function(){this._internal.uiControl.setText("")}},focus:{index:2601,group:"Actions",displayName:"Focus",valueChangedToTrue:function(){this._internal.uiControl.focus()}},blur:{index:2602,group:"Actions",displayName:"Blur",valueChangedToTrue:function(){this._internal.uiControl.blur()}},confirmBlurs:{index:2603,type:"boolean",displayName:"Blur On Confirm",default:!1,group:"Actions",set:function(a){this._internal.confirmBlurs=a}},type:{index:3001,group:"Appearance",displayName:"Type",default:"text",type:{name:"enum",enums:[{value:"text",label:"Text"},{value:"textarea",label:"Text Area"},{value:"password",label:"Password"},{value:"email",label:"Email"},{value:"tel",label:"Tel"},{value:"number",label:"Number"}]},set:function(a){this._internal.uiControl.setInputType(a)}},color:{index:3002,type:"color",displayName:"Color",group:"Appearance",default:"#ffffff",set:function(a){this._internal.uiControl.setColor(a)}}},outputs:{text:{index:2500,group:"Text",displayName:"Text",type:"string",getter:function(){return this._internal.uiControl.getText()}},focused:{index:2501,group:"State",displayName:"Focused",type:"boolean",getter:function(){return this._internal.uiControl.isFocused()}},blurred:{index:2502,group:"State",displayName:"Blurred",type:"boolean",getter:function(){return!this._internal.uiControl.isFocused()}},confirmed:{index:2503,group:"State",displayName:"Confirmed",type:"signal"}},prototypeExtensions:{setText:function(a){this._internal.uiControl.setText(a)}}}),b.exports={node:i,setup:function(a,b){b.on("nodeAdded.Text Input",function(a){a.parameters.fontFamily&&g.instance.loadFont(a.parameters.fontFamily),a.on("parameterUpdated",function(a,b){"fontFamily"===a&&g.instance.loadFont(b)})})}}},{"../../fontloader":72,"../../nodedefinition":81,"./renderable":150}],155:[function(a,b,c){"use strict";function d(a,b){this.control=a,this.uniformValues={},this.uniformTypes={},this.ports=[],this.numPasses=1,this.isSecondaryPass=b,this.uniformPrefix=b?d.SecondPassUniformPrefix:d.UniformPrefix}var e=a("../../../uiengine/controls/effectcontrol");d.UniformPrefix="shader-",d.SecondPassUniformPrefix="second-pass-shader-",d.prototype.isVectorType=function(a){return"vec4"===a||"vec3"===a||"vec2"===a},d.prototype.createValueOfType=function(a){return"float"===a?0:"vec2"===a?[0,0]:"vec3"===a?[0,0,0]:"vec4"===a?[0,0,0,0]:"sampler2D"===a?{image:null,imagePath:null}:null},d.prototype.setShader=function(a,b){this.controlId=b;var c=[],d={},e="Shader Variables",f=this.uniformPrefix;this.isSecondaryPass&&(e="Second Pass "+e),(a?a.uniforms:[]).forEach(function(a){"float"===a.type?(d[a.name]=a.type,c.push({group:e,plug:"input",displayName:a.name,name:f+a.name,type:"number",default:0})):"sampler2D"===a.type?(d[a.name]=a.type,c.push({group:e,plug:"input",displayName:a.name,name:f+a.name,type:"image"})):"vec2"!==a.type&&"vec3"!==a.type&&"vec4"!==a.type||(d[a.name]=a.type,c.push({group:e,plug:"input",displayName:a.name+"X",name:f+a.name+"X",type:"number",default:0}),c.push({group:e,plug:"input",displayName:a.name+"Y",name:f+a.name+"Y",type:"number",default:0}),"vec3"!==a.type&&"vec4"!==a.type||c.push({group:e,plug:"input",displayName:a.name+"Z",name:f+a.name+"Z",type:"number",default:0}),"vec4"===a.type&&c.push({group:e,plug:"input",displayName:a.name+"W",name:f+a.name+"W",type:"number",default:0}))}),this.uniformTypes=d,this.ports=c,this.shader=a},d.prototype.setUniform=function(a,b){a=a.replace(this.uniformPrefix,"");var c=a.substring(0,a.length-1);if(this.isVectorType(this.uniformTypes[c])){c in this.uniformValues||(this.uniformValues[c]=this.createValueOfType(this.uniformTypes[c]));var d=this.uniformValues[c],f=a[a.length-1];"X"===f?d[0]=b||0:"Y"===f?d[1]=b||0:"Z"===f?d[2]=b||0:"W"===f&&(d[3]=b||0),this.uniformValues[c]=d,this.control.setUniform(c,d,this.uniformTypes[a],this.isSecondaryPass)}else if("sampler2D"===this.uniformTypes[a]){a in this.uniformValues||(this.uniformValues[a]={image:null,imagePath:null});var g=this.uniformValues[a];if(g.imagePath===b)return;g.imagePath=b,g.image=null;var h=this.control,i=this;if(b&&0===b.search(e.ImageOutputPrefix)){var j=b.split(e.ImageOutputPrefix)[1].split(":"),k=j[0];h.setUniform(a,k,i.isSecondaryPass)}else this.control.imageCache.getImage(b,function(b){b._path===g.imagePath&&(g.image=b,h.setUniform(a,g,i.isSecondaryPass))})}else this.control.setUniform(a,b||0,this.uniformTypes[a],this.isSecondaryPass);return!1},b.exports=d},{"../../../uiengine/controls/effectcontrol":171}],156:[function(a,b,c){"use strict";var d=(a("./renderable"),a("../../nodedefinition")),e=a("./visualbase"),f=a("../../nodes/visual/htmlcontent"),g=(a("events").EventEmitter,e.createDefinition({sizeEnums:[{value:"explicit",label:"Explicit"},{value:"childWidth",label:"Content Width"},{value:"childHeight",label:"Content Height"},{value:"childSize",label:"Content Size"}],defaultSizeEnum:"explicit",defaultSizeUnit:"%",defaultWidth:100,defaultHeight:100,createControl:function(a){return a.createHtmlControl()}})),h=Object.assign({},f.definition);delete h.dynamicports;var g=d.extend(g,h);d.extend(g,{name:"Video",category:"Visual",initialize:function(){var a=this;f.node.initialize.bind(this)();var b=this._internal;b.videoPath="",b.paused=!1,b.autoplay=!1,b.loop=!1,b.poster=void 0,b.seekTime=0,b.fillMode="contain",b.preload=!1,b.hasSignaledLoaded=!1;this.context;this._internal.addedToParentCallback=function(c){b.uiControl.domNode.element.style.overflow="hidden";var d="width: 100%; height: 100%; object-fit: "+b.fillMode+";",e='<video style="'+d+'" playsinline';b.autoplay&&(e+=" autoplay"),b.preload?e+=' preload="auto"':e+=' preload="metadata"',b.loop&&(e+=" loop"),b.poster&&(e+=' poster="'+b.poster+'"'),b.muted&&(e+=" muted"),""!==b.videoPath&&(e+=' src="'+b.videoPath+'"'),e+="></video>",b.content=e,a.restartPlayback()};var c=this;b.onMetadataLoaded=function(){var a=b.uiControl.domNode;if(a&&a.element){var d=a.element.firstChild;c._internal.uiControl.setMediaSize(d.videoWidth,d.videoHeight)}},b.onTimeUpdate=function(){c.flagOutputDirty("currentTime")},b.onDurationChange=function(){c.flagOutputDirty("duration")},b.onCanPlayThrough=function(){b.hasSignaledLoaded||(c.sendSignalOnOutput("gotLoaded"),b.hasSignaledLoaded=!0)},b.onPlay=function(){c.sendSignalOnOutput("startedPlaying")},b.onPause=function(){c.restartPlayback()},b.onCanPlay=function(){c.restartPlayback()},this._internal.initialHTMLSetCallback=function(){var a=c.getVideoNode();a.removeEventListener("timeupdate",b.onTimeUpdate),a.removeEventListener("durationchange",b.onDurationChange),a.removeEventListener("loadedmetadata",b.onMetadataLoaded),a.removeEventListener("canplaythrough",b.onCanPlayThrough),
a.removeEventListener("play",b.onPlay),a.removeEventListener("canplay",b.onCanPlay),a.removeEventListener("pause",b.onPause),a.addEventListener("timeupdate",b.onTimeUpdate),a.addEventListener("durationchange",b.onDurationChange),a.addEventListener("loadedmetadata",b.onMetadataLoaded),a.addEventListener("canplaythrough",b.onCanPlayThrough),a.addEventListener("play",b.onPlay),a.addEventListener("pause",b.onPause),a.addEventListener("canplay",b.onCanPlay)}},inputs:{videoPath:{type:{name:"string"},displayName:"Video Path",group:"Video Properties",set:function(a){if(this._internal.addedToDOM){this.getVideoNode().src=a}this._internal.hasSignaledLoaded=!1,this._internal.videoPath=a}},posterPath:{type:{name:"string"},displayName:"Poster path",group:"Video Properties",set:function(a){if(this._internal.addedToDOM){this.getVideoNode().poster=a}this._internal.poster=a}},fillMode:{type:{name:"enum",enums:[{value:"cover",label:"Aspect Fill"},{value:"contain",label:"Aspect Fit"},{value:"fill",label:"Fill"}],allowEditOnly:!0},displayName:"Fill Mode",group:"Video Properties",default:"contain",set:function(a){var b=this.getVideoNode();b&&(b.style.objectFit=a),this._internal.fillMode=a}},preload:{type:{name:"boolean"},displayName:"Preload",group:"Video Properties",set:function(a){var b=this.getVideoNode();b&&(b.preload=a?"auto":"metadata"),this._internal.preload=a}},loop:{type:{name:"boolean"},displayName:"Loop",group:"Video Properties",set:function(a){var b=this.getVideoNode();b&&(b.loop=a),this._internal.loop=a}},muted:{type:{name:"boolean"},displayName:"Muted",group:"Video Properties",set:function(a){var b=this.getVideoNode();b&&(b.muted=a),this._internal.muted=a}},autoplay:{type:{name:"boolean"},displayName:"Autoplay",group:"Video Properties",description:"On iOS the video needs to be muted for autoplay to work.",set:function(a){var b=this.getVideoNode();b&&(b.autoplay=a,a&&b.play().catch(function(a){})),this._internal.autoplay=a}},"seekToTime.time":{type:{name:"number"},displayName:"Seek Time",group:"Seek to time",set:function(a){this._internal.seekTime=a}},"seekToTime.do":{type:{name:"signal"},displayName:"Do",editorName:"Do | Seek to time",group:"Seek to time",valueChangedToTrue:function(){var a=this.getVideoNode();a&&(a.currentTime=this._internal.seekTime)}},pause:{displayName:"Pause",group:"Actions",valueChangedToTrue:function(){var a=this.getVideoNode();a&&a.pause(),this._internal.paused=!0,this._internal.startPlaying=!1}},play:{displayName:"Play",group:"Actions",valueChangedToTrue:function(){var a=this.getVideoNode();this._internal.paused=!1,a?a.play().catch(function(a){}):this._internal.startPlaying=!0}}},outputs:{duration:{type:{name:"number"},displayName:"Duration",group:"Video Properties",getter:function(){var a=this.getVideoNode();return a?isNaN(a.duration)?void 0:a.duration:void 0}},currentTime:{type:{name:"number"},displayName:"Current Time",group:"Video Properties",getter:function(){var a=this.getVideoNode();return a?a.currentTime:0}},paused:{type:{name:"boolean"},displayName:"Paused",group:"Video Properties",getter:function(){var a=this.getVideoNode();return!a||a.paused()}},startedPlaying:{type:"signal",displayName:"Started playing",group:"Video Properties"},gotLoaded:{type:"signal",displayName:"Got loaded",group:"Video Properties"}},prototypeExtensions:{restartPlayback:function(){var a=this._internal,b=this;a.autoplay&&!a.paused&&this.context.scheduleNextFrame(function(){var a=b.getVideoNode();a&&a.play().catch(function(a){})})},_onNodeDeleted:function(){f.definition.prototypeExtensions._onNodeDeleted.call(this);var a=this.getVideoNode();a&&(a.removeEventListener("canplaythrough",this._internal.onCanPlayThrough),a.removeEventListener("timeupdate",this._internal.onTimeUpdate),a.removeEventListener("durationchange",this._internal.onDurationChange),a.removeEventListener("loadedmetadata",this._internal.onMetadataLoaded),a.removeEventListener("play",this._internal.onPlay),a.removeEventListener("oncanplay",this._internal.onCanPlay),a.removeEventListener("pause",this._internal.onPause))},initFillMode:function(){},shouldUpdateHTML:function(){return this._internal.uiControl.isAttached()&&!this._internal.addedToDOM},getVideoNode:function(){return this._internal.addedToDOM?this._internal.uiControl.domNode.element.firstChild:null}}}),delete g.inputs.html,delete g.inputs.elementType,delete g.inputs.usesDynamicContent,delete g.outputs.isAddedToDOM,delete g.outputs.domElement,b.exports=d.defineNode(g)},{"../../nodedefinition":81,"../../nodes/visual/htmlcontent":144,"./renderable":150,"./visualbase":157,events:7}],157:[function(a,b,c){"use strict";function d(a){if(a=a||{},!a.createControl)throw new Error("createControl can't be undefined");a.sizeEnums=a.sizeEnums||[],a.defaultSizeEnum=a.defaultSizeEnum||"",a.defaultSizeUnit=a.defaultSizeUnit||"px",a.defaultPivotUnit=a.defaultPivotUnit||"%",a.defaultWidth=a.hasOwnProperty("defaultWidth")?a.defaultWidth:0,a.defaultHeight=a.hasOwnProperty("defaultHeight")?a.defaultHeight:0,a.widthCondition=a.widthCondition||"sizeMode = explicit OR sizeMode = childHeight OR sizeMode NOT SET",a.heightCondition=a.heightCondition||"sizeMode = explicit OR sizeMode = childWidth OR sizeMode NOT SET";var b={category:"Visual",initialize:function(){var b=this._internal,c=a.createControl.call(this,this.context.uiEngine);c.onTouch=g,c.onHover=h,c.noodlNode=this,b.uiControl=c,b.touchHandlers=[],b.hoverHandlers=[],b.visualParent=void 0,c.setSizeMode(a.defaultSizeEnum),c.setWidth(a.defaultWidth),c.setHeight(a.defaultHeight),c.setWidthUnit(a.defaultSizeUnit),c.setHeightUnit(a.defaultSizeUnit),c.setPivotXUnit(a.defaultPivotUnit),c.setPivotYUnit(a.defaultPivotUnit),this._internal.tapHandler=this.context.uiEngine.createTapHandler(e),this.addTouchHandler(j,this),this.addHoverHandler(k,this);var d=this;c.on("screenXChanged",function(){d.flagOutputDirty("screenX")}),c.on("screenYChanged",function(){d.flagOutputDirty("screenY")}),c.on("layoutWidthChanged",function(){d.flagOutputDirty("width")}),c.on("layoutHeightChanged",function(){d.flagOutputDirty("height")})},inputs:{x:{type:{name:"number"},group:"Placement",index:2002,displayName:"Position X",default:0,set:function(a){this.setPositionX(Number(a))}},y:{type:{name:"number"},index:2003,group:"Placement",displayName:"Position Y",default:0,set:function(a){this.setPositionY(Number(a))}},z:{type:{name:"number"},index:2004,group:"Placement",displayName:"Position Z",default:0,set:function(a){this._internal.uiControl.setPositionZ(Number(a))}},alignX:{index:2e3,type:{name:"enum",enums:[{value:"left",label:"Left"},{value:"center",label:"Center"},{value:"right",label:"Right"}]},group:"Placement",displayName:"Align X",default:"left",set:function(a){this._internal.uiControl.setAlignX(a)}},alignY:{index:2001,type:{name:"enum",enums:[{value:"top",label:"Top"},{value:"center",label:"Center"},{value:"bottom",label:"Bottom"}]},group:"Placement",displayName:"Align Y",default:"top",set:function(a){this._internal.uiControl.setAlignY(a)}},width:{index:1001,type:{name:"number",units:["%","px"],defaultUnit:a.defaultSizeUnit},displayName:"Width",group:"Dimensions",default:a.defaultWidth,set:function(a,b){void 0!==a&&this._internal.uiControl.setWidth(Number(a)),b&&this._internal.uiControl.setWidthUnit(b)}},height:{index:1002,type:{name:"number",units:["%","px"],defaultUnit:a.defaultSizeUnit},displayName:"Height",group:"Dimensions",default:a.defaultHeight,set:function(a,b){void 0!==a&&this._internal.uiControl.setHeight(Number(a)),b&&this._internal.uiControl.setHeightUnit(b)}},opacity:{index:3e3,group:"Appearance",displayName:"Opacity",type:"number",default:1,set:function(a){this._internal.uiControl.setOpacity(Number(a))}},visible:{type:{name:"boolean"},index:3001,displayName:"Visible",group:"Appearance",default:!0,set:function(a){this._internal.uiControl.setVisible(!!a)}},scaleX:{index:5e3,type:"number",group:"Transform",displayName:"Scale X",default:1,set:function(a){this._internal.uiControl.setScaleX(Number(a))}},scaleY:{index:5001,type:"number",group:"Transform",displayName:"Scale Y",default:1,set:function(a){this._internal.uiControl.setScaleY(Number(a))}},rotationX:{index:5002,type:"number",group:"Transform",displayName:"Rotation X",default:0,set:function(a){this._internal.uiControl.setRotationX(Math.PI/180*Number(a))}},rotationY:{index:5003,type:"number",group:"Transform",displayName:"Rotation Y",default:0,set:function(a){this._internal.uiControl.setRotationY(Math.PI/180*Number(a))}},rotationZ:{index:5004,type:"number",group:"Transform",displayName:"Rotation Z",default:0,set:function(a){this._internal.uiControl.setRotationZ(Math.PI/180*Number(a))}},pivotX:{index:5005,type:{name:"number",units:["%","px"],defaultUnit:a.defaultPivotUnit},default:50,group:"Transform",displayName:"Pivot X",set:function(a,b){b&&this._internal.uiControl.setPivotXUnit(b),this._internal.uiControl.setPivotX(Number(a))}},pivotY:{index:5006,type:{name:"number",units:["%","px"],defaultUnit:a.defaultPivotUnit},default:50,group:"Transform",displayName:"Pivot Y",set:function(a,b){b&&this._internal.uiControl.setPivotYUnit(b),this._internal.uiControl.setPivotY(Number(a))}},pivotZ:{index:5007,type:"number",group:"Transform",displayName:"Pivot Z",default:0,set:function(a){this._internal.uiControl.setPivotZ(Number(a))}},touchPropagation:{index:4e3,type:{name:"boolean"},displayName:"Ignore Touch",default:!1,set:function(a){this._internal.uiControl.setTouchPropagation(!a)}},blockTouch:{index:4001,type:{name:"boolean"},displayName:"Block Touch",default:!1,set:function(a){this._internal.uiControl.setBlockTouch(!!a)}},depth:{index:4002,type:{name:"number"},displayName:"Depth",set:function(a){!0===a?a=1:!1===a&&(a=0),this._internal.uiControl.setDepth(Number(a))}}},outputs:{this:{type:"reference",displayName:"This",getter:function(){return this}},childIndex:{type:"number",displayName:"Child Index",getter:function(){var a=this._internal.uiControl.parent;return a?a.children.indexOf(this._internal.uiControl):-1}},width:{displayName:"Width",group:"Dimensions",type:"number",getter:function(){return this._internal.uiControl.layoutRect.width}},height:{displayName:"Height",group:"Dimensions",type:"number",getter:function(){return this._internal.uiControl.layoutRect.height}},x:{displayName:"Position X",group:"Placement",type:"number",getter:function(){return this._internal.uiControl.positionX}},y:{displayName:"Position Y",group:"Placement",type:"number",getter:function(){return this._internal.uiControl.positionY}},screenX:{displayName:"Screen Position X",group:"Placement",type:"number",getter:function(){return this._internal.uiControl.getScreenX()}},screenY:{displayName:"Screen Position Y",group:"Placement",type:"number",getter:function(){return this._internal.uiControl.getScreenY()}}},prototypeExtensions:{addTouchHandler:function(a,b){this._internal.touchHandlers.push({callback:a,id:b})},removeTouchHandlersWithId:function(a){n.remove(this._internal.touchHandlers,function(b){return b.id===a})},addHoverHandler:function(a,b){this._internal.hoverHandlers.push({callback:a,id:b})},removeHoverHandler:function(a){n.remove(this._internal.hoverHandlers,function(b){return b.id===a})},getVisualRoot:function(){return this},_onNodeDeleted:function(){m.prototype._onNodeDeleted.call(this),this._internal.uiControl.removeListenersWithRef(this),this._internal.uiControl.dispose()},setPositionX:function(a){this._internal.uiControl.setPositionX(a),this.flagOutputDirty("x")},setPositionY:function(a){this._internal.uiControl.setPositionY(a),this.flagOutputDirty("y")},getLayoutRect:function(){return this._internal.uiControl.layoutRect},setHighlightEnabled:function(a){this._internal.uiControl.setHighlightEnabled(a)}}};return a.sizeEnums.length>0&&f(b,a),i(b),b}function e(a){a.noodlNode.sendSignalOnOutput("touch.tap")}function f(a,b){var c={index:1001,name:"width",plug:"input",type:{name:"number",units:["%","px"],defaultUnit:b.defaultSizeUnit},displayName:"Width",group:"Dimensions",default:b.defaultWidth},d={index:1002,name:"height",plug:"input",type:{name:"number",units:["%","px"],defaultUnit:b.defaultSizeUnit},displayName:"Height",group:"Dimensions",default:b.defaultHeight},e={name:"conditionalports/basic",condition:b.widthCondition,ports:[c]},f={name:"conditionalports/basic",condition:b.heightCondition,ports:[d]};l(a,{dynamicports:[e,f],inputs:{sizeMode:{index:1e3,type:{name:"enum",enums:b.sizeEnums,allowEditOnly:!0},group:"Dimensions",displayName:"Size Mode",default:b.defaultSizeEnum,set:function(a){this._internal.uiControl.setSizeMode(a)}}}})}function g(a){var b=void 0,c=this.noodlNode,d=this;return c._internal.touchHandlers.forEach(function(c){var e=c.callback.call(d,a);void 0!==e&&("StartTracking"===e?b=e:"StopPropagation"===e&&"StartTracking"!==b&&(b=e))}),c.context.scheduleFrame(),b}function h(a){var b=void 0,c=this.noodlNode,d=this;return c._internal.hoverHandlers.forEach(function(c){var e=c.callback.call(d,a);void 0!==e&&"StopPropagation"===e&&(b=e)}),c.context.scheduleFrame(),b}function i(a){l(a,{initialize:function(){this._internal.hasSignaledMove=!1,this.context.nodeIsDirty(this)},outputs:{"touch.tap":{group:"Touch",displayName:"Tap",type:"signal"},"touch.press":{type:"signal",group:"Touch",displayName:"Press"},"touch.release":{type:"signal",group:"Touch",displayName:"Release"},"touch.enter":{type:"signal",group:"Touch",displayName:"Enter"},"touch.exit":{type:"signal",group:"Touch",displayName:"Exit"},"touch.move":{type:"signal",group:"Touch",displayName:"Move"},"hover.enter":{type:"signal",group:"Hover",displayName:"Hover Enter"},"hover.move":{type:"signal",group:"Hover",displayName:"Hover Move"},"hover.exit":{type:"signal",group:"Hover",displayName:"Hover Exit"}}})}function j(a){var b=this.noodlNode;if(a.isDown&&(b.sendSignalOnOutput("touch.press"),b._internal.hasSignaledMove=!1),a.isMove?!1===b._internal.hasSignaledMove&&(b._internal.hasSignaledMove=!0,b.sendSignalOnOutput("touch.move")):a.isUp?b.sendSignalOnOutput("touch.release"):a.isEnter?b.sendSignalOnOutput("touch.enter"):a.isExit&&b.sendSignalOnOutput("touch.exit"),b.getOutput("touch.tap").hasConnections())return b._internal.tapHandler.onTouch(this,a)}function k(a){var b=this.noodlNode;a.isHoverEnter&&b.sendSignalOnOutput("hover.enter"),a.isHoverMove?b.sendSignalOnOutput("hover.move"):a.isHoverExit&&b.sendSignalOnOutput("hover.exit")}var l=a("../../nodedefinition").extend,m=a("../../node"),n=a("lodash");b.exports={createDefinition:d}},{"../../node":79,"../../nodedefinition":81,lodash:12}],158:[function(a,b,c){"use strict";function d(a){function b(){j[a]&&(console.log("websocket disconnected",a),delete j[a])}if(!j[a]){var c=new WebSocket(a);c.addEventListener("close",b),c.addEventListener("error",b),j[a]=c}return j[a]}function e(a){function b(){e.reconnectTimer||(e.reconnectTimer=window.setTimeout(e.connect.bind(e,e.uri),1e3))}function c(){console.log("websocket connected",e.socket.url),e.eventEmitter.emit("connected"),e.context.eventEmitter.once("applicationDataReloaded",function(){e._close(),e.eventEmitter.removeAllListeners()}),e.socket.addEventListener("message",e._onMessage)}function d(a){var b=JSON.parse(a.data);e.eventEmitter.emit("jsonMessage",b)}this.eventEmitter=new h,this.eventEmitter.setMaxListeners(1e3),this.context=a;var e=this;this._reconnect=b,this._onConnectionOpen=c,this._onMessage=d}function f(a,b){if(a){var c={};for(var d in b)isNaN(Number(b[d]))?c[d]=b[d]:c[d]=Number(b[d]);a.send(JSON.stringify(c))}}var g=a("../nodedefinition"),h=a("events").EventEmitter,i=a("lodash"),j={};e.prototype._close=function(){this.socket&&(clearTimeout(this.reconnectTimer),this.reconnectTimer=void 0,this.eventEmitter.emit("disconnected"),this.socket.removeEventListener("close",this._reconnect),this.socket.removeEventListener("error",this._reconnect),this.socket.removeEventListener("open",this._onConnectionOpen),this.socket.removeEventListener("message",this._onMessage),this.socket=void 0)},e.prototype.connect=function(a){this._close(),this.uri=a,this.socket=d(a),this.socket.addEventListener("close",this._reconnect),this.socket.addEventListener("error",this._reconnect),this.socket.readyState===WebSocket.OPEN?this._onConnectionOpen():this.socket.addEventListener("open",this._onConnectionOpen)},e.prototype.addEventListener=function(a,b){this.eventEmitter.on(a,b)},e.prototype.send=function(a){this.socket&&this.socket.readyState===WebSocket.OPEN&&this.socket.send(a)},b.exports=g.defineNode({name:"Websocket",category:"Communication",initialize:function(){var a=this._internal;a.socket=new e(this.context),a.socket.addEventListener("connected",this.onConnected.bind(this)),a.socket.addEventListener("disconnected",this.onDisconnected.bind(this)),a.socket.addEventListener("jsonMessage",this.onMessageReceived.bind(this)),a.connected=!1,a.inputValues={},a.outputValues={},a.outputNames=[]},panels:[{name:"PortEditor",context:["select","connectFrom"],title:"Outputs",plug:"output",type:{name:"*",group:"Output data"}},{name:"PortEditor",context:["select","connectTo"],title:"Data To Send",plug:"input",group:"Data To Send",type:{name:"string"}}],inputs:{address:{group:"Settings",displayName:"Ip Address:Port",type:{name:"string"},set:function(a){if(!(void 0===a||a.length<=0)){var b=a;i.startsWith(b,"ws://")||i.startsWith(b,"wss://")||(b="ws://"+b),b[b.length]-1!=="/"&&(b+="/"),this._internal.socket.connect(b)}}},sendData:{group:"Send Data",displayName:"Send Data",valueChangedToTrue:function(){var a=this;this.scheduleAfterInputsHaveUpdated(function(){a._internal.inputValues._nodeId=a.id,f(a._internal.socket,a._internal.inputValues)})}}},outputs:{newDataReceived:{displayName:"New Data Received",type:"signal"},connected:{displayName:"Connected",type:"boolean",getter:function(){return this._internal.connected}}},prototypeExtensions:{registerOutputIfNeeded:function(a){if(!this.hasOutput(a)){this._internal.outputValues[a]=void 0;var b=this;this.registerOutput(a,{getter:function(){return b._internal.outputValues[a]}})}},registerInputIfNeeded:function(a){if(!this.hasInput(a)){var b=this;this.registerInput(a,{set:function(c){b._internal.inputValues[a]=c}})}},onMessageReceived:function(a){if(!a._nodeIds||-1!==a._nodeIds.indexOf(this.id)){var b=!1;for(var c in a)this.hasOutput(c)&&(this._internal.outputValues[c]=a[c],this.flagOutputDirty(c),b=!0);b&&this.sendSignalOnOutput("newDataReceived")}},onConnected:function(){!0!==this._internal.connected&&(this._internal.connected=!0,this.flagOutputDirty("connected"))},onDisconnected:function(){!1!==this._internal.connected&&(this._internal.connected=!1,this.flagOutputDirty("connected"))}}})},{"../nodedefinition":81,events:7,lodash:12}],159:[function(a,b,c){"use strict";function d(a,b){this.context=a,this.nodes={},this.componentOwner=b,this.noodlJavascriptAPI=g(this),this.componentInstanceChildren={}}function f(a,b){b.forEach(function(b){if(!a[b])throw new Error("Missing "+b)})}var g=a("./noodl-js-api"),h=a("lodash");d.prototype.addConnection=function(a){try{f(a,["sourceId","sourcePort","targetId","targetPort"])}catch(e){throw new Error("Error in connection: "+e.message)}try{var b=this.getNodeWithId(a.sourceId),c=this.getNodeWithId(a.targetId);c.registerInputIfNeeded(a.targetPort),b.registerOutputIfNeeded(a.sourcePort),c.connectInput(a.targetPort,b,a.sourcePort)}catch(e){console.error(e.message)}},d.prototype.setNodeParameters=function(a,b){var c=Object.keys(b);if(this.context.nodeRegister.hasNode(a.name)){var d=this.context.nodeRegister.getNodeMetadata(a.name);c.sort(function(a,b){var c=d.inputs[a],e=d.inputs[b];return(e?e.inputPriority:0)-(c?c.inputPriority:0)})}c.forEach(function(c){function d(){var d=b[c];"object"==typeof d?a.setInputValue(c,d.value,d.unit):a.setInputValue(c,d)}a.registerInputIfNeeded(c),!1!==a.hasInput(c)&&d()})},d.prototype.createNodeFromModel=function(a){if("Component Children"!==a.type){var b;try{b=this.createNode(a.type,a.id),b.setNodeModel(a)}catch(e){return void console.error(e.message,e.stack)}this.setNodeParameters(b,a.parameters),a.parent&&this.insertNodeInTree(b,a)}else if(a.parent){var c=this.getNodeWithId(a.parent.id);this.componentOwner.setChildRoot(c)}},d.prototype.insertNodeInTree=function(a,b){var c=this.getNodeWithId(b.parent.id),d=b.parent.children.indexOf(b);if(!c.addChild)throw new Error("Node "+c.id+" of type "+c.constructor.name+" can't have children");a.getVisualRoot&&c.addChild(a,d)},d.prototype.getNodeWithId=function(a){if(!1===this.nodes.hasOwnProperty(a))throw new Error("Unknown node id "+a);return this.nodes[a]},d.prototype.hasNodeWithId=function(a){return this.nodes.hasOwnProperty(a)},d.prototype.createNode=function(a,b){if(this.nodes.hasOwnProperty(b))throw Error("duplicate id "+b);var c;return this.context.hasComponentModelWithName(a)?(c=this.context.createComponentInstanceNode(a),c.parentNodeScope=this,this.componentInstanceChildren[b]=c):(c=this.context.nodeRegister.createNode(a),c.nodeScope=this),this.nodes[b]=c,c.id=b,c},d.prototype.getNodesWithIdRecursive=function(b){function c(a,b,e){a.nodes.hasOwnProperty(b)&&e.push(a.nodes[b]),Object.keys(a.nodes).filter(function(b){return a.nodes[b]instanceof d}).forEach(function(d){c(a.nodes[d].nodeScope,b,e)})}var d=a("./nodes/componentinstance"),e=[];return c(this,b,e),e},d.prototype.getNodesWithType=function(a){var b=this;return Object.keys(this.nodes).filter(function(c){return b.nodes[c].name===a}).map(function(a){return b.nodes[a]})},d.prototype.getNodesWithTypeRecursive=function(b){function c(){f=f.concat(e.getNodesWithType(b)),Object.keys(e.nodes).filter(function(a){return e.nodes[a]instanceof d}).forEach(function(a){var c=e.nodes[a].nodeScope.getNodesWithTypeRecursive(b);f=f.concat(c)})}var d=a("./nodes/componentinstance"),e=this,f=[];return c(f),f},d.prototype.onNodeModelRemoved=function(a){var b=this.getNodeWithId(a.id);if(a.parent){this.getNodeWithId(a.parent.id).removeChild(b)}b._onNodeDeleted(),delete this.nodes[b.id],delete this.componentInstanceChildren[b.id]},d.prototype.removeConnection=function(a){this.getNodeWithId(a.targetId).removeInputConnection(a.targetPort,a.sourceId,a.sourcePort)},d.prototype.removeNodeFromParent=function(a){if(a.getVisualRoot&&a.getVisualRoot()){var b=a.getVisualRoot()._internal.visualParent;b&&b.removeChild(a)}},d.prototype.setComponentModel=function(a){this.componentModel=a,a.getAllNodes().forEach(this.createNodeFromModel.bind(this)),a.getAllConnections().forEach(this.addConnection.bind(this)),a.on("connectionAdded",this.addConnection,this),a.on("connectionRemoved",this.removeConnection,this),a.on("nodeAdded",this.createNodeFromModel,this);var b=this;a.on("nodeParentWillBeRemoved",function(a){if("Component Children"!==a.type){var c=b.getNodeWithId(a.id);b.removeNodeFromParent(c)}else if(a.parent){this.getNodeWithId(a.parent.id);this.componentOwner.setChildRoot(null)}},this),a.on("nodeParentUpdated",function(a){if("Component Children"===a.type){var c=this.getNodeWithId(a.parent.id);this.componentOwner.setChildRoot(c)}else{var d=b.getNodeWithId(a.id);b.insertNodeInTree(d,a)}},this),a.on("nodeRemoved",function(a){"Component Children"!==a.type&&b.onNodeModelRemoved(a)},this)},d.prototype.reset=function(){if(this.componentModel){this.componentModel.removeListenersWithRef(this);var a=this;Object.keys(this.nodes).forEach(function(b){a.nodes.hasOwnProperty(b)&&a.deleteNode(a.nodes[b])}),this.componentModel=void 0,this.noodlJavascriptAPI.eventEmitter.removeAllListeners()}},d.prototype.deleteNode=function(a){if(!1===this.nodes.hasOwnProperty(a.id))return void console.error("Node doesn't belong to this scope",this,a);var b=this;this.removeNodeFromParent(a),a.getChildren&&(a.getChildren().forEach(a.removeChild.bind(a)),a.getChildren().forEach(function(a){b.deleteNode(a)}));var c=this.componentModel.getConnectionsFrom(a.id),d=this.componentModel.getConnectionsTo(a.id);c.concat(d).forEach(function(a){b.nodes.hasOwnProperty(a.targetId)&&b.nodes.hasOwnProperty(a.sourceId)&&b.removeConnection(a)}),a._onNodeDeleted(),delete this.nodes[a.id],delete this.componentInstanceChildren[a.id]},d.prototype.sendEventFromThisScope=function(a,b,c,d){if(d){this.getNodesWithType("Event Receiver").filter(function(b){return b.getChannelName()===a}).forEach(function(a){a.handleEvent(b)})}"parent"===c&&this.componentOwner.parentNodeScope?this.componentOwner.parentNodeScope.sendEventFromThisScope(a,b,c,!0):"children"===c&&h.forIn(this.componentInstanceChildren,function(d){d.nodeScope.sendEventFromThisScope(a,b,c,!0)})},b.exports=d},{"./nodes/componentinstance":89,"./noodl-js-api":160,lodash:12}],160:[function(a,b,c){"use strict";function d(a){function b(b){return b&&b.length>0&&"/"!==b[0]&&(b="/"+b),a.createNode(b,e())}function c(b){a.deleteNode(b)}function d(a,b){l.scheduleAfterUpdate(function(){l.setGlobalValue(a,b)})}function j(a){return l.getGlobalValue(a)}function k(a,b){if(m[a]){var c=m[a].indexOf(b);-1!==c&&m[a].splice(c,1)}}var l=a.context,m={};return{createComponent:b,deleteComponent:c,setGlobalValue:d,getGlobalValue:j,eventEmitter:{on:function(a,b){var c=l.eventSenderEmitter;c.on(a,b),m[a]=m[a]||[],m[a].push(b),l.eventEmitter.once("applicationDataReloaded",function(){c.removeListener(a,b),k(a,b)})},once:function(a,b){l.eventSenderEmitter.once(a,b)},off:function(a,b){l.eventSenderEmitter.removeListener(a,b),k(a,b)},emit:function(a,b){l.eventSenderEmitter.emit(a,b)},removeAllListeners:function(){Object.keys(m).forEach(function(a){for(var b=m[a],c=b.length-1;c>=0;c--){var d=b[c];l.eventSenderEmitter.removeListener(a,d),k(a,d)}})}},Collection:f,Model:g,Item:g,AnimationCurve:h,PubSub:i.pubsub}}var e=a("./guid"),f=a("./nodes/data/collection"),g=a("./nodes/data/model"),h=a("./easecurves"),i=a("./services/services");b.exports=d},{"./easecurves":67,"./guid":73,"./nodes/data/collection":92,"./nodes/data/model":96,"./services/services":166}],161:[function(a,b,c){"use strict";function d(a){if(!a.owner)throw new Error("Owner must be set");this.getter=a.getter,this.connections=[],this.owner=a.owner,this.name=a.name,this._id=void 0}Object.defineProperties(d.prototype,{value:{get:function(){return this.getter.call(this.owner)}},id:{get:function(){return this._id||(this._id=this.owner.id+this.name),this._id}},registerConnection:{value:function(a,b){this.connections.push({node:a,inputPortName:b})}},deregisterConnection:{value:function(a,b){for(var c=0;c<this.connections.length;c++){var d=this.connections[c];if(d.node===a&&d.inputPortName===b){this.connections.splice(c,1);break}}}},flagDependeesDirty:{value:function(a){for(var b=0,c=this.connections.length;b<c;b++)this.connections[b].node.flagDirty()}},sendValue:{value:function(a){for(var b=0,c=this.connections.length;b<c;b++){var d=this.connections[b];d.node.queueInput(d.inputPortName,a)}}},hasConnections:{value:function(){return this.connections.length>0}}}),b.exports=d},{}],162:[function(a,b,c){"use strict";function d(a,b,c){if(!c[a]){if(!g[a])throw new Error("Unknown patch key "+a);var d={nodePatches:[],dismissPatches:[]};for(var e in g[a])d[e]=g[a][e];c[a]=d}c[a].nodePatches.push(b)}function e(a,b){var c=[];[h,i,j,k,l].forEach(function(b){b.condition(a)&&c.push(b.generatePatch(a))}),c.forEach(function(a){d(a.key,a.patch,b)})}function f(a,b){e(a,b),a.children&&a.children.forEach(function(a){f(a,b)})}var g={LayoutNotSupported:{message:"Group with layout is no longer supported. These have been replaced with the new nodes Stack Layout and Flow Layout",notifyUser:!0,askPermission:!1,key:"LayoutNotSupported"},ImageDefaultUnitChanged:{notifyUser:!1,askPermission:!1,key:"ImageDefaultUnitChanged",message:""},TextMaxLineWidthReplaced:{notifyUser:!0,askPermission:!1,key:"TextMaxLineWidthReplaced",message:"Text max line width is no longer supported. Replaced with size mode content height and explicit width set in pixels"},RemoveValue:{notifyUser:!1,askPermission:!1,key:"RemoveValue",message:""}},h={condition:function(a){return void 0===a.version&&"Group"===a.type&&"none"===a.parameters.layout},generatePatch:function(a){return{key:"RemoveValue",version:2,patch:{nodeId:a.id,params:{layout:null}}}}},i={condition:function(a){return void 0===a.version&&"Group"===a.type&&a.parameters.hasOwnProperty("layout")&&"none"!==a.parameters.layout},generatePatch:function(a){var b,c;if("stackHorizontal"===a.parameters.layout)b="Stack Layout",c="horizontal";else if("stackVertical"===a.parameters.layout)b="Stack Layout",c="vertical";else if("flowHorizontal"===a.parameters.layout)b="Flow Layout",c="horizontal";else{if("flowVertical"!==a.parameters.layout)return void console.error("Can't convert layout",a);b="Flow Layout",c="vertical"}return{key:"LayoutNotSupported",patch:{nodeId:a.id,version:2,typename:b,params:{layout:null,orientation:c}}}}},j={condition:function(a){return void 0===a.version&&"Image"===a.type&&(("explicit"===a.parameters.sizeMode||"childHeight"===a.parameters.sizeMode)&&(!a.parameters.hasOwnProperty("width")||"object"!=typeof a.parameters.width))},generatePatch:function(a){var b=0;return a.parameters.width&&(b=a.parameters.width.value?a.parameters.width.value:a.parameters.width),{key:"ImageDefaultUnitChanged",patch:{nodeId:a.id,version:2,params:{width:{value:b,unit:"px"}}}}}},k={condition:function(a){return void 0===a.version&&"Image"===a.type&&(("explicit"===a.parameters.sizeMode||"childWidth"===a.parameters.sizeMode)&&(!a.parameters.hasOwnProperty("height")||"object"!=typeof a.parameters.height))},generatePatch:function(a){var b=0;return a.parameters.height&&(b=a.parameters.height.value?a.parameters.height.value:a.parameters.height),{key:"ImageDefaultUnitChanged",patch:{nodeId:a.id,version:2,params:{height:{value:b,unit:"px"}}}}}},l={condition:function(a){return void 0===a.version&&"Text"===a.type&&a.parameters.hasOwnProperty("maxWidth")},generatePatch:function(a){return{key:"TextMaxLineWidthReplaced",patch:{nodeId:a.id,version:2,params:{maxWidth:null,sizeMode:"childHeight",width:{value:a.parameters.maxWidth,unit:"px"}}}}}};b.exports={collectPatches:function(a){var b={};return a.components.forEach(function(a){a.nodes.forEach(function(a){f(a,b)})}),b}}},{}],163:[function(a,b,c){"use strict";function d(a,b){var c="Device Settings - "+a;b.ports.push({group:c,type:{name:"enum",enums:[{label:"WebGL",value:"webgl"},{label:"Canvas2D",value:"canvas2d"}]},name:a+".renderer",displayName:"Renderer",default:"webgl"}),b.ports.push({group:c,type:"boolean",name:a+".transparent",displayName:"Transparent",default:!1}),b.ports.push({group:c,type:{name:"component"},name:a+".rootComponent",displayName:"Root Component"}),b.dynamicports.push({name:"conditionalports/basic",condition:"'"+a+".fillMode' = aspectFit OR '"+a+".fillMode' NOT SET",ports:[{group:c,type:"number",name:a+".canvasWidth",displayName:"Width",default:1080},{group:c,type:"number",name:a+".canvasHeight",displayName:"Height",default:1920}]}),b.ports.push({group:c,type:{name:"enum",enums:[{label:"Fill",value:"fill"},{label:"Aspect Fit",value:"aspectFit"}]},name:a+".fillMode",displayName:"Fill Mode",default:"aspectFit"})}function e(a){for(var b=[],c=0;c<__noodl_modules.length;c++){var d=__noodl_modules[c];d.mqttBrokers&&d.mqttBrokers.forEach(function(a){b.push(a)})}if(0===b.length)a.dynamicports.push({name:"conditionalports/basic",condition:"mqttUseExternalBroker = true",ports:[{group:"MQTT",type:"string",name:"mqttBrokerUrl",displayName:"Broker URL",default:"mqtt://user:pass@brokerurl.com:1883"}]});else{for(var e=[{value:"default",label:"Default"}],c=0;c<b.length;c++){var f=b[c];e.push({value:f.id,label:f.name})}a.dynamicports.push({name:"conditionalports/basic",condition:"mqttUseExternalBroker = true",ports:[{group:"MQTT",type:{name:"enum",enums:e},default:"default",displayName:"Type",name:"mqttBrokerType"}]}),a.dynamicports.push({name:"conditionalports/basic",condition:"mqttUseExternalBroker = true AND mqttBrokerType = default OR mqttBrokerType NOT SET",ports:[{group:"MQTT",type:"string",name:"mqttBrokerUrl",displayName:"Broker URL",default:"mqtt://user:pass@brokerurl.com:1883"}]});for(var c=0;c<b.length;c++){var f=b[c];a.dynamicports.push({name:"conditionalports/basic",
condition:"mqttUseExternalBroker = true AND mqttBrokerType = "+f.id,ports:f.settings})}}a.ports.push({group:"MQTT",type:"boolean",name:"mqttUseExternalBroker",displayName:"External Broker",default:!1})}function f(a){for(var b=0;b<__noodl_modules.length;b++){var c=__noodl_modules[b];c.settings&&c.settings.forEach(function(b){a.ports.push(b)})}}function g(a){var b={dynamicports:[],ports:[{group:"Devices",type:"stringlist",name:"devices",displayName:"Devices",default:i}]},c=[i];return a.devices&&(c=a.devices.split(",")),c.forEach(function(a){d(a,b)}),e(b),f(b),b}function h(a){var b=["fillMode","canvasWidth","canvasHeight","renderer"],c=b.filter(function(b){return a.hasOwnProperty(b)});if(0!==c.length){var d={fillMode:null,canvasWidth:null,canvasHeight:null,renderer:null,devices:i};return c.forEach(function(b){d[i+"."+b]=a[b]}),{askPermission:!1,notifyUser:!1,settingsPatch:d}}}var i="Default Device";b.exports={generateProjectSettings:g,collectPatch:h}},{}],164:[function(a,b,c){"use strict";function d(){this.subscriptions={},f.call(this)}var e=(a("paho-mqtt"),a("./services")),f=a("../eventsender"),g=a("lodash");d.prototype=Object.create(f.prototype),d.prototype.constructor=d,d.prototype.connect=function(a){if(this.url!==a.url||this.clientId!==a.clientId||!this.client){this.connectArgs=a,this.url=a.url,this.clientId=a.clientId,this.client&&(this.client.disconnect(),this.client=void 0,this.hasClient=!1);var b="function"==typeof this.url?this.url():this.url;if(b){g.endsWith(b,"/")||-1!==b.indexOf("?")||(b+="/"),g.startsWith(b,"mqtt://")?b="ws://"+b.substring(7):g.startsWith(b,"mqtts://")&&(b="wss://"+b.substring(8));var c={useSSL:g.startsWith(b,"wss:")||g.startsWith(b,"mqtts:")},d=b.match(/^(wss?):\/\/((\[(.+)\])|([^\/]+?))(:(\d+))?(\/.*)$/);if(d){var f=d[4]||d[2];if(-1!==f.indexOf("@")){var h=f.split("@"),i=h[0].split(":"),j=i[0],k=i[1];b=b.substring(0,b.indexOf("://")+3)+b.substring(b.indexOf("@")+1),c.userName=j,c.password=k}var l=new Paho.MQTT.Client(b,a.clientId);this.client=l;var m=this;c.onSuccess=function(){function a(){0===--c&&m.emit("connected")}console.log("MQTT","Connected to",b);var c=Object.keys(m.subscriptions).length;if(0===c)m.emit("connected");else for(var d in m.subscriptions)m.client.subscribe(d,{onSuccess:a,onFailure:a})},c.onFailure=function(){console.log("MQTT","Failed to connect to",b),m.client=void 0,setTimeout(function(){m.connect(a)},2e3)},l.connect(c),l.onConnectionLost=function(b){console.log("MQTT",JSON.stringify(b)),m.client=void 0,m.emit("connectionClosed"),setTimeout(function(){m.connect(a)},2e3)},l.onMessageArrived=function(a){var b=a.destinationName,c=a.payloadString.toString();try{c=JSON.parse(c)}catch(e){}e.pubsub.routeMessage({topic:b,payload:c})}}}}},d.prototype.reconnect=function(){this.connect(this.connectArgs)},d.prototype.disconnect=function(){this.client&&(this.client.disconnect(),this.client=null)},d.prototype.isConnected=function(){return this.client&&this.client.isConnected()},d.prototype.sendServiceRequest=function(a){if("subscribe"===a.type)this.subscriptions[a.topic]=!0,this.client&&this.client.isConnected()&&this.client.subscribe(a.topic);else if("unsubscribe"===a.type)delete this.subscriptions[a.topic],this.client&&this.client.isConnected()&&this.client.unsubscribe(a.topic);else if("publish"===a.type&&this.client&&this.client.isConnected()){var b=a.payload;"object"==typeof b&&(b=JSON.stringify(a.payload));var c=new Paho.MQTT.Message(b);c.destinationName=a.topic,this.client.send(c)}},b.exports=d},{"../eventsender":71,"./services":166,lodash:12,"paho-mqtt":13}],165:[function(a,b,c){"use strict";function d(){}var e={},f=["connected","connectionClosed"];d.prototype.setConnection=function(a){var b=this;this.connection&&f.forEach(function(a){b.connection.removeAllListeners(a)}),this.connection=a},d.prototype.reconnect=function(){this.connection.reconnect&&this.connection.reconnect()},d.prototype.isConnected=function(){return this.connection.isConnected()},d.prototype.on=function(a,b){-1!==f.indexOf(a)&&this.connection.on(a,b)},d.prototype.getMatchingSubscribers=function(a){function b(a,b){var c=a.split("/"),d=b.split("/");if(c.length!==d.length)return!1;for(var e=0;e<c.length;e++)if("+"!==d[e]&&c[e]!==d[e])return!1;return!0}var c=[];for(var d in e)if(b(a,d))for(var f=e[d],g=0;g<f.length;g++)c.push(f[g]);return c},d.prototype.routeMessage=function(a){for(var b=this.getMatchingSubscribers(a.topic),c=0;c<b.length;c++)b[c](a)},d.prototype.getSubscribers=function(a){return e[a]||(e[a]=[]),e[a]},d.prototype.subscribe=function(a,b){var c=this.getSubscribers(a);0===c.length&&this.connection.sendServiceRequest({service:"pubsub",type:"subscribe",topic:a}),c.push(b)},d.prototype.unsubscribe=function(a,b){for(var c=this.getSubscribers(a),d=0;d<c.length;d++)c[d]===b&&c.splice(d,1);0===c.length&&this.connection.sendServiceRequest({service:"pubsub",type:"unsubscribe",topic:a})},d.prototype.publish=function(a,b){this.connection.sendServiceRequest({service:"pubsub",type:"publish",topic:a,payload:b})},b.exports=d},{}],166:[function(a,b,c){function d(){}var e=a("events").EventEmitter;d.events=new e,b.exports=d},{events:7}],167:[function(a,b,c){var d={};d.StandardUniformNames={texture:!0,u_view:!0,u_projection:!0,u_world:!0,u_opacity:!0,u_color:!0,u_srcRect:!0,u_flipTexCoordY:!0},d.extractStorageQualifier=function(a,b){var c,d=[],e=new RegExp(b+"\\s*([^;]*)","g");do{if(c=e.exec(a)){var f=c[1].split(" ");3===f.length&&f.splice(0,1),d.push({type:f[0],name:f[1]})}}while(c);return d},d.extractUniforms=function(a,b){function c(a){a.forEach(function(a){!1===e.some(function(b){return b.name===a.name})&&e.push(a)})}var e=[];return c(d.extractStorageQualifier(a,"uniform")),c(d.extractStorageQualifier(b,"uniform")),e},b.exports=d},{}],168:[function(a,b,c){"use strict";function d(a,b){this.duration=b.duration||0,this._isRunning=!1,this._hasCalledOnStart=!1,this.scheduler=a,this.repeatCount=1,this.delay=0;for(var c in b)this[c]=b[c]}function e(a){this.requestFrame=a,this.runningTimers=[],this.newTimers=[]}d.prototype.start=function(){return this._isRunning&&this.stop(),this.scheduler.scheduleTimer(this),this},d.prototype.stop=function(){this.scheduler.stopTimer(this),this._hasCalledOnStart=!1,this._isRunning=!1,this._wasStopped=!0},e.prototype.createTimer=function(a){return new d(this,a)},e.prototype.scheduleTimer=function(a){-1===this.newTimers.indexOf(a)&&(0===a.repeatCount&&(a.repeatCount=1e5),this.newTimers.push(a),this.requestFrame())},e.prototype.stopTimer=function(a){var b;a._isRunning?(b=this.runningTimers.indexOf(a),-1!==b&&this.runningTimers.splice(b,1),a.onStop&&!a._wasStopped&&a.onStop()):-1!==(b=this.newTimers.indexOf(a))&&this.newTimers.splice(b,1)},e.prototype.runTimers=function(a){var b,c,d=[],e=[],f=[],g=this.runningTimers.length;for(b=0;b<g;++b)f[b]=this.runningTimers[b];for(b=0;b<g;++b)if((c=f[b])&&a>=c._start){!1===c._hasCalledOnStart&&c.onStart&&(c.onStart(),c._hasCalledOnStart=!0);var h;h=c.duration>0?(a-c._start)/(c.duration*c.repeatCount):1;var i=h*c.repeatCount-Math.floor(h*c.repeatCount);h>=1&&(i=1),c.onRunning&&c.onRunning(i),h<1&&c._isRunning?d.push(c):c._wasStopped||e.push(c)}else d.push(c);for(this.runningTimers=d,b=0;b<e.length;++b)e[b]._isRunning=!1,e[b]._hasCalledOnStart=!1,e[b].onFinish&&e[b].onFinish();if(this.newTimers.length>0){for(b=0;b<this.newTimers.length;++b)c=this.newTimers[b],c._start=a+c.delay,c._isRunning=!0,c._wasStopped=!1,this.runningTimers.push(c),0===c.delay&&(c.onStart&&(c.onStart(),c._hasCalledOnStart=!0),c.onRunning&&c.onRunning(0));this.newTimers.length=0}},e.prototype.hasPendingTimers=function(){return this.runningTimers.length>0||this.newTimers.length>0},b.exports=e},{}],169:[function(a,b,c){"use strict";function d(a,b){e.call(this,a),this.layout=f,this.imageCache=b,this.renderCommand={type:"circle",color:"#ffffff",blendMode:"alpha",arcAngle:2*Math.PI,solid:!0,lineWidth:2,blur:0,image:null,imagePath:null}}var e=a("./uicontrol"),f={measure:function(a){return this.layoutSize(a,0,0)},layoutSize:function(a,b,c){var d="%"===a.widthUnit?b*(a.width/100):a.width;return{width:d,height:d}}};d.prototype=Object.create(e.prototype),d.prototype.constructor=d,d.prototype.setColor=function(a){this.renderCommand.color=a,this.setContentDirty(!0)},d.prototype.setArcAngle=function(a){this.renderCommand.arcAngle=a,this.setContentDirty(!0)},d.prototype.setSolid=function(a){this.renderCommand.solid=a,this.setContentDirty(!0)},d.prototype.setLineWidth=function(a){this.renderCommand.lineWidth=a,this.setContentDirty(!0)},d.prototype.setBlur=function(a){this.renderCommand.blur=a,this.setContentDirty(!0)},d.prototype.setBlendMode=function(a){this.renderCommand.blendMode=a,this.setContentDirty(!0)},d.prototype.setImagePath=function(a){this.renderCommand.image=null,this.renderCommand.imagePath=null,this.path=a,this.setContentDirty(!0),this.imageCache.getImage(a,this._onImageLoaded.bind(this))},d.prototype._onImageLoaded=function(a){a._path===this.path&&(this.renderCommand.image=a,this.renderCommand.imagePath=this.path,this.setContentDirty(!0))},d.prototype.setMaskType=function(a){this.renderCommand.maskType=a},b.exports=d},{"./uicontrol":185}],170:[function(a,b,c){"use strict";function d(a){e.call(this,a,f.static)}var e=a("./layoutcontrol"),f=a("../layout/docklayout");d.prototype=Object.create(e.prototype),d.prototype.constructor=d,b.exports=d},{"../layout/docklayout":187,"./layoutcontrol":176}],171:[function(a,b,c){"use strict";function d(a,b){e.call(this,a),this.renderToFramebuffer=!0,this.imageCache=b,this.frameBufferSettings={renderEffectsToTexture:!1,renderAfterPop:!0,cornerRadius:0,renderScale:1,effect:"none",vertices:null,maskImage:null,requiresExclusiveFBO:!1,maskViewId:null,effectParams:{gaussianBlurRadius:d.StandardGaussianBlurRadius,effectAmount:d.StandardEffectAmount}},this.shaderSource=null,this.secondaryShaderSource=null}var e=(a("./uicontrol"),a("./docklayoutcontrol")),f=a("./layoutcontrol");d.prototype=Object.create(e.prototype),d.prototype.constructor=d,d.prototype.setRenderEffectsToTexture=function(a){this.frameBufferSettings.renderEffectsToTexture=a,this.setContentDirty(!0)},d.prototype.setRenderScale=function(a){this.frameBufferSettings.renderScale=a,this.setContentDirty(!0)},d.prototype.setColor=function(a){this.renderCommand.color=a,this.setContentDirty(!0)},d.prototype.setFrameBufferIsExclusive=function(a){this.frameBufferSettings.requiresExclusiveFBO=a},d.prototype.setMaskImagePath=function(a){if(!a||""===a)return this.frameBufferSettings.maskImage=null,this.frameBufferSettings.maskViewId=null,void this.setContentDirty(!0);if("string"==typeof a){if(0===a.search(d.ImageOutputPrefix)){var b=a.split(d.ImageOutputPrefix)[1];return b=b.split(":")[0],this.frameBufferSettings.maskViewId=b,void this.setContentDirty(!0)}this.frameBufferSettings.maskViewId=null;var c=this;this.imageCache.getImage(a,function(b){c.frameBufferSettings.maskImage={imagePath:a,image:b},c.setContentDirty(!0)})}},d.prototype.setSecondaryShader=function(a){this.secondaryShaderSource=a,this.setContentDirty(!0)},d.prototype.setShader=function(a){this.shaderSource=a,this.setContentDirty(!0)},d.prototype.setUniform=function(a,b,c,d){d?(this.secondaryShaderUniforms||(this.secondaryShaderUniforms={}),this.secondaryShaderUniforms[a]=b):(this.shaderUniforms||(this.shaderUniforms={}),this.shaderUniforms[a]=b),this.setContentDirty(!0)},d.prototype.setCornerRadius=function(a){this.frameBufferSettings.cornerRadius=a,this.setContentDirty(!0)},d.prototype.setEffectAmount=function(a){this.frameBufferSettings.effectParams.effectAmount=a,this.setContentDirty(!0)},d.prototype.setGaussianBlurRadius=function(a){this.frameBufferSettings.effectParams.gaussianBlurRadius=a,this.setContentDirty(!0)},d.prototype.setStandardEffect=function(a){this.frameBufferSettings.effect=a,this.setContentDirty(!0)},d.prototype.setDrawToScreen=function(a){this.frameBufferSettings.renderAfterPop=a,this.setContentDirty(!0)},d.prototype.setVertices=function(a){this.frameBufferSettings.vertices=a,this.setContentDirty(!0)},d.prototype.getOutputImageId=function(){var a=this.layoutRect,b=a.width||0,c=a.height||0;return d.ImageOutputPrefix+this.id+":"+b+":"+c},d.prototype.setClip=function(a){f.prototype.setClip.call(this,a),this.frameBufferSettings.clip=a},d.ImageOutputPrefix="/EffectGroup/:",d.StandardGaussianBlurRadius=30,d.StandardEffectAmount=1,b.exports=d},{"./docklayoutcontrol":170,"./layoutcontrol":176,"./uicontrol":185}],172:[function(a,b,c){"use strict";function d(a){e.call(this,a,f.static),this.verticalItemSpacing=0,this.horizontalItemSpacing=0,this.orientation="horizontal",this.contentAlignX="left",this.contentAlignY="top"}var e=a("./layoutcontrol"),f=a("../layout/flowlayout");d.prototype=Object.create(e.prototype),d.prototype.constructor=d,d.prototype.setVerticalItemSpacing=function(a){this.verticalItemSpacing=a,this.layouter.setNeedsRelayout(this),this.setContentDirty(!0)},d.prototype.setHorizontalItemSpacing=function(a){this.horizontalItemSpacing=a,this.layouter.setNeedsRelayout(this),this.setContentDirty(!0)},d.prototype.setOrientation=function(a){this.orientation=a,this.layouter.setNeedsRelayout(this),this.setContentDirty(!0)},d.prototype.setContentAlignX=function(a){this.contentAlignX=a,this.layouter.setNeedsRelayout(this),this.setContentDirty(!0)},d.prototype.setContentAlignY=function(a){this.contentAlignY=a,this.layouter.setNeedsRelayout(this),this.setContentDirty(!0)},b.exports=d},{"../layout/flowlayout":188,"./layoutcontrol":176}],173:[function(a,b,c){"use strict";function d(a){e.call(this,a),this.layout=f,this.domNode=null,this.lastSetContent=null,this.layout.mediaWidth=null,this.layout.mediaHeight=null,this.renderCommand={type:"html",inputEnabled:!0}}var e=a("./uicontrol"),f={measure:function(a){return this.layoutSize(a,0,0)},layoutSize:function(a,b,c){var d="%"===a.widthUnit?b*(a.width/100):a.width,e="%"===a.heightUnit?c*(a.height/100):a.height;if("explicit"===a.sizeMode||null===this.mediaWidth||null===this.mediaHeight)return{width:d,height:e};if("childWidth"===a.sizeMode){var f=this.mediaWidth/this.mediaHeight;return{width:e*f,height:e}}if("childHeight"===a.sizeMode){var f=this.mediaWidth/this.mediaHeight;return{width:d,height:d/f}}return"childSize"===a.sizeMode?{width:this.mediaWidth,height:this.mediaHeight}:void 0}};d.prototype=Object.create(e.prototype),d.prototype.constructor=d,d.prototype.setMediaSize=function(a,b){this.layout.mediaWidth=a,this.layout.mediaHeight=b,this.setContentDirty(!0),this.layouter.setNeedsRelayout(this)},d.prototype.setDomNode=function(a){this.domNode=a},d.prototype.dispose=function(){e.prototype.dispose.call(this),this.domNode.dispose(),this.lastSetContent=null},d.prototype.isAttached=function(){return this.domNode.element&&this.domNode.element.parentNode},d.prototype.setClassName=function(a){this.domNode.element.className=a},d.prototype.setContent=function(a){return null!==this.domNode.element.parentNode&&this.lastSetContent!==a&&(this.domNode.element.innerHTML=a,this.setContentDirty(!0),this.lastSetContent=a,!0)},b.exports=d},{"./uicontrol":185}],174:[function(a,b,c){"use strict";function d(a,b,c,d){var e=c/a,f=d/b,g=Math.min(e,f);return{width:a*g,height:b*g}}function e(a,b,c,d){var e=c/a,f=d/b,g=Math.max(e,f);return{width:a*g,height:b*g}}function f(a,b){h.call(this,a),this.layout=j,this.setAlignX("center"),this.setAlignY("center"),this.setSizeMode("original"),this.imageCache=b,this.layoutSourceRect=[0,0,1,1],this.customSourceRect=[0,0,1,1],this.fillMode="aspectFit",this.renderCommand={type:"image",color:"#ffffff",blendMode:"alpha",image:null,imagePath:null,cornerRadius:0,blur:0,shaderSource:null},this.imageWidth=0,this.imageHeight=0}function g(a){return 0===a[0]&&0===a[1]&&1===a[2]&&1===a[3]}var h=a("../uicontrol"),i=a("../effectcontrol"),j={measure:function(a){return this.layoutSize(a,0,0)},layoutSize:function(a,b,c){var f=b,g=c;if(a.renderCommand.vertices)return{width:f,height:g};"childSize"===a.parent.sizeMode?(f=a.imageWidth,g=a.imageHeight):"childWidth"===a.parent.sizeMode?f=a.imageWidth:"childHeight"===a.parent.sizeMode?g=a.imageHeight:a.parent.sizeMode;var h=a.imageWidth&&a.imageHeight&&f&&g;if("fill"===a.fillMode||!h)return a.setLayoutImageSourceRect([0,0,1,1]),{width:f,height:g};var i={width:a.imageWidth?a.imageWidth:f,height:a.imageHeight?a.imageHeight:g};"aspectFit"===a.fillMode&&h?i=d(a.imageWidth,a.imageHeight,f,g):"aspectFill"===a.fillMode&&h&&(i=e(a.imageWidth,a.imageHeight,f,g));var j=[0,0,1,1];if(i.width>b){var k=b/i.width,l=(1-k)/2,m=l+k;j[0]=l,j[2]=m}if(i.height>c){var n=c/i.height,o=(1-n)/2,p=o+n;j[1]=o,j[3]=p}return a.setLayoutImageSourceRect(j),i={width:Math.min(f,i.width),height:Math.min(g,i.height)}}};f.prototype=Object.create(h.prototype),f.prototype.setImagePath=function(a){if(this.renderCommand.imageTextureControlId=null,this.renderCommand.image=null,this.renderCommand.imagePath=null,this.path=a,this.imageWidth=0,this.imageHeight=0,this.setContentDirty(!0),this.layouter.setNeedsRelayout(this),null!==a)if("string"==typeof a)if(0===a.search(i.ImageOutputPrefix)){var b=a.split(i.ImageOutputPrefix)[1].split(":"),c=b[0],d=b[1],e=b[2];this.renderCommand.imageTextureControlId=c,this.imageWidth=d,this.imageHeight=e}else this.imageCache.getImage(a,this._onImageLoaded.bind(this));else if("object"==typeof a&&"CANVAS"===a.tagName){var f=a;this.imageWidth=f.width,this.imageHeight=f.height,this.renderCommand.image=f,this.renderCommand.imagePath=f.id||"canvas"}},f.prototype.setFillMode=function(a){this.fillMode=a,this.layouter.setNeedsRelayout(this)},f.prototype.setVideoElement=function(a){this.renderCommand.image=null,this.renderCommand.imagePath=null,this.path=a.src,this.imageWidth=0,this.imageHeight=0,this.setContentDirty(!0),this.layouter.setNeedsRelayout(this),a.videoWidth?this._onVideoLoaded(a):a.addEventListener("canplay",this._onVideoLoaded.bind(this,a))},f.prototype._onVideoLoaded=function(a){a.src===this.path&&(this.imageWidth=a.videoWidth,this.imageHeight=a.videoHeight,this.renderCommand.image=a,this.renderCommand.imagePath=this.path,this.setContentDirty(!0),this.layouter.setNeedsRelayout(this))},f.prototype._onImageLoaded=function(a){a._path===this.path&&(this.imageWidth=a.width,this.imageHeight=a.height,this.renderCommand.image=a,this.renderCommand.imagePath=this.path,this.layouter.setNeedsRelayout(this),this.setContentDirty(!0))},f.prototype.setColor=function(a){this.renderCommand.color=a,this.setContentDirty(!0)},f.prototype.setBlendMode=function(a){this.renderCommand.blendMode=a,this.setContentDirty(!0)},f.prototype.setCornerRadius=function(a){this.renderCommand.cornerRadius=a,this.setContentDirty(!0)},f.prototype.updateSourceRect=function(){var a=this.layoutSourceRect,b=this.customSourceRect,c=b[2]-b[0],d=b[3]-b[1];if(g(a)&&g(b))return void delete this.renderCommand.srcRect;this.renderCommand.srcRect||(this.renderCommand.srcRect=[0,0,1,1]),this.renderCommand.srcRect[0]=b[0]+a[0]*c,this.renderCommand.srcRect[1]=b[1]+a[1]*d,this.renderCommand.srcRect[2]=b[0]+a[2]*c,this.renderCommand.srcRect[3]=b[1]+a[3]*d},f.prototype.setLayoutImageSourceRect=function(a){this.layoutSourceRect=a,this.updateSourceRect()},f.prototype.setImageSourceRect=function(a){this.renderCommand;this.customSourceRect[0]=a[0],this.customSourceRect[1]=a[1],this.customSourceRect[2]=a[2],this.customSourceRect[3]=a[3],this.updateSourceRect()},f.prototype.setShader=function(a){this.renderCommand.shaderSource=a},f.prototype.setUniform=function(a,b,c){this.renderCommand.shaderUniforms||(this.renderCommand.shaderUniforms={}),this.renderCommand.shaderUniforms[a]=b},f.prototype.setVertices=function(a){this.renderCommand.vertices=a,this.layouter.setNeedsRelayout(this),this.setContentDirty(!0)},b.exports=f},{"../effectcontrol":171,"../uicontrol":185}],175:[function(a,b,c){"use strict";function d(a,b){f.call(this,a),this.innerControl=new e(a,b),this.imageCache=b,this.addChild(this.innerControl)}var e=a("./image/imageinnercontrol"),f=a("./docklayoutcontrol");d.prototype=Object.create(f.prototype),d.prototype.constructor=d,d.prototype.setImagePath=function(a){this.innerControl.setImagePath(a)},d.prototype.setVideoElement=function(a){this.innerControl.setVideoElement(a)},d.prototype.setFillMode=function(a){this.innerControl.setFillMode(a)},d.prototype.setClip=function(a){this.clip=a,this.setContentDirty(!0)},d.prototype.setColor=function(a){this.innerControl.setColor(a)},d.prototype.setBlendMode=function(a){this.innerControl.setBlendMode(a)},d.prototype.setCornerRadius=function(a){this.innerControl.setCornerRadius(a)},d.prototype.setImageSourceRect=function(a){this.innerControl.setImageSourceRect(a)},d.prototype.dispose=function(){this.innerControl.dispose(),f.prototype.dispose.call(this)},d.prototype.setVertices=function(a){this.innerControl.setVertices(a),this.setContentDirty(!0)},d.prototype.setShader=function(a){this.innerControl.setShader(a),this.setContentDirty(!0)},d.prototype.setUniform=function(a,b,c){this.innerControl.setUniform(a,b,c),this.setContentDirty(!0)},b.exports=d},{"./docklayoutcontrol":170,"./image/imageinnercontrol":174}],176:[function(a,b,c){"use strict";function d(a,b){e.call(this,a),this.layout=b,this.children=[],this.padding={top:0,bottom:0,left:0,right:0},this.clip=!1,this.childAABB=f.create()}var e=a("./uicontrol"),f=a("../math/aabb");d.prototype=Object.create(e.prototype),d.prototype.constructor=d,d.prototype.setPaddingTop=function(a){this.padding.top=a,this.layouter.setNeedsRelayout(this),this.setContentDirty(!0)},d.prototype.setPaddingLeft=function(a){this.padding.left=a,this.layouter.setNeedsRelayout(this),this.setContentDirty(!0)},d.prototype.setPaddingRight=function(a){this.padding.right=a,this.layouter.setNeedsRelayout(this),this.setContentDirty(!0)},d.prototype.setPaddingBottom=function(a){this.padding.bottom=a,this.layouter.setNeedsRelayout(this),this.setContentDirty(!0)},d.prototype.addChild=function(a,b){void 0===b&&(b=this.children.length-1),this.children.splice(b,0,a),a.parent=this,this.layouter.setNeedsRelayout(this),this.layouter.setNeedsRelayout(a),a.setContentDirty(!0),a.localTransformDirty=!0},d.prototype.removeChild=function(a){var b=this.children.indexOf(a);-1!==b?this.children.splice(b,1):console.error("Node is not a child"),this.layouter.setNeedsRelayout(this),this.setContentDirty(!0)},d.prototype.setClip=function(a){this.clip=a,this.setContentDirty(!0)},d.prototype.getChildren=function(){return this.children},b.exports=d},{"../math/aabb":193,"./uicontrol":185}],177:[function(a,b,c){"use strict";function d(a,b){e.call(this,a),this.layout=f,this.setWidth(100),this.setHeight(100),this.renderCommand={type:"mesh",color:"#ffffff",blendMode:"alpha",mesh:null,shader:null,image:null,imagePath:null,srcRect:[0,0,1,1]},this.imageCache=b}var e=a("./uicontrol"),f={measure:function(a){return this.layoutSize(a,0,0)},layoutSize:function(a,b,c){return{width:"%"===a.widthUnit?b*(a.width/100):a.width,height:"%"===a.heightUnit?c*(a.height/100):a.height}}};d.prototype=Object.create(e.prototype),d.prototype.constructor=d,d.prototype.setImagePath=function(a){this.renderCommand.image=null,this.renderCommand.imagePath=null,this.path=a,this.imageWidth=0,this.imageHeight=0,this.setContentDirty(!0),null!==a&&this.imageCache.getImage(a,this._onImageLoaded.bind(this))},d.prototype._onImageLoaded=function(a){a._path===this.path&&(this.renderCommand.image=a,this.renderCommand.imagePath=this.path,this.setContentDirty(!0))},d.prototype.setColor=function(a){this.renderCommand.color=a,this.setContentDirty(!0)},d.prototype.setShader=function(a){this.renderCommand.shader=a,this.setContentDirty(!0)},d.prototype.setMesh=function(a){this.renderCommand.mesh=a,this.setContentDirty(!0)},d.prototype.setImageSourceRect=function(a){var b=this.renderCommand;b.srcRect||(b.srcRect=[0,0,1,1]),b.srcRect[0]=a[0],b.srcRect[1]=a[1],b.srcRect[2]=a[2],b.srcRect[3]=a[3]},d.prototype.dispose=function(){this.renderCommand.mesh&&this.renderCommand.mesh.dispose(),e.prototype.dispose.call(this)},b.exports=d},{"./uicontrol":185}],178:[function(a,b,c){"use strict";function d(a){e.call(this,a),this.layout=f,this.renderCommand={type:"rectangle",color:"#ffffff",blendMode:"solid",cornerRadius:0,blur:0}}var e=a("./uicontrol"),f={measure:function(a){return this.layoutSize(a,0,0)},layoutSize:function(a,b,c){return{width:"%"===a.widthUnit?b*(a.width/100):a.width,height:"%"===a.heightUnit?c*(a.height/100):a.height}}};d.prototype=Object.create(e.prototype),d.prototype.constructor=d,d.prototype.setColor=function(a){this.renderCommand.color=a,this.setContentDirty(!0)},d.prototype.setCornerRadius=function(a){this.renderCommand.cornerRadius=a,this.setContentDirty(!0)},d.prototype.setBlur=function(a){this.renderCommand.blur=a,this.setContentDirty(!0)},d.prototype.setBlendMode=function(a){this.renderCommand.blendMode=a,this.setContentDirty(!0)},d.prototype.setMaskType=function(a){this.renderCommand.maskType=a},b.exports=d},{"./uicontrol":185}],179:[function(a,b,c){"use strict";function d(a,b){e.call(this,a,f.static),this.itemSpacing=0,this.orientation="vertical",this.scrollOffset=0;var c=this;this.scroller=new g(b,{scrollThreshold:50,axis:1,scrollEndedAnimationDuration:300,bounceOnPositionEndedOverride:!1,scrollEndedPositionCallback:function(a,b){return c.scrollEndedPositionCallback(a,b)},scrollCallback:function(a){c.setScrollOffset(a)}}),this.contentLengthChanged=function(a){c.scroller.scrollObjectSize=a},this.on("layoutWidthChanged",this._updateScrollViewSize.bind(this)),this.on("layoutHeightChanged",this._updateScrollViewSize.bind(this))}var e=a("./layoutcontrol"),f=a("../layout/scrollviewlayout"),g=a("../touch/scroller");d.prototype=Object.create(e.prototype),d.prototype.constructor=d,d.prototype._updateScrollViewSize=function(){"horizontal"===this.orientation?this.scroller.scrollViewSize=this.layoutRect.width-this.padding.left-this.padding.right:"vertical"===this.orientation&&(this.scroller.scrollViewSize=this.layoutRect.height-this.padding.top-this.padding.bottom)},d.prototype.setPaddingTop=function(a){e.prototype.setPaddingTop.call(this,a),this._updateScrollViewSize()},d.prototype.setPaddingLeft=function(a){e.prototype.setPaddingLeft.call(this,a),this._updateScrollViewSize()},d.prototype.setPaddingRight=function(a){e.prototype.setPaddingRight.call(this,a),this._updateScrollViewSize()},d.prototype.setPaddingBottom=function(a){e.prototype.setPaddingBottom.call(this,a),this._updateScrollViewSize()},d.prototype.setItemSpacing=function(a){this.itemSpacing=a,this.layouter.setNeedsRelayout(this),this.setContentDirty(!0)},d.prototype.getItemSpacing=function(){return this.itemSpacing},d.prototype.setOrientation=function(a){this.orientation=a,this.scroller.setOrientation(a),this.layouter.setNeedsRelayout(this),this.setContentDirty(!0)},d.prototype.setScrollOffset=function(a){this.scrollOffset=a,this.layouter.setNeedsRelayout(this),this.setContentDirty(!0),this.emit("scrollOffsetChanged",a)},d.prototype.setOverscrollEnabled=function(a){this.scroller.shouldRubber=a},d.prototype.setScrollThreshold=function(a){this.scroller.scrollThreshold=a},d.prototype.setScrollDuration=function(a){this.scroller.scrollEndedAnimationDuration=a},d.prototype.getScrollObjectSize=function(){return this.scroller.scrollObjectSize},d.prototype.getScrollViewSize=function(){return this.scroller.scrollViewSize},b.exports=d},{"../layout/scrollviewlayout":191,"../touch/scroller":218,"./layoutcontrol":176}],180:[function(a,b,c){"use strict";function d(a){e.call(this,a,f.static),this.orientation="vertical",this.itemSpacing=0}var e=a("./layoutcontrol"),f=a("../layout/stacklayout");d.prototype=Object.create(e.prototype),d.prototype.constructor=d,d.prototype.setItemSpacing=function(a){this.itemSpacing=a,this.layouter.setNeedsRelayout(this),this.setContentDirty(!0)},d.prototype.setOrientation=function(a){this.orientation=a,this.layouter.setNeedsRelayout(this),this.setContentDirty(!0)},b.exports=d},{"../layout/stacklayout":192,"./layoutcontrol":176}],181:[function(a,b,c){"use strict";function d(a){e.call(this,a),this.layout=g,this.renderCommand={type:"text",fontFamily:"Helvetica",fontSize:40,color:"#ffffff",text:"",lineHeight:0,blendMode:"alpha"},this.text="",this.textWidth=0,this.textHeight=0,this.horizontalAlignment="left",this.maxWidth=0,this.lineHeight=0}var e=a("../uicontrol"),f=a("./textlayout"),g={measure:function(a){return this.layoutSize(a,0,0)},layoutSize:function(a,b,c){return a.contentDirty&&a.layoutText(),{width:a.textWidth,height:a.textHeight}}};d.prototype=Object.create(e.prototype),d.prototype.layoutText=function(){var a=f.layoutText(this.text,this.renderCommand.fontFamily,this.renderCommand.fontSize,this.horizontalAlignment,this.lineHeight,this.maxWidth);this.textWidth=a.width,this.textHeight=a.height,this.renderCommand.lines=a.lines,this.renderCommand.text=a.lines.map(function(a){return a.text}).join("\n"),this.setContentDirty(!0)},d.prototype.setFontFamily=function(a){this.renderCommand.fontFamily=a,this.layouter.setNeedsRelayout(this),this.setContentDirty(!0)},d.prototype.setFontSize=function(a){this.renderCommand.fontSize=a,this.layouter.setNeedsRelayout(this),this.setContentDirty(!0)},d.prototype.setLineHeight=function(a){this.lineHeight=a,this.renderCommand.lineHeight=a,this.layouter.setNeedsRelayout(this),this.setContentDirty(!0)},d.prototype.setText=function(a){a=String(a),this.text!==a&&(this.text=a,this.layouter.setNeedsRelayout(this),this.setContentDirty(!0))},d.prototype.getText=function(){return this.text},d.prototype.setColor=function(a){this.renderCommand.color=a,this.setContentDirty(!0)},d.prototype.setHorizontalAlignment=function(a){this.horizontalAlignment=a,this.renderCommand.horizontalAlignment=a,this.layouter.setNeedsRelayout(this)},d.prototype.setMaxWidth=function(a){this.maxWidth!==a&&(this.maxWidth=a,this.layouter.setNeedsRelayout(this))},d.prototype.setBlendMode=function(a){this.renderCommand.blendMode=a,this.setContentDirty(!0)},b.exports=d},{"../uicontrol":185,"./textlayout":182}],182:[function(a,b,c){"use strict";function d(a,b){var c=a+" - "+b;if(void 0===i[c]){var d=document.createElement("span");d.style.fontFamily=a,d.style.fontSize=b+"px",d.innerHTML="yÅq|";var e=document.createElement("div");e.style.display="inline-block",e.style.width="1px",e.style.height="0px";var f=document.createElement("div");f.style.display="inline-block",f.appendChild(d),f.appendChild(e),document.body.appendChild(f),e.style.verticalAlign="bottom";var g=e.offsetTop-d.offsetTop;e.style.verticalAlign="baseline";var h=e.offsetTop-d.offsetTop;document.body.removeChild(f);var j={height:g,baseline:h};i[c]=j}return i[c]}function e(a,b,c){k.font=c+'px "'+b+'"';var e=d(b,c);return{width:k.measureText(a).width,height:e.height,baseline:e.baseline}}function f(a,b){if(k.measureText(a).width<b)return[a];var c=a.split(" ").map(function(a){return a+" "});c[c.length-1]=c[c.length-1].slice(0,-1);for(var d=[],e="";c.length>0;){for(;c[0].length>1&&k.measureText(c[0]).width>=b;){var f=c[0];c[0]=f.slice(0,-1),c.length>1?c[1]=f.slice(-1)+c[1]:c.push(f.slice(-1))}0===e.length||k.measureText(e+c[0]).width<b?e+=c.shift():(d.push(e),e="",c.length&&" "===c[0][0]&&(c[0]=c[0].slice(1),0===c[0].length&&c.shift())),0===c.length&&d.push(e)}return d}function g(a,b,c){return"center"===a?(b-c)/2:"right"===a?b-c:0}function h(a,b,c,e,h,i){k.font=c+'px "'+b+'"';var j=[];0===i?j=a.split("\n"):a.split("\n").forEach(function(a){j=j.concat(f(a,i))});var l=0,m=[];j.forEach(function(a){var b=k.measureText(a).width;l=Math.max(l,b),m.push(b)});var n=d(b,c),o=h||n.height,p=n.height+(j.length-1)*o,q=[];return j.forEach(function(a,b){var c=m[b],d=g(e,l,c);q.push({text:a,x:d,y:n.baseline+b*o})}),{width:l,height:p,lines:q}}var i={},j=document.createElement("canvas"),k=j.getContext("2d");b.exports={measureText:e,layoutText:h}},{}],183:[function(a,b,c){"use strict";function d(a){e.call(this,a),this.innerControl=new f(a),this.addChild(this.innerControl)}var e=a("./docklayoutcontrol"),f=a("./text/textinnercontrol");d.prototype=Object.create(e.prototype),
d.prototype.constructor=d,d.prototype._onLayoutWidthChanged=function(a){e.prototype._onLayoutWidthChanged.call(this,a),"explicit"===this.sizeMode||"childHeight"===this.sizeMode?this.innerControl.setMaxWidth(a):this.innerControl.setMaxWidth(0)},d.prototype.setFontFamily=function(a){this.innerControl.setFontFamily(a)},d.prototype.setFontSize=function(a){this.innerControl.setFontSize(a)},d.prototype.setLineHeight=function(a){this.innerControl.setLineHeight(a)},d.prototype.setText=function(a){this.innerControl.setText(a)},d.prototype.getText=function(){return this.innerControl.getText()},d.prototype.setColor=function(a){this.innerControl.setColor(a)},d.prototype.setHorizontalAlignment=function(a){this.innerControl.setHorizontalAlignment(a),this.innerControl.setAlignX(a)},d.prototype.setVerticalAlignment=function(a){this.innerControl.setAlignY(a)},d.prototype.setBlendMode=function(a){this.innerControl.setBlendMode(a)},d.prototype.dispose=function(){this.innerControl.dispose(),e.prototype.dispose.call(this)},b.exports=d},{"./docklayoutcontrol":170,"./text/textinnercontrol":181}],184:[function(a,b,c){"use strict";function d(a){e.call(this,a),this.layout=h,this.contentWidth=0,this.contentHeight=0,this.renderCommand={type:"textInput",fontFamily:"Helvetica",fontSize:40,color:"#ffffff",focused:!1,text:"",blendMode:"alpha"},this.text="",this.type="text",this.clip=!0}var e=a("./uicontrol"),f=a("./text/textlayout"),g=a("../../useragent-utils"),h={measure:function(a){return this.layoutSize(a,0,0)},layoutSize:function(a,b,c){var d=0,e=0;return d="childSize"===a.sizeMode||"childWidth"===a.sizeMode?a.contentWidth:"%"===a.widthUnit?b*(a.width/100):a.width,e="childSize"===a.sizeMode||"childHeight"===a.sizeMode?a.contentHeight:"%"===a.heightUnit?c*(a.height/100):a.height,{width:d,height:e}}};d.prototype=Object.create(e.prototype),d.prototype.constructor=d,d.prototype.updateTextMetrics=function(){var a=f.measureText(this.renderCommand.text,this.renderCommand.fontFamily,this.renderCommand.fontSize);this.contentWidth=a.width,this.contentHeight=a.height,this.renderCommand.baseline=a.baseline,this.renderCommand.textWidth=a.width,this.renderCommand.textHeight=a.height,this.layouter.setNeedsRelayout(this)},d.prototype.setInputField=function(a){this.textInputField=a;var b=this;a.on("confirmed",function(){b.emit("confirmed")}),a.on("inputChanged",function(a){b.setText(a)},this),a.on("blur",this.blur.bind(this),this)},d.prototype.setFontFamily=function(a){this.renderCommand.fontFamily=a,this.updateTextMetrics(),this.setContentDirty(!0)},d.prototype.setFontSize=function(a){this.renderCommand.fontSize=a,this.updateTextMetrics(),this.setContentDirty(!0)},d.prototype.getRenderText=function(a){if("password"===this.type){a=(g.isMobile.iOS()?"●":"•").repeat(a.length)}return a},d.prototype.setText=function(a){this.renderCommand.text=this.getRenderText(a),this.updateTextMetrics(),this.setContentDirty(!0),this.text=a,this.emit("textChanged",a)},d.prototype.setColor=function(a){this.renderCommand.color=a,this.setContentDirty(!0)},d.prototype.getText=function(){return this.text},d.prototype.setHorizontalAlignment=function(a){},d.prototype.setVerticalAlignment=function(a){},d.prototype.focus=function(){!0!==this.renderCommand.focused&&(this.renderCommand.focused=!0,this.textInputField.focus(),this.setContentDirty(!0),this.emit("focused",this))},d.prototype.blur=function(){!1!==this.renderCommand.focused&&(this.renderCommand.focused=!1,this.textInputField.blur(),this.setContentDirty(!0),this.emit("blurred",this))},d.prototype.isFocused=function(){return this.renderCommand.focused},d.prototype.setInputType=function(a){this.type=a,this.textInputField.setType(a),this.renderCommand.text=this.getRenderText(this.text),this.updateTextMetrics(),this.setContentDirty(!0)},d.prototype.dispose=function(){e.prototype.dispose.call(this),this.textInputField&&(this.textInputField.removeListenersWithRef(this),this.textInputField.dispose())},d.prototype.setBlendMode=function(a){this.renderCommand.blendMode=a,this.setContentDirty(!0)},b.exports=d},{"../../useragent-utils":223,"./text/textlayout":182,"./uicontrol":185}],185:[function(a,b,c){"use strict";function d(a){f.call(this),this.id=g(),this.layouter=a,this.sizeMode="explicit",this.pivotUnitType=[],this.pivotFactors=[.5,.5],this.parent=null,this.renderOrdering=0,this.positionX=0,this.positionY=0,this.positionZ=0,this.alignX="left",this.alignY="top",this.pivotX=50,this.pivotY=50,this.pivotXUnit="%",this.pivotYUnit="%",this.pivotXPx=0,this.pivotYPx=0,this.pivotZPx=0,this.width=0,this.height=0,this.widthUnit="%",this.heightUnit="%",this.depth=void 0,this.opacity=1,this.visible=!0,this.scaleX=1,this.scaleY=1,this.rotationX=0,this.rotationY=0,this.rotationZ=0,this.blockTouch=!1,this.touchPropagation=!0,this.contentDirty=!0,this.highlightEnabled=!1,this.selectionEnabled=!1,this.layoutRect=new e({xChanged:this._onLayoutPositionChanged.bind(this),yChanged:this._onLayoutPositionChanged.bind(this),widthChanged:this._onLayoutWidthChanged.bind(this),heightChanged:this._onLayoutHeightChanged.bind(this)}),this.screenAABB=i.create(),this.transform=h.create(),this.localTransform=h.create(),this.localTransformDirty=!1}var e=a("./../layout/layoutrect"),f=a("../../eventsender"),g=a("../../guid"),h=a("../math/mat4"),i=a("../math/aabb");d.prototype=Object.create(f.prototype),d.prototype.constructor=d,d.prototype._onLayoutPositionChanged=function(){this.localTransformDirty=!0},d.prototype._onLayoutWidthChanged=function(a){this.emit("layoutWidthChanged",a),"%"===this.pivotXUnit&&this.setPivotX(this.pivotX)},d.prototype._onLayoutHeightChanged=function(a){this.emit("layoutHeightChanged",a),"%"===this.pivotYUnit&&this.setPivotY(this.pivotY)},d.prototype.setPositionX=function(a){this.positionX=a,this.layouter.setNeedsRelayout(this),this.setContentDirty(!0)},d.prototype.setPositionY=function(a){this.positionY=a,this.layouter.setNeedsRelayout(this),this.setContentDirty(!0)},d.prototype.setPositionZ=function(a){this.positionZ=a,this.localTransformDirty=!0,this.setContentDirty(!0)},d.prototype.setWidth=function(a){a===1/0&&(a=0),this.width=a,this.layouter.setNeedsRelayout(this),this.setContentDirty(!0)},d.prototype.setHeight=function(a){a===1/0&&(a=0),this.height=a,this.layouter.setNeedsRelayout(this),this.setContentDirty(!0)},d.prototype.setWidthUnit=function(a){this.widthUnit=a,this.layouter.setNeedsRelayout(this),this.setContentDirty(!0)},d.prototype.setHeightUnit=function(a){this.heightUnit=a,this.layouter.setNeedsRelayout(this),this.setContentDirty(!0)},d.prototype.setSizeMode=function(a){this.sizeMode=a,this.layouter.setNeedsRelayout(this),this.setContentDirty(!0)},d.prototype.setAlignX=function(a){this.alignX=a,this.layouter.setNeedsRelayout(this),this.setContentDirty(!0)},d.prototype.setAlignY=function(a){this.alignY=a,this.layouter.setNeedsRelayout(this),this.setContentDirty(!0)},d.prototype.setBlockTouch=function(a){this.blockTouch=a},d.prototype.setTouchPropagation=function(a){this.touchPropagation=a},d.prototype.setDepth=function(a){this.depth=a,this.setContentDirty(!0)},d.prototype.setOpacity=function(a){0===this.opacity&&a>0&&(this.localTransformDirty=!0),this.opacity=a,this.setContentDirty(!0)},d.prototype.setVisible=function(a){this.visible=a,this.localTransformDirty=!0,this.setContentDirty(!0)},d.prototype.setPivotX=function(a){this.pivotX=a;var b=a;if("%"===this.pivotXUnit){b=(void 0===this.layoutRect.width?0:this.layoutRect.width)*a*.01}this.pivotXPx!==b&&(this.pivotXPx=b,this.localTransformDirty=!0,this.setContentDirty(!0))},d.prototype.setPivotXUnit=function(a){this.pivotXUnit=a,this.setPivotX(this.pivotX),this.setContentDirty(!0)},d.prototype.setPivotY=function(a){this.pivotY=a;var b=a;if("%"===this.pivotYUnit){b=(void 0===this.layoutRect.height?0:this.layoutRect.height)*a*.01}this.pivotYPx!==b&&(this.pivotYPx=b,this.localTransformDirty=!0,this.setContentDirty(!0))},d.prototype.setPivotYUnit=function(a){this.pivotYUnit=a,this.setPivotY(this.pivotY),this.setContentDirty(!0)},d.prototype.setPivotZ=function(a){this.pivotZPx=a,this.localTransformDirty=!0,this.setContentDirty(!0)},d.prototype.setRotationX=function(a){this.rotationX=a,this.localTransformDirty=!0,this.setContentDirty(!0)},d.prototype.setRotationY=function(a){this.rotationY=a,this.localTransformDirty=!0,this.setContentDirty(!0)},d.prototype.setRotationZ=function(a){this.rotationZ=a,this.localTransformDirty=!0,this.setContentDirty(!0)},d.prototype.setScaleX=function(a){this.scaleX=a,this.localTransformDirty=!0,this.setContentDirty(!0)},d.prototype.setScaleY=function(a){this.scaleY=a,this.localTransformDirty=!0,this.setContentDirty(!0)},d.prototype.setContentDirty=function(a){this.contentDirty!==a&&(this.contentDirty=a,a&&this.parent&&this.parent.setContentDirty(!0))},d.prototype.setSelectionEnabled=function(a){this.selectionEnabled=a,this.setContentDirty(!0)},d.prototype.setHighlightEnabled=function(a){this.highlightEnabled=a,this.setContentDirty(!0)},d.prototype.getScreenX=function(){return this.screenAABB.min[0]},d.prototype.getScreenY=function(){return this.screenAABB.min[1]},d.prototype.dispose=function(){this.emit("disposed",this),this.removeAllListeners()},b.exports=d},{"../../eventsender":71,"../../guid":73,"../math/aabb":193,"../math/mat4":195,"./../layout/layoutrect":190}],186:[function(a,b,c){"use strict";function d(){this.cache={},this.crossOrigin=!1}d.prototype.setCrossOrigin=function(a){this.crossOrigin=!!a},d.prototype.getImage=function(a,b){var c=this.cache[a];if(c)return void(c.isLoaded?b(c.image):c.callbacks.push(b));this.cache[a]={image:new Image,callbacks:[],isLoaded:!1},c=this.cache[a],c.callbacks.push(b);var d=c.image;this.crossOrigin&&(d.crossOrigin="anonymous"),d.addEventListener("load",function(){c.callbacks.forEach(function(a){a(d)}),c.isLoaded=!0,delete c.callbacks}),d.src=a,d._path=a},d.prototype.clear=function(){this.cache={}},b.exports=d},{}],187:[function(a,b,c){"use strict";function d(){}d.prototype.layoutChildHorizontally=function(a,b,c,d,e){"left"===b.alignX?(a.x=b.positionX+e.left,a.width=c):"right"===b.alignX?(a.x=d.width-e.right+b.positionX-c,a.width=c):"center"===b.alignX&&(a.x=(d.width-e.right-e.left)/2+e.left+b.positionX-c/2,a.width=c),a.x=Math.round(a.x)},d.prototype.layoutChildVertically=function(a,b,c,d,e){"top"===b.alignY?(a.y=b.positionY+e.top,a.height=c):"bottom"===b.alignY?(a.y=d.height-e.bottom+b.positionY-c,a.height=c):"center"===b.alignY&&(a.y=(d.height-e.bottom-e.top)/2+e.top+b.positionY-c/2,a.height=c),a.y=Math.round(a.y)},d.prototype.setChildLayoutRect=function(a,b){var c=a.layoutRect.width!=b.width||a.layoutRect.height!=b.height;a.layoutRect.x=b.x,a.layoutRect.y=b.y,a.layoutRect.width=Math.max(b.width,0),a.layoutRect.height=Math.max(b.height,0),(c||a.needsRelayout)&&(a.layout.layout&&a.layout.layout(a),a.needsRelayout=!1)},d.prototype.layout=function(a){for(var b={x:0,y:0,width:0,height:0},c=0;c<a.children.length;c++){var d=a.children[c],e=a.layoutRect.width-a.padding.left-a.padding.right,f=a.layoutRect.height-a.padding.top-a.padding.bottom,g=d.layout.layoutSize(d,e,f);this.layoutChildHorizontally(b,d,g.width,a.layoutRect,a.padding),this.layoutChildVertically(b,d,g.height,a.layoutRect,a.padding),this.setChildLayoutRect(d,b)}},d.prototype.layoutSize=function(a,b,c){var d=this.measure(a,b,c);return{width:"childWidth"===a.sizeMode||"childSize"===a.sizeMode?d.width:this.layoutWidth(a,b),height:"childHeight"===a.sizeMode||"childSize"===a.sizeMode?d.height:this.layoutHeight(a,c)}},d.prototype.measureChildrenWidth=function(a,b){for(var c=0,d=0;d<a.children.length;d++){var e=a.children[d],f=e.layout.measure(e,b.width,b.height);c=Math.max(c,Math.max(e.positionX,0)+f.width)}return c},d.prototype.measureChildrenHeight=function(a,b){for(var c=0,d=0;d<a.children.length;d++){var e=a.children[d],f=e.layout.measure(e,b.width,b.height);c=Math.max(c,Math.max(e.positionY,0)+f.height)}return c},d.prototype.layoutWidth=function(a,b){return"%"===a.widthUnit?b*(a.width/100):a.width},d.prototype.layoutHeight=function(a,b){return"%"===a.heightUnit?b*(a.height/100):a.height},d.prototype.measure=function(a,b,c){if(a.measuredSize)return a.measuredSize;var d={width:"childWidth"===a.sizeMode||"childSize"===a.sizeMode?0:this.layoutWidth(a,b),height:"childHeight"===a.sizeMode||"childSize"===a.sizeMode?0:this.layoutHeight(a,c)},e={width:"childWidth"===a.sizeMode||"childSize"===a.sizeMode?this.measureChildrenWidth(a,d)+a.padding.left+a.padding.right:d.width,height:"childHeight"===a.sizeMode||"childSize"===a.sizeMode?this.measureChildrenHeight(a,d)+a.padding.top+a.padding.bottom:d.height};return a.measuredSize=e,e},d.static=new d,b.exports=d},{}],188:[function(a,b,c){"use strict";function d(){}var e=a("./docklayout");d.prototype=Object.create(e.prototype),d.prototype.measureChildrenHeightForHorizontalFlow=function(a,b){if("explict"===this.sizeMode||"childWidth"===this.sizeMode)return b.height;for(var c="childSize"===a.sizeMode?Number.MAX_VALUE:b.width-a.padding.left-a.padding.right,d=0,e=0,f=0,g=a.children.length,h=0;h<g;h++){var i=a.children[h],j=i.layout.measure(i,b.width,b.height);e+j.width>c&&(d+=f+a.verticalItemSpacing,f=e=0),f=Math.max(f,j.height+i.positionY),e+=j.width+a.horizontalItemSpacing}return d+=f},d.prototype.measureChildrenWidthForHorizontalFlow=function(a,b){if("explict"===this.sizeMode||"childHeight"===this.sizeMode)return b.width;for(var c=0,d=a.children.length,e=0;e<d;e++){var f=a.children[e];c+=f.layout.measure(f,b.width,b.height).width+(e!==d-1?a.horizontalItemSpacing:0)}return c},d.prototype.measureChildrenWidthForVerticalFlow=function(a,b){if("explict"===this.sizeMode||"childHeight"===this.sizeMode)return dim.width;for(var c="childSize"===a.sizeMode?Number.MAX_VALUE:b.height-a.padding.top-a.padding.left,d=0,e=0,f=0,g=a.children.length,h=0;h<g;h++){var i=a.children[h],j=i.layout.measure(i,b.width,b.height);d+j.height>c&&(e+=f+a.horizontalItemSpacing,f=d=0),f=Math.max(f,j.width+i.positionX),d+=j.height+a.verticalItemSpacing}return e+=f},d.prototype.measureChildrenHeightForVerticalFlow=function(a,b){if("explict"===this.sizeMode||"childWidth"===this.sizeMode)return b.height;for(var c=0,d=a.children.length,e=0;e<d;e++){var f=a.children[e];c+=f.layout.measure(f,b.width,b.height).height+(e!==d-1?a.verticalItemSpacing:0)}return c},d.prototype.measureChildrenWidth=function(a,b){return"horizontal"===a.orientation?this.measureChildrenWidthForHorizontalFlow(a,b):this.measureChildrenWidthForVerticalFlow(a,b)},d.prototype.measureChildrenHeight=function(a,b){return"horizontal"===a.orientation?this.measureChildrenHeightForHorizontalFlow(a,b):this.measureChildrenHeightForVerticalFlow(a,b)};var f=[];d.prototype.layout=function(a){function b(b,c,d,e,g){var h=0,i=a.layoutRect.width-a.padding.left-a.padding.right;"center"===a.contentAlignX?h=Math.round(.5*(i-g)):"right"===a.contentAlignX&&(h=i-g);for(var k=b;k<c;k++){var l=a.children[k],m=f[k],n=l.layout.layoutSize(l,0,e);j.layoutChildVertically(m,l,n.height,{height:e},{top:0,bottom:0,left:0,right:0}),m.x+=h,m.y+=d,j.setChildLayoutRect(l,m)}}function c(b,c,d,e,g){var h=0,i=a.layoutRect.height-a.padding.top-a.padding.bottom;"center"===a.contentAlignY?h=Math.round(.5*(i-g)):"bottom"===a.contentAlignY&&(h=i-g);for(var k=b;k<c;k++){var l=a.children[k],m=f[k],n=l.layout.layoutSize(l,e,0);j.layoutChildHorizontally(m,l,n.width,{width:e},{top:0,bottom:0,left:0,right:0}),m.x+=d,m.y+=h,j.setChildLayoutRect(l,m)}}var d,e,g,h,i,j=this,k=0,l=0,m=0,n=0,o=0,p=a.children.length;if(f.length<p)for(e=0;e<p;e++)f[e]={x:0,y:0,width:0,height:0};if("horizontal"===a.orientation){var q=a.layoutRect.width-a.padding.left-a.padding.right;d=q;var n=0;for(e=0;e<p;e++)i=f[e],g=a.children[e],h=g.layout.layoutSize(g,q,0),k+h.width>d&&(b(o,e,l+a.padding.top,m,k-a.horizontalItemSpacing),l+=m+a.verticalItemSpacing,o=e,m=0,n=0,k=0),m=Math.round(Math.max(m,h.height)),i.x=k+a.padding.left+g.positionX,i.width=h.width,k+=Math.round(h.width)+a.horizontalItemSpacing;b(o,e,l+a.padding.top,m,k-a.horizontalItemSpacing)}else{var r=a.layoutRect.height-a.padding.top-a.padding.bottom;for(d=r,e=0;e<p;e++)i=f[e],g=a.children[e],h=g.layout.layoutSize(g,0,r),l+h.height>d&&(c(o,e,k+a.padding.left,n,l-a.verticalItemSpacing),k+=n+a.horizontalItemSpacing,o=e,n=0,l=0),n=Math.round(Math.max(n,h.width)),i.y=l+a.padding.top+g.positionY,i.height=h.height,l+=Math.round(h.height)+a.verticalItemSpacing;c(o,e,k+a.padding.left,n,l-a.verticalItemSpacing)}},d.static=new d,b.exports=d},{"./docklayout":187}],189:[function(a,b,c){"use strict";function d(){}var e=a("./docklayout");d.prototype.setWindowSize=function(a,b){this.windowSize={width:a,height:b}},d.prototype.layout=function(a){var b={layoutRect:{x:0,y:0,width:this.windowSize.width,height:this.windowSize.height},padding:{top:0,left:0,bottom:0,right:0},children:[a]};e.static.layout(b),a.needsRelayout=!1},d.prototype.setNeedsFullRelayout=function(a){function b(a){if(a.measuredSize=void 0,a.needsRelayout=!0,a.children)for(var c=0;c<a.children.length;c++)b(a.children[c])}b(a)},d.prototype.setNeedsRelayout=function(a){a.needsRelayout||(a.measuredSize=void 0,a.needsRelayout=!0,a.parent&&this.setNeedsRelayout(a.parent))},d.prototype.relayout=function(a){this.setNeedsFullRelayout(a),this.layout(a)},b.exports=d},{"./docklayout":187}],190:[function(a,b,c){var d=function(a){this._x=this._y=this._width=this._height=void 0,this.callbacks=a};Object.defineProperties(d.prototype,{x:{set:function(a){this._x!==a&&(this._x=a,this.callbacks.xChanged(a))},get:function(){return this._x}},y:{set:function(a){this._y!==a&&(this._y=a,this.callbacks.yChanged(a))},get:function(){return this._y}},width:{set:function(a){this._width!==a&&(this._width=a,this.callbacks.widthChanged(a))},get:function(){return this._width}},height:{set:function(a){this._height!==a&&(this._height=a,this.callbacks.heightChanged(a))},get:function(){return this._height}}}),b.exports=d},{}],191:[function(a,b,c){"use strict";function d(){}var e=a("./stacklayout");d.prototype=Object.create(e.prototype),d.prototype.layout=function(a){var b,c,d,e=a.children.length,f={x:0,y:0,width:0,height:0},g=a.layoutRect.height-a.padding.top-a.padding.bottom,h=a.layoutRect.width-a.padding.left-a.padding.right;if("horizontal"===a.orientation){var i=a.padding.left;for(d=0;d<e;d++)b=a.children[d],c=b.layout.layoutSize(b,h,g),f.x=Math.round(i+a.scrollOffset+b.positionX),f.width=Math.round(c.width),this.layoutChildVertically(f,b,c.height,a.layoutRect,a.padding),this.setChildLayoutRect(b,f),i+=a.itemSpacing+b.layoutRect.width;a.contentLengthChanged&&a.contentLengthChanged(i-(d>0?a.itemSpacing:0)-a.padding.left)}else{var j=a.padding.top;for(d=0;d<e;d++)b=a.children[d],c=b.layout.layoutSize(b,h,g),this.layoutChildHorizontally(f,b,c.width,a.layoutRect,a.padding),f.y=Math.round(j+a.scrollOffset+b.positionY),f.height=Math.round(c.height),this.setChildLayoutRect(b,f),j+=a.itemSpacing+b.layoutRect.height;a.contentLengthChanged&&a.contentLengthChanged(j-(d>0?a.itemSpacing:0)-a.padding.top)}},d.static=new d,b.exports=d},{"./stacklayout":192}],192:[function(a,b,c){"use strict";function d(){}var e=a("./docklayout");d.prototype=Object.create(e.prototype),d.prototype.layout=function(a){var b,c,d,e=0,f=0,g=0,h={x:0,y:0,width:0,height:0},i=a.layoutRect.width-a.padding.left-a.padding.right,j=a.layoutRect.height-a.padding.top-a.padding.bottom;if("horizontal"===a.orientation){for(c=a.children.length,d=0;d<c;d++)if(b=a.children[d],"%"!==b.widthUnit||"explicit"!==b.sizeMode&&"childHeight"!==b.sizeMode){var k=b.layout.measure(b,i,j);e+=k.width}else g+=b.width/100;f=Math.max(0,a.layoutRect.width-a.padding.left-a.padding.right-e-a.itemSpacing*(c-1))/g;var l=Math.round(a.padding.left);for(d=0;d<c;d++){b=a.children[d];var m=a.layoutRect.height-a.padding.top-a.padding.bottom;k=b.layout.layoutSize(b,f,m),h.x=l+b.positionX,h.width=Math.round(k.width),this.layoutChildVertically(h,b,k.height,a.layoutRect,a.padding),this.setChildLayoutRect(b,h),l+=a.itemSpacing+b.layoutRect.width}}else{for(c=a.children.length,d=0;d<c;d++)b=a.children[d],"%"!==b.heightUnit||"explicit"!==b.sizeMode&&"childWidth"!==b.sizeMode?(k=b.layout.measure(b,i,j),e+=k.height):g+=b.height/100;f=Math.max(0,a.layoutRect.height-a.padding.top-a.padding.bottom-e-a.itemSpacing*(c-1))/g;var n=Math.round(a.padding.top);for(d=0;d<c;d++){b=a.children[d];var o=a.layoutRect.width-a.padding.left-a.padding.right;k=b.layout.layoutSize(b,o,f),this.layoutChildHorizontally(h,b,k.width,a.layoutRect,a.padding),h.y=n+b.positionY,h.height=Math.round(k.height),this.setChildLayoutRect(b,h),n+=a.itemSpacing+b.layoutRect.height}}a.needsRelayout=!1},d.prototype.measureChildrenWidth=function(a,b){if("horizontal"===a.orientation){for(var c=0,d=a.children.length,f=0;f<d;f++){var g=a.children[f];c+=g.layout.measure(g,b.width,b.height).width+(f!==d-1?a.itemSpacing:0)}return c}return e.prototype.measureChildrenWidth.call(this,a,b)},d.prototype.measureChildrenHeight=function(a,b){if("vertical"===a.orientation){for(var c=0,d=a.children.length,f=0;f<d;f++){var g=a.children[f];c+=g.layout.measure(g,b.width,b.height).height+(f!==d-1?a.itemSpacing:0)}return c}return e.prototype.measureChildrenHeight.call(this,a,b)},d.static=new d,b.exports=d},{"./docklayout":187}],193:[function(a,b,c){"use strict";var d=a("./mat3"),e=a("./mat4"),f=[[0,0,0],[0,0,0],[0,0,0],[0,0,0]],g={};g.create=function(){return{min:[0,0],max:[0,0]}},g.createFrom=function(a,b,c,d){return{min:[a||0,b||0],max:[c||0,d||0]}},g.set=function(a,b,c,d,e){a.min[0]=b,a.min[1]=c,a.max[0]=d,a.max[1]=e},g.transform3=function(a,b){f[0][0]=a.min[0],f[0][1]=a.min[1],f[1][0]=a.min[0],f[1][1]=a.max[1],f[2][0]=a.max[0],f[2][1]=a.min[1],f[3][0]=a.max[0],f[3][1]=a.max[1],d.transformPoint(b,f[0]),a.min[0]=a.max[0]=f[0][0],a.min[1]=a.max[1]=f[0][1];for(var c=1;c<4;++c){var e=f[c];d.transformPoint(b,e),e[0]<a.min[0]&&(a.min[0]=e[0]),e[1]<a.min[1]&&(a.min[1]=e[1]),e[0]>a.max[0]&&(a.max[0]=e[0]),e[1]>a.max[1]&&(a.max[1]=e[1])}},g.transform4=function(a,b){f[0][0]=a.min[0],f[0][1]=a.min[1],f[1][0]=a.min[0],f[1][1]=a.max[1],f[2][0]=a.max[0],f[2][1]=a.min[1],f[3][0]=a.max[0],f[3][1]=a.max[1],e.transformPoint(b,f[0]),a.min[0]=a.max[0]=f[0][0],a.min[1]=a.max[1]=f[0][1];for(var c=1;c<4;++c){var d=f[c];e.transformPoint(b,d),d[0]<a.min[0]&&(a.min[0]=d[0]),d[1]<a.min[1]&&(a.min[1]=d[1]),d[0]>a.max[0]&&(a.max[0]=d[0]),d[1]>a.max[1]&&(a.max[1]=d[1])}},g.copy=function(a,b){a.min[0]=b.min[0],a.min[1]=b.min[1],a.max[0]=b.max[0],a.max[1]=b.max[1]},g.intersects=function(a,b){return!(a.min[0]>=b.max[0]||a.max[0]<=b.min[0]||a.min[1]>=b.max[1]||a.max[1]<=b.min[1])},g.union=function(a,b){b.min[0]<a.min[0]&&(a.min[0]=b.min[0]),b.min[1]<a.min[1]&&(a.min[1]=b.min[1]),b.max[0]>a.max[0]&&(a.max[0]=b.max[0]),b.max[1]>a.max[1]&&(a.max[1]=b.max[1])},g.width=function(a){return a.max[0]-a.min[0]},g.height=function(a){return a.max[1]-a.min[1]},g.isPointInside=function(a,b){return b[0]>=a.min[0]&&b[0]<=a.max[0]&&b[1]>=a.min[1]&&b[1]<=a.max[1]},g.intersection=function(a,b){a.min[0]=Math.max(a.min[0],b.min[0]),a.min[1]=Math.max(a.min[1],b.min[1]),a.max[0]=Math.min(a.max[0],b.max[0]),a.max[1]=Math.min(a.max[1],b.max[1])},b.exports=g},{"./mat3":194,"./mat4":195}],194:[function(b,c,d){"use strict";var e={};e.create=function(){var a=new Array(9);return e.identity(a),a},e.identity=function(a){return a[0]=1,a[1]=0,a[2]=0,a[3]=0,a[4]=1,a[5]=0,a[6]=0,a[7]=0,a[8]=1,a},e.copy=function(a,b){for(var c=0;c<9;c++)a[c]=b[c];return a},e.multiply=function(a,b,c){var d=b[0],e=b[1],f=b[2],g=b[3],h=b[4],i=b[5],j=b[6],k=b[7],l=b[8],m=c[0],n=c[1],o=c[2],p=c[3],q=c[4],r=c[5],s=c[6],t=c[7],u=c[8];return a[0]=m*d+n*g+o*j,a[1]=m*e+n*h+o*k,a[2]=m*f+n*i+o*l,a[3]=p*d+q*g+r*j,a[4]=p*e+q*h+r*k,a[5]=p*f+q*i+r*l,a[6]=s*d+t*g+u*j,a[7]=s*e+t*h+u*k,a[8]=s*f+t*i+u*l,a},e.translate=function(a,b,c){return a[6]=b*a[0]+c*a[3]+a[6],a[7]=b*a[1]+c*a[4]+a[7],a[8]=b*a[2]+c*a[5]+a[8],a},e.rotate=function(a,b){var c=a[0],d=a[1],e=a[2],f=a[3],g=a[4],h=a[5],i=a[6],j=a[7],k=a[8],l=Math.sin(b),m=Math.cos(b);return a[0]=m*c+l*f,a[1]=m*d+l*g,a[2]=m*e+l*h,a[3]=m*f-l*c,a[4]=m*g-l*d,a[5]=m*h-l*e,a[6]=i,a[7]=j,a[8]=k,a},e.scale=function(b,c,d){return b[0]=c*a[0],b[1]=c*a[1],b[2]=c*a[2],b[3]=d*a[3],b[4]=d*a[4],b[5]=d*a[5],b[6]=a[6],b[7]=a[7],b[8]=a[8],b},e.transformPoint=function(a,b){var c=b[0],d=b[1];b[0]=a[0]*c+a[3]*d+a[6],b[1]=a[1]*c+a[4]*d+a[7]},e.invert=function(a){var b=a[0],c=a[1],d=a[2],e=a[3],f=a[4],g=a[5],h=a[6],i=a[7],j=a[8],k=j*f-g*i,l=-j*e+g*h,m=i*e-f*h,n=b*k+c*l+d*m;return n?(n=1/n,a[0]=k*n,a[1]=(-j*c+d*i)*n,a[2]=(g*c-d*f)*n,a[3]=l*n,a[4]=(j*b-d*h)*n,a[5]=(-g*b+d*e)*n,a[6]=m*n,a[7]=(-i*b+c*h)*n,a[8]=(f*b-c*e)*n,a):null},c.exports=e},{}],195:[function(b,c,d){"use strict";var e={};e.create=function(){var a=new Array(16);return e.identity(a),a},e.identity=function(a){return a[0]=1,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=1,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=1,a[11]=0,a[12]=0,a[13]=0,a[14]=0,a[15]=1,a},e.identityMatrix=e.create(),e.copy=function(a,b){for(var c=0;c<16;c++)a[c]=b[c];return a},e.multiply=function(a,b,c){var d=b[0],e=b[1],f=b[2],g=b[3],h=b[4],i=b[5],j=b[6],k=b[7],l=b[8],m=b[9],n=b[10],o=b[11],p=b[12],q=b[13],r=b[14],s=b[15],t=c[0],u=c[1],v=c[2],w=c[3];return a[0]=t*d+u*h+v*l+w*p,a[1]=t*e+u*i+v*m+w*q,a[2]=t*f+u*j+v*n+w*r,a[3]=t*g+u*k+v*o+w*s,t=c[4],u=c[5],v=c[6],w=c[7],a[4]=t*d+u*h+v*l+w*p,a[5]=t*e+u*i+v*m+w*q,a[6]=t*f+u*j+v*n+w*r,a[7]=t*g+u*k+v*o+w*s,t=c[8],u=c[9],v=c[10],w=c[11],a[8]=t*d+u*h+v*l+w*p,a[9]=t*e+u*i+v*m+w*q,a[10]=t*f+u*j+v*n+w*r,a[11]=t*g+u*k+v*o+w*s,t=c[12],u=c[13],v=c[14],w=c[15],a[12]=t*d+u*h+v*l+w*p,a[13]=t*e+u*i+v*m+w*q,a[14]=t*f+u*j+v*n+w*r,a[15]=t*g+u*k+v*o+w*s,a},e.translate=function(a,b,c,d){return a[12]=a[0]*b+a[4]*c+a[8]*d+a[12],a[13]=a[1]*b+a[5]*c+a[9]*d+a[13],a[14]=a[2]*b+a[6]*c+a[10]*d+a[14],a[15]=a[3]*b+a[7]*c+a[11]*d+a[15],a},e.rotateX=function(a,b){var c=Math.sin(b),d=Math.cos(b),e=a[4],f=a[5],g=a[6],h=a[7],i=a[8],j=a[9],k=a[10],l=a[11];return a[4]=e*d+i*c,a[5]=f*d+j*c,a[6]=g*d+k*c,a[7]=h*d+l*c,a[8]=i*d-e*c,a[9]=j*d-f*c,a[10]=k*d-g*c,a[11]=l*d-h*c,a},e.rotateY=function(a,b){var c=Math.sin(b),d=Math.cos(b),e=a[0],f=a[1],g=a[2],h=a[3],i=a[8],j=a[9],k=a[10],l=a[11];return a[0]=e*d-i*c,a[1]=f*d-j*c,a[2]=g*d-k*c,a[3]=h*d-l*c,a[8]=e*c+i*d,a[9]=f*c+j*d,a[10]=g*c+k*d,a[11]=h*c+l*d,a},e.rotateZ=function(a,b){var c=Math.sin(b),d=Math.cos(b),e=a[0],f=a[1],g=a[2],h=a[3],i=a[4],j=a[5],k=a[6],l=a[7];return a[0]=e*d+i*c,a[1]=f*d+j*c,a[2]=g*d+k*c,a[3]=h*d+l*c,a[4]=i*d-e*c,a[5]=j*d-f*c,a[6]=k*d-g*c,a[7]=l*d-h*c,a},e.scale=function(b,c,d,e){return b[0]=a[0]*c,b[1]=a[1]*c,b[2]=a[2]*c,b[3]=a[3]*c,b[4]=a[4]*d,b[5]=a[5]*d,b[6]=a[6]*d,b[7]=a[7]*d,b[8]=a[8]*e,b[9]=a[9]*e,b[10]=a[10]*e,b[11]=a[11]*e,b[12]=a[12],b[13]=a[13],b[14]=a[14],b[15]=a[15],b},e.transformPoint=function(a,b){var c=b[0],d=b[1],e=b[2],f=a[3]*c+a[7]*d+a[11]*e+a[15];f=f||1,b[0]=(a[0]*c+a[4]*d+a[8]*e+a[12])/f,b[1]=(a[1]*c+a[5]*d+a[9]*e+a[13])/f,b[2]=(a[2]*c+a[6]*d+a[10]*e+a[14])/f},e.invert=function(a){var b=a[0],c=a[1],d=a[2],e=a[3],f=a[4],g=a[5],h=a[6],i=a[7],j=a[8],k=a[9],l=a[10],m=a[11],n=a[12],o=a[13],p=a[14],q=a[15],r=b*g-c*f,s=b*h-d*f,t=b*i-e*f,u=c*h-d*g,v=c*i-e*g,w=d*i-e*h,x=j*o-k*n,y=j*p-l*n,z=j*q-m*n,A=k*p-l*o,B=k*q-m*o,C=l*q-m*p,D=r*C-s*B+t*A+u*z-v*y+w*x;if(!D)return null;D=1/D,a[0]=(g*C-h*B+i*A)*D,a[1]=(d*B-c*C-e*A)*D,a[2]=(o*w-p*v+q*u)*D,a[3]=(l*v-k*w-m*u)*D,a[4]=(h*z-f*C-i*y)*D,a[5]=(b*C-d*z+e*y)*D,a[6]=(p*t-n*w-q*s)*D,a[7]=(j*w-l*t+m*s)*D,a[8]=(f*B-g*z+i*x)*D,a[9]=(c*z-b*B-e*x)*D,a[10]=(n*v-o*t+q*r)*D,a[11]=(k*t-j*v-m*r)*D,a[12]=(g*y-f*A-h*x)*D,a[13]=(b*A-c*y+d*x)*D,a[14]=(o*s-n*u-p*r)*D,a[15]=(j*u-k*s+l*r)*D},e.perspective=function(a,b,c,d,e){var f=1/Math.tan(b/2),g=1/(d-e);return a[0]=f/c,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=f,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=(e+d)*g,a[11]=-1,a[12]=0,a[13]=0,a[14]=2*e*d*g,a[15]=0,a},c.exports=e},{}],196:[function(a,b,c){"use strict";function d(a){h.call(this),this.rendererType=d.TypeWebGL,this.domCache=new n,this.rootElement=document.createElement("div"),this.rootElement.style.position="absolute",this.rootElement.style.display="block",this.rootElement.style.perspective="1000px",this.rootElement.style.webkitPerspective="1000px",a.appendChild(this.rootElement),this.clipAABB=g.create(),this.rootRendererTransparent=!1,this.renderersToDetach=[],this.clipToViewport=!0,this.renderers=[],this.cachedRenderers=[],this.renderDepthSet={},this._resizeRootElement();var b=this;i.isMobile.Android()&&window.addEventListener("orientationchange",function(){window.setTimeout(b._resizeRootElement.bind(b),100)})}function e(a,b){return a-b}var f=a("./math/mat4"),g=a("./math/aabb"),h=a("../eventsender"),i=a("../useragent-utils"),j=a("lodash"),k=a("./renderers/renderer-dom"),l=a("./renderers/renderer-webgl"),m=a("./renderers/renderer-canvas2d"),n=a("./renderers/dom/domcache");d.TypeWebGL=1,d.TypeCanvas=2,d.TypeDOM=3,d.prototype=Object.create(h.prototype),d.prototype.constructor=d,d.prototype._resizeRootElement=function(){i.isMobile.Android()?(this.rootElement.style.width=window.innerWidth+"px",this.rootElement.style.height=window.innerHeight+"px"):(this.rootElement.style.width="100%",this.rootElement.style.height="100%"),this.renderers.concat(this.cachedRenderers).forEach(function(a){a.resizeRootElement&&a.resizeRootElement()}),this.emit("requestFrame")},d.prototype.setClipToViewport=function(a){this.clipToViewport=a},d.prototype.setRendererType=function(a,b){this.removeAllRenderers(),this.rendererType=a,this.rootRendererTransparent=b,this.renderers.unshift(this.createRendererForType("noodl",!1,!0))},d.prototype.removeAllRenderers=function(){this.renderers.concat(this.cachedRenderers).forEach(function(a){a.detach&&a.detach(),a.onShaderError&&delete a.onShaderError}),this.textInputRenderer=null,this.renderers=[],this.cachedRenderers=[]},d.prototype.configureRenderer=function(a,b){b||!this.textInputRenderer?a.attach&&a.attach(this.rootElement):a.attach&&a.attach(this.rootElement,this.textInputRenderer.rootElement),a.setViewportSize&&a.setViewportSize(this.viewportWidth,this.viewportHeight)},d.prototype.beginLayout=function(){this.renderDepthSet={}},d.prototype.layout=function(a,b){if(a.visible&&0!==a.opacity){a.contentDirty=!1;var c=a.layoutRect,d=a.localTransform,e=b||a.localTransformDirty;if(a.localTransformDirty&&(f.identity(d),d[0]=a.scaleX,d[5]=a.scaleY,d[12]=c.x+a.pivotXPx,d[13]=c.y+a.pivotYPx,d[14]=a.positionZ+a.pivotZPx,a.rotationX&&f.rotateX(d,a.rotationX),a.rotationY&&f.rotateY(d,a.rotationY),a.rotationZ&&f.rotateZ(d,a.rotationZ),f.translate(d,-a.pivotXPx,-a.pivotYPx,-a.pivotZPx),a.localTransformDirty=!1),e){f.multiply(a.transform,a.parent.transform,d);var h=a.screenAABB.min[0],i=a.screenAABB.min[1];g.set(a.screenAABB,0,0,c.width,c.height),g.transform4(a.screenAABB,a.transform),h!==a.screenAABB.min[0]&&a.emit("screenXChanged",a.screenAABB.min[0]),i!==a.screenAABB.min[1]&&a.emit("screenYChanged",a.screenAABB.min[1])}if(a.renderDepth=void 0!==a.depth?a.depth:a.parent.renderDepth||0,this.renderDepthSet[a.renderDepth]=!0,a.children){g.copy(a.childAABB,a.screenAABB);for(var j=0,k=a.children.length;j<k;j++){var l=a.children[j];this.layout(l,e),a.clip||g.union(a.childAABB,l.childAABB||l.screenAABB)}}}},d.prototype._addRenderCommand=function(a,b,c){if(void 0!==c)a[c].push(b);else for(var d=0;d<this.renderDepths.length;d++)a[this.renderDepths[d]].push(b)},d.prototype._collectRenderCommandsRecursive=function(a,b,c,d,e){if(a.visible&&0!==a.opacity&&!1!==g.intersects(this.clipAABB,a.childAABB||a.screenAABB)){var h=!1;if(a.renderToFramebuffer&&(h=!0,this._addRenderCommand(b,{content:{type:"pushFrameBuffer"},id:a.id,frameBufferSettings:a.frameBufferSettings},a.renderDepth)),a.clip){this._addRenderCommand(b,{content:{type:"pushClipRect"},id:a.id+"clip",transform:a.transform,width:a.layoutRect.width,height:a.layoutRect.height});var i=g.create();g.copy(i,this.clipAABB),g.intersection(this.clipAABB,a.screenAABB)}var k=a.renderCommand;if(k&&!a.renderToFramebuffer&&("image"!==k.type||k.image||k.imageTextureControlId)&&(k.opacity=a.opacity*d,this._addRenderCommand(b,{content:k,id:a.id,transform:a.transform,
width:a.layoutRect.width,height:a.layoutRect.height},a.renderDepth)),k&&k.maskType&&"none"!==k.maskType){var l=j.clone(k);l.maskType="positive"===k.maskType?"negative":"positive",c.push({content:l,id:a.id+"-undoMask",transform:a.transform,width:a.layoutRect.width,height:a.layoutRect.height})}if(a.renderToFramebuffer&&!a.frameBufferSettings.renderAfterPop&&(e=.1),a.children){for(var m=[],n=0,o=a.children.length;n<o;n++)this._collectRenderCommandsRecursive(a.children[n],b,m,h?1:a.opacity*d,e);for(var n=0,o=m.length;n<o;n++)this._addRenderCommand(b,m[n],a.renderDepth)}if(a.highlightEnabled||a.selectionEnabled){var p=this,q=function(c,d,f,g,h){h=h||0,g=g||"#30C2FF",p._addRenderCommand(b,{id:a.id+"-hl",content:{type:"rectangle",color:g,opacity:e,cornerRadius:h,blur:0},transform:c,width:d,height:f},a.renderDepth)},r=2,s=8,t=Math.max(0,r-a.screenAABB.min[0]),u=Math.max(0,r+a.screenAABB.max[0]-this.viewportWidth),v=Math.max(0,r-a.screenAABB.min[1]),w=Math.max(0,r+a.screenAABB.max[1]-this.viewportHeight),x=f.create();f.copy(x,a.transform),f.translate(x,-r+t,-r+v,0),q(x,r,a.layoutRect.height+2*r),q(x,a.layoutRect.width+2*r,r);var y=f.create();f.copy(y,a.transform),f.translate(y,a.layoutRect.width-u,-r,0),q(y,r,a.layoutRect.height+2*r);var z=f.create();if(f.copy(z,a.transform),f.translate(z,-r,a.layoutRect.height-w,0),q(z,a.layoutRect.width+2*r,r),a.selectionEnabled){var A=f.create();f.copy(A,a.transform),f.translate(A,-s/2-r/2,-s/2-r/2,0),q(A,s,s,"#3f81b0",4);var B=f.create();f.copy(B,y),f.translate(B,-s/2+r/2,-s/2+r/2,0),q(B,s,s,"#3f81b0",4);var C=f.create();f.copy(C,B),f.translate(C,0,a.layoutRect.height+r,0),q(C,s,s,"#3f81b0",4);var D=f.create();f.copy(D,A),f.translate(D,0,a.layoutRect.height+r,0),q(D,s,s,"#3f81b0",4)}}if(a.clip){for(var n=0;n<this.renderDepths.length;n++){var E=b[this.renderDepths[n]];"pushClipRect"===E[E.length-1].content.type?E.length=E.length-1:E.push({content:{type:"popClipRect"}})}g.copy(this.clipAABB,i)}a.renderToFramebuffer&&this._addRenderCommand(b,{content:{type:"popFrameBuffer",transform:a.transform,opacity:a.opacity*d,shaderSource:a.shaderSource,shaderUniforms:a.shaderUniforms,secondaryShaderSource:a.secondaryShaderSource,secondaryShaderUniforms:a.secondaryShaderUniforms},frameBufferSettings:a.frameBufferSettings,width:this.viewportWidth,height:this.viewportHeight,clipWidth:a.layoutRect.width,clipHeight:a.layoutRect.height,id:a.id,transform:f.identityMatrix},a.renderDepth)}},d.prototype._collectRenderCommands=function(a){var b={};this.renderDepths=Object.keys(this.renderDepthSet);for(var c=0;c<this.renderDepths.length;c++)b[this.renderDepths[c]]=[];return this._collectRenderCommandsRecursive(a,b,[],1,1),b},d.prototype.createRendererForType=function(a,b,c){var e=null;if(a&&"html"===a)e=new k(!0,this.domCache),e.setRenderHTMLOnly(!0);else{var f=i.isMobile.any();if(this.rendererType===d.TypeWebGL){e=new l({alpha:!c||this.rootRendererTransparent});var g=this;e.onShaderError=function(a,b,c){g.emit("shaderError",{id:a,error:b,type:c})}}else this.rendererType===d.TypeCanvas?e=new m({alpha:!c||this.rootRendererTransparent,useScreenResolution:f}):this.rendererType===d.TypeDOM?e=new k(!0,this.domCache):"function"==typeof this.rendererType&&(e=this.rendererType(0===this.renderers.length,this.domCache))}return this.configureRenderer(e,b),e},d.prototype.render=function(a){for(var b=0;b<this.renderersToDetach.length;b++){var c=this.renderersToDetach[b];c.detach&&c.detach()}this.renderersToDetach=[];var d=this._collectRenderCommands(a),f=Object.keys(d).sort(e),g={};this.textInputRenderer||(this.textInputRenderer=new k(!0,this.domCache),this.textInputRenderer.setRenderInputFieldsOnly(!0),this.configureRenderer(this.textInputRenderer,!0));for(var h=this.textInputRenderer,i=this.renderers.filter(function(a){return a!==h}),j=[],l=null,m=0,b=0;b<f.length;b++)for(var n=d[f[b]],o=0;o<n.length;o++){var p=n[o],q=p.content.type,r="html"===q?"html":"noodl",s="pushClipRect"===q||"popClipRect"===q;"pushFrameBuffer"===q?m++:"popFrameBuffer"===q&&m--,"html"===r&&m>0||(l||(l={type:r,commands:[],clipCommands:[]}),"html"===q&&(g[p.id]=!0),s?(l.commands.push(p),l.clipCommands.push(p)):r!==l.type?(j.push(l),l={type:r,commands:[p],clipCommands:[]}):l.commands.push(p))}null!==l&&j.push(l);for(var t=!1,b=0;b<j.length;b++){var u=j[b];if(b>=i.length||!i[b].supportsRenderType(u.type,b)){if(t=!0,b<i.length){var v=i[b];this.renderersToDetach.push(v),this.cachedRenderers.push(v)}for(var w=null,o=0;o<this.cachedRenderers.length;o++)if(this.cachedRenderers[o].supportsRenderType(u.type,b)){w=this.cachedRenderers[o],this.cachedRenderers.splice(o,1);var x=this.renderersToDetach.indexOf(w);-1!==x&&this.renderersToDetach.splice(x,1),w.rootElement.style.visibility="hidden",w.attach&&w.attach(this.rootElement,this.textInputRenderer.rootElement);break}i[b]=w||this.createRendererForType(u.type,!1,0===b)}u.renderer=i[b]}if(t=t||j.length>i.length)return this.emit("requestFrame"),i.push(this.textInputRenderer),void(this.renderers=i);for(var y=[],z=[],b=0;b<j.length;b++){var u=j[b];"hidden"===u.renderer.rootElement.style.visibility&&(u.renderer.rootElement.style.visibility="visible"),u.renderer.beginFrame&&u.renderer.beginFrame(),u.renderer.render(y),u.renderer.render(u.commands),y=y.concat(u.clipCommands),z=z.concat(u.commands),u.renderer.endFrame()&&u.renderer.endFrame()}for(this.textInputRenderer.beginFrame(),this.textInputRenderer.render(y),this.textInputRenderer.render(z),this.textInputRenderer.endFrame(),this.domCache.notifyInvisibleHTMLElements(g);i.length>1&&i.length>j.length;){var c=i.pop();this.renderersToDetach.push(c),this.cachedRenderers.push(c)}return 0===j.length&&1===i.length&&(i[0].beginFrame(),i[0].endFrame()),i.push(this.textInputRenderer),this.renderers=i,!0},d.prototype.setViewportSize=function(a,b){this.viewportWidth=a,this.viewportHeight=b,this.renderers.forEach(function(c){c.setViewportSize&&c.setViewportSize(a,b)})},d.prototype.beginFrame=function(){this.clipToViewport?g.set(this.clipAABB,0,0,this.viewportWidth,this.viewportHeight):g.set(this.clipAABB,Number.MIN_VALUE,Number.MIN_VALUE,Number.MAX_VALUE,Number.MAX_VALUE)},d.prototype.endFrame=function(){},d.prototype.setFillMode=function(a){this.fillMode=a,this.renderers.forEach(function(b){b.setFillMode&&b.setFillMode(a)})},d.prototype.captureScreenShot=function(a,b,c,d){var e=this.rootElement.style.width,f=this.rootElement.style.height;this.rootElement.style.width=b+"px",this.rootElement.style.height=c+"px";for(var g=0;g<this.renderers.length;g++)this.renderers[g].resizeRootElement();this.beginFrame(),this.render(a),this.endFrame();for(var h=[],g=0;g<this.renderers.length;g++){var i=this.renderers[g];if(i.rootElement&&"CANVAS"===i.rootElement.tagName)try{var j=i.rootElement.toDataURL();h.push(j)}catch(e){}}this.rootElement.style.width=e,this.rootElement.style.height=f;for(var g=0;g<this.renderers.length;g++)this.renderers[g].resizeRootElement();if(this.emit("requestFrame"),0===h.length)d(null);else for(var k=[],l=0,g=0;g<h.length;g++){var m=new Image;k.push(m),m.onload=function(){if(++l===h.length){var a=document.createElement("canvas");a.width=b,a.height=c;for(var e=a.getContext("2d"),f=0;f<k.length;f++){var g=k[f];e.drawImage(g,0,0,b,c)}d(a.toDataURL())}},m.onerror=function(){d(null),d=null},m.src=h[g]}},d.prototype.onControlDisposed=function(a){this.renderers.forEach(function(b){b.removeResourcesForRenderCommand({id:a.id,content:a.renderCommand})})},d.prototype.clearImageCaches=function(){this.renderers.forEach(function(a){a.clearImageCache&&a.clearImageCache()})},b.exports=d},{"../eventsender":71,"../useragent-utils":223,"./math/aabb":193,"./math/mat4":195,"./renderers/dom/domcache":197,"./renderers/renderer-canvas2d":202,"./renderers/renderer-dom":203,"./renderers/renderer-webgl":204,lodash:12}],197:[function(a,b,c){"use strict";function d(){this.elements={},this.unusedElements={}}var e=a("./htmldomelement"),f=a("./dominputfield");d.prototype.removeElement=function(a){var b=this.elements[a];if(void 0!==b){var c=b.element;null!==c.parentNode&&c.parentNode.removeChild(c)}delete this.elements[a]},d.prototype.getElement=function(a){if(this.elements[a])return this.elements[a];throw new Error("Invalid ID passed to DOMCache.getElement")},d.prototype.notifyInvisibleHTMLElements=function(a){for(var b=Object.keys(this.elements),c=0;c<b.length;c++){var d=b[c];if(this.elements[d]instanceof e&&!(d in a)){var f=this.elements[d],g=f.element;null!==g.parentNode&&(g.parentNode.removeChild(g),f.onNodeRemovedFromParent())}}},d.prototype.createElement=function(a,b,c,d){if(this.elements[b])throw new Error("createElement called multiple times for same ID");if("html"===a){var g=new e(b,c,this,d);return this.elements[b]=g,g}if("textInput"===a){var h=new f(b,this);return this.elements[b]=h,h}},b.exports=d},{"./dominputfield":198,"./htmldomelement":199}],198:[function(a,b,c){"use strict";function d(a,b){e.call(this);var c=document.createElement("input");c.style.position="absolute",c.style.display="block",c.style.transformOrigin="0% 0%",c.style.padding="0px",c.style.margin="0px",c.style.border="none",c.style.outline="none",c.style.background="none",c.style.textAlign="left",c._noodlStyle={},this.element=c,this.inputListener=this.onInput.bind(this),this.blurListener=this.emit.bind(this,"blur"),c.addEventListener("keyup",this.inputListener),c.addEventListener("blur",this.blurListener),this.domCache=b,this.id=a}var e=a("../../../eventsender");d.prototype=Object.create(e.prototype),d.prototype.onInput=function(a){13===a.which&&this.emit("confirmed"),this.emit("inputChanged",this.element.value)},d.prototype.focus=function(){this.element.style.visibility="visible",this.element._noodlStyle.visibility="visible",this.element.focus()},d.prototype.blur=function(){this.element.style.visibility="hidden",this.element._noodlStyle.visibility="hidden",this.element.blur()},d.prototype.setText=function(a){this.element.value=a},d.prototype.setType=function(a){this.element.type=a},d.prototype.dispose=function(){this.element.removeEventListener("input",this.inputListener),this.element.removeEventListener("blur",this.blurListener),this.domCache.removeElement(this.id)},b.exports=d},{"../../../eventsender":71}],199:[function(a,b,c){"use strict";function d(a,b,c,d){e.call(this);var f=document.createElement(d);f.style.position="absolute",f.style.display="block",b||(f.style.pointerEvents="none"),f.style.transformOrigin="0% 0%",f._noodlStyle={},f.style.backgroundSize="100% 100%",f.className="html",this.element=f,this.domCache=c,this.id=a}var e=a("../../../eventsender");d.prototype=Object.create(e.prototype),d.prototype.onNodeRemovedFromParent=function(){this.emit("removedFromParent")},d.prototype.onNodeAddedToParent=function(a){this.emit("addedToParent",a)},d.prototype.dispose=function(){this.domCache.removeElement(this.id)},b.exports=d},{"../../../eventsender":71}],200:[function(a,b,c){"use strict";function d(a){this.rootElement=document.createElement(a.rootElementTag),this.rootElement.style.position="absolute",this.rootElement.style.display="block",this.rootElement.style.overflow="hidden",this.rootElement.style.pointerEvents="none",this.fillMode="aspectFit",this.viewportWidth=0,this.viewportHeight=0,this.onResizeCallback=a.onResize,this.onWindowResizeHandler=this._windowResizeListener.bind(this)}d.prototype._windowResizeListener=function(){"aspectFit"===this.fillMode&&this.resizeRootElement(),this.onResizeCallback&&this.onResizeCallback()},d.prototype.moveToTop=function(){if(null!==this.rootElement.parentNode){var a=this.rootElement.parentNode.children;a.length>0&&a[a.length-1]!==this.rootElement&&this.rootElement.parentNode.appendChild(this.rootElement)}},d.prototype.attach=function(a,b){b?a.insertBefore(this.rootElement,b):a.appendChild(this.rootElement),window.addEventListener("resize",this.onWindowResizeHandler),this.resizeRootElement()},d.prototype.detach=function(){window.removeEventListener("resize",this.onWindowResizeHandler),this.rootElement.parentNode&&this.rootElement.parentNode.removeChild(this.rootElement)},d.prototype.setViewportSize=function(a,b){this.viewportWidth=a,this.viewportHeight=b,this.rootElement.parentNode&&"aspectFit"===this.fillMode&&this.resizeRootElement(),this.onResizeCallback&&this.onResizeCallback()},d.prototype.supportsRenderCommand=function(a){return!1},d.prototype.getParentRect=function(){return this.rootElement.parentElement?this.rootElement.parentElement.getBoundingClientRect():this.rootElement.getBoundingClientRect()},d.prototype._calculateAspectFit=function(){var a=this.viewportWidth,b=this.viewportHeight,c=1,d=1,e=a/b,f=this.getParentRect(),g=f.width/f.height;return e/g>1?d=g/e:c=e/g,{width:f.width*c,height:f.height*d}},d.prototype.resizeRootElementAspectFit=function(){var a=this._calculateAspectFit();this.rootElement.style.width=a.width+"px",this.rootElement.style.height=a.height+"px";var b=this.getParentRect(),c=Math.round(b.width-a.width)/2+"px",d=Math.round(b.height-a.height)/2+"px";this.rootElement.style.transform="translate("+c+","+d+")",this.rootElement.style.webkitTransform=this.rootElement.style.transform},d.prototype.resizeRootElementFill=function(){this.rootElement.style.width="100%",this.rootElement.style.height="100%",this.rootElement.style.transform="",this.rootElement.style.webkitTransform=""},d.prototype.resizeRootElement=function(){"aspectFit"===this.fillMode?this.resizeRootElementAspectFit():this.resizeRootElementFill(),this.onResizeCallback&&this.onResizeCallback()},d.prototype.setFillMode=function(a){this.fillMode=a,this.resizeRootElement()},b.exports=d},{}],201:[function(a,b,c){"use strict";function d(a){e.call(this,{rootElementTag:"canvas",onResize:this._onResize.bind(this)}),this.useDeviceScaleForCanvasElement=!0,this.useScreenResolution=!!a.useScreenResolution}var e=a("./renderer-base");d.prototype=Object.create(e.prototype),d.prototype.constructor=d,d.prototype._onResize=function(){this.resizeCanvasBuffer()},d.prototype.resizeCanvasBuffer=function(){var a=this.rootElement.getBoundingClientRect(),b=0,c=0;if(this.useDeviceScaleForCanvasElement){var d=window.devicePixelRatio||1;if("aspectFit"===this.fillMode){var e=Math.max(a.width*d/this.viewportWidth,a.height*d/this.viewportHeight);!1===this.useScreenResolution&&(e=Math.max(1,Math.round(e))),b=Math.round(this.viewportWidth*e),c=Math.round(this.viewportHeight*e),this.renderScale=b/this.viewportWidth}else b=Math.round(a.width*d),c=Math.round(a.height*d),this.renderScale=d}else"aspectFit"===this.fillMode?(b=Math.round(this.viewportWidth),c=Math.round(this.viewportHeight)):(b=Math.round(a.width),c=Math.round(a.height)),this.renderScale=1;b!==this.rootElement.width&&(this.rootElement.width=b),c!==this.rootElement.height&&(this.rootElement.height=c)},b.exports=d},{"./renderer-base":200}],202:[function(a,b,c){"use strict";function d(a){j.call(this,a),this.rootElement.className="RendererCanvasElement",this.clearWithBlackRect=!a.alpha,this.coloredImagesCache=new k,this.rectangleBlurEdgeCache=new k,this.circleBlurCache=new k,this.circleStrokeBlurCache=new k,this.circleStrokeCache=new k,this.ctx=this.rootElement.getContext("2d",{alpha:!!a.alpha}),this.usesAlpha=a.alpha,this.clipDepth=0}function e(a,b){for(var c=0;c<3;++c){var d=1+2*c;a[c]=parseInt(b.substring(d,d+2),16)}}function f(a,b,c){var d=Math.max(0,Math.min(1,(c-a)/(b-a)));return d*d*(3-2*d)}function g(a,b){var c=document.createElement("canvas"),d=c.getContext("2d");c.width=1,c.height=a;var g=d.createImageData(1,a);e(l,b);for(var h=0;h<a;h++){var i=f(0,1,h/(a-1));g.data[4*h]=l[0],g.data[4*h+1]=l[1],g.data[4*h+2]=l[2],g.data[4*h+3]=255*i}return d.putImageData(g,0,0),c}function h(a,b,c){var d=document.createElement("canvas"),g=d.getContext("2d");d.width=a+b,d.height=a+b;var h=g.createImageData(a+b,a+b);e(l,c);for(var i=0;i<h.height;i++)for(var j=0;j<h.width;j++){var k=Math.sqrt(j*j+i*i)-a,m=f(1,0,k/b),n=h.width-1-j+(h.height-1-i)*h.width;h.data[4*n]=l[0],h.data[4*n+1]=l[1],h.data[4*n+2]=l[2],h.data[4*n+3]=255*m}return g.putImageData(h,0,0),d}function i(a,b,c,d){var g=document.createElement("canvas"),h=g.getContext("2d");g.width=a+b,g.height=a+b;var i=h.createImageData(a+b,a+b);e(l,d);for(var j=0;j<i.height;j++)for(var k=0;k<i.width;k++){var m=Math.sqrt(k*k+j*j),n=0;m>=a-c-b&&m<=a-c?n=f(a-c-b,a-c,m):m>a-c&&m<a?n=1:m>=a&&(n=1-f(a,a+b,m));var o=i.width-1-k+(i.height-1-j)*i.width;i.data[4*o]=l[0],i.data[4*o+1]=l[1],i.data[4*o+2]=l[2],i.data[4*o+3]=255*n}return h.putImageData(i,0,0),g}var j=a("./renderer-canvas-base"),k=a("../resourcecache");d.prototype=Object.create(j.prototype),d.prototype.constructor=d,d.prototype.supportsRenderType=function(a,b){return"noodl"===a&&(0===b||this.usesAlpha)},d.prototype.beginFrame=function(){this.ctx.setTransform(1,0,0,1,0,0),this.ctx.globalAlpha=1,this.clearWithBlackRect?(this.ctx.fillStyle="#000000",this.ctx.fillRect(0,0,this.toPixel(this.viewportWidth),this.toPixel(this.viewportHeight))):this.ctx.clearRect(0,0,this.toPixel(this.viewportWidth),this.toPixel(this.viewportHeight))},d.prototype.restoreClipState=function(){for(;this.clipDepth>0;)this.popClipRect()},d.prototype.endFrame=function(){this.restoreClipState()},d.prototype.render=function(a){for(var b=0;b<a.length;b++){var c=a[b],d=c.content.type;"pushClipRect"===d?this.pushClipRect(c):"popClipRect"===d?this.popClipRect():"pushFrameBuffer"===d||"popFrameBuffer"===d||this._renderContent(c)}},d.prototype.drawColoredImage=function(a,b,c){var d=b.src+"."+c;if(!1===this.coloredImagesCache.isInCache(d)){var e=document.createElement("canvas");e.width=b.width,e.height=b.height;var f=e.getContext("2d",{alpha:!0});f.clearRect(0,0,e.width,e.height),f.drawImage(b,0,0,b.width,b.height),f.globalCompositeOperation="source-in",f.fillStyle=c,f.fillRect(0,0,b.width,b.height),this.coloredImagesCache.addResource(d,e)}return this.coloredImagesCache.updateReference(a,d),this.coloredImagesCache.getResource(d)},d.prototype._drawRoundedRect=function(a,b,c,d){a<2*c&&(c=a/2),b<2*c&&(c=b/2),this.ctx.beginPath(),this.ctx.moveTo(c,0),this.ctx.arcTo(a,0,a,b,c),this.ctx.arcTo(a,b,0,b,c),this.ctx.arcTo(0,b,0,0,c),this.ctx.arcTo(0,0,a,0,c),this.ctx.closePath(),"positive"===d?(this.ctx.save(),this.ctx.clip()):this.ctx.fill()};var l=[0,0,0];d.prototype._drawRectangleBlurred=function(a,b,c,d,f,i){b<2*d&&(d=b/2),c<2*d&&(d=c/2),d>0?(this.ctx.fillRect(d,0,b-2*d,d),this.ctx.fillRect(0,d,b,c-2*d),this.ctx.fillRect(d,c-d,b-2*d,d)):this.ctx.fillRect(0,0,b,c),e(l,i);var j=i+f;!1===this.rectangleBlurEdgeCache.isInCache(j)&&this.rectangleBlurEdgeCache.addResource(j,g(f,i)),this.rectangleBlurEdgeCache.updateReference(a,j);var k=i+d+"."+f;!1===this.circleBlurCache.isInCache(k)&&this.circleBlurCache.addResource(k,h(d,f,i)),this.circleBlurCache.updateReference(a,k);var m=this.rectangleBlurEdgeCache.getResource(j),n=this.circleBlurCache.getResource(k);this.ctx.drawImage(m,d,-f,b-2*d,f),this.ctx.drawImage(n,-f,-f,f+d,f+d),this.ctx.save(),this.ctx.rotate(Math.PI/2),this.ctx.translate(0,-b),this.ctx.drawImage(m,d,-f,c-2*d,f),this.ctx.drawImage(n,-f,-f,f+d,f+d),this.ctx.rotate(Math.PI/2),this.ctx.translate(0,-c),this.ctx.drawImage(m,d,-f,b-2*d,f),this.ctx.drawImage(n,-f,-f,f+d,f+d),this.ctx.rotate(Math.PI/2),this.ctx.translate(0,-b),this.ctx.drawImage(m,d,-f,c-2*d,f),this.ctx.drawImage(n,-f,-f,f+d,f+d),this.ctx.restore()},d.prototype._drawCircleBlurred=function(a,b,c,d,e){var f=d+b+"."+c;!1===this.circleBlurCache.isInCache(f)&&this.circleBlurCache.addResource(f,h(b,c,d)),this.circleBlurCache.updateReference(a,f);var g=this.circleBlurCache.getResource(f);this.ctx.save(),e<2*Math.PI&&(this.ctx.beginPath(),this.ctx.arc(b,b,b+c,-Math.PI/2,-Math.PI/2+e,!1),this.ctx.lineTo(b,b),this.ctx.clip()),this.ctx.rotate(Math.PI/2),this.ctx.drawImage(g,-c,-c-2*b,c+b,c+b),e>Math.PI/2&&(this.ctx.rotate(Math.PI/2),this.ctx.drawImage(g,-c-2*b,-c-2*b,c+b,c+b),e>Math.PI&&(this.ctx.rotate(Math.PI/2),this.ctx.drawImage(g,-c-2*b,-c,c+b,c+b),e>1.5*Math.PI&&(this.ctx.rotate(Math.PI/2),this.ctx.drawImage(g,-c,-c,c+b,c+b)))),this.ctx.restore()},d.prototype._drawCircleStrokeBlurred=function(a,b,c,d,e,f){var g=d+b+"."+c+"."+f;!1===this.circleStrokeBlurCache.isInCache(g)&&this.circleStrokeBlurCache.addResource(g,i(b,c,f,d)),this.circleStrokeBlurCache.updateReference(a,g);var h=this.circleStrokeBlurCache.getResource(g);this.ctx.save(),e<2*Math.PI&&(this.ctx.beginPath(),this.ctx.arc(b,b,b+c,-Math.PI/2,-Math.PI/2+e,!1),this.ctx.lineTo(b,b),this.ctx.clip()),this.ctx.rotate(Math.PI/2),this.ctx.drawImage(h,-c,-c-2*b,c+b,c+b),e>Math.PI/2&&(this.ctx.rotate(Math.PI/2),this.ctx.drawImage(h,-c-2*b,-c-2*b,c+b,c+b),e>Math.PI&&(this.ctx.rotate(Math.PI/2),this.ctx.drawImage(h,-c-2*b,-c,c+b,c+b),e>1.5*Math.PI&&(this.ctx.rotate(Math.PI/2),this.ctx.drawImage(h,-c,-c,c+b,c+b)))),this.ctx.restore()},d.prototype.toPixel=function(a){return a*this.renderScale},d.prototype._renderContent=function(a){var b=a.content.type;switch(this._setTransform(a.transform),this.ctx.globalAlpha=a.content.opacity,a.content.blendMode){case"alpha":case"solid":this.ctx.globalCompositeOperation="source-over";break;case"additive":this.ctx.globalCompositeOperation="lighter";break;case"multiply":this.ctx.globalCompositeOperation="multiply"}if("-undoMask"===a.id.slice(-9))return void this.ctx.restore();if("rectangle"===b){this.ctx.fillStyle=a.content.color;var c=Math.floor(this.toPixel(a.content.blur));c>0?this._drawRectangleBlurred(a.id,this.toPixel(a.width),this.toPixel(a.height),this.toPixel(a.content.cornerRadius),a.content.blur,a.content.color):a.content.cornerRadius>0?this._drawRoundedRect(this.toPixel(a.width),this.toPixel(a.height),this.toPixel(a.content.cornerRadius),a.content.maskType):this.ctx.fillRect(0,0,this.toPixel(a.width),this.toPixel(a.height))}else if("image"===b&&a.content.image){var d=a.content.image;if("#ffffff"!==a.content.color&&(d=this.drawColoredImage(a.id,a.content.image,a.content.color)),a.content.cornerRadius&&this._drawRoundedRect(this.toPixel(a.width),this.toPixel(a.height),this.toPixel(a.content.cornerRadius),"positive"),a.content.srcRect){var e=Math.round(a.content.srcRect[0]*d.width),f=Math.round(a.content.srcRect[1]*d.height),g=Math.round((a.content.srcRect[2]-a.content.srcRect[0])*d.width),h=Math.round((a.content.srcRect[3]-a.content.srcRect[1])*d.height);this.ctx.drawImage(d,e,f,g,h,0,0,this.toPixel(a.width),this.toPixel(a.height))}else this.ctx.drawImage(d,0,0,this.toPixel(a.width),this.toPixel(a.height));a.content.cornerRadius&&this.ctx.restore()}else if("text"===b&&a.content.text){this.ctx.fillStyle=a.content.color,this.ctx.font=this.toPixel(a.content.fontSize)+'px "'+a.content.fontFamily+'"';for(var i=0;i<a.content.lines.length;i++){var j=a.content.lines[i];this.ctx.fillText(j.text,this.toPixel(j.x),this.toPixel(j.y))}}else if("textInput"===b&&a.content.text&&!a.content.focused){this.ctx.fillStyle=a.content.color,this.ctx.font=this.toPixel(a.content.fontSize)+'px "'+a.content.fontFamily+'"';var k=.5*(a.height-a.content.textHeight);this.ctx.fillText(a.content.text,0,this.toPixel(k+a.content.baseline))}else if("circle"===b){var l=a.width/2,c=Math.floor(this.toPixel(a.content.blur));if(c>1)a.content.solid?this._drawCircleBlurred(a.id,Math.floor(this.toPixel(l)),c,a.content.color,a.content.arcAngle):this._drawCircleStrokeBlurred(a.id,Math.floor(this.toPixel(l)),c,a.content.color,a.content.arcAngle,Math.floor(this.toPixel(a.content.lineWidth)));else{var m=a.width/2,k=a.height/2;if(this.ctx.beginPath(),a.content.solid||(l-=.5*a.content.lineWidth),this.ctx.arc(this.toPixel(m),this.toPixel(k),this.toPixel(l),-Math.PI/2,-Math.PI/2+a.content.arcAngle,!1),a.content.solid)if(a.content.arcAngle<2*Math.PI&&this.ctx.lineTo(this.toPixel(m),this.toPixel(k)),a.content.image){this.ctx.save(),this.ctx.clip();var d=a.content.image;"#ffffff"!==a.content.color&&(d=this.drawColoredImage(a.id,a.content.image,a.content.color)),this.ctx.drawImage(d,0,0,this.toPixel(a.width),this.toPixel(a.height)),this.ctx.restore()}else this.ctx.fillStyle=a.content.color,this.ctx.fill();else this.ctx.strokeStyle=a.content.color,this.ctx.lineWidth=Math.max(1,this.toPixel(a.content.lineWidth)),this.ctx.stroke()}}},d.prototype._setTransform=function(a){this.ctx.setTransform(a[0],a[1],a[4],a[5],this.toPixel(a[12]),this.toPixel(a[13]))},d.prototype.pushClipRect=function(a){this._setTransform(a.transform),this.ctx.save(),this.ctx.beginPath(),this.ctx.rect(0,0,this.toPixel(a.width),this.toPixel(a.height)),this.ctx.clip(),this.clipDepth++},d.prototype.popClipRect=function(){this.ctx.restore(),this.clipDepth--},d.prototype.removeResourcesForRenderCommand=function(a){"image"===a.content.type||"circle"===a.content.type?this.coloredImagesCache.removeReference(a.id):"rectangle"===a.content.type?(this.rectangleBlurEdgeCache.removeReference(a.id),this.circleBlurCache.removeReference(a.id)):"circle"===a.content.type&&(this.circleBlurCache.removeReference(a.id),this.circleStrokeBlurCache.removeReference(a.id),this.circleStrokeCache.removeReference(a.id))},d.prototype.detach=function(){j.prototype.detach.call(this),this.coloredImagesCache.clear(),this.rectangleBlurEdgeCache.clear(),this.circleBlurCache.clear(),this.circleStrokeBlurCache.clear(),this.circleStrokeCache.clear()},b.exports=d},{"../resourcecache":216,"./renderer-canvas-base":201}],203:[function(a,b,c){"use strict";function d(a,b){var c=document.createElement(a);return c.style.position="absolute",c.style.display="block",b||(c.style.pointerEvents="none"),c.style.transformOrigin="0% 0%",c._noodlStyle={},c}function f(a,b){j.call(this,{rootElementTag:"div",onResize:this._onResize.bind(this)}),this.id=k(),this.rootElement.style.transformStyle="preserve-3d",this.rootElement.style.webkitTransformStyle="preserve-3d",this.rootElement.className="RendererDOMRootElement",this.inputEnabled=a,this.elements={},this.clipDepth=0,this.domCache=b,this.unusedElements={},this.transformStack=[],this.textFields={},this.renderHtmlOnly=!1,this.renderTextInputOnly=!1}function g(a,b,c){a._noodlStyle[b]!==c&&(a.style[b]=c,a._noodlStyle[b]=c)}function h(a,b,c){if(a.parentNode===b&&a.index===c)return!1;c<b.children.length-1?b.insertBefore(a,b.children[c+1]):b.appendChild(a);for(var d=0;d<b.children.length;d++)b.children[d].index=d;return!0}var i=a("../math/mat4"),j=(a("./dom/dominputfield"),a("./renderer-base")),k=a("../../guid");f.prototype=Object.create(j.prototype),f.prototype.constructor=f,f.prototype.setRenderHTMLOnly=function(a){this.renderHtmlOnly=a},f.prototype.setRenderInputFieldsOnly=function(a){this.renderTextInputOnly=a},f.prototype.supportsRenderType=function(a,b){return!this.renderHtmlOnly||"html"===a},f.prototype._onResize=function(){"aspectFit"===this.fillMode?this.renderScale=this.rootElement.getBoundingClientRect().width/this.viewportWidth:this.renderScale=1},f.prototype.endFrame=function(){this._removeUnusedElements(),this.restoreClipState()},f.prototype._removeUnusedElements=function(){for(var a in this.elements)if(!this.elementsThisFrame[a]){var b=this.elements[a],c=b.parentNode;c.removeChild(b),delete this.elements[a],this.unusedElements[a]=b,b.index=void 0;for(var d=0;d<c.children.length;d++)c.children[d].index=d}},f.prototype._getTextInputCommands=function(a){for(var b=[],c=0;c<a.length;c++){var d=a[c],e=d.content.type;"textInput"!==e&&"pushClipRect"!==e&&"popClipRect"!==e||("popClipRect"===d.content.type&&b.length>0&&"pushClipRect"===b[b.length-1].content.type?b.length=b.length-1:b.push(d))}return b},f.prototype.beginFrame=function(){this.elementsThisFrame={},this.nodeIndices=[0],this.parentElement=this.rootElement},f.prototype.render=function(a){var b=this.nodeIndices;this.renderTextInputOnly&&(a=this._getTextInputCommands(a));for(var c=0;c<a.length;c++){var d=a[c],e=d.content.type;"pushClipRect"===e?(this.pushClipRect(d,b[b.length-1]),b[b.length-1]++,b.push(0)):"popClipRect"===e?(this.popClipRect(),b.pop()):(this._renderContent(d,b[b.length-1]),b[b.length-1]++)}};var l=i.create();f.prototype._setTransform=function(a,b){this.transformStack.length&&(i.identity(l),i.multiply(l,this.transformStack[this.transformStack.length-1],l),i.multiply(l,l,b),b=l);var c="matrix3d("+b[0]+","+b[1]+","+b[2]+","+b[3]+","+b[4]+","+b[5]+","+b[6]+","+b[7]+","+b[8]+","+b[9]+","+b[10]+","+b[11]+","+b[12]*this.renderScale+","+b[13]*this.renderScale+","+b[14]*this.renderScale+","+b[15]+")";a._noodlStyle.transform!==c&&(a._noodlStyle.transform=c,a.style.transform=c,a.style.webkitTransform=c)},f.prototype._renderContent=function(a,b){var c,f=a.id,i=a.content.type;if(this.elements[f]?c=this.elements[f]:"html"===i||"textInput"===i?c=this.domCache.getElement(f).element:(this.unusedElements[f]?(c=this.unusedElements[f],delete this.unusedElements[f]):"rectangle"===i?c=d("div"):"image"===i?(c=d("div"),e.style.backgroundSize="100% 100%"):"text"===i?(c=d("div"),e.style.whiteSpace="nowrap"):"circle"===i&&(c=d("div"),e.style.borderRadius="50%"),this.elements[f]=c,c.className=i),this.elementsThisFrame[f]=!0,h(c,this.parentElement,b)&&"html"===i&&this.domCache.getElement(f).onNodeAddedToParent(this.parentElement),this._setTransform(c,a.transform),g(c,"width",a.width*this.renderScale+"px"),g(c,"height",a.height*this.renderScale+"px"),g(c,"opacity",a.content.opacity),"rectangle"===i)g(c,"backgroundColor",a.content.color),g(c,"borderRadius",.5*a.content.cornerRadius+"px");else if("image"===i)g(c,"backgroundImage","url("+a.content.image.src+")"),"#ffffff"!==a.content.color?(g(c,"backgroundColor",a.content.color),g(c,"backgroundBlendMode","overlay"),g(c,"isolation","isolate")):(g(c,"backgroundColor",void 0),g(c,"backgroundBlendMode","normal"));else if("text"===i)g(c,"color",a.content.color),g(c,"fontFamily",a.content.fontFamily),g(c,"fontSize",a.content.fontSize*this.renderScale+"px"),g(c,"textAlign",a.content.horizontalAlignment),g(c,"lineHeight",a.content.lineHeight?a.content.lineHeight*this.renderScale+"px":"normal"),c.innerText!==a.content.text&&(c.innerText=a.content.text);else if("textInput"===i)g(c,"color",a.content.color),g(c,"fontFamily",a.content.fontFamily),g(c,"fontSize",a.content.fontSize*this.renderScale+"px"),a.content.focused||c.value===a.content.text||(c.value=a.content.text),this.renderTextInputOnly&&!a.content.focused&&g(c,"visibility","hidden");else if("circle"===i)a.content.solid?g(c,"backgroundColor",a.content.color):g(c,"border",a.content.lineWidth+"px solid "+a.content.color);else if("html"===i){if("CANVAS"===c.tagName){var j=Math.round(a.width*this.renderScale),k=Math.round(a.height*this.renderScale);c.width!==j&&(c.width=j),c.height!==k&&(c.height=k)}c.style.pointerEvents="auto",c.style.boxSizing="border-box"}},f.prototype.restoreClipState=function(){for(;this.clipDepth>0;)this.popClipRect()},f.prototype.pushClipRect=function(a,b){this.clipDepth++;var c=a.id;if(!this.elements[c]){var e=d("div");e._noodlStyle={},e.style.overflow="hidden",this.elements[c]=e}this.elementsThisFrame[c]=!0;var f=this.elements[c];this._setTransform(f,a.transform),g(f,"width",a.width*this.renderScale+"px"),g(f,"height",a.height*this.renderScale+"px"),f.className="RenderDOMClipControl",h(f,this.parentElement,b);var j=i.create();i.copy(j,a.transform),i.invert(j),this.transformStack.push(j),this.parentElement=f},f.prototype.popClipRect=function(){this.clipDepth--,this.parentElement=this.parentElement.parentNode,this.transformStack.pop()},f.prototype.removeResourcesForRenderCommand=function(a){},b.exports=f},{"../../guid":73,"../math/mat4":195,"./dom/dominputfield":198,"./renderer-base":200}],204:[function(a,b,c){"use strict";function d(a){m.call(this,a);var b={alpha:!!a.alpha,stencil:!0},c=this.rootElement.getContext("webgl",b);if(c||(c=this.rootElement.getContext("experimental-webgl",b)),!c)throw new Error("WebGL not supported");this.useDeviceScaleForCanvasElement=!1,this.usesAlpha=a.alpha,this.rootElement.className="RendererWebGLCanvas",this.webGLHelper=new p(c,1080,1920),this.defaultShader=this.createShader({vertexSource:this.webGLHelper._defaultVsSource,fragmentSource:this.webGLHelper._defaultFsSource}),this.defaultTextShader=this._createDefaultTextShader(),this.frameBuffers=[],
this.clipRects=[o.create()],this.defaultMesh=this.webGLHelper.createMesh(),this.numFloatsThisFrame=0,this.textCache=new q(this.webGLHelper),this.circleCache={},this.meshCache={},this.roundedBlurredRectCache={},this.roundedRectCache={},this.frameBufferCache=[],this.textureCache=new w(this.webGLHelper),this.tempVertices=new Float32Array(y*this.defaultShader.numComponentsPerVertex),this.shaderCache={}}function e(a,b,c,d,e,f,g){a[0]=0,a[1]=0,a[2]=0,b[0]=e,b[1]=0,b[2]=0,c[0]=0,c[1]=f,c[2]=0,d[0]=e,d[1]=f,d[2]=0,n.transformPoint(g,a),n.transformPoint(g,b),n.transformPoint(g,c),n.transformPoint(g,d)}function f(a,b,c,d,e,f,g,h){var i=g.width,j=g.height;a[0]<h.min[0]&&(e[0]=(h.min[0]-a[0])/i,a[0]=h.min[0],c[0]=h.min[0]),a[1]<h.min[1]&&(e[1]=(h.min[1]-a[1])/j,a[1]=h.min[1],b[1]=h.min[1]),b[0]>h.max[0]&&(f[0]=(b[0]-h.max[0])/i,b[0]=h.max[0],d[0]=h.max[0]),c[1]>h.max[1]&&(f[1]=(c[1]-h.max[1])/j,c[1]=h.max[1],d[1]=h.max[1])}function g(a,b,c,d,e,f){var g=Math.min(a[0],b[0],c[0],d[0]),h=Math.min(a[1],b[1],c[1],d[1]),i=Math.max(a[0],b[0],c[0],d[0]),j=Math.max(a[1],b[1],c[1],d[1]);(g<f.min[0]||h<f.min[1]||i>f.max[0]||j>f.max[1])&&(e.scissorTest=!0,e.scissorRect[0]=f.min[0],e.scissorRect[1]=f.min[1],e.scissorRect[2]=f.max[0],e.scissorRect[3]=f.max[1])}function h(a){return 1!==a[0]||1!==a[5]||1!==a[10]}function i(a){return 0!==a[1]||0!==a[2]||0!==a[4]||0!==a[6]||0!==a[8]||0!==a[9]}function j(a,b){for(var c=0;c<3;++c){var d=1+2*c;a[c]=parseInt(b.substring(d,d+2),16)/255}}function k(a,b,c,d){var j=b.transform;e(B,C,D,E,b.width,b.height,j),F[0]=0,F[1]=0,G[0]=0,G[1]=0,i(j)||h(j)||0!==j[14]?g(B,C,D,E,c,d):f(B,C,D,E,F,G,b,d);var k=c.srcRect,l=k[2]-k[0],m=k[3]-k[1],n=c.color;a[0]=B[0],a[1]=B[1],a[2]=B[2],a[3]=k[0]+F[0]*l,a[4]=k[1]+F[1]*m,a[5]=n[0]*b.content.opacity,a[6]=n[1]*b.content.opacity,a[7]=n[2]*b.content.opacity,a[8]=b.content.opacity,a[9]=C[0],a[10]=C[1],a[11]=C[2],a[12]=k[2]-G[0]*l,a[13]=a[4],a[14]=a[5],a[15]=a[6],a[16]=a[7],a[17]=a[8],a[18]=D[0],a[19]=D[1],a[20]=D[2],a[21]=a[3],a[22]=k[3]-G[1]*m,a[23]=a[5],a[24]=a[6],a[25]=a[7],a[26]=a[8],a[27]=E[0],a[28]=E[1],a[29]=E[2],a[30]=a[12],a[31]=a[22],a[32]=a[5],a[33]=a[6],a[34]=a[7],a[35]=a[8],"popFrameBuffer"===b.content.type&&(a[4]=1-a[4],a[13]=1-a[13],a[22]=1-a[22],a[31]=1-a[31])}function l(a,b,c,d,f){d.mesh=a,d.shader=b,b&&-1!==b.standardUniforms.u_world&&(d.worldTransform=c.transform),e(B,C,D,E,c.width,c.height,c.transform),g(B,C,D,E,d,f)}var m=a("./renderer-canvas-base"),n=a("../math/mat4"),o=a("../math/aabb"),p=a("./webgl/webglhelper"),q=a("./webgl/text-cache"),r=a("./webgl/texture"),s=a("./webgl/circle"),t=a("./webgl/mesh"),u=a("./webgl/roundedrect"),v=a("./webgl/roundedrect-standard"),w=a("./webgl/texturecache"),x=a("./webgl/framebuffer-effects"),y=4,z=10;d.prototype=Object.create(m.prototype),d.prototype.constructor=d,d.prototype.createShader=function(a){return this.webGLHelper.createShader(a)},d.prototype._onResize=function(){m.prototype._onResize.call(this),o.set(this.clipRects[0],0,0,this.viewportWidth,this.viewportHeight);for(var a=0;a<this.frameBufferCache.length;a++)this.frameBufferCache[a].dispose();this.frameBufferCache=[],this.webGLHelper.setVirtualSize(this.viewportWidth,this.viewportHeight),this.webGLHelper.setRenderBufferSize(this.rootElement.width,this.rootElement.height)},d.prototype.supportsRenderType=function(a,b){return"noodl"===a&&(0===b||this.usesAlpha)},d.prototype.getFrameBufferForScale=function(a,b,c){var d=this.webGLHelper.renderWidth*a,e=this.webGLHelper.renderHeight*a;if(c)for(var f=0;f<this.frameBufferCache.length;f++){var g=this.frameBufferCache[f];if(g.controlId===b&&c){if(g.width===d&&g.height===e)return g;g.dispose(),this.frameBufferCache.splice(f,1),g=null}}for(var f=0;f<this.frameBufferCache.length;f++){var g=this.frameBufferCache[f];if(g.width===d&&g.height===e&&!g.active&&!g.controlId)return g.unused=!1,c&&(g.controlId=b),g}var g=this.webGLHelper.createFBO({width:d,height:e});return g.scale=a,g.unused=!1,c&&(g.controlId=b),this.frameBufferCache.push(g),g},d.prototype.frameBufferScaleForGaussianBlur=function(a){return a.frameBufferSettings.effectParams.effectAmount>.1?.5:1},d.prototype.pushFrameBuffer=function(a,b){var c=a.frameBufferSettings.renderScale;this.shouldApplyGaussianBlur(a)&&(c=this.frameBufferScaleForGaussianBlur(a));var d=a.frameBufferSettings.requiresExclusiveFBO;a.frameBufferSettings.renderEffectsToTexture&&(d=!1);var e=this.getFrameBufferForScale(c,a.id,d);e.active=!0,this.frameBuffers.push(e),b.push({type:"pushFrameBuffer",fbo:e})},d.prototype.configureFramebufferVertices=function(a,b,c,d,e,f){this.fillVerticesRenderCommand(b,a,b.frameBufferSettings.vertices,b.content.transform,e)},d.prototype.configureFramebufferQuad=function(a,b,c,d,e){a.mesh=this.defaultMesh,j(a.color,"#ffffff"),c?k(this.tempVertices,b,a,e):k(this.tempVertices,b,a,this.clipRects[this.clipRects.length-1]),a.vertexIndex=this.numFloatsThisFrame/this.defaultShader.numComponentsPerVertex,this.appendBufferToDefaultMesh(this.tempVertices)},d.prototype.configureFramebufferRoundedRect=function(a,b,c,d,f,h){a.mesh=this.defaultMesh,j(a.color,"#ffffff"),this.roundedRectCache[b.id]||(this.roundedRectCache[b.id]=new v);var i=this.roundedRectCache[b.id],k=b.frameBufferSettings.cornerRadius,l=(a.texture.size[0],a.texture.size[1],o.width(f)),m=o.height(f);l<2*k&&(k=l/2),m<2*k&&(k=m/2),i.setColor([1,1,1,1]),i.setWidth(l),i.setHeight(m),i.setCornerRadius(k),i.setSourceRect(h),i.updateMesh(),a.vertexIndex=this.numFloatsThisFrame/this.defaultShader.numComponentsPerVertex,this.appendBufferToDefaultMesh(i.vertices),this.transformRoundedRectVertices(a,b.content.transform,i.vertices.length),e(B,C,D,E,b.width,b.height,b.transform),g(B,C,D,E,a,this.clipRects[this.clipRects.length-1]),a.mesh=this.defaultMesh,a.numVertices=i.vertices.length/this.defaultShader.numComponentsPerVertex},d.prototype.shouldApplyGaussianBlur=function(a){return"gaussianBlur"===a.frameBufferSettings.effect&&Math.round(a.frameBufferSettings.effectParams.gaussianBlurRadius)>=1&&0!==a.frameBufferSettings.effectParams.effectAmount},d.prototype.getOrCreateShader=function(a,b){if(a in this.shaderCache)return this.shaderCache[a].shader;var c=b(),d=this.createShader(c);return this.shaderCache[a]={shader:d,error:d.error,vertexSource:c.vertexSource,fragmentSource:c.fragmentSource},d},d.prototype.popFrameBuffer=function(a,b){var c=this.frameBuffers.pop();b.push({type:"popFrameBuffer"});var d=this.glCommandForRc(a,c.texture),e=a.frameBufferSettings.maskImage,f=!0;if(a.frameBufferSettings.maskViewId)for(var g=0;g<this.frameBufferCache.length;g++){var c=this.frameBufferCache[g];if(c.controlId===a.frameBufferSettings.maskViewId){e=c.texture,f=!1;break}}var h=f?"_flip":"",i=a.frameBufferSettings.clip||e,j=o.create();o.set(j,0,0,a.clipWidth,a.clipHeight),o.transform4(j,a.content.transform);var k=[j.min[0]/this.webGLHelper.renderWidth,1-j.min[1]/this.webGLHelper.renderHeight,j.max[0]/this.webGLHelper.renderWidth,1-j.max[1]/this.webGLHelper.renderHeight];c.contentSrcRect=k;var l={maskTexture:e,maskRect:[k[0],k[3],k[2],k[1]],amount:a.frameBufferSettings.effectParams.effectAmount},m=this.webGLHelper;if(this.shouldApplyGaussianBlur(a)){var n=this.frameBufferScaleForGaussianBlur(a),p=1;n>=1&&(p=1/(1+n));var q=Math.round(a.frameBufferSettings.effectParams.gaussianBlurRadius*n*p),r=this.getOrCreateShader("gaussianBlur_"+q+h,function(){return x.generateGaussianBlurShaders(q,m.getMaxVaryingVectors(),!1,!0)}),s=this.getFrameBufferForScale(n,a.id,!1),t=this.glCommandForRc(a,c.texture);this.configureFramebufferQuad(t,a,!1,e,j),t.shader=r,t.shaderUniforms={opacity:1,texelWidthOffset:1/(c.width*p)*a.frameBufferSettings.effectParams.effectAmount,texelHeightOffset:0},d.texture=s.texture,e&&(r=this.getOrCreateShader("gaussianBlur_"+q+"_mask"+h,function(){return x.generateGaussianBlurShaders(q,m.getMaxVaryingVectors(),!0,f)})),d.shader=r,l.opacity=a.content.opacity,l.texelWidthOffset=0,l.texelHeightOffset=1/(c.height*p)*a.frameBufferSettings.effectParams.effectAmount,d.shaderUniforms=this.createGLShaderUniforms(l,d.shader),b.push({type:"pushFrameBuffer",fbo:s}),b.push(t),b.push({type:"popFrameBuffer"})}else if("desaturate"===a.frameBufferSettings.effect){var u=this.getOrCreateShader((e?"desaturate_mask":"desaturate")+h,function(){return x.getDesaturateShaders(e,f)});d.shader=u,d.shaderUniforms=this.createGLShaderUniforms(l,d.shader)}else if(!a.content.shaderSource||a.frameBufferSettings.effect&&"none"!==a.frameBufferSettings.effect)e&&(d.shader=this.getOrCreateShader("maskShader"+h,function(){return x.getMaskShaders(f)}),d.shaderUniforms=this.createGLShaderUniforms(l,d.shader));else{if(a.content.secondaryShaderSource){var s=this.getFrameBufferForScale(a.frameBufferSettings.renderScale,a.id,!1),t=this.glCommandForRc(a,c.texture);this.configureFramebufferQuad(t,a,!1,e,j),this.configureShaderSourceForCommand(t,a.content.secondaryShaderSource,a.content.secondaryShaderUniforms),b.push({type:"pushFrameBuffer",fbo:s}),b.push(t),b.push({type:"popFrameBuffer"}),d.texture=s.texture}this.configureShaderSourceForCommand(d,a.content.shaderSource,a.content.shaderUniforms)}if(a.frameBufferSettings.vertices?this.configureFramebufferVertices(d,a,i,e,j,k):a.frameBufferSettings.clip&&a.frameBufferSettings.cornerRadius>0?this.configureFramebufferRoundedRect(d,a,i,e,j,k):this.configureFramebufferQuad(d,a,i,e,j),a.frameBufferSettings.renderEffectsToTexture){var v=this.getFrameBufferForScale(a.frameBufferSettings.renderScale,a.id,a.frameBufferSettings.requiresExclusiveFBO);b.push({type:"pushFrameBuffer",fbo:v}),b.push(d),b.push({type:"popFrameBuffer"}),v.contentSrcRect=k,d=this.glCommandForRc(a,v.texture),this.configureFramebufferQuad(d,a,!1,null,j),d.texture=v.texture}a.frameBufferSettings.renderAfterPop&&(b.push(d),c.active=!1)},d.prototype.markFrameBuffersUnused=function(){for(var a=0;a<this.frameBufferCache.length;a++)this.frameBufferCache[a].unused=!0},d.prototype.removeUnusedFramebuffers=function(){for(var a=[],b=0;b<this.frameBufferCache.length;b++)this.frameBufferCache[b].unused&&!this.frameBufferCache[b].controlId&&a.push(this.frameBufferCache[b]);for(;a.length>z;){var c=a.shift(),b=this.frameBufferCache.indexOf(c);this.frameBufferCache.splice(b,1),c.dispose()}},d.prototype.render=function(a){for(var b=[],c=0;c<a.length;c++){var d=a[c],e=d.content.type;if("pushClipRect"===e)this.pushClipRect(d);else if("popClipRect"===e)this.popClipRect();else{if("html"===e)throw new Error("Renderer does not support HTML");if("pushFrameBuffer"===e)this.pushFrameBuffer(d,b);else if("popFrameBuffer"===e)this.popFrameBuffer(d,b);else{var f="textInput"===d.content.type&&d.content.focused;!1===f&&this._renderContent(d,b)}}}var g=0;for(c=0;c<b.length;c++){var h=b[c];"pushFrameBuffer"===h.type?(g+=1,this.webGLHelper.bindFbo(h.fbo),this.frameBuffers.push(h.fbo),this.webGLHelper.setScissorTest(!1,[0,0,0,0]),this.webGLHelper.clearScreen(),this.webGLHelper.setBlendMode(p.BlendMode.Alpha)):"popFrameBuffer"===h.type?(this.frameBuffers.pop(),this.frameBuffers.length>0?this.webGLHelper.bindFbo(this.frameBuffers[this.frameBuffers.length-1]):this.webGLHelper.bindScreen()):h.texture&&this.webGLHelper.executeRenderCommand(h)}},d.prototype.pushClipRect=function(a){var b=o.create();o.set(b,0,0,a.width,a.height),o.transform4(b,a.transform),o.intersection(b,this.clipRects[this.clipRects.length-1]),this.clipRects.push(b)},d.prototype.popClipRect=function(){this.clipRects.pop()};var A=[0,0,1,1];d.prototype.createGLShaderUniforms=function(a,b){var c=[],d=this.textureCache,e=this;return Object.keys(a).forEach(function(f){var g=b._uniforms[f];if(g)if("sampler2D"===g.type){var h=a[f];if(h&&h.image){var i=d.getTexture(h.imagePath,h.image);i.refCount=1,c[f]=i}else if(h.constructor===r)c[f]=a[f];else if("string"==typeof h){var j=e.getFrameBufferWithId(h);j&&(c[f]=j.texture)}}else c[f]=a[f]}),c},d.prototype.configureShaderSourceForCommand=function(a,b,c){var d=b.id in this.shaderCache;if(d){var e=this.shaderCache[b.id];e.vertexSource===b.vertexShaderSource&&e.fragmentSource===b.fragmentShaderSource||(this.webGLHelper.deleteShader(e.shader),delete this.shaderCache[b.id],d=!1)}if(!d){var e=this.createShader({vertexSource:b.vertexShaderSource,fragmentSource:b.fragmentShaderSource});this.shaderCache[b.id]={shader:e,error:e.error,vertexSource:b.vertexShaderSource,fragmentSource:b.fragmentShaderSource}}var e=this.shaderCache[b.id];e.error?this.onShaderError&&this.onShaderError(b.id,e.error.message,e.error.type):(a.shader=e.shader,c&&(a.shaderUniforms=this.createGLShaderUniforms(c,e.shader)))},d.prototype.glCommandForRc=function(a,b){return{texture:b||null,blendMode:p.BlendMode.Alpha,mesh:null,depthTest:!1,vertexIndex:-1,opacity:a.content.opacity||1,scissorTest:!1,scissorRect:[0,0,0,0],srcRect:a.content.srcRect||A,flipTexCoordY:0,writeToStencil:!1,maskIsPositive:!1,shader:this.defaultShader,shaderUniforms:{},worldTransform:null,color:[0,0,0]}},d.prototype.getFrameBufferWithId=function(a){for(var b=0;b<this.frameBufferCache.length;b++){var c=this.frameBufferCache[b];if(c.controlId===a)return c}},d.prototype._renderContent=function(a,b){var c=this.glCommandForRc(a);switch(a.content.shader?(c.shader=a.content.shader,a.content.shaderUniforms&&(c.shaderUniforms=this.createGLShaderUniforms(a.content.shaderUniforms,a.content.shader))):a.content.shaderSource&&this.configureShaderSourceForCommand(c,a.content.shaderSource,a.content.shaderUniforms),a.content.blendMode){case"alpha":c.blendMode=p.BlendMode.Alpha;break;case"solid":c.blendMode=p.BlendMode.Solid;break;case"additive":c.blendMode=p.BlendMode.Additive;break;case"multiply":c.blendMode=p.BlendMode.Multiply}if("solid"===a.content.blendMode&&a.content.opacity<1&&(c.blendMode=p.BlendMode.Alpha),a.content.maskType&&"none"!==a.content.maskType&&(c.writeToStencil=!0,c.maskIsPositive="positive"===a.content.maskType),j(c.color,a.content.color),a.content.imageTextureControlId){var d=this.getFrameBufferWithId(a.content.imageTextureControlId);if(d&&(c.texture=d.texture,d.contentSrcRect&&c.srcRect)){var f=d.contentSrcRect[0],h=d.contentSrcRect[1],i=d.contentSrcRect[2]-f,m=d.contentSrcRect[3]-h;c.srcRect=[f,h,f+(c.srcRect[2]-c.srcRect[0])*i,h+(c.srcRect[3]-c.srcRect[1])*m]}}else a.content.image?(c.texture=this.textureCache.getTexture(a.content.imagePath,a.content.image),c.texture.refCount=1,c.texture.videoDOMNode&&c.texture.updateVideoTexture()):"text"===a.content.type||"textInput"===a.content.type?(c.texture=this.textCache.getTextTexture(a,this.renderScale,a.content.color),c.shader=this.defaultTextShader):c.texture=this.webGLHelper.whiteTexture();if("circle"===a.content.type){var n=this._getCircle(a);this.circleShader||(this.circleShader=s.createShader(this.webGLHelper)),l(n.getMesh(),this.circleShader,a,c,this.clipRects[this.clipRects.length-1])}else if("image"===a.content.type&&a.content.vertices)this.fillVerticesRenderCommand(a,c,a.content.vertices,a.transform,null);else if("rectangle"===a.content.type&&!1===u.cornerTooSmall(a.content.cornerRadius,a.content.blur)||"image"===a.content.type&&a.content.cornerRadius>0)if(a.content.blur){var o=this._getBlurredRoundedRectangle(a);this.blurredRoundedRectangleShader||(this.blurredRoundedRectangleShader=u.createShader(this.webGLHelper)),l(o.getMesh(),this.blurredRoundedRectangleShader,a,c,this.clipRects[this.clipRects.length-1])}else{this.roundedRectCache[a.id]||(this.roundedRectCache[a.id]=new v);var o=this.roundedRectCache[a.id],q=a.content.cornerRadius;a.width<2*q&&(q=a.width/2),a.height<2*q&&(q=a.height/2);var r=c.color,t=[r[0]*a.content.opacity,r[1]*a.content.opacity,r[2]*a.content.opacity,a.content.opacity];o.setColor(t),o.setWidth(a.width),o.setHeight(a.height),o.setCornerRadius(q),c.srcRect&&o.setSourceRect(c.srcRect),o.updateMesh(),c.vertexIndex=this.numFloatsThisFrame/this.defaultShader.numComponentsPerVertex,this.appendBufferToDefaultMesh(o.vertices),this.transformRoundedRectVertices(c,a.transform,o.vertices.length),e(B,C,D,E,a.width,a.height,a.transform),g(B,C,D,E,c,this.clipRects[this.clipRects.length-1]),c.mesh=this.defaultMesh,c.numVertices=o.vertices.length/this.defaultShader.numComponentsPerVertex}else"mesh"===a.content.type&&a.content.mesh&&a.content.shader&&a.content.mesh.vertices&&a.content.mesh.vertices.length>0?l(a.content.mesh,a.content.shader,a,c,this.clipRects[this.clipRects.length-1]):(k(this.tempVertices,a,c,this.clipRects[this.clipRects.length-1]),c.vertexIndex=this.numFloatsThisFrame/this.defaultShader.numComponentsPerVertex,this.appendBufferToDefaultMesh(this.tempVertices),c.mesh=this.defaultMesh);b.push(c)},d.prototype.fillVerticesRenderCommand=function(a,b,c,d,e){var f=c.data;if(c.range&&(f=f.subarray(c.range[0],c.range[1])),a.id in this.meshCache){var g=this.meshCache[a.id];g.vertices.length!==f.length?g.vertices=new Float32Array(f):g.vertices.set(f),g.indices=c.indices,g.vertexDataDirty=!0}else this.meshCache[a.id]=this.webGLHelper.createMesh({vertices:new Float32Array(f),indices:c.indices,primitiveType:t.PrimitiveTypeFromString(c.format)});var g=this.meshCache[a.id];b.mesh=this.mesh,b.vertexIndex=0;for(var h=null,i=null,j=0;j<b.shader.attributes.length;j++){var k=b.shader.attributes[j];-1!==k.name.search("a_position")?h=k:-1!==k.name.search("a_uv")&&(i=k)}var m=[0,0,0,0];if(h)for(var c=g.vertices,o=h.offset,j=0;j<c.length;j+=b.shader.numComponentsPerVertex){for(var p=0;p<Math.min(4,h.numComponents);p++)m[p]=c[j+p+o];n.transformPoint(d,m);for(var p=0;p<Math.min(4,h.numComponents);p++)c[j+p+o]=m[p]}if(i&&e)for(var o=i.offset,q=e,r=q.min[0]/this.webGLHelper.renderWidth,s=q.max[0]/this.webGLHelper.renderWidth,u=q.min[1]/this.webGLHelper.renderHeight,v=q.max[1]/this.webGLHelper.renderHeight,j=0;j<c.length;j+=b.shader.numComponentsPerVertex){var w=c[j+o],x=c[j+o+1];w=r+w*(s-r),x=u+x*(v-u),x=1-x,c[j+o]=w,c[j+o+1]=x}l(g,b.shader,a,b,this.clipRects[this.clipRects.length-1]),b.worldTransform=null,b.numVertices=f.length/b.shader.numComponentsPerVertex},d.prototype.transformRoundedRectVertices=function(a,b,c){for(var d=a.vertexIndex*this.defaultShader.numComponentsPerVertex,e=d+c,f=this.defaultMesh.vertices,g=[0,0,0],h=d;h<e;h+=this.defaultShader.numComponentsPerVertex)g[0]=f[h],g[1]=f[h+1],g[2]=f[h+2],n.transformPoint(b,g),f[h]=g[0],f[h+1]=g[1],f[h+2]=g[2]},d.prototype.appendBufferToDefaultMesh=function(a){var b=this.numFloatsThisFrame;this.numFloatsThisFrame+=a.length,this.validateDefaultMeshBufferSize(),this.defaultMesh.vertices.set(a,b),this.defaultMesh.vertexDataDirty=!0},d.prototype.validateDefaultMeshBufferSize=function(){if(this.numFloatsThisFrame>this.defaultMesh.vertices.length){var a=new Float32Array(2*this.numFloatsThisFrame);a.set(this.defaultMesh.vertices,0),this.defaultMesh.vertices=a}},d.prototype.removeResourcesForRenderCommand=function(a){for(var b=0;b<this.frameBufferCache.length;b++){var c=this.frameBufferCache[b];if(c.controlId===a.id){c.dispose(),this.frameBufferCache.splice(b,1),c=null;break}}"rectangle"===a.content.type&&this.roundedBlurredRectCache.hasOwnProperty(a.id)?(this.roundedBlurredRectCache[a.id].dispose(),delete this.roundedBlurredRectCache[a.id]):"image"!==a.content.type&&"rectangle"!==a.content.type||!this.roundedRectCache.hasOwnProperty(a.id)?"circle"===a.content.type&&this.circleCache.hasOwnProperty(a.id)?(this.circleCache[a.id].dispose(),delete this.circleCache[a.id]):this.meshCache.hasOwnProperty(a.id)?(this.meshCache[a.id].dispose(),delete this.meshCache[a.id]):"text"!==a.content.type&&"textInput"!==a.content.type||this.textCache.textResourceRemoved(a.id):(this.roundedRectCache[a.id].dispose(),delete this.roundedRectCache[a.id])},d.prototype.beginFrame=function(){this.webGLHelper.beginFrame(),this.webGLHelper.bindRenderTarget(0),this.numFloatsThisFrame=0,this.markFrameBuffersUnused()},d.prototype.restoreClipState=function(){this.clipRects=[o.create()],o.set(this.clipRects[0],0,0,this.viewportWidth,this.viewportHeight)},d.prototype.endFrame=function(){this.restoreClipState(),this.removeUnusedFramebuffers()},d.prototype._getCircle=function(a){this.circleCache[a.id]||(this.circleCache[a.id]=new s(this.webGLHelper));var b=this.circleCache[a.id];return b.setSize(a.width),b.setArcAngle(a.content.arcAngle),b.setSolid(a.content.solid),b.setLineWidth(a.content.lineWidth),b.setBlur(Math.max(1,a.content.blur)),b.updateMesh(),b},d.prototype._getBlurredRoundedRectangle=function(a){this.roundedBlurredRectCache[a.id]||(this.roundedBlurredRectCache[a.id]=new u(this.webGLHelper));var b=this.roundedBlurredRectCache[a.id],c=a.content.cornerRadius;return a.width<2*c&&(c=a.width/2),a.height<2*c&&(c=a.height/2),b.setWidth(a.width),b.setHeight(a.height),b.setBlur(a.content.blur),b.setCornerRadius(c),a.content.srcRect&&b.setSourceRect(a.content.srcRect),b.updateMesh(),b},d.prototype.detach=function(){m.prototype.detach.call(this),this.textCache.clear(),this.textureCache.clear();var a=this.roundedBlurredRectCache;Object.keys(a).forEach(function(b){a[b].dispose()}),this.roundedBlurredRectCache={};var b=this.roundedRectCache;Object.keys(b).forEach(function(a){b[a].dispose()}),this.roundedRectCache={};var c=this.circleCache;Object.keys(c).forEach(function(a){c[a].dispose()}),this.circleCache={};var d=this.meshCache;Object.keys(d).forEach(function(a){d[a].dispose()}),this.meshCache={},this.circleCache={};for(var e=0;e<this.frameBufferCache.length;e++)this.frameBufferCache[e].dispose();this.frameBufferCache=[];var f=this.shaderCache,g=this;Object.keys(f).forEach(function(a){var b=f[a];g.webGLHelper.deleteShader(b.shader)}),this.shaderCache={}},d.prototype.clearImageCache=function(){this.textureCache.clear()};var B=[0,0,0],C=[0,0,0],D=[0,0,0],E=[0,0,0],F=[0,0],G=[0,0];d.prototype._createDefaultTextShader=function(){return this.createShader({vertexSource:["uniform mat4 u_projection;","uniform mat4 u_view;","attribute vec3 a_position;","attribute vec2 a_uv;","attribute vec4 a_color;","varying mediump vec2 uv;","varying lowp vec4 color;","void main(void) {","   gl_Position = u_projection * u_view * vec4(a_position, 1.0);","   uv = a_uv;","   color = a_color;","}"].join("\n"),fragmentSource:["uniform sampler2D texture;","uniform lowp float u_opacity;","varying mediump vec2 uv;","varying lowp vec4 color;","void main(void) {","    lowp vec4 texColor = texture2D(texture, uv);","    gl_FragColor = texColor*color.a;","}"].join("\n")})},b.exports=d},{"../math/aabb":193,"../math/mat4":195,"./renderer-canvas-base":201,"./webgl/circle":205,"./webgl/framebuffer-effects":207,"./webgl/mesh":208,"./webgl/roundedrect":210,"./webgl/roundedrect-standard":209,"./webgl/text-cache":212,"./webgl/texture":213,"./webgl/texturecache":214,"./webgl/webglhelper":215}],205:[function(a,b,c){"use strict";function d(a,b,c){return Math.max(a,Math.min(b,c))}function e(a,b){b=b||{},this.solid=!b.hasOwnProperty("solid")||b.solid,this.radius=b.size/2||100,this.lineWidth=b.lineWidth||1,this.blurDistance=b.hasOwnProperty("blur")?b.blur:2,this.arcAngle=b.hasOwnProperty("arcAngle")?d(0,2*Math.PI,b.arcAngle):2*Math.PI,this.error=b.error||.075,this.meshDirty=!0,this._calculateVertices(),this.mesh=a.createMesh({vertices:this.vertices,indices:this.indices,primitiveType:g.PrimitiveType.TriangleStrip})}function f(a){var b=["uniform mat4 u_projection;","uniform mat4 u_view;","uniform mat4 u_world;","uniform mediump vec4 u_srcRect;","uniform lowp float u_flipTexCoordY;","attribute vec2 a_position;","attribute vec2 a_uv;","attribute float aBlur;","attribute float aVertexOpacity;","varying mediump vec2 uv;","varying lowp float blur;","varying lowp float vertexOpacity;","void main(void) {","   gl_Position = u_projection * u_view * u_world * vec4(a_position, 0.0, 1.0);","   uv = u_srcRect.xy + a_uv * (u_srcRect.zw - u_srcRect.xy);","   if(u_flipTexCoordY > 0.0) { uv.y = 1.0 - uv.y; }","   blur = aBlur;","   vertexOpacity = aVertexOpacity;","}"].join("\n"),c=["uniform sampler2D texture;","uniform lowp vec3 u_color;","uniform lowp float u_opacity;","varying mediump vec2 uv;","varying lowp float blur;","varying lowp float vertexOpacity;","void main(void) {","   lowp float intensity = smoothstep(0.0, 1.0, blur*vertexOpacity);","   gl_FragColor = texture2D(texture, uv)*vec4(u_color,1.0)*(u_opacity*intensity);","}"].join("\n");return a.createShader({vertexSource:b,fragmentSource:c})}var g=a("./mesh");e.prototype._calculateVertices=function(){function a(a,c,d,e){var f=Math.cos(d-.5*Math.PI),g=Math.sin(d-.5*Math.PI);n[i++]=a+b*f,n[i++]=c+b*g,n[i++]=(n[i-3]+o)/(2*b),n[i++]=(n[i-3]+o)/(2*b),n[i++]=0,n[i++]=e,n[i++]=a+p*f,n[i++]=c+p*g,n[i++]=(n[i-3]+o)/(2*b),n[i++]=(n[i-3]+o)/(2*b),n[i++]=1,n[i++]=e,n[i++]=a+j*f,n[i++]=c+j*g,n[i++]=(n[i-3]+o)/(2*b),n[i++]=(n[i-3]+o)/(2*b),n[i++]=1,n[i++]=e,n[i++]=a+k*f,n[i++]=c+k*g,n[i++]=(n[i-3]+o)/(2*b),n[i++]=(n[i-3]+o)/(2*b),n[i++]=0,n[i++]=e}var b=this.radius+this.blurDistance,c=Math.acos(2*(1-this.error/b)*(1-this.error/b)-1),d=Math.ceil(this.arcAngle/c),e=24,f=this.arcAngle<2*Math.PI;this.arcAngle>0&&d<4&&(d=2);var g=d;f&&(g+=2);var h=g*e;this.vertices&&this.vertices.length===h||(this.vertices=new Float32Array(h));var i=0,j=this.radius-this.lineWidth,k=j-this.blurDistance,l=this.radius,m=this.radius;this.solid&&(j=0,k=0);var n=this.vertices,o=this.blurDistance,p=this.radius;f&&a(l,m-this.blurDistance,0,0);var q;for(q=0;q<d;++q){var r=q/(d-1);a(l,m,this.arcAngle*r,1)}f&&a(l-Math.sin(this.arcAngle)*o,m+Math.cos(this.arcAngle)*o,this.arcAngle,0);var s=8*(g-1);for(this.indices&&this.indices.length===s||(this.indices=new Uint16Array(s)),i=0,q=0;q<g-1;++q){var t;if(q%2==0)for(t=0;t<4;++t)this.indices[i++]=4*q+t,this.indices[i++]=4*(q+1)+t;else for(t=0;t<4;++t)this.indices[i++]=4*q+3-t,this.indices[i++]=4*(q+1)+3-t}},e.prototype.updateMesh=function(){!1!==this.meshDirty&&(this._calculateVertices(),this.mesh.vertices=this.vertices,this.mesh.indices=this.indices,this.mesh.vertexDataDirty=!0,this.meshDirty=!1)},e.prototype.setSize=function(a){this.radius!==a/2&&(this.radius=a/2,this.meshDirty=!0)},e.prototype.setLineWidth=function(a){this.lineWidth!==a&&(this.lineWidth=a,this.meshDirty=!0)},e.prototype.setSolid=function(a){this.solid!==a&&(this.solid=a,this.meshDirty=!0)},e.prototype.setBlur=function(a){this.blurDistance!==a&&(this.blurDistance=a,this.meshDirty=!0)},e.prototype.setArcAngle=function(a){a=d(0,2*Math.PI,a),this.arcAngle!==a&&(this.arcAngle=a,this.meshDirty=!0)},e.prototype.getMesh=function(){return this.mesh},e.prototype.dispose=function(){this.mesh.dispose()},e.createShader=function(a){return f(a)},b.exports=e},{"./mesh":208}],206:[function(a,b,c){"use strict";function d(a,b){this.texture=b.texture;var c,d,e=a.getParameter(a.FRAMEBUFFER_BINDING),f=a.createFramebuffer();a.bindFramebuffer(a.FRAMEBUFFER,f),a.framebufferTexture2D(a.FRAMEBUFFER,a.COLOR_ATTACHMENT0,a.TEXTURE_2D,this.texture.handle,0),b.stencilBuffer?(d=a.createRenderbuffer(),a.bindRenderbuffer(a.RENDERBUFFER,d),a.renderbufferStorage(a.RENDERBUFFER,a.STENCIL_INDEX8,b.width,b.height),a.framebufferRenderbuffer(a.FRAMEBUFFER,a.STENCIL_ATTACHMENT,a.RENDERBUFFER,d)):b.depthBuffer&&(c=a.createRenderbuffer(),a.bindRenderbuffer(a.RENDERBUFFER,c),a.renderbufferStorage(a.RENDERBUFFER,a.DEPTH_COMPONENT16,b.width,b.height),a.framebufferRenderbuffer(a.FRAMEBUFFER,a.DEPTH_ATTACHMENT,a.RENDERBUFFER,c)),this.stencilRenderBuffer=d,this.depthRenderBuffer=c;var g=a.checkFramebufferStatus(a.FRAMEBUFFER);switch(g){case a.FRAMEBUFFER_COMPLETE:break;case a.FRAMEBUFFER_INCOMPLETE_ATTACHMENT:console.log("Incomplete framebuffer: FRAMEBUFFER_INCOMPLETE_ATTACHMENT");break;case a.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:console.log("Incomplete framebuffer: FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT");break;case a.FRAMEBUFFER_INCOMPLETE_DIMENSIONS:console.log("Incomplete framebuffer: FRAMEBUFFER_INCOMPLETE_DIMENSIONS");break;case a.FRAMEBUFFER_UNSUPPORTED:console.log("Incomplete framebuffer: FRAMEBUFFER_UNSUPPORTED");break;default:console.log("Incomplete framebuffer: "+g)}a.bindFramebuffer(a.FRAMEBUFFER,e),this.fbo=f,this.gl=a,this.width=b.width,this.height=b.height}d.prototype.dispose=function(){this.texture&&(this.texture.dispose(),this.texture=null),this.stencilRenderBuffer&&(this.gl.deleteRenderbuffer(this.stencilRenderBuffer),this.stencilRenderBuffer=null),this.depthRenderBuffer&&(this.gl.deleteRenderbuffer(this.depthRenderBuffer),this.depthRenderBuffer=null),this.fbo&&(this.gl.deleteFramebuffer(this.fbo),this.fbo=null)},b.exports=d},{}],207:[function(a,b,c){function d(a,b){for(var c=0;;){for(var d=!0,e=0,f=!1,g=[],h=!1,i=0;i<a.length;i++){var j=a[i];if(-1!==j.search("#ifdef")){if(++e>1){g.push(j),h=!0;continue}var k=j.split("#ifdef");k=k[k.length-1].trim(),k in b?(d=!0,f=!0):d=!1}else if(-1!==j.search("#elif ")){if(e>1){g.push(j);continue}if(f)d=!1;else{var k=j.split("#elif");k=k[k.length-1].trim(),k in b&&(d=!0,f=!0)}}else if(-1!==j.search("#else")){if(e>1){g.push(j);continue}f?d=!1:(d=!0,f=!0)}else if(-1!==j.search("#endif")){if(--e>0){g.push(j);continue}if(d=!0,f=!1,e<0)throw new Error("Invalid #ifdef syntax")}else d&&g.push(j)}if(!h)break;a=g,g=[],c++}return g.join("\n")}function e(a){a=a||0;var b=""+a;return b=b.replace(",","."),-1===b.indexOf(".")&&(b+=".0"),b}function f(a,b){for(var c=new Float32Array(a+1),d=0,e=0;e<a+1;e++)c[e]=1/Math.sqrt(2*Math.PI*Math.pow(b,2))*Math.exp(-Math.pow(e,2)/(2*Math.pow(b,2))),d+=0==e?c[e]:2*c[e];for(var e=0;e<a+1;e++)c[e]=c[e]/d;return c}function g(a,b,c,d){for(var e=Math.min(a/2+a%2,c-1),f=new Float32Array(e),g=0;g<e;g++){var h=b[2*g+1],i=b[2*g+2],j=h+i;j=j||0,f[g]=(h*(2*g+1)+i*(2*g+2))/j,d&&d(g,j)}return f}function h(a,b,c,h,i){a=Math.floor(a);var j=f(a,b),k=g(a,j,c),l={};h&&(l.USE_MASK=!0),i&&(l.FLIP_MASK=!0);var m=["attribute vec3 a_position;","attribute vec2 a_uv;","attribute vec4 a_color;","","uniform highp mat4 u_projection;","uniform highp mat4 u_view;","","uniform lowp float opacity;","uniform lowp float amount;","uniform lowp float texelWidthOffset;","uniform lowp float texelHeightOffset;","#ifdef USE_MASK","uniform lowp vec4 maskRect;","#endif",""];m.push("varying lowp vec4 bc["+(1+k.length)+"];"),m=m.concat(["","void main()","{","    gl_Position = u_projection * u_view * vec4(a_position, 1.0);","    // Force usage of a_color so it's not optimized away. Will","    // always be 1 since blur and tint don't combine","    lowp vec2 offset = vec2(texelWidthOffset * a_color.x, texelHeightOffset);\n","    bc[0].xy = a_uv.xy;","#ifdef USE_MASK","    bc[0].zw = (a_uv.xy - maskRect.xy) / (maskRect.zw - maskRect.xy);","#ifdef FLIP_MASK","    bc[0].w = 1.0 - bc[0].w;","#endif","#endif"]);for(var n=0;n<k.length;n++)m.push("    bc["+(n+1)+"].xy = a_uv.xy + offset * "+e(k[n])+";"),m.push("    bc["+(n+1)+"].zw = a_uv.xy - offset * "+e(k[n])+";");return m.push("}"),d(m,l)}function i(a,b,c,h,i){a=Math.floor(a);var j=f(a,b),k=Math.min(a/2+a%2,c-1),l=a/2+a%2,m={};h&&(m.USE_MASK=!0),i&&(m.FLIP_MASK=!0);var n=["uniform sampler2D texture;","uniform lowp float opacity;","uniform lowp float amount;","uniform lowp float texelWidthOffset;","uniform lowp float texelHeightOffset;","#ifdef USE_MASK","uniform sampler2D maskTexture;","#endif",""];n.push("varying lowp vec4 bc["+(1+k)+"];"),n=n.concat(["","void main()","{","    lowp vec4 sum = vec4(0.0);"]),n.push("    sum += texture2D(texture, bc[0].xy) * "+e(j[0])+";");g(a,j,c,function(a,b){b=e(b),n.push("    sum += texture2D(texture, bc["+(a+1)+"].xy) * "+b+";"),n.push("    sum += texture2D(texture, bc["+(a+1)+"].zw) * "+b+";")});if(l>k){n.push("    lowp vec2 offset = vec2(texelWidthOffset, texelHeightOffset);");for(var o=k;o<l;o++){var p=j[2*o+1],q=j[2*o+2],r=p+q,s=(p*(2*o+1)+q*(2*o+2))/r;s=e(s),r=e(r),n.push("    sum += texture2D(texture, bc[0].xy + offset * "+s+") * "+r+";"),n.push("    sum += texture2D(texture, bc[0].xy - offset * "+s+") * "+r+";")}}return n.push("    sum *= opacity;"),n=n.concat(["#ifdef USE_MASK","    lowp vec4 maskColor = texture2D(maskTexture, bc[0].zw);","    gl_FragColor = sum * maskColor.aaaa;","#else","    gl_FragColor = sum;","#endif"]),n.push("}"),d(n,m)}var j={};j.generateGaussianBlurShaders=function(a,b,c,d){var e=1;if(a>=1){var f=1/256
;e=Math.floor(Math.sqrt(-2*Math.pow(a,2)*Math.log(f*Math.sqrt(2*Math.PI*Math.pow(a,2))))),e=Math.round(e),e+=e%2}return{vertexSource:h(e,a,b,c,d),fragmentSource:i(e,a,b,c,d)}},j.getMaskShaders=function(a){var b={};a&&(b.FLIP_MASK=!0);var c=["uniform mat4 u_projection;","uniform mat4 u_view;","uniform lowp vec4 maskRect;","attribute vec3 a_position;","attribute vec2 a_uv;","attribute vec4 a_color;","varying mediump vec2 uv;","varying mediump vec2 maskUv;","varying lowp vec4 color;","void main(void) {","   gl_Position = u_projection * u_view * vec4(a_position, 1.0);","   maskUv = (a_uv.xy - maskRect.xy) / (maskRect.zw - maskRect.xy);","#ifdef FLIP_MASK","   maskUv.y = 1.0 - maskUv.y;","#endif","   uv = a_uv;","   color = a_color;","}"],e=["uniform sampler2D texture;","uniform sampler2D maskTexture;","varying mediump vec2 uv;","varying mediump vec2 maskUv;","varying lowp vec4 color;","void main(void) {","    lowp vec4 maskColor = texture2D(maskTexture, maskUv);","    lowp vec4 maskVec = vec4(maskColor.a, maskColor.a, maskColor.a, maskColor.a);","    gl_FragColor = texture2D(texture, uv) * color * maskVec;","}"];return{vertexSource:d(c,b),fragmentSource:d(e,b)}},j.getDesaturateShaders=function(a,b){var c={};a&&(c.USE_MASK=!0),b&&(c.FLIP_MASK=!0);var e=["uniform mat4 u_projection;","uniform mat4 u_view;","attribute vec3 a_position;","attribute vec2 a_uv;","attribute vec4 a_color;","varying mediump vec2 uv;","varying lowp vec4 color;","#ifdef USE_MASK","varying mediump vec2 maskUv;","uniform lowp vec4 maskRect;","#endif","","void main(void) {","    gl_Position = u_projection * u_view * vec4(a_position, 1.0);","    uv = a_uv;","#ifdef USE_MASK","   maskUv = (a_uv.xy - maskRect.xy) / (maskRect.zw - maskRect.xy);","#ifdef FLIP_MASK","   maskUv.y = 1.0 - maskUv.y;","#endif","#endif","    color = a_color;","}"],f=["uniform sampler2D texture;","uniform mediump float amount;","varying mediump vec2 uv;","varying lowp vec4 color;","#ifdef USE_MASK","varying mediump vec2 maskUv;","uniform sampler2D maskTexture;","#endif","void main(void) {","    mediump vec4 tex = texture2D(texture, uv);","    mediump float lum = dot( vec3(tex[0], tex[1], tex[2]), vec3(0.22, 0.707, 0.071) );","#ifdef USE_MASK","    lowp vec4 maskColor = texture2D(maskTexture, maskUv);","    lowp vec4 maskVec = vec4(maskColor.a, maskColor.a, maskColor.a, maskColor.a);","    gl_FragColor = color*vec4(mix(tex[0], lum, amount),","                              mix(tex[1], lum, amount),","                              mix(tex[2], lum, amount),","                              tex[3]) * maskVec;","#else","    gl_FragColor = color*vec4(mix(tex[0], lum, amount),","                              mix(tex[1], lum, amount),","                              mix(tex[2], lum, amount),","                              tex[3]);","#endif","}"];return{vertexSource:d(e,c),fragmentSource:d(f,c)}},b.exports=j},{}],208:[function(a,b,c){"use strict";function d(a,b){b=b||{},void 0===b.vertices&&(b.vertices=new Float32Array(0)),b.vertices instanceof Float32Array==!1&&console.error("Vertices must be of type Float32Array"),b.indices&&b.indices instanceof Uint16Array==!1&&console.error("Indices must be of type Uint16Array"),this.gl=a,this.vertexBuffer=a.createBuffer(),this.vertices=b.vertices,this.indexBuffer=null,this.indices=b.indices,b.primitiveType===d.PrimitiveType.Triangles?this.primitiveType=a.TRIANGLES:b.primitiveType===d.PrimitiveType.Lines?this.primitiveType=a.LINES:b.primitiveType===d.PrimitiveType.LineStrip?this.primitiveType=a.LINE_STRIP:b.primitiveType===d.PrimitiveType.TriangleFan?this.primitiveType=a.TRIANGLE_FAN:this.primitiveType=a.TRIANGLE_STRIP,this.vertexDataDirty=!0}d.prototype.bind=function(a,b){var c=this.gl;this.numComponentsPerVertex=b,c.bindBuffer(c.ARRAY_BUFFER,this.vertexBuffer);var d,e=0;for(d=c.numVertexAttribsEnabled;d<a.length;++d)c.enableVertexAttribArray(d);for(d=a.length;d<c.numVertexAttribsEnabled;++d)c.disableVertexAttribArray(d);for(c.numVertexAttribsEnabled=a.length,d=0;d<a.length;++d){var f=a[d];c.vertexAttribPointer(d,f.numComponents,c.FLOAT,!1,4*b,4*e),e+=f.numComponents}null===this.indexBuffer&&this.indices&&this.indices.length>0&&(this.indexBuffer=c.createBuffer()),c.bindBuffer(c.ELEMENT_ARRAY_BUFFER,this.indexBuffer)},d.prototype.syncVertexData=function(){var a=this.gl;this.vertexDataDirty&&(this.indices&&this.indices.length>0&&a.bufferData(a.ELEMENT_ARRAY_BUFFER,this.indices,a.STATIC_DRAW),a.bufferData(a.ARRAY_BUFFER,this.vertices,a.STREAM_DRAW),this.vertexDataDirty=!1)},d.prototype.draw=function(){this.syncVertexData();var a=this.gl,b=0;this.indexBuffer?a.drawElements(this.primitiveType,this.indices.length,a.UNSIGNED_SHORT,0):(b=this.vertices.length/this.numComponentsPerVertex,a.drawArrays(this.primitiveType,0,b))},d.prototype.drawVertexRange=function(a,b){this.syncVertexData();var c=this.gl;this.indexBuffer?c.drawElements(this.primitiveType,b,c.UNSIGNED_SHORT,2*a):c.drawArrays(this.primitiveType,a,b)},d.prototype.dispose=function(){this.gl.deleteBuffer(this.vertexBuffer),this.indexBuffer&&this.gl.deleteBuffer(this.indexBuffer)},d.PrimitiveType={TriangleStrip:0,Triangles:1,Lines:2,LineStrip:3,TriangleFan:4},d.PrimitiveTypeFromString=function(a){return"triangle_strip"===a?d.PrimitiveType.TriangleStrip:"triangles"===a?d.PrimitiveType.Triangles:"lines"===a?d.PrimitiveType.Lines:"line_strip"===a?d.PrimitiveType.LineStrip:"triangle_fan"===a?d.PrimitiveType.TriangleFan:d.PrimitiveType.Triangles},b.exports=d},{}],209:[function(a,b,c){"use strict";function d(){this.width=0,this.height=0,this.sourceRect=[0,0,1,1],this.dirty=!0,this.color=[1,1,1,1]}var e=(a("./mesh"),9);d.prototype._generateMesh=function(){function a(a){return 3*(a.numSegments+1)}function b(){var b=0;return h.forEach(function(c){b+=a(c)*e}),b+16*e}function c(a,b,c){a[p++]=b,a[p++]=c,a[p++]=0,a[p++]=m+b/i*k,a[p++]=n+c/j*l,a[p++]=o[0],a[p++]=o[1],a[p++]=o[2],a[p++]=o[3]}function d(a,b,d,e,f){for(var g=r/b.numSegments,h=0;h<=b.numSegments;++h){var i=Math.cos(f+h*g),j=Math.sin(f+h*g);c(a,d,e),c(a,d+b.radius*i,e-b.radius*j),c(a,d+b.radius*i,e-b.radius*j)}}function f(a){d(a,h[0],h[0].radius,h[0].radius,Math.PI/2),c(a,0,h[0].radius),c(a,h[0].radius,h[0].radius),c(a,0,j-h[1].radius),d(a,h[1],h[1].radius,j-h[1].radius,Math.PI),c(a,h[1].radius,j-h[1].radius),c(a,i-h[2].radius,j),c(a,h[1].radius,j-h[1].radius),c(a,h[1].radius,j-h[1].radius),d(a,h[2],i-h[2].radius,j-h[2].radius,3*Math.PI/2),c(a,i,h[3].radius),c(a,i-h[2].radius,j-h[2].radius),c(a,i-h[2].radius,h[3].radius),d(a,h[3],i-h[3].radius,h[3].radius,0),c(a,h[0].radius,0),c(a,i-h[3].radius,0),c(a,h[0].radius,h[0].radius),c(a,i-h[3].radius,h[3].radius),c(a,h[0].radius,j-h[1].radius),c(a,i-h[3].radius,j-h[2].radius)}function g(){h.forEach(function(a){if(0===a.radius)a.numSegments=1;else{var b=1-q/a.radius,c=Math.acos(2*b*b-1);a.numSegments=Math.ceil(r/c)}})}var h=this.corners,i=this.width,j=this.height,k=this.sourceRect[2]-this.sourceRect[0],l=this.sourceRect[3]-this.sourceRect[1],m=this.sourceRect[0],n=this.sourceRect[1],o=this.color,p=0,q=.2,r=Math.PI/2;g();var s=b();void 0!==this.vertices&&this.vertices.length===s||(this.vertices=new Float32Array(s)),f(this.vertices)},d.prototype.setCornerRadius=function(a){a=Math.max(0,a),this.corners&&this.corners[0].radius===a&&this.corners[1].radius===a&&this.corners[2].radius===a&&this.corners[3].radius===a||(a=Math.max(1,a),this.corners=[{radius:a},{radius:a},{radius:a},{radius:a}],this.dirty=!0)},d.prototype.setIndividualCornerRadii=function(a,b,c,d){this.corners=[{radius:Math.max(0,a)},{radius:Math.max(0,b)},{radius:Math.max(0,c)},{radius:Math.max(0,d)}],this.dirty=!0},d.prototype.updateMesh=function(){!1!==this.dirty&&(this._generateMesh(),this.dirty=!1)},d.cornerTooSmall=function(a){return a<.1},d.prototype.setSourceRect=function(a){this.sourceRect[0]===a[0]&&this.sourceRect[1]===a[1]&&this.sourceRect[2]===a[2]&&this.sourceRect[3]===a[3]||(this.sourceRect=a,this.dirty=!0)},d.prototype.setWidth=function(a){this.width!==a&&(this.width=a,this.dirty=!0)},d.prototype.setColor=function(a){this.color[0]===a[0]&&this.color[1]===a[1]&&this.color[2]===a[2]&&this.color[3]===a[3]||(this.color=a,this.dirty=!0)},d.prototype.setHeight=function(a){this.height!==a&&(this.height=a,this.dirty=!0)},d.prototype.dispose=function(){},b.exports=d},{"./mesh":208}],210:[function(a,b,c){"use strict";function d(a){this.width=0,this.height=0,this.sourceRect=[0,0,1,1],this.mesh=a.createMesh({vertices:new Float32Array(0),indices:new Uint16Array(0),primitiveType:e.PrimitiveType.TriangleStrip})}var e=a("./mesh");d.createShader=function(a){var b=["uniform mat4 u_projection;","uniform mat4 u_view;","uniform mat4 u_world;","uniform mediump vec4 u_srcRect;","uniform lowp float u_flipTexCoordY;","attribute vec2 a_position;","attribute vec2 a_uv;","attribute float a_blur;","varying mediump vec2 uv;","varying lowp float blur;","void main(void) {","   gl_Position = u_projection * u_view * u_world * vec4(a_position, 0.0, 1.0);","   uv = a_uv;","   if(u_flipTexCoordY > 0.0) { uv.y = 1.0 - uv.y; }","   blur = a_blur;","}"].join("\n"),c=["uniform sampler2D texture;","uniform lowp vec3 u_color;","uniform lowp float u_opacity;","varying mediump vec2 uv;","varying lowp float blur;","void main(void) {","   lowp float intensity = smoothstep(0.0, 1.0, blur);","   gl_FragColor = texture2D(texture, uv)*vec4(u_color,1.0)*(u_opacity*intensity);","}"].join("\n");return a.createShader({vertexSource:b,fragmentSource:c})},d.prototype._generateMesh=function(){function a(a){return(a.numSegments+1)*w}function b(){var b=0;return k.forEach(function(c){b+=a(c)*t}),b}function c(){var a=0;return k.forEach(function(b){a+=b.numSegments}),6*a+29}function d(a,b,c,d,e){for(var f=b.radius+n,g=v/b.numSegments,h=0;h<=b.numSegments;++h){var i=Math.cos(e+h*g),j=Math.sin(e+h*g);a[s++]=c,a[s++]=d,a[s++]=q+a[s-3]/l*o,a[s++]=r+a[s-3]/m*p,a[s++]=1,a[s++]=c+b.radius*i,a[s++]=d-b.radius*j,a[s++]=q+a[s-3]/l*o,a[s++]=r+a[s-3]/m*p,a[s++]=1,a[s++]=c+f*i,a[s++]=d-f*j,a[s++]=q+a[s-3]/l*o,a[s++]=r+a[s-3]/m*p,a[s++]=0}}function e(a){d(a,k[0],k[0].radius,k[0].radius,Math.PI/2),d(a,k[1],k[1].radius,m-k[1].radius,Math.PI),d(a,k[2],l-k[2].radius,m-k[2].radius,3*Math.PI/2),d(a,k[3],l-k[3].radius,k[3].radius,0)}function f(a,b,c){for(var d=c.startFromVertexIndex,e=!0===c.startFromInnerEdge?0:1,f=0;f<b.numSegments;++f){var g;if(f%2===e){for(g=0;g<w;++g)a[s++]=f*w+g+d,a[s++]=(f+1)*w+g+d;c.startFromInnerEdge=!1}else{for(g=0;g<w;++g)a[s++]=f*w+(w-1)-g+d,a[s++]=(f+1)*w+(w-1)-g+d;c.startFromInnerEdge=!0}}c.startFromVertexIndex=a[s-1]}function g(a,b){var c,d,e=x/t;!0===b.startFromInnerEdge?(c=b.startFromVertexIndex+w,d=b.startFromVertexIndex,a[s++]=d,a[s++]=c%e,a[s++]=d+1,a[s++]=(c+1)%e,a[s++]=d+2,a[s++]=(c+2)%e,b.startFromInnerEdge=!1):!1===b.startFromInnerEdge&&(c=b.startFromVertexIndex+1,d=b.startFromVertexIndex,a[s++]=d,a[s++]=(c+2)%e,a[s++]=d-1,a[s++]=(c+1)%e,a[s++]=d-2,a[s++]=c%e,b.startFromInnerEdge=!0),b.startFromVertexIndex=c}function h(b){var c=[a(k[0]),a(k[1]),a(k[2]),a(k[3])];b[s++]=0,b[s++]=0,b[s++]=c[0]+c[1]+c[2],b[s++]=c[0],b[s++]=c[0]+c[1]}function i(a){var b={startFromInnerEdge:!0,startFromVertexIndex:0};s=0,f(a,k[0],b),g(a,b),f(a,k[1],b),g(a,b),f(a,k[2],b),g(a,b),f(a,k[3],b),g(a,b),h(a)}function j(){k.forEach(function(a){if(0===a.radius)a.numSegments=1;else{var b=1-u/(a.radius+n),c=Math.acos(2*b*b-1);a.numSegments=Math.ceil(v/c)}})}var k=this.corners,l=this.width,m=this.height,n=this.blurDistance,o=this.sourceRect[2]-this.sourceRect[0],p=this.sourceRect[3]-this.sourceRect[1],q=this.sourceRect[0],r=this.sourceRect[1],s=0,t=5,u=.2,v=Math.PI/2,w=3;j();var x=b();void 0!==this.vertices&&this.vertices.length===x||(this.vertices=new Float32Array(x)),e(this.vertices);var y=c();void 0!==this.indices&&this.indices.length===y||(this.indices=new Uint16Array(y)),i(this.indices),this.mesh.vertices=this.vertices,this.mesh.indices=this.indices,this.mesh.vertexDataDirty=!0},d.prototype.setCornerRadius=function(a){a=Math.max(0,a),this.corners&&this.corners[0].radius===a&&this.corners[1].radius===a&&this.corners[2].radius===a&&this.corners[3].radius===a||(a=Math.max(1,a),this.corners=[{radius:a},{radius:a},{radius:a},{radius:a}],this.meshDirty=!0)},d.prototype.setIndividualCornerRadii=function(a,b,c,d){this.corners=[{radius:Math.max(0,a)},{radius:Math.max(0,b)},{radius:Math.max(0,c)},{radius:Math.max(0,d)}],this.meshDirty=!0},d.prototype.updateMesh=function(){!1!==this.meshDirty&&(this._generateMesh(),this.meshDirty=!1)},d.cornerTooSmall=function(a,b){return a+b<.1},d.prototype.setSourceRect=function(a){this.sourceRect[0]===a[0]&&this.sourceRect[1]===a[1]&&this.sourceRect[2]===a[2]&&this.sourceRect[3]===a[3]||(this.sourceRect=a,this.meshDirty=!0)},d.prototype.setBlur=function(a){this.blurDistance!==a&&(this.blurDistance=a,this.meshDirty=!0)},d.prototype.setWidth=function(a){this.width!==a&&(this.width=a,this.meshDirty=!0)},d.prototype.setHeight=function(a){this.height!==a&&(this.height=a,this.meshDirty=!0)},d.prototype.setBlur=function(a){this.blurDistance!==a&&(this.blurDistance=a,this.meshDirty=!0)},d.prototype.dispose=function(){this.mesh.dispose()},d.prototype.getMesh=function(){return this.mesh},b.exports=d},{"./mesh":208}],211:[function(a,b,c){function d(a,b,c){var d=a.createShader(c);if(a.shaderSource(d,b),a.compileShader(d),!a.getShaderParameter(d,a.COMPILE_STATUS)){var e=a.getShaderInfoLog(d);return console.warn("Shader compilation error:",e),console.log(b),{shader:null,error:{message:e,type:c==a.VERTEX_SHADER?"vertexShader":"fragmentShader"}}}return{shader:d,error:null}}function e(a,b,c){var d=1;switch(b.type){case"float":d=1;break;case"vec2":d=2;break;case"vec3":d=3;break;case"vec4":d=4}return{name:b.name,numComponents:d,offset:c}}function f(a,b,c){var d,e=j.extractStorageQualifier(c,"attribute"),f=a.getProgramParameter(b,a.ACTIVE_ATTRIBUTES),g={};for(d=0;d<f;++d)g[a.getActiveAttrib(b,d).name]=!0;for(d=0;d<e.length;)!0!==g[e[d].name]?e.splice(d,1):d++;return e}function g(a){switch(a){case"float":return 0;case"vec2":return[0,0];case"vec3":return[0,0,0];case"vec4":return[0,0,0,0]}return 0}function h(a,b,c){function d(d,e,f){Object.defineProperty(d,e,{set:function(d){null===c.value&&(c.value=g(b)),c.value[f]=d,a.hasDirtyUniforms=!0},get:function(){return c.value[f]}})}for(var e=Number(b[b.length-1]),f={},h=0;h<e;h++)for(var i=0;i<k[h].length;i++)d(f,k[h][i],h);return Object.defineProperty(f,"array",{get:function(){return c.value},set:function(a){if(a.length!==e)throw new Error("Uniform array: Array must be of size "+e);c.value=a}}),Object.freeze(f)}function i(a,b){if(!b.vertexSource)throw new Error("No vertex shader source");if(!b.fragmentSource)throw new Error("No fragment shader source");if(b.uniforms&&Array.isArray(b.uniforms))throw new Error("WebGLShader: old style uniforms is unsupported");this.program=a.createProgram(),this.attributes=[];var c=d(a,b.vertexSource,a.VERTEX_SHADER);if(c.error)return void(this.error=c.error);var h=b.fragmentSource+"\nvoid _haxAndroidShaderCache() { lowp float hax="+Math.random()+";}",i=d(a,h,a.FRAGMENT_SHADER);if(i.error)return void(this.error=i.error);if(a.attachShader(this.program,c.shader),a.attachShader(this.program,i.shader),this.vs=c.shader,this.fs=i.shader,a.linkProgram(this.program),!a.getProgramParameter(this.program,a.LINK_STATUS))return this.error=a.getProgramInfoLog(this.program),void console.warn("Shader link error:",this.error);var k=0,l=this;f(a,this.program,b.vertexSource).forEach(function(b,c){a.bindAttribLocation(l.program,c,b.name);var d=e(a,b,k);l.attributes.push(d),k+=d.numComponents}),a.linkProgram(this.program),this.numComponentsPerVertex=k,this.standardUniforms={},this._uniforms={},j.extractUniforms(b.vertexSource,b.fragmentSource).forEach(function(b){var c=a.getUniformLocation(l.program,b.name);j.StandardUniformNames[b.name]?l.standardUniforms[b.name]=c:l._uniforms[b.name]={type:b.type,location:c,value:g(b.type)}}),this.uniforms=this.createUniformSetters(this._uniforms),this.uniformNames=Object.keys(this._uniforms),this.hasDirtyUniforms=!0}var j=a("../../../shaderparser"),k=[["x","r","u"],["y","g","v"],["z","b"],["w","a"]];i.prototype.release=function(a){this.vs&&(a.detachShader(this.program,this.vs),a.deleteShader(this.vs)),this.fs&&(a.detachShader(this.program,this.fs),a.deleteShader(this.fs)),this.program&&a.deleteProgram(this.program)},i.prototype.createUniformSetters=function(a){var b={},c=this;return Object.keys(this._uniforms).forEach(function(d){var e=c._uniforms[d];"vec"!==e.type.substring(0,3)?Object.defineProperty(b,d,{set:function(b){a[d].value=b,c.hasDirtyUniforms=!0},get:function(){return a[d].value}}):b[d]=h(c,e.type,a[d])}),b},b.exports=i},{"../../../shaderparser":167}],212:[function(a,b,c){"use strict";function d(a){this.webGLHelper=a,this.textureCache=new e({freelistSize:50}),this.canvas=document.createElement("canvas")}var e=a("../../resourcecache");d.prototype._createNewTextTexture=function(a,b,c){var d=this.canvas;d.width=a.width*b,d.height=a.height*b;var e=d.getContext("2d");if(e.clearRect(0,0,d.width,d.height),e.font=a.content.fontSize*b+'px "'+a.content.fontFamily+'"',e.fillStyle=c,"text"===a.content.type)for(var f=0;f<a.content.lines.length;f++){var g=a.content.lines[f];e.fillText(g.text,g.x*b,g.y*b)}else if("textInput"===a.content.type){var h=.5*(a.height-a.content.textHeight);e.fillText(a.content.text,0,b*(h+a.content.baseline))}return this.webGLHelper.createTexture({canvas:d})},d.prototype.getTextTexture=function(a,b,c,d){var e=b+""+a.content.fontSize+a.content.fontFamily+c;return"text"===a.content.type?e+=a.content.lines.map(function(a){return a.x+" "+a.text}).join(""):e+=a.content.text,!1===this.textureCache.isInCache(e)&&this.textureCache.addResource(e,this._createNewTextTexture(a,b,c)),this.textureCache.updateReference(a.id,e),this.textureCache.getResource(e)},d.prototype.textResourceRemoved=function(a){this.textureCache.removeReference(a)},d.prototype.clear=function(){this.textureCache.clear()},b.exports=d},{"../../resourcecache":216}],213:[function(a,b,c){"use strict";function d(a,b){this.handle=0,this.size=[0,0],this.loaded=!1,this.path=null,this.target=null,this.gl=a,this.refCount=0,this.preloadedAndUnused=!1,this.keepForever=!1,this.sizeCallbacks=[],this._pixelDataChangedListeners=[],b.wrapMode=b.wrapMode||d.WrapMode.Clamp,b.filter=b.filter||d.Filter.Linear,b.pixels?this._uploadPixelData(b.pixels,b.width,b.height,b.wrapMode,b.filter):b.path instanceof Array?6==b.path.length?this._uploadCubemap(b.resourceDirectory,b.path,b.wrapMode,b.filter):console.error("Cubemap requries six image paths"):b.path&&b.domElement?this._uploadDomElement(b.domElement,b.path,b.wrapMode,b.filter):b.path?this._uploadImageData(b.resourceDirectory,b.path,b.wrapMode,b.filter):b.canvas?this._uploadCanvas(b.canvas,b.wrapMode,b.filter):b.video?this._uploadVideo(b.video,b.wrapMode,b.filter):this._uploadEmptyTexture(b.width,b.height,b.wrapMode,b.filter)}var e=0;d.prototype._uploadEmptyTexture=function(a,b,c,d){var e=this.gl;this._createAndBindHandle(e.TEXTURE_2D,c,d),e.texImage2D(this.target,0,e.RGBA,a,b,0,e.RGBA,e.UNSIGNED_BYTE,null),this._textureDataLoaded(a,b)},d.prototype._uploadPixelData=function(a,b,c,d,e){if(Array.isArray(a))a=new Uint8Array(a);else if(a instanceof Uint8Array==!1)throw new Error("pixels must be an array or Uint8Array");var f=this.gl;this._createAndBindHandle(f.TEXTURE_2D,d,e),f.bindTexture(this.target,this.handle),f.texImage2D(this.target,0,f.RGBA,b,c,0,f.RGBA,f.UNSIGNED_BYTE,a),this._textureDataLoaded(b,c)},d.prototype._uploadVideo=function(a,b,c){this.videoDOMNode=a,this._createAndBindHandle(this.gl.TEXTURE_2D,b,c)},d.prototype._uploadImageData=function(a,b,c,d){var e=this.gl;this._createAndBindHandle(e.TEXTURE_2D,c,d);var f="http"===b.substring(0,4).toLowerCase(),g=new Image;f&&(g.crossOrigin="anonymous");var h=this;g.onload=function(){e.bindTexture(h.target,h.handle),e.pixelStorei(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!0),e.texImage2D(h.target,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,this),h._textureDataLoaded(this.width,this.height)},g.src=a+b,this.path=b},d.prototype._uploadDomElement=function(a,b,c,d){if("video"===a.tagName.toLowerCase())this._uploadVideo(a,c,d);else{var e=this.gl;this._createAndBindHandle(e.TEXTURE_2D,c,d),e.pixelStorei(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!0),e.texImage2D(this.target,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,a),this._textureDataLoaded(a.width,a.height)}this.path=b},d.prototype._uploadCubemap=function(a,b,c,d){var e=this.gl;this._createAndBindHandle(e.TEXTURE_CUBE_MAP,c,d);for(var f=[e.TEXTURE_CUBE_MAP_NEGATIVE_X,e.TEXTURE_CUBE_MAP_NEGATIVE_Y,e.TEXTURE_CUBE_MAP_NEGATIVE_Z,e.TEXTURE_CUBE_MAP_POSITIVE_X,e.TEXTURE_CUBE_MAP_POSITIVE_Y,e.TEXTURE_CUBE_MAP_POSITIVE_Z],g=this,h=0;h<6;++h){var i=new Image;i.crossOrigin="anonymous",i.onload=function(a){return function(){e.bindTexture(g.target,g.handle),e.texImage2D(f[a],0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,this),g._textureDataLoaded(this.width,this.height)}}(h),i.src=a+b[h]}},d.prototype._uploadCanvas=function(a,b,c){var d=this.gl;this._createAndBindHandle(d.TEXTURE_2D,b,c),d.bindTexture(this.target,this.handle),d.pixelStorei(d.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!0),d.texImage2D(this.target,0,d.RGBA,d.RGBA,d.UNSIGNED_BYTE,a);var e=window.devicePixelRatio||1;this._textureDataLoaded(a.width/e,a.height/e)},d.prototype.updateVideoTexture=function(){var a=this.videoDOMNode;if(a.readyState===a.HAVE_ENOUGH_DATA){var b=this.gl;b.bindTexture(this.target,this.handle),b.texImage2D(this.target,0,b.RGBA,b.RGBA,b.UNSIGNED_BYTE,a),!1===this.loaded&&this._textureDataLoaded(a.videoWidth,a.videoHeight),this._notifyPixleDataChangedListeners()}},d.prototype.addPixelDataChangedListener=function(a){this._pixelDataChangedListeners.push(a)},d.prototype.removePixelDataChangedListener=function(a){var b=this._pixelDataChangedListeners.indexOf(a);if(-1===b)throw new Error("Listener is not added");this._pixelDataChangedListeners.splice(b,1)},d.prototype._notifyPixleDataChangedListeners=function(){for(var a=0;a<this._pixelDataChangedListeners.length;++a)this._pixelDataChangedListeners[a].onTexturePixelDataChanged(this)},d.prototype._createAndBindHandle=function(a,b,c){var e=this.gl;this.handle=e.createTexture(),this.target=a,e.bindTexture(a,this.handle);var f;c===d.Filter.Nearest?f=e.NEAREST:c===d.Filter.Linear&&(f=e.LINEAR),e.texParameteri(a,e.TEXTURE_MAG_FILTER,f),e.texParameteri(a,e.TEXTURE_MIN_FILTER,f),b===d.WrapMode.Repeat?(e.texParameteri(a,e.TEXTURE_WRAP_S,e.REPEAT),e.texParameteri(a,e.TEXTURE_WRAP_T,e.REPEAT)):(e.texParameteri(a,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(a,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE)),this.wrapMode=b},d.prototype._textureDataLoaded=function(a,b){this.size=[a,b],this.loaded=!0,this._notifySizeCallbacks(this.size),e+=a*b*4},d.prototype._notifySizeCallbacks=function(a){if(0!==this.sizeCallbacks.length){for(var b=0;b<this.sizeCallbacks.length;++b)this.sizeCallbacks[b].callback(a);this.sizeCallbacks.length=0}},d.prototype.dispose=function(){this.gl.deleteTexture(this.handle)},d.WrapMode={Clamp:0,Repeat:1},d.Filter={Nearest:1,Linear:2},b.exports=d},{}],214:[function(a,b,c){"use strict";function d(a){this.webGLHelper=a,this.textureCache={}}d.prototype.getTexture=function(a,b){var c=this.textureCache[a];return c||(c=this.webGLHelper.createTexture({path:a,domElement:b}),this.textureCache[a]=c),c},d.prototype.flushUnused=function(){for(var a in this.textureCache){var b=this.textureCache[a];0===b.refCount&&!1===b.preloadedAndUnused&&!1===b.keepForever&&delete this.textureCache[a]}},d.prototype.evict=function(a){this.textureCache[a]?delete this.textureCache[a]:console.log("WebGLTextureCache.evict: texture doesn't exist: "+a)},d.prototype.clear=function(){this.textureCache={}},b.exports=d},{}],215:[function(a,b,c){"use strict";function d(a){return void 0!==a&&null!==a}function e(a,b,c){this.gl=a,this.gl.numVertexAttribsEnabled=0,this.screenCameraProjection=m.create(),this.screenCameraView=m.create(),this.fieldOfView=25,this._whiteTexture=null,this.identityMatrix=m.create(),this.currentBlendMode=e.BlendMode.Solid,this.currentRenderTarget=0,this.currentShader=0,this.currentUniformValues=null,this.currentViewMatrix=this.screenCameraView,this.currentProjectionMatrix=this.screenCameraProjection,this.currentDepthTestState=!1,this.currentScissorTestState=!1,this.currentStencilTestState=!1,this.currentBoundMesh=null,this.maskRenderingEnabled=!1,this.currentViewport={width:0,height:0},a.disable(a.CULL_FACE),a.clearColor(0,0,0,0),a.stencilMask(255),a.clearStencil(128),this.supportsEGLImageExternal=!!a.TEXTURE_EXTERNAL_OES,this.cameraMatricesDirty=!0,this.activeTexture=0,this.setVirtualSize(b,c),this.resourceDirectory="",this._defaultVsSource=["uniform mat4 u_projection;","uniform mat4 u_view;","attribute vec3 a_position;","attribute vec2 a_uv;","attribute vec4 a_color;","varying mediump vec2 uv;","varying lowp vec4 color;","void main(void) {","   gl_Position = u_projection * u_view * vec4(a_position, 1.0);","   uv = a_uv;","   color = a_color;","}"].join("\n"),this._defaultFsSource=["uniform sampler2D texture;","varying mediump vec2 uv;","varying lowp vec4 color;","void main(void) {","    gl_FragColor = texture2D(texture, uv)*color;","}"].join("\n"),this._videoFsSource=["#extension GL_OES_EGL_image_external : require","uniform samplerExternalOES texture;","varying mediump vec2 uv;","varying lowp vec4 color;","void main(void) {","    gl_FragColor = texture2D(texture, uv)*color;","}"].join("\n"),this._imageMaskFsSource=["uniform sampler2D texture;","varying mediump vec2 uv;","varying lowp vec4 color;","void main(void) {","    lowp vec4 tex = texture2D(texture, uv);","    if (tex.a < 0.5) {","       discard;","    }","    else {","       gl_FragColor = vec4(vec3(tex.a), 1.);","    }","}"].join("\n")}function f(a,b){var c=new window.XMLHttpRequest;c.onreadystatechange=function(){if(4===c.readyState&&200===c.status)b(c.responseText);else if(404===c.status)throw new Error("Failed to read shader file: "+a)},c.open("GET",a,!0),c.send()}function g(a,b,c){var d=h(c,"vertex"),e=h(c,"fragment"),f=b.file;b.file=void 0,b.vertexSource=d,b.fragmentSource=e;var g=a.createShader(b);void 0!==b.onCreated&&b.onCreated(g,f)}function h(a,b){function c(a,b,c,d){void 0===c&&(c=0),void 0===d&&(d=a.length);for(var e=0,f=a.indexOf(b,c);-1!=f&&f<d;)e++,f=a.indexOf(b,f+1);return e}function d(a,b){for(var c="",d=0;d<b;d++)c+=a;return c}var e,f,g="(^|\\n)\\s*\\["+b+"\\]((\\n|.)*?)(\\n\\s*\\[|$)",h=new RegExp(g);if(null!==(e=h.exec(a))){var i=e[2],j=a.indexOf(i),k=c(a,"\n",0,j),l=c(a,"\n",j+i.length);f=d("\n",k),f+=i,f+=d("\n",l)}return f}var i=a("./mesh"),j=a("./shader"),k=a("./texture"),l=a("./fbo"),m=a("../../math/mat4");e.prototype.setVirtualSize=function(a,b){this.virtualWidth=a,this.virtualHeight=b,this.calculateCamera(this.screenCameraView,this.screenCameraProjection,this.virtualWidth,this.virtualHeight)},e.prototype.setRenderBufferSize=function(a,b){this.renderWidth=a,this.renderHeight=b,this.gl.viewport(0,0,a,b),this.currentViewport.width=a,this.currentViewport.height=b},e.prototype.deleteShader=function(a){a.release(this.gl)},e.prototype.createShader=function(a){return void 0===a.vertexSource&&(a.vertexSource=this._defaultVsSource),void 0===a.fragmentSource&&(a.fragmentSource=this._defaultFsSource),new j(this.gl,a)},e.prototype.createShaderFromFile=function(a){if(void 0===a.file)throw new Error("createShaderFromFile: no file specified");f(a.file,g.bind(null,this,a))},e.prototype.createMesh=function(a){return new i(this.gl,a)},e.prototype.createTexture=function(a){return new k(this.gl,a)},e.prototype.createFBO=function(a){return a.texture=new k(this.gl,{width:a.width,height:a.height}),new l(this.gl,a)},e.prototype.calculateCamera=function(a,b,c,d){var e=this.fieldOfView*Math.PI/180,f=.5*d/Math.tan(.5*e);m.perspective(b,e,c/d,.05*f,5*f),m.identity(a),m.translate(a,.5*-c,.5*d,-f),a[5]=-1,this.cameraMatricesDirty=!0},e.prototype.bindScreen=function(){var a=this.gl;a.bindFramebuffer(a.FRAMEBUFFER,null),a.viewport(0,0,this.renderWidth,this.renderHeight),this.currentViewport.width=this.renderWidth,this.currentViewport.height=this.renderHeight},e.prototype.setBlendMode=function(a){if(a!==this.currentBlendMode){var b=this.gl;this.currentBlendMode=a,this.currentBlendMode===e.BlendMode.Alpha?(b.blendFunc(b.ONE,b.ONE_MINUS_SRC_ALPHA),b.enable(b.BLEND)):this.currentBlendMode===e.BlendMode.Additive?(b.blendFunc(b.ONE,b.ONE),b.enable(b.BLEND)):this.currentBlendMode===e.BlendMode.Solid?b.disable(b.BLEND):this.currentBlendMode===e.BlendMode.Multiply&&(b.blendFunc(b.DST_COLOR,b.ONE_MINUS_SRC_ALPHA),b.enable(b.BLEND))}},e.prototype.setDepthTest=function(a){if(a!==this.currentDepthTestState){var b=this.gl;a?b.enable(b.DEPTH_TEST):b.disable(b.DEPTH_TEST),this.currentDepthTestState=a}},e.prototype.setStencilTest=function(a){if(a!==this.currentStencilTestState){var b=this.gl;a?b.enable(b.STENCIL_TEST):b.disable(b.STENCIL_TEST),this.currentStencilTestState=a}},e.prototype.setScissorTest=function(a,b){var c=this.gl;if(this.currentScissorTestState!==a&&(a?c.enable(c.SCISSOR_TEST):c.disable(c.SCISSOR_TEST),this.currentScissorTestState=a),a){var d=this.currentViewport.width/this.virtualWidth,e=this.currentViewport.height/this.virtualHeight;0!==this.currentRenderTarget&&(d=1,e=1);var f=Math.ceil(b[0]*d),g=Math.ceil(this.currentViewport.height-b[3]*e),h=Math.ceil((b[2]-b[0])*d),i=Math.ceil((b[3]-b[1])*e);h=Math.max(0,h),i=Math.max(0,i),c.scissor(f,g,h,i)}},e.prototype.getMaxVaryingVectors=function(){return this.gl.getParameter(this.gl.MAX_VARYING_VECTORS)},e.prototype.clearScreen=function(){this.gl.clear(this.gl.COLOR_BUFFER_BIT|this.gl.DEPTH_BUFFER_BIT|this.gl.STENCIL_BUFFER_BIT)},e.prototype.bindFbo=function(a){var b=this.gl;b.bindFramebuffer(b.FRAMEBUFFER,a.fbo),b.viewport(0,0,a.width,a.height),this.currentViewport.width=a.width,this.currentViewport.height=a.height},e.prototype.bindRenderTarget=function(a){a!==this.currentRenderTarget&&(this.currentRenderTarget=a,0===this.currentRenderTarget||null===this.currentRenderTarget?(this.bindScreen(),this.currentViewMatrix=this.screenCameraView,this.currentProjectionMatrix=this.screenCameraProjection,this.cameraMatricesDirty=!0):(this.bindFbo(this.currentRenderTarget.fbo),this.currentViewMatrix=this.currentRenderTarget.cameraView,this.currentProjectionMatrix=this.currentRenderTarget.cameraProjection,this.cameraMatricesDirty=!0)),this.setScissorTest(!1),this.setMaskRendering(!1),this.gl.stencilMask(255),this.clearScreen()},e.prototype.bindTexture=function(a,b){this.activeTexture!==a&&(this.activeTexture=a,this.gl.activeTexture(this.gl.TEXTURE0+a)),this.gl.bindTexture(b.target,b.handle)},e.prototype.bindShader=function(a,b){var c=this.gl;if(this.currentShader!==a&&(this.currentShader=a,this.currentBoundMesh=null,c.useProgram(this.currentShader.program),d(a.standardUniforms.texture)&&c.uniform1i(a.standardUniforms.texture,0),this.cameraMatricesDirty=!0,a.hasDirtyUniforms=!0),b!==this.currentUniformValues&&(this.currentUniformValues=b,a.hasDirtyUniforms=!0),this.currentShader.hasDirtyUniforms){for(var e=1,f=this.currentShader._uniforms,g=0,h=a.uniformNames.length;g<h;g++){var i=a.uniformNames[g],j=f[i],k=j.value;b&&b.hasOwnProperty(i)&&(k=b[i]),d(j.location)&&("float"===j.type||"f"===j.type?c.uniform1f(j.location,k):"vec2"===j.type?c.uniform2f(j.location,k[0],k[1]):"vec3"===j.type?c.uniform3f(j.location,k[0],k[1],k[2]):"vec4"===j.type?c.uniform4f(j.location,k[0],k[1],k[2],k[3]):"sampler2D"===j.type&&k&&(this.bindTexture(e,k),c.uniform1i(j.location,e),e++))}a.hasDirtyUniforms=!1}this.cameraMatricesDirty&&(d(a.standardUniforms.u_projection)&&c.uniformMatrix4fv(a.standardUniforms.u_projection,!1,this.currentProjectionMatrix),d(a.standardUniforms.u_view)&&c.uniformMatrix4fv(a.standardUniforms.u_view,!1,this.currentViewMatrix),this.cameraMatricesDirty=!1)},e.prototype.bindMesh=function(a){this.currentBoundMesh!==a&&(a.bind(this.currentShader.attributes,this.currentShader.numComponentsPerVertex),this.currentBoundMesh=a)},e.prototype.beginFrame=function(){
var a=this.gl;a.stencilMask(255),a.clear(a.STENCIL_BUFFER_BIT)},e.prototype.setMaskRendering=function(a,b){var c=this.gl;this.setStencilTest(!0),a?(!1===this.maskRenderingEnabled&&(c.colorMask(!1,!1,!1,!1),c.depthMask(!1),c.stencilFunc(c.NEVER,1,255),this.maskRenderingEnabled=!0),b?c.stencilOp(c.INCR,c.INCR,c.INCR):c.stencilOp(c.DECR,c.DECR,c.DECR)):!0===this.maskRenderingEnabled&&(c.colorMask(!0,!0,!0,!0),c.depthMask(!0),c.stencilFunc(c.LEQUAL,128,255),c.stencilOp(c.KEEP,c.KEEP,c.KEEP),this.maskRenderingEnabled=!1)},e.prototype.executeRenderCommand=function(a){var b=this.gl;this.setBlendMode(a.blendMode),this.setDepthTest(a.depthTest),this.setMaskRendering(a.writeToStencil,a.maskIsPositive),this.setScissorTest(a.scissorTest,a.scissorRect),this.bindShader(a.shader,a.shaderUniforms),this.bindTexture(0,a.texture);var c=this.currentShader.standardUniforms.u_world;d(c)&&(a.worldTransform?b.uniformMatrix4fv(c,!1,a.worldTransform):b.uniformMatrix4fv(c,!1,this.identityMatrix));var e=this.currentShader.standardUniforms.u_opacity;d(e)&&b.uniform1f(e,a.opacity);var f=this.currentShader.standardUniforms.u_color;d(f)&&b.uniform3f(f,a.color[0],a.color[1],a.color[2]);var g=this.currentShader.standardUniforms.u_srcRect;d(g)&&b.uniform4f(g,a.srcRect[0],a.srcRect[1],a.srcRect[2],a.srcRect[3]);var h=this.currentShader.standardUniforms.u_flipTexCoordY;d(h)&&b.uniform1f(h,a.flipTexCoordY),this.bindMesh(a.mesh),-1===a.vertexIndex?a.mesh.draw():a.mesh.drawVertexRange(a.vertexIndex,a.numVertices?a.numVertices:4)},e.prototype.whiteTexture=function(){return null===this._whiteTexture&&(this._whiteTexture=this.createTexture({pixels:new Uint8Array([255,255,255,255]),width:1,height:1})),this._whiteTexture},e.prototype.setFieldOfView=function(a){this.fieldOfView=a,this.calculateCamera(this.screenCameraView,this.screenCameraProjection,this.virtualWidth,this.virtualHeight)},e.BlendMode={Alpha:0,Solid:1,Additive:2,Multiply:3},b.exports=e},{"../../math/mat4":195,"./fbo":206,"./mesh":208,"./shader":211,"./texture":213}],216:[function(a,b,c){"use strict";function d(a){a=a||{},this.cache={},this.activeReferences={},this.freelist={},this.freelistKeys=[],this.freelistMaxLength=a.freelistSize||0,this.disposeCallback=a.disposeCallback}d.prototype.isInCache=function(a){return this.cache.hasOwnProperty(a)||this.freelist.hasOwnProperty(a)},d.prototype.addResource=function(a,b){this.cache[a]={resource:b,refCount:0}},d.prototype._decreaseRefCount=function(a){var b=this.cache[a];if(0===--b.refCount){if(this.freelistMaxLength>0){if(this.freelistKeys.length===this.freelistMaxLength){var c=this.freelistKeys.shift();this._dispose(this.freelist[c]),delete this.freelist[c]}this.freelistKeys.push(a),this.freelist[a]=b.resource}else this._dispose(b.resource);delete this.cache[a]}},d.prototype.removeReference=function(a){if(!1!==this.activeReferences.hasOwnProperty(a)){var b=this.activeReferences[a];this._decreaseRefCount(b),delete this.activeReferences[a]}},d.prototype.updateReference=function(a,b){if(this.activeReferences[a]!==b){var c=this.activeReferences[a];if(this.freelist.hasOwnProperty(b)){this.cache[b]={resource:this.freelist[b],refCount:0},delete this.freelist[b];var d=this.freelistKeys.indexOf(b);this.freelistKeys.splice(d,1)}this.activeReferences[a]=b,this.cache[b].refCount++,c&&this._decreaseRefCount(c)}},d.prototype.getResource=function(a){return this.cache[a].resource},d.prototype.clear=function(){var a;for(a in this.cache)this._dispose(this.cache[a].resource);for(a in this.freelist)this._dispose(this.freelist[a]);this.cache={},this.freelist={},this.freelistKeys=[],this.activeReferences={}},d.prototype._dispose=function(a){this.disposeCallback?this.disposeCallback(a):a.dispose&&a.dispose()},b.exports=d},{}],217:[function(a,b,c){"use strict";function d(){}function e(a){this.axis=a.axis||0,this.track=!a.hasOwnProperty("track")||a.track,this.threshold=a.threshold,this.onDragStart=a.onDragStart||d,this.onDrag=a.onDrag||d,this.onDragEnd=a.onDragEnd||d,this._startPosition=0,this._touchPosition=0,this._hasPressedDown=!1,this._isDragging=!1,this._velocity=0,this._deltaPosition=0}e.prototype=Object.create(e.prototype,{velocity:{get:function(){return this._velocity}},dragDistance:{get:function(){return this._touchPosition-this._startPosition}},dragDelta:{get:function(){return this._deltaPosition}}}),e.prototype.onTouch=function(a){if(a.isDown)this._touchPosition=a.pos[this.axis],this._hasPressedDown=!0,this._velocity=0,this._deltaPosition=0,this._startPosition=this._touchPosition;else if(a.isMove&&this._hasPressedDown){var b=a.pos[this.axis];if(!1===this._isDragging?Math.abs(b-this._touchPosition)>this.threshold&&(this._isDragging=!0,this._startPosition=b,this._touchPosition=b,this.onDragStart()):(a.deltaTime>0&&(this._velocity=(b-this._touchPosition)/a.deltaTime),this._touchPosition=b,this._deltaPosition=a.delta[this.axis],this.onDrag()),this._isDragging&&this.track)return"StartTracking"}else(a.isUp||a.isExit)&&this._isDragging&&(this._isDragging=!1,this._hasPressedDown=!1,this._deltaPosition=0,this.onDragEnd())},b.exports=e},{}],218:[function(a,b,c){"use strict";function d(a,b,c,d,e){var f=1-e;return f*f*f*a+3*f*f*e*b+3*f*e*e*c+e*e*e*d}function e(a,b){this.axis=b.axis,this.scrollCallback=b.scrollCallback,this.scrollThreshold=b.scrollThreshold,this.shouldRubber=void 0===b.shouldRubber||b.shouldRubber,this.scrollSpeed=void 0!==b.scrollSpeed?b.scrollSpeed:1,this.scrollEndedAnimationDuration=b.scrollEndedAnimationDuration||300,this.scrollEndedPositionCallback=b.scrollEndedPositionCallback,this.trackId=-1,this.animation=null,this.speed=0,this.timerScheduler=a,this.scrollObjectSize=1,this.scrollViewSize=1,this.rubberLength=4}e.prototype.onTouch=function(a,b){if(-1===this.trackId||b.id===this.trackId){var c=0,e=this.axis,f=!0;if(b.isDown||b.isEnter)this.hasMoved=!1,this.downStartPos=b.pos[e],this.animation&&this.animation.stop(),this.speed=0;else if(b.isMove&&(this.hasMoved||Math.abs(b.pos[e]-this.downStartPos)>this.scrollThreshold)){this.hasMoved=!0;var g=0,h=a+b.delta[e],i=Math.min(0,-this.scrollObjectSize+this.scrollViewSize);if(h>0?g=h:h<i&&(g=i-h),g>0&&this.shouldRubber){var j=Math.max(0,1-g/this.scrollViewSize*this.rubberLength);c=b.delta[e]*j}else h>0?(c=-a,!1===this.shouldRubber&&(f=!1)):h<i?(c=i-a,!1===this.shouldRubber&&(f=!1)):c=b.delta[e];b.deltaTime>0&&(this.speed=b.delta[this.axis]/b.deltaTime),0!==c&&(a+=c,this.scrollCallback(a,c))}else if((b.isUp||b.isExit)&&!0===this.hasMoved){this.hasMoved=!1;var k=this.scrollEndedAnimationDuration,l=a+this.speed*k/3,m=a+this.speed*k/3,n=Math.min(0,this.scrollViewSize-this.scrollObjectSize);l>0?(l=0,m=0):l<n&&(l=n,m=l),l=this.scrollEndedPositionCallback(this.speed,l),!1===this.shouldRubber&&(m=l);var o=this.scrollCallback,p=this.onScrollEnded;this.animation=this.timerScheduler.createTimer({duration:k,p0:a,p1:m,p2:l,p3:l,onRunning:function(a){o(d(this.p0,this.p1,this.p2,this.p3,a))},onFinish:function(){p&&p()}}).start()}if(this.hasMoved&&f)return this.trackId=b.id,"StartTracking";this.trackId=-1}},e.prototype.setOrientation=function(a){this.axis="horizontal"===a?0:1},b.exports=e},{}],219:[function(a,b,c){"use strict";function d(a,b){this.scrollThreshold=a,this.startPos=[0,0],this.hasReceivedDownEvent=!1,this.callback=b}d.prototype.onTouch=function(a,b){if(b.isDown)this.startPos[0]=b.pos[0],this.startPos[1]=b.pos[1],this.hasReceivedDownEvent=!0;else if(b.isMove)(Math.abs(b.pos[0]-this.startPos[0])>this.scrollThreshold||Math.abs(b.pos[1]-this.startPos[1])>this.scrollThreshold)&&(this.hasReceivedDownEvent=!1);else if(b.isUp&&!0===this.hasReceivedDownEvent)return this.callback(a,b),this.hasReceivedDownEvent=!1,"StopPropagation"},b.exports=d},{}],220:[function(a,b,c){"use strict";function d(){this.trackedControls=[],this.lastTouch=[],this.prevIntersectedControlsDepthLayers={},this.hoverState={prevIntersectedControlsDepthLayers:{},lastHover:{}},this.depthIndices=[],this.numDepthIndices=0,this.focusedControl=null}function e(a,b){return a-b}function f(a){for(var b=0,c=a.length;b<c;++b)null!==a[b].onTouch&&a[b].onTouch(s)}function g(a){for(var b=0,c=a.length;b<c;++b)null!==a[b].onHover&&a[b].onHover(u)}function h(a,b){return q.intersects(a.childAABB||a.screenAABB,b)}function i(a,b){return q.intersects(a.screenAABB,b)}function j(a,b){return q.isPointInside(a.childAABB||a.screenAABB,b)}function k(a,b){return q.isPointInside(a.screenAABB,b)}function l(a,b,c,d){if(d=void 0===a.depth?d:a.depth,a.touchPropagation&&a.visible&&a.opacity>0&&j(a,b.pos)){(a.onTouch||a.blockTouch)&&k(a,b.pos)&&(a.blockTouch&&(c[d]=[],v=Math.max(v,d)),a.onTouch&&(void 0===c[d]&&(c[d]=[]),c[d].push(a)));var e=a.children;if(e)for(var f=0,g=e.length;f<g;f++)l(e[f],b,c,d)}}function m(a,b,c,d){if(d=void 0===a.depth?d:a.depth,a.touchPropagation&&a.visible&&a.opacity>0&&j(a,b.pos)){(a.onHover||a.blockTouch)&&k(a,b.pos)&&(a.blockTouch&&(c[d]=[],v=Math.max(v,d)),a.onHover&&(void 0===c[d]&&(c[d]=[a]),c[d].push(a)));var e=a.children;if(e)for(var f=0,g=e.length;f<g;f++)m(e[f],b,c,d)}}function n(a,b,c,d){if(d=void 0===a.depth?d:a.depth,a.touchPropagation&&a.visible&&a.opacity>0&&h(a,b)){(a.onTouch||a.blockTouch)&&i(a,b)&&(void 0===c[d]&&(c[d]=[]),c[d].push(a));var e=a.children;if(e)for(var f=0,g=e.length;f<g;f++)n(e[f],b,c,d)}}function o(a,b,c,d){if(d=void 0===a.depth?d:a.depth,a.touchPropagation&&a.visible&&a.opacity>0&&j(a,b)){(a.onTouch||a.blockTouch)&&k(a,b)&&(void 0===c[d]&&(c[d]=[]),c[d].push(a));var e=a.children;if(e)for(var f=0,g=e.length;f<g;f++)o(e[f],b,c,d)}}function p(){return{pos:[0,0],delta:[0,0],deltaTime:0,type:"isMove",isMove:!1,isUp:!1,isDown:!1,isEnter:!1,isExit:!1,id:0}}var q=a("../math/aabb"),r=p();r.type="isEnter",r.isEnter=!0;var s=p();s.type="isExit",s.isExit=!0;var t=p();t.type="isHoverEnter",t.isHoverEnter=!0;var u=p();u.type="isHoverExit",u.isHoverExit=!0,d.prototype.processTouchEvent=function(a,b){var c=b.id,d=this.lastTouch[c];d||(this.lastTouch[c]={pos:[0,0],time:0},d=this.lastTouch[c]),b.isMove&&(b.delta[0]=b.pos[0]-d.pos[0],b.delta[1]=b.pos[1]-d.pos[1],b.deltaTime=b.time-d.time),d.time=b.time,d.pos[0]=b.pos[0],d.pos[1]=b.pos[1];var g={0:[]};this.trackedControls[b.id]?g[0].push(this.trackedControls[b.id]):(v=-1e7,l(a,b,g,void 0===a.depth?0:a.depth)),r.id=b.id,r.pos[0]=b.pos[0],r.pos[1]=b.pos[1],r.delta[0]=b.delta[0],r.delta[1]=b.delta[1],r.deltaTime=b.deltaTime,r.force=b.force,r.domEvent=b.domEvent,s.id=b.id,s.pos[0]=b.pos[0],s.pos[1]=b.pos[1],s.delta[0]=b.delta[0],s.delta[1]=b.delta[1],s.deltaTime=b.deltaTime,s.force=0,s.domEvent=b.domEvent;var h,i,j,k,m,n,o=!0;this.numDepthIndices=0;for(n in g)n>=v&&(this.depthIndices[this.numDepthIndices++]=n);for(this.depthIndices.length=this.numDepthIndices,this.depthIndices.sort(e),k=this.numDepthIndices-1;k>=0&&o;--k)for(j=this.depthIndices[k],m=g[j],h=m.length-1;h>=0;--h){var p=m[h],q=!1;for(i in this.prevIntersectedControlsDepthLayers){var t=this.prevIntersectedControlsDepthLayers[i].indexOf(p);if(-1!==t){q=!0,this.prevIntersectedControlsDepthLayers[i].splice(t,1);break}}!1===q&&(p.onTouch(r),this.focusedControl&&p!==this.focusedControl&&(this.focusedControl.blur(),this.focusedControl=null));var u=p.onTouch(b);if("StartTracking"===u){this.trackedControls[b.id]=p,o=!1;break}if(this.trackedControls[b.id]=null,"StopPropagation"===u){o=!1;break}void 0!==u&&console.log("unknown return value from from onTouch "+u)}if(b.isUp){for(k=this.numDepthIndices-1;k>=0;--k)j=this.depthIndices[k],m=g[j],f(m);this.prevIntersectedControlsDepthLayers={}}else{this.numDepthIndices=0;for(n in this.prevIntersectedControlsDepthLayers)this.depthIndices[this.numDepthIndices++]=n;for(this.depthIndices.length=this.numDepthIndices,this.depthIndices.sort(e),k=this.numDepthIndices-1;k>=0;--k)j=this.depthIndices[k],m=this.prevIntersectedControlsDepthLayers[j],f(m);this.prevIntersectedControlsDepthLayers=g}},d.prototype.processHoverEvent=function(a,b){var c=(b.id,{0:[]});v=-1e7,m(a,b,c,void 0===a.depth?0:a.depth),t.id=b.id,t.pos[0]=b.pos[0],t.pos[1]=b.pos[1],t.delta[0]=b.delta[0],t.delta[1]=b.delta[1],t.deltaTime=b.deltaTime,t.domEvent=b.domEvent,u.id=b.id,u.pos[0]=b.pos[0],u.pos[1]=b.pos[1],u.delta[0]=b.delta[0],u.delta[1]=b.delta[1],u.deltaTime=b.deltaTime,u.domEvent=b.domEvent;var d,f,h,i,j,k,l=!0;this.numDepthIndices=0;for(k in c)k>=v&&(this.depthIndices[this.numDepthIndices++]=k);for(this.depthIndices.length=this.numDepthIndices,this.depthIndices.sort(e),i=this.numDepthIndices-1;i>=0&&l;--i)for(h=this.depthIndices[i],j=c[h],d=j.length-1;d>=0;--d){var n=j[d],o=!1;for(f in this.hoverState.prevIntersectedControlsDepthLayers){var p=this.hoverState.prevIntersectedControlsDepthLayers[f].indexOf(n);if(-1!==p){o=!0,this.hoverState.prevIntersectedControlsDepthLayers[f].splice(p,1);break}}!1===o&&n.onHover(t);var q=n.onHover(b);if("StopPropagation"===q){l=!1;break}void 0!==q&&console.log("unknown return value from from onhoverEvent "+q)}this.numDepthIndices=0;for(k in this.hoverState.prevIntersectedControlsDepthLayers)this.depthIndices[this.numDepthIndices++]=k;for(this.depthIndices.length=this.numDepthIndices,this.depthIndices.sort(e),i=this.numDepthIndices-1;i>=0;--i)h=this.depthIndices[i],j=this.hoverState.prevIntersectedControlsDepthLayers[h],g(j);this.hoverState.prevIntersectedControlsDepthLayers=c},d.prototype.handleTouchEvent=function(a,b){var c=p();c.pos[0]=b.x,c.pos[1]=b.y,c.delta[0]=0,c.delta[1]=0,c.time=b.timestamp,c[c.type]=!1,c.type=b.type,c[b.type]=!0,c.id=b.id,c.force=b.force,c.domEvent=b.domEvent,this.processTouchEvent(a,c)},d.prototype.handleHoverEvent=function(a,b){var c=p();c.pos[0]=b.x,c.pos[1]=b.y,c.delta[0]=0,c.delta[1]=0,c.time=b.timestamp,c[c.type]=!1,c.type=b.type,c[b.type]=!0,c.id=b.id,c.force=0,c.domEvent=b.domEvent,this.processHoverEvent(a,c)},d.prototype.setFocus=function(a){if(!a.blur)return void console.error("Can't set focus on a control that can't be blurred");this.focusedControl=a};var v;d.prototype.hitTestBox=function(a,b){var c={};return n(a,b,c,0),c},d.prototype.hitTest=function(a,b){var c={};return o(a,b,c,0),c},b.exports=d},{"../math/aabb":193}],221:[function(a,b,c){"use strict";function d(){e.call(this),this.mouseDown=!1,this.lastTouch=[],this.lastMouseMove=void 0;var a=this;this.onMouseMove=function(b){if(a.lastMouseMove=b,a.isTouchIntercepted())return b.preventDefault(),void(a.interceptMouseMove&&a.interceptMouseMove(b));!0===a.mouseDown&&a.emitEvent(0,a.getTouchX(b),a.getTouchY(b),0,b.timeStamp,"isMove",b),a.emitHoverEvent(0,a.getTouchX(b),a.getTouchY(b),b.timeStamp,"isHoverMove",b)},this.onUnhandledInputEvent=function(b){if(a.isTouchIntercepted())return void b.preventDefault();a.emitUnhandledEvent(0,a.getTouchX(b),a.getTouchY(b),b.force,b.timeStamp,"unhandled",b)},this.onTouchMove=function(b){if(a.isTouchIntercepted())return void b.preventDefault();a.onTouchEvent(b,"isMove")},this.onTouchLeave=function(b){if(a.isTouchIntercepted())return void b.preventDefault();var c=a.getTouchX(b),d=a.getTouchY(b);a.mouseDown&&b.target===a.domElement&&(c<0||c>1||d<0||d>1)&&(a.mouseDown=!1,a.emitEvent(0,c,d,b.force,b.timeStamp,"isUp",b))},this.onTouchEnd=function(b){if(a.isTouchIntercepted())return void b.preventDefault();a.onTouchEvent(b,"isUp")},this.onMouseUp=function(b){if(a.isTouchIntercepted())return a.interceptMouseUp&&a.interceptMouseUp(b),void b.preventDefault();0===b.button&&(a.mouseDown=!1,a.emitEvent(0,a.getTouchX(b),a.getTouchY(b),b.force,b.timeStamp,"isUp",b))},this.onMouseOut=function(b){if(a.isTouchIntercepted())return void b.preventDefault();var c=a.getTouchX(b),d=a.getTouchY(b);a.mouseDown&&b.target===a.domElement&&(c<0||c>1||d<0||d>1)&&(a.mouseDown=!1,a.emitEvent(0,c,d,b.force,b.timeStamp,"isUp",b)),a.emitHoverEvent(0,c,d,b.timeStamp,"isHoverMove",b)},this.onTouchStart=function(b){if(a.isTouchIntercepted())return void b.preventDefault();a.onTouchEvent(b,"isDown")},this.onMouseDown=function(b){if(a.isTouchIntercepted())return b.preventDefault(),void(a.interceptMouseDown&&a.interceptMouseDown(b));0===b.button?(a.mouseDown=!0,a.emitEvent(0,a.getTouchX(b),a.getTouchY(b),b.force,b.timeStamp,"isDown",b)):2===b.button&&a.emit("rightButtonClick",{id:2,x:a.getTouchX(b),y:a.getTouchY(b),force:b.force,timestamp:b.timestamp,type:"isDown",domEvent:b})}}var e=a("../../eventsender");d.prototype=Object.create(e.prototype),d.prototype.setDOMElement=function(a){this.setTouchEnabled(!1),this.domElement=a,this.setTouchEnabled(!0),this.clientRect=a.getBoundingClientRect()},d.prototype.setTouchEnabled=function(a){var b=this.domElement;b&&(a?(b.addEventListener("click",this.onUnhandledInputEvent,!0),b.addEventListener("dblclick",this.onUnhandledInputEvent,!0),b.addEventListener("mouseover",this.onUnhandledInputEvent,!0),b.addEventListener("mouseenter",this.onUnhandledInputEvent,!0),b.addEventListener("mouseleave",this.onUnhandledInputEvent,!0),b.addEventListener("auxclick",this.onUnhandledInputEvent,!0),b.addEventListener("mousemove",this.onMouseMove,!0),b.addEventListener("touchmove",this.onTouchMove,!0),b.addEventListener("touchleave",this.onTouchLeave,!0),b.addEventListener("touchend",this.onTouchEnd,!0),b.addEventListener("mouseup",this.onMouseUp,!0),b.addEventListener("mouseout",this.onMouseOut,!0),b.addEventListener("touchstart",this.onTouchStart,!0),b.addEventListener("mousedown",this.onMouseDown,!0)):(b.removeEventListener("click",this.onUnhandledInputEvent),b.removeEventListener("dblclick",this.onUnhandledInputEvent),b.removeEventListener("mouseover",this.onUnhandledInputEvent),b.removeEventListener("mouseenter",this.onUnhandledInputEvent),b.removeEventListener("mouseleave",this.onUnhandledInputEvent),b.removeEventListener("auxclick",this.onUnhandledInputEvent),b.removeEventListener("mousemove",this.onMouseMove),b.removeEventListener("touchmove",this.onTouchMove),b.removeEventListener("touchleave",this.onTouchLeave),b.removeEventListener("touchend",this.onTouchEnd),b.removeEventListener("mouseup",this.onMouseUp),b.removeEventListener("mouseout",this.onMouseOut),b.removeEventListener("touchstart",this.onTouchStart),b.removeEventListener("mousedown",this.onMouseDown)))},d.prototype.setTouchInterceptCallbacks=function(a,b,c){this.interceptMouseMove=a,this.interceptMouseDown=b,this.interceptMouseUp=c},d.prototype.isTouchIntercepted=function(){return this.interceptMouseMove||this.interceptMouseDown||this.interceptMouseUp},d.prototype.onTouchEvent=function(a,b){for(var c=0;c<a.changedTouches.length;++c){var d=a.changedTouches[c];this.emitEvent(d.identifier,this.getTouchX(d),this.getTouchY(d),d.force,a.timeStamp,b,a)}},d.prototype.emitUnhandledEvent=function(a,b,c,d,e,f,g){this.emit("unhandledInputEvent",{id:a,x:b,y:c,force:d,timestamp:e,type:f,domEvent:g})},d.prototype.emitEvent=function(a,b,c,d,e,f,g){this.emit("touchEvent",{id:a,x:b,y:c,force:d,timestamp:e,type:f,domEvent:g})},d.prototype.emitHoverEvent=function(a,b,c,d,e,f){this.emit("hoverEvent",{id:a,x:b,y:c,timestamp:d,type:e,domEvent:f})},d.prototype.getTouchX=function(a){var b=this.clientRect,c=b.right-b.left;return(a.pageX-b.left)/c},d.prototype.getTouchY=function(a){var b=this.clientRect,c=b.bottom-b.top;return(a.pageY-b.top)/c},b.exports=d},{"../../eventsender":71}],222:[function(a,b,c){"use strict";function d(a,b){i.call(this),this.timerScheduler=a,this.eventSender=new i,this.layouter=new f,this.imageCache=new x,this.renderer=new e(b);var c=this;this.renderer.on("shaderError",function(a){c.emit("shaderError",a)},this),this.renderer.on("requestFrame",function(){c.eventSender.emit("requestFrame")},this),this.touchEnabled=!0,this.root=this.createDockLayoutControl(),this.root.setSizeMode("explicit"),this.root.setWidthUnit("px"),this.root.setHeightUnit("px"),this.touchEngine=new g,this.touchListener=new h,this.touchListener.on("unhandledInputEvent",this.handleAuxillaryEvent.bind(this),this),this.touchListener.on("rightButtonClick",this.handleRightButtonClick.bind(this),this),this.touchListener.on("touchEvent",this.handleTouchEvent.bind(this),this),this.touchListener.on("hoverEvent",this.handleHoverEvent.bind(this),this),this.fillMode="aspectFit",this.setAspectFitViewport(1080,1920),this.root.setContentDirty=function(a){l.prototype.setContentDirty(a),a&&c.eventSender.emit("requestFrame")},window.addEventListener("resize",function(){c._resizeViewport(),c.eventSender.emit("requestFrame")})}var e=a("./renderer"),f=a("./layout/layouter"),g=a("./touch/touchengine"),h=a("./touch/touchlistener"),i=a("../eventsender"),j=(a("./math/aabb"),a("./controls/effectcontrol")),k=a("./controls/circlecontrol"),l=a("./controls/docklayoutcontrol"),m=a("./controls/flowlayoutcontrol"),n=a("./controls/imagecontrol"),o=a("./controls/rectanglecontrol"),p=a("./controls/htmlcontrol"),q=a("./controls/scrollviewcontrol"),r=a("./controls/stacklayoutcontrol"),s=a("./controls/textcontrol"),t=a("./controls/textinputcontrol"),u=a("./controls/meshcontrol"),v=a("./touch/taphandler"),w=a("./touch/draggesturerecognizer"),x=a("./imagecache");d.prototype=Object.create(i.prototype),d.prototype.constructor=d,d.prototype._addListenersToControl=function(a){a.on("disposed",this.renderer.onControlDisposed.bind(this.renderer))},d.prototype.createCircleControl=function(){var a=new k(this.layouter,this.imageCache);return this._addListenersToControl(a),a},d.prototype.createDockLayoutControl=function(){return new l(this.layouter)},d.prototype.createFlowLayoutControl=function(){return new m(this.layouter)},d.prototype.createEffectControl=function(){var a=new j(this.layouter,this.imageCache);return this._addListenersToControl(a),a},d.prototype.createImageControl=function(){var a=new n(this.layouter,this.imageCache);return this._addListenersToControl(a.innerControl),a},d.prototype.createRectangleControl=function(){var a=new o(this.layouter);return this._addListenersToControl(a),a},d.prototype.createDOMElement=function(a,b,c,d){return this.renderer.domCache.createElement("html",c,d,b)},d.prototype.createHtmlControl=function(){return new p(this.layouter)},d.prototype.createScrollViewControl=function(){return new q(this.layouter,this.timerScheduler)},d.prototype.createStackLayoutControl=function(){return new r(this.layouter)},d.prototype.createTextControl=function(){var a=new s(this.layouter);return this._addListenersToControl(a.innerControl),a},d.prototype.createTextInputControl=function(){var a=new t(this.layouter);this._addListenersToControl(a);var b=this.renderer.domCache.createElement("textInput",a.id,!0,"input");return b&&a.setInputField(b),a.on("focused",this.touchEngine.setFocus.bind(this.touchEngine)),a},d.prototype.createMeshControl=function(){var a=new u(this.layouter,this.imageCache);return this._addListenersToControl(a),a},d.prototype.createTapHandler=function(a){return new v(50,a)},d.prototype.createDragGestureRecognizer=function(a){return new w(a)},d.prototype.setAspectFitViewport=function(a,b){this.aspectFillViewportSize={width:a,height:b},this._resizeViewport()},d.prototype.getUIScale=function(){var a=this.renderer.rootElement.getBoundingClientRect(),b=this.layouter.windowSize.width,c=this.layouter.windowSize.height,d=b/c,e=a.width/a.height;return(e>d?a.height*d:a.width)/b},d.prototype._resizeViewport=function(){var a,b;if("aspectFit"===this.fillMode)a=this.aspectFillViewportSize.width,b=this.aspectFillViewportSize.height;else{var c=this.renderer.rootElement.getBoundingClientRect();a=c.width,b=c.height}this._setViewportSize(a,b)},d.prototype._setViewportSize=function(a,b){this.renderer.setViewportSize(a,b),this.layouter.setWindowSize(a,b),this.root.setWidth(a),this.root.setHeight(b),this.root.screenAABB.max[0]=a,this.root.screenAABB.max[1]=b,this.root.childAABB.max[0]=a,this.root.childAABB.max[1]=b,this.emit("viewportSizeChanged",{width:a,height:b})},d.prototype.layout=function(){if(this.layouter.layout(this.root),this.root.contentDirty){this.renderer.beginLayout();for(var a=0;a<this.root.children.length;a++)this.renderer.layout(this.root.children[a],!1)}},d.prototype.renderFrame=function(){this.renderer.beginFrame(),this.renderer.render(this.root),this.renderer.endFrame(),this.renderer.rootElement!==this.touchListener.domElement&&this.touchListener.setDOMElement(this.renderer.rootElement);var a=this.renderer.renderers;if(a.length>0){var b=a[a.length-1];this.touchListener.clientRect=b.rootElement.getBoundingClientRect()}},d.prototype.setTouchEnabled=function(a){this.touchEnabled=a},d.prototype.setOverlayNode=function(a){this.overlayNode&&this.root.removeChild(this.overlayNode),this.overlayNode=a,a&&this.root.addChild(a)},d.prototype.touchEventOverlapsHTMLControl=function(a){var b=this.hitTest(a.x,a.y),c=Object.keys(b);c.sort();for(var d=c.length-1;d>=0;d--){var e=c[d];if(b[e].length>0){var f=b[e];if(f[f.length-1]instanceof p)return!0}}return!1},d.prototype.handleRightButtonClick=function(a){this.touchEnabled&&(a.x*=this.renderer.viewportWidth,a.y*=this.renderer.viewportHeight,a.domEvent.preventDefault(),a.domEvent.stopImmediatePropagation(),this.emit("rightButtonClick",a))},d.prototype.handleAuxillaryEvent=function(a){this.touchEnabled&&(a.x*=this.renderer.viewportWidth,a.y*=this.renderer.viewportHeight,this.touchEventOverlapsHTMLControl(a)||(a.domEvent.preventDefault(),a.domEvent.stopImmediatePropagation()))},d.prototype.handleTouchEvent=function(a){this.touchEnabled&&(a.x*=this.renderer.viewportWidth,a.y*=this.renderer.viewportHeight,this.touchEventOverlapsHTMLControl(a)||(a.domEvent&&(a.domEvent.preventDefault(),a.domEvent.stopImmediatePropagation()),this.emit("touchEvent",a),this.touchEngine.handleTouchEvent(this.root,a)))},d.prototype.handleHoverEvent=function(a){this.touchEnabled&&(a.x*=this.renderer.viewportWidth,a.y*=this.renderer.viewportHeight,this.emit("hoverEvent",a),this.touchEngine.handleHoverEvent(this.root,a))},d.prototype.removeAllRenderers=function(){this.renderer.removeAllRenderers()},d.prototype.setRendererType=function(a,b){this.renderer.setRendererType(a,b)},d.prototype.setFillMode=function(a){this.fillMode=a,this.renderer.setFillMode(a),this._resizeViewport()},d.prototype.hitTestBox=function(a){return this.touchEngine.hitTestBox(this.root,a)},d.prototype.hitTest=function(a,b){return this.touchEngine.hitTest(this.root,[a,b])},d.prototype.captureScreenShot=function(a,b,c){this.renderer.captureScreenShot(this.root,a,b,c)},d.prototype.getViewportSize=function(){return{width:this.renderer.viewportWidth,height:this.renderer.viewportHeight}},d.prototype.clearImageCache=function(){this.imageCache.clear(),this.renderer.clearImageCaches()},b.exports=d},{"../eventsender":71,"./controls/circlecontrol":169,"./controls/docklayoutcontrol":170,"./controls/effectcontrol":171,"./controls/flowlayoutcontrol":172,"./controls/htmlcontrol":173,"./controls/imagecontrol":175,"./controls/meshcontrol":177,"./controls/rectanglecontrol":178,"./controls/scrollviewcontrol":179,"./controls/stacklayoutcontrol":180,"./controls/textcontrol":183,"./controls/textinputcontrol":184,"./imagecache":186,"./layout/layouter":189,"./math/aabb":193,"./renderer":196,"./touch/draggesturerecognizer":217,"./touch/taphandler":219,"./touch/touchengine":220,"./touch/touchlistener":221}],223:[function(a,b,c){"use strict";var d={Windows:function(){return/IEMobile/i.test(navigator.userAgent)},Android:function(){return/Android/i.test(navigator.userAgent)},BlackBerry:function(){return/BlackBerry/i.test(navigator.userAgent)},iOS:function(){return/iPhone|iPad|iPod/i.test(navigator.userAgent)},any:function(){return d.Android()||d.BlackBerry()||d.iOS()||d.Windows()}};b.exports={isMobile:d}},{}]},{},[66])(66)});